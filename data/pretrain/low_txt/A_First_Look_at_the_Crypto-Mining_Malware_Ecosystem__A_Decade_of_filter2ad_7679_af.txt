### Future Work
Finally, it is worth noting that we assume a wallet to be illicit if it is associated with malware. However, not all mining activities may be illicit. For instance, a criminal might start mining from their own PC before or while engaging in illicit mining. Although this scenario is unlikely, we currently lack the technical means to distinguish between these two situations. While some mining could be legitimate, we argue that the revenues generated from such activities ultimately benefit the criminal and can fuel other illicit activities. Therefore, the figures associated with these wallets are relevant to our study.

### Quality of Aggregation
Our methodology groups samples and wallets into campaigns. We primarily use the collected data for this purpose but also gather additional information to measure the magnitude of the problem. Manual verification is employed to ensure the coherence of our heuristics. For known mining botnets (e.g., Photominer, Adylkuzz), we verify that the campaign structure matches reported characteristics. For novel campaigns, we confirm that the aggregation aligns with our heuristic results, as demonstrated in the case studies in §V. We acknowledge that our heuristics are not infallible and can lead to both under- and over-aggregation. To mitigate over-aggregation, we design our heuristics conservatively, such as aggregating based on full URLs rather than domain names to avoid combining campaigns that use common third-party infrastructure like Amazon WS or GitHub.

### Anti-Analysis Techniques
A key challenge to the quality of our ground truth is the ability of malware to evade detection. On one hand, malware employs obfuscation to thwart static analysis, often using packers and crypters, though advanced adversaries may use polymorphic or metamorphic malware. We address this partially by identifying known packers and analyzing binary entropy. On the other hand, malware uses evasion techniques to hinder dynamic analysis. While we are vulnerable to various forms of evasion, such as sandbox detection, we focus on de-anonymizing domain aliases that mask connections to mining pools (c.f., §III-E). Despite our efforts, our study inherits the limitations of both static and dynamic analysis, potentially missing samples from advanced adversaries. To counteract other advanced evasion techniques, such as anti-emulation, bare-metal solutions [7] could be employed.

### Mining-Tailored Solutions
When dealing with adversaries using advanced obfuscation and evasion, tailored solutions are often effective. Since miners have distinct CPU usage patterns, anomaly detection systems can be built to identify crypto-malware. Related works model CPU usage [8] or instrument web browsers to detect suspicious activity [42], [11]. While these approaches are effective for web-based cryptojacking, they are less so for crypto-mining malware because the malware can control the infected computer and evade local defenses. Other works propose monitoring CPU usage from a hypervisor to protect cloud environments [6], but this approach is not applicable to end-users. An alternative is to offload usage monitoring to an external system and analyze energy consumption fingerprints. Power-aware anomaly detection systems have been proposed for smartphone malware [43], [44], but no such solution exists for general-purpose computers. We suggest that electric companies could deploy these solutions to end-users with smart meters.

### Related Work
Illicit mining has been a threat since Bitcoin's emergence in 2009, but it was not widely addressed in academia until recently. The first analysis of crypto-mining malware was published in 2014 by Huang et al. [15], who found that malicious malware mined at least 4.5K bitcoins (worth around $3.2M in 2014). As Bitcoin mining became unprofitable for end-user computers, both cryptocurrency malware and web-based cryptojacking shifted to ASIC-resistant cryptocurrencies like Monero and Bytecoin. Recent works have analyzed web-based mining, both as an alternative to advertisements [13], [12] and as cryptojacking [8], [9], [10]. Konoth et al. [8] analyzed the Top 1M Alexa sites for web-browser cryptojacking, using code analysis and network monitoring. Hong et al. [9] proposed a dynamic analysis method to detect cryptojacking in web content.

To distinguish cryptojacking from benign mining, user consent must be properly identified. Some works search for keywords indicating mining activity [9] or look for AuthedMine scripts requiring explicit user action [8], [11]. In our work, we rely on AV reports and heuristics to classify binaries into malware or goodware.

Previous works often aggregate campaigns based on mining pool identifiers alone [9], [11]. However, criminals use multiple identifiers to continue operations when wallets are banned [17]. Konoth et al. include server information in their aggregation [8], but this requires significant manual effort. Huang et al. use Blockchain data for aggregation [15], which is not feasible for cryptocurrencies that obfuscate transactions (e.g., Monero, Zcash).

The earnings from malicious mining have increased in recent years. Konoth et al. estimated monthly revenues of $188,878 from 1,735 domains, while Hong et al. estimated $1.7M from 2,770 domains. However, these estimates are unreliable due to the need to estimate visitor numbers, time spent, and device types. Our approach, which tracks wallets and payments, provides more accurate earnings data, estimating at least $58 million USD over 4.5 years (more than $1M/month). Table XII summarizes and compares the related works.

### Conclusion
In this paper, we present a longitudinal large-scale measurement study of crypto-mining malware, analyzing samples spanning over a decade. We show that Monero is the preferred currency for criminals, who have obtained massive earnings. This criminal activity is embedded within the underground ecosystem, allowing criminals to externalize operations and evade AV detection. Through static and dynamic analysis, we group samples into campaigns, revealing that some campaigns use third-party infrastructure while others employ simple yet effective evasion mechanisms like domain aliases.

Our profit analysis on Monero shows that a small number of actors dominate the illicit mining business, having mined at least 4.4% of the moneros in circulation, earning up to $56 million USD. The success of this criminal business is due to its low cost and high return on investment. The AV industry has not given it due attention, considering it a lower threat to clients. Our findings complement studies on Bitcoin and web-based cryptojacking, confirming that malicious crypto-mining is a growing and complex threat requiring effective countermeasures. Regular changes in the PoW algorithm may discourage criminals by increasing the cost of acquiring and maintaining botnets. We provide technical details about the ecosystem, discuss open challenges, and release the data of all campaigns to foster further research.

### Acknowledgments
A shorter version of this paper appears in the 2019 ACM Internet Measurement Conference (IMC). We thank our IMC shepherd, Professor Ben Y. Zhao, and the anonymous reviewers for their valuable feedback. Special thanks to VirusTotal for access to its private API, the Cambridge Cybercrime Centre for sharing the CrimeBB dataset, and Palo Alto for sharing data feeds related to cryptomining malware. We also thank Alexander Vetterl and Daniel Thomas for their assistance and feedback.

This work is partially supported by MINECO (grant TIN2016-79095-C2-2-R) and the Comunidad de Madrid (P2018/TCS-4566, co-financed by European Structural Funds ESF and FEDER). The opinions, findings, and conclusions expressed are those of the authors and do not necessarily reflect those of the funders.

### References
[1] C. Beek, T. Dunton, S. Grobman, M. Karlton, N. Minihane, C. Palm, E. Peterson, R. Samani, C. Schmugar, R. Sims, D. Sommer, and B. Sun, “McAfee Threat Report,” June 2018.
[2] Webroot, “Webroot Threat Report: Mid-Year Update,” September 2018. [Online]. Available: https://perma.cc/3M2Z-Q76Y
[3] A. Norton, “Crypto-Malware - A Look at the Latest Malware Threat,” September 2018. [Online]. Available: https://perma.cc/6K3K-E632
[4] D. Liebenberg, C. McFarland, M. Martinez, C. Jerome, F. Gutierrez, A. Giandomenico, T. DeJesus, J. Grunzweig, M. Martinez, A. Brandt, N. Jenkins, and S. Scher, “The Illicit Cryptocurrency Mining Threat,” September 2018. [Online]. Available: https://perma.cc/Z5ZH-H5TG
[5] K. Thomas, D. Yuxing, H. David, W. Elie, B. C. Grier, T. J. Holt, C. Kruegel, D. McCoy, S. Savage, and G. Vigna, “Framing Dependencies Introduced by Underground Commoditization,” in Proceedings of the Workshop on Economics of Information Security (WEIS), Delft, Netherlands, 2015.
[6] R. Tahir, M. Huzaifa, A. Das, M. Ahmad, C. Gunter, F. Zaffar, M. Caesar, and N. Borisov, “Mining on Someone Else’s Dime: Mitigating Covert Mining Operations in Clouds and Enterprises,” in Proceedings of the International Symposium on Research in Attacks, Intrusions, and Defenses (RAID). Cham: Springer International Publishing, 2017, pp. 287–310.
[7] D. Kirat, G. Vigna, and C. Kruegel, “BareCloud: Bare-Metal Analysis-Based Evasive Malware Detection.” in 23rd USENIX Security Symposium. San Diego, CA, USA: USENIX Association, 2014, pp. 287–301.
[8] R. K. Konoth, E. Vineti, V. Moonsamy, M. Lindorfer, C. Kruegel, H. Bos, and G. Vigna, “Minesweeper: An In-Depth Look into Drive-by Cryptocurrency Mining and Its Defense,” in Proceedings of the 25th ACM SIGSAC Conference on Computer and Communications Security (CCS). Toronto, Canada: ACM, 2018, pp. 1714–1730.
[9] G. Hong, Z. Yang, S. Yang, L. Zhang, Y. Nan, Z. Zhang, M. Yang, Y. Zhang, Z. Qian, and H. Duan, “How You Get Shot in the Back: A Systematical Study About Cryptojacking in the Real World,” in Proceedings of the 25th ACM SIGSAC Conference on Computer and Communications Security (CCS). Toronto, Canada: ACM, 2018, pp. 1701–1713.
[10] M. Saad, A. Khormali, and A. Mohaisen, “End-to-End Analysis of In-Browser Cryptojacking,” arXiv preprint arXiv:1809.02152, 2018.
[11] A. Kharraz, Z. Ma, P. Murley, C. Lever, J. Mason, A. Miller, N. Borisov, M. Antonakakis, and M. Bailey, “Outguard: Detecting In-Browser Covert Cryptocurrency Mining in the Wild,” in Proceedings of The Web Conference (WWW). San Francisco, USA: ACM, 2019, pp. 840–852.
[12] J. Rüth, T. Zimmermann, K. Wolsing, and O. Hohlfeld, “Digging into Browser-Based Crypto Mining,” in Proceedings of the 2018 Internet Measurement Conference (IMC’18). Boston, MA, USA: ACM, 2018, pp. 70–76.
[13] P. Papadopoulos, P. Ilia, and E. P. Markatos, “Truth in Web Mining: Measuring the Profitability and Cost of Cryptominers as a Web Monetization Model,” arXiv preprint arXiv:1806.01994, 2018.
[14] M. Musch, C. Wressnegger, M. Johns, and K. Rieck, “Web-Based Cryptojacking in the Wild,” arXiv preprint arXiv:1808.09474, 2018.
[15] D. Y. Huang, H. Dharmdasani, S. Meiklejohn, V. Dave, C. Grier, D. McCoy, S. Savage, N. Weaver, A. C. Snoeren, and K. Levchenko, “Botcoin: Monetizing Stolen Cycles.” in Proceedings of the Network and Distributed System Security Symposium (NDSS), Citeseer. San Diego, CA, USA: Internet Society, 2014, pp. 1–16.
[16] J. Grunzweig, “Palo Alto Networks: The Rise of the Cryptocurrency Miners,” June 2018. [Online]. Available: https://perma.cc/4VZL-J45Q
[17] Kafeine, “Proofpoint: Smominru Monero Mining Botnet Making Millions for Operators,” January 2018. [Online]. Available: https://perma.cc/V5UR-TDLU
[18] ——, “Proofpoint: Adylkuzz Cryptocurrency Mining Malware Spreading for Weeks via EternalBlue/DoublePulsar,” June 2017. [Online]. Available: https://perma.cc/3V7G-CDEN
[19] K. Kurokawa, “Forking for ASIC Resistance: A Monero Case Study,” June 2018. [Online]. Available: https://perma.cc/5JL6-RPPS
[20] R. Recabarren and B. Carbunar, “Hardening Stratum, the Bitcoin Pool Mining Protocol,” Proceedings on Privacy Enhancing Technologies, vol. 2017, no. 3, pp. 57–74, 2017.
[21] S. Pastrana, D. R. Thomas, A. Hutchings, and R. Clayton, “CrimeBB: Enabling Cybercrime Research on Underground Forums at Scale,” in Proceedings of The Web Conference (WWW). Lyon, France: ACM, 2018, pp. 1845–1854.
[22] C. Kolbitsch, E. Kirda, and C. Kruegel, “The Power of Procrastination: Detection and Mitigation of Execution-Stalling Malicious Code,” in Proceedings of the 18th ACM SIGSAC Conference on Computer and Communications Security (CCS). Chicago, Illinois, USA: ACM, 2011, pp. 285–296.
[23] C. Lever, P. Kotzias, D. Balzarotti, J. Caballero, and M. Antonakakis, “A Lustrum of Malware Network Communication: Evolution and Insights,” in IEEE Symposium on Security and Privacy (SP). San Jose, CA, USA: IEEE, 2017, pp. 788–804.
[24] V. G. Li, M. Dunn, P. Pearce, D. McCoy, G. M. Voelker, and S. Savage, “Reading the Tea Leaves: A Comparative Analysis of Threat Intelligence,” in 28th USENIX Security Symposium. Santa Clara, CA: USENIX Association, Aug 2019, pp. 851–867. [Online]. Available: https://www.usenix.org/conference/usenixsecurity19/presentation/li
[25] M. Lindorfer, M. Neugschwandtner, L. Weichselbaum, Y. Fratantonio, V. Van Der Veen, and C. Platzer, “Andrubis–1,000,000 Apps Later: A View on Current Android Malware Behaviors,” in Proceedings of the 3rd International Workshop on Building Analysis Datasets and Gathering Experience Returns for Security (BADGERS). Wroclaw, Poland: IEEE, 2014, pp. 3–17.
[26] M. Lindorfer, M. Neugschwandtner, and C. Platzer, “Marvin: Efficient and Comprehensive Mobile App Classification through Static and Dynamic Analysis,” in Proceedings of the IEEE 39th Annual Computer Software and Applications Conference (COMPSAC), vol. 2. Taichung, Taiwan: IEEE, 2015, pp. 422–433.
[27] A. Kantchelian, M. C. Tschantz, S. Afroz, B. Miller, V. Shankar, R. Bachwani, A. D. Joseph, and J. D. Tygar, “Better Malware Ground Truth: Techniques for Weighting Anti-Virus Vendor Labels,” in Proceedings of the 8th ACM Workshop on Artificial Intelligence and Security. Denver, Colorado, USA: ACM, 2015, pp. 45–56.
[28] S. Eskandari, A. Leoutsarakos, T. Mursch, and J. Clark, “A First Look at Browser-Based Cryptojacking,” in IEEE Security & Privacy on the Blockchain. London, UK: IEEE, 2018, pp. 58–66.
[29] D. Goldberg, “Guardicore: The Photominer Campaign,” June 2016. [Online]. Available: https://perma.cc/JE3Y-F42L
[30] A. Vamshi, “Netskope: Technical Analysis of Xbooster Parasitic Monero Miner,” May 2018. [Online]. Available: https://perma.cc/8RZG-5QBS
[31] Checkpoint, “Jenkins Miner: One of the Biggest Mining Operations Ever Discovered,” February 2018. [Online]. Available: https://perma.cc/SVN4-C5B4
[32] D. Liebenberg, “Cisco Talos: Rocke, the Champion of Monero Miners,” August 2018. [Online]. Available: https://perma.cc/ZH4B-DBG3
[33] J. Caballero, C. Grier, C. Kreibich, and V. Paxson, “Measuring Pay-Per-Install: The Commoditization of Malware Distribution.” in 20th USENIX Security Symposium. San Francisco, CA, USA: USENIX Association, 2011, pp. 13–13.
[34] R. Van Wegberg, S. Tajalizadehkhoob, K. Soska, U. Akyazi, C. H. Ganan, B. Klievink, N. Christin, and M. Van Eeten, “Plug and Prey? Measuring the Commoditization of Cybercrime via Online Anonymous Markets,” in 27th USENIX Security Symposium. Baltimore, MD, USA: USENIX Association, 2018, pp. 1009–1026.
[35] Y. Li, S. C. Sundaramurthy, A. G. Bardas, X. Ou, D. Caragea, X. Hu, and J. Jang, “Experimental Study of Fuzzy Hashing in Malware Clustering Analysis,” in 8th Workshop on Cyber Security Experimentation and Test (CSET 15), vol. 5. Washington, D.C, USA: USENIX Association, 2015.