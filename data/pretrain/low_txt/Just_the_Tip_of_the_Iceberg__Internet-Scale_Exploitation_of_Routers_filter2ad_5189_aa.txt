# Just the Tip of the Iceberg: Internet-Scale Exploitation of Routers for Cryptojacking

**Authors:**
- Hugo L.J. Bijmans
- Tim M. Booij
- Christian Doerr

**Affiliation:**
Delft University of Technology, Cyber Security Group
2628 CD Delft, The Netherlands
- h.l.j.bijmans@student.tudelft.nl
- t.m.booij@student.tudelft.nl
- c.doerr@tudelft.nl

## Abstract
The introduction of an efficient browser-based cryptominer by Coinhive in 2017 has led to its widespread adoption, either as a new revenue stream for websites or as a tool for malicious activities such as hacks and fraudulent advertisements. Studies analyzing the Alexa Top 1M have identified between 380 and 3,200 (0.038% to 0.32%) websites actively engaged in mining, with the top 10 perpetrators estimated to generate $41,000 per month [5, 15, 18, 30, 31]. While placing a cryptominer on a popular website can yield significant returns, it is limited to the duration of a user's visit.

In this paper, we report on a new attack vector that significantly outpaces all previously known cryptojacking activities. By exploiting a firmware vulnerability in MikroTik routers, cybercriminals can rewrite outgoing user traffic and inject cryptomining code into every web connection. This means that every webpage visited by users behind an infected router will mine cryptocurrency to benefit the attackers. Using NetFlows from a Tier 1 network, semiweekly crawls, and telescope traffic, we tracked these activities over a 10-month period. Our findings reveal the modus operandi and coordinating infrastructure of the attackers, who at one point controlled up to 1.4 million routers, approximately 70% of all MikroTik devices globally. We observed varying levels of sophistication among the adversaries, ranging from individual installations to large-scale campaigns. Our results indicate that cryptojacking through man-in-the-middle (MITM) attacks is highly profitable, generating 30 times more revenue than previous attack vectors.

**Keywords:**
- cryptojacking
- MikroTik
- router
- MITM
- cyber threat intelligence

**ACM Reference Format:**
Hugo L.J. Bijmans, Tim M. Booij, and Christian Doerr. 2019. Just the Tip of the Iceberg: Internet-Scale Exploitation of Routers for Cryptojacking. In 2019 ACM SIGSAC Conference on Computer & Communications Security (CCS '19), November 11–15, 2019, London, United Kingdom. ACM, New York, NY, USA, 16 pages. https://doi.org/10.1145/3319535.3354230

**Permissions:**
Permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page. Copyrights for components of this work owned by others than ACM must be honored. Abstracting with credit is permitted. To copy otherwise, or republish, to post on servers or to redistribute to lists, requires prior specific permission and/or a fee. Request permissions from permissions@acm.org.

**Conference Details:**
CCS '19, November 11–15, 2019, London, United Kingdom
© 2019 Association for Computing Machinery.
ACM ISBN 978-1-4503-6747-9/19/11...$15.00
https://doi.org/10.1145/3319535.3354230

## 1 Introduction
Cryptocurrencies, which began with Bitcoin in 2009 [24], represent monetary value secured by a blockchain. Transactions are stored in an ever-growing list of records, with each transaction added by solving a cryptographic challenge. Solving this puzzle, which depends on the last block, current transactions, and their recipients, results in a new record being inserted into the chain, thereby validating previous activities. Users are incentivized to participate and contribute computational resources, as the solver receives a cryptocurrency unit as a reward.

As the difficulty of Bitcoin's cryptographic challenges has increased, Bitcoin mining is no longer profitable on regular PCs, now requiring specialized hardware like ASICs. Consequently, thousands of alternative cryptocurrencies (alt-coins) have emerged, using different proof-of-work algorithms. Monero, for example, uses the CryptoNight algorithm, a memory-intensive computation that can be efficiently run on consumer-grade CPUs.

The potential rewards from alt-coins have attracted cybercriminals, who distribute cryptomining code through malware or botnets [28]. The introduction of a JavaScript miner by Coinhive in 2017 allowed cryptomining code to be embedded in web pages and executed by web browsers, providing an easy, scalable, and low-effort method to deploy cryptomining to a large user base. This has led to new business models, such as replacing advertisements with cryptomining [40].

However, the ease of recruiting website visitors for cryptomining has also led to a surge in illicit cryptomining, or "cryptojacking," where users' resources are hijacked without their knowledge or consent. This includes cryptojacking initiated by website owners, compromising websites to install mining code [6, 20], and hiding miners in third-party software used by webmasters [2, 8, 42]. Previous work by Konoth et al. estimates that the top 10 perpetrators across the Alexa Top 1M could generate monthly revenues of $41,000 [18].

In this paper, we analyze a previously unseen attack vector for cryptojacking: man-in-the-middle (MITM) attacks launched through compromised MikroTik routers, which inject mining code into every web page requested by users. This was made possible by a firmware vulnerability discovered in early 2018 [26], which allowed attackers to change device configurations and create an outgoing HTTP proxy. By following reconnaissance scans, detecting compromised routers, and tracing connection patterns, we provide a comprehensive insight into how this vulnerability scaled into massive cryptojacking campaigns. Our contributions include:

- **First Investigation:** We are the first to investigate a new type of attack that exploits internet infrastructure for cryptomining, showing how groups of criminals launched campaigns to control 1.4 million routers over 10 months, with a peak of 460,618 simultaneously infected routers.
- **Adversarial Tactics:** We analyze adversarial tactics and unveil the supporting infrastructure, demonstrating differences in how groups locate victims, compromise routers, and manage their infrastructure.
- **Revenue Comparison:** We show that previously reported vectors are negligible compared to the MITM attack, with estimated monthly revenues exceeding $1,200,000 for the top 10 accounts, 30 times higher than previous estimates.
- **Sophistication Levels:** We observe high levels of sophistication in three identified campaigns, with the largest involving 40 mining accounts linked to a single actor.

The remainder of the paper is structured as follows: Section 2 provides an overview of related work. Section 3 introduces the concept of cryptojacking and previously used methods, and describes the vulnerability and its exploitation. Section 4 details the datasets used in this study. Section 5 presents the techniques, tactics, and procedures used during the identification, exploitation, monetization, and maintenance of the compromised systems. Section 6 puts the techniques and sophistication levels into perspective and quantifies adversarial revenues. Finally, Section 7 summarizes and concludes our work.

## 2 Related Work
The growing interest in cryptojacking by cybercriminals has been followed by academic research. Shortly after the release of the Coinhive miner in September 2017, Eskandari et al. explored the field by searching source code databases for strings associated with cryptomining libraries [12]. Due to the possibilities of JavaScript obfuscation and other hiding techniques, subsequent research focused on detection methods. Rauchberger et al. developed Mininghunter, a crawler that analyzes both source code and WebSocket traffic [30]. A crawl of the Alexa Top 1M identified 3,178 cryptojacking websites and several campaigns. Other studies, such as those by Parra Rodriguez & Posegga [31] and Carlin et al. [5], used machine learning to detect active mining, achieving high precision scores.

The CMTracker by Hong et al. [15] also crawls the web but detects cryptojacking based on periodic executions in WebAssembly modules. This method identified 868 actively mining websites in the Alexa Top 100K. Wang et al. [41] used support vector machines (SVM) to analyze WebAssembly modules, concluding that this is a very efficient and robust detection method.

Recent web crawling studies include the work of Rüth et al., who crawled the largest top-level domains (.com, .net, and .org) and the Alexa Top 1M, estimating that 0.08% of probed websites were actively mining [32]. Konoth et al. created another crawler identifying 1,735 actively mining websites and performed campaign analysis [18]. Kharraz et al. used machine learning to identify 35 campaigns involving 386 websites [17].

A large-scale study across 55 million websites found that the prevalence of cryptojacking varies by top-level domain and website popularity, with about half of all cryptojacking activity being organized and part of a campaign [2]. Initial evidence suggests that browser-based mining through visitors might not be the main source of revenue. Papadopoulos et al. concluded that advertisements are five times more profitable [27]. Pastrana et al. found that only a small number of cybercriminals are making large profits, with some having mined 4.3% of all Monero in circulation [28].

Previous studies have primarily focused on detection or estimation of compromised websites. While MITM attacks through malicious WiFi networks have been mentioned as feasible [12], this attack vector has not been researched before. This paper addresses this gap, showing how and to what extent cryptojacking is deployed through attacks on internet infrastructure.

## 3 Background
The introduction of memory-bound cryptocurrencies like Monero enabled new methods of cryptomining, including browser-based cryptomining. These cryptocurrencies, along with new web technologies such as WebAssembly, WebWorkers, HTML5 WebSockets, and the Stratum Mining Protocol, paved the way for the creation of an efficient browser-based cryptominer by Coinhive in 2017. The miner works by embedding a script in a web page, which downloads a highly optimized WebAssembly module and spawns WebWorkers to run the module. It then sets up a connection with a mining pool, authenticating with a siteKey or wallet address. The mining pool distributes jobs, and the WebWorkers start mining, submitting found hashes to the pool. When the browser window is closed, all mining activity stops.

### 3.1 Past Modus Operandi of Cryptojacking
According to the New Jersey Attorney General in 2015 [14], mining cryptocurrencies with the computing power of others is not illegal if there is clear notification and the option to opt-out. However, most cryptojacking cases lack these and are therefore illegal. Cryptojacking scripts have been found on malware-infected PCs [28], but since the release of the Coinhive miner, browser-based mining has become popular. Many websites use cryptominers to increase revenue, such as The Pirate Bay [40], but cryptojacking has also occurred on websites where the owner did not initiate it. Website compromises, such as those of Indian government pages in 2018 [6], have led to cryptojacking infections. Attackers have also exploited third-party software, such as WordPress plugins [42] and Drupal CMS vulnerabilities [34], to spread mining scripts, and injected advertisements with mining code [22].

### 3.2 Pervasive Cryptojacking through Man-In-The-Middle Attacks
While cryptomining code is typically included in the served HTML page, requiring the website owner to install or inadvertently embed it, it is also possible to modify the traffic at the router level. By exploiting a firmware vulnerability in MikroTik routers, attackers can rewrite outgoing user traffic and inject cryptomining code into every web connection, effectively hijacking the computational resources of all users behind the infected router.