### Addressing Cyclic Dependencies in DNS

The problem of cyclic dependencies in the Domain Name System (DNS) can be mitigated by modifying and deploying recursive resolvers. However, this process is time-consuming. In the interim, operators of authoritative DNS services can protect their servers by ensuring that no sub-domains have cyclic dependencies. Over the long term, both resolver and domain fixes should be implemented, as new recursive software or domains with cyclic dependencies can always recreate the problem.

To address these issues, we collaborated with Google, whose public DNS service handles a significant portion of recursive resolver traffic. After notification, they resolved the problem in their Global DNS (GDNS). We followed best practices for these disclosures, allowing operators at least 90 days to address the problems. This timeframe aligns with CERT.org's 45-day notification policy and Google Project Zero’s 90-day policy. We also notified Cisco OpenDNS, another large public DNS provider, which subsequently fixed their resolver software.

In addition to Google, we notified the operators of other Autonomous Systems (ASes) that generated the most recursive traffic in our experiments. Three out of ten responded, with two reporting the use of outdated recursive resolver software. One was using a PowerDNS resolver (version 3.6.2-2 from 2014), and the other was using Windows 2008R2. Both planned to update their resolvers.

### Private and Public Disclosure

We made early, limited disclosures to specific operators and broader, but still limited, disclosures to the operator and vendor community in February 2021. Upon our private disclosure, Google and Cisco fixed their public DNS software. Additionally, the developers of three popular resolver software—BIND, Unbound, and PowerDNS—released public statements about how they mitigate or plan to address the issue.

### Experimental Design and Ethical Considerations

Our experiments were designed to minimize potential harm. We monitored the experiment for any surges in traffic, ensuring that aggregate traffic would not harm authoritative servers. The maximum query rate during the sinkhole experiment was 5.6k queries per second, well within our capacity. We also limited the duration of the experiments to 11 hours to reduce the traffic generated by the tested recursive resolvers.

Our goal was to reproduce the problem, confirm which resolvers were affected, and understand their behavior, rather than to evaluate how long they would loop. We balanced the benefits of understanding potential harm and notifying operators against the carefully managed, modest experimental risks. The changes made by Google and OpenDNS demonstrate the success of our approach.

### Sinkhole Experiment

Our sinkhole experiment temporarily introduced cyclic dependencies in the domains, preventing bots from receiving answers related to their Command and Control (C&C) sinkholed domain. This change did not impact regular users but caused vulnerable resolvers to query more frequently, though at a very safe rate of less than 1 query per second. After the experiment, we reverted the domain to its original configuration.

### Data and Privacy

While we often release datasets publicly, in this case, we could not do so due to the risk of abuse. Disclosing IP addresses of vulnerable resolvers and cyclic zones could enable misuse and provide little lasting benefit if the problems are resolved. We provided information privately to operators and developers, with at least 60 days' notice before public disclosure.

### Related Work

#### DNS Misconfiguration
Reports of various types of DNS misconfiguration have been prevalent. Our work focuses on cyclic dependencies, first described in RFC1536 and later coined by Pappas et al. We show how this misconfiguration interacts in real networks, leading to some recursive resolvers greatly amplifying traffic, and provide the first scan for these cyclic dependencies.

#### DDoS Attacks Against DNS
Denial-of-service attacks on authoritative DNS servers can have catastrophic consequences. The Mirai attack on DYN, for example, disrupted many prominent web services. The root DNS has also suffered DDoS attacks, although no prior attack has affected enough root DNS instances to cause a user-visible outage, partly due to heavy caching.

#### DDoS Attacks Using DNS
The DNS protocol has been exploited to carry out attacks on others. Spoofed queries and DNSSEC provide vectors for attack amplification. Long CNAME chains have also been used to amplify attacks against authoritative servers.

### Conclusions

The risk of DNS cycles has been documented for over 30 years but has been underestimated. Our study, prompted by large traffic increases, shows amplification factors ranging from 120x to 526x, explaining significant growth in .nz and a European ccTLD. We document the cause and threat of the problem, disclose this information to the vendor and operational community, and provide a tool to detect existing cyclic dependencies. Multiple vendors have confirmed that current software mitigates the problem, and important operators like Google Public DNS have taken steps to manage the challenge.

### Acknowledgments

We thank the anonymous IMC reviewers and the shepherd for their detailed suggestions. We also thank Marco Davids for his support and help in this research. Additional thanks go to Puneet Sood, Warren Kumari, Brian Dickson, Barry Greene, Keith Mitchell, Denesh Bhabuta, Benno Overeinder, Dario Ciccarone, Ralph Weber, and the DNS-OARC community for their feedback and support. We also thank the Anonymous European ccTLD operator for sharing their experience and traffic graph.

### References

[1] 1.1.1.1. 2018. The Internet’s Fastest, Privacy-First DNS Resolver. https://1.1.1.1/

[2] Gautam Akiwate, Mattijs Jonker, Raffaele Sommese, Ian Foster, Geoffrey M. Voelker, Stefan Savage, and KC Claffy. 2020. Unresolved Issues: Prevalence, Persistence, and Perils of Lame Delegations. In Proceedings of the ACM Internet Measurement Conference (Virtual Event, USA) (IMC ’20). Association for Computing Machinery, New York, NY, USA, 281–294. https://doi.org/10.1145/3419394.3423623

[3] Mark Allman. 2018. Comments on DNS Robustness. In Proceedings of the Internet Measurement Conference 2018 (Boston, MA, USA) (IMC ’18). Association for Computing Machinery, New York, NY, USA, 84–90. https://doi.org/10.1145/3278532.3278541

[4] M. Andrews. 1998. Negative Caching of DNS Queries (DNS NCACHE). RFC 2308. IETF. http://tools.ietf.org/rfc/rfc2308.txt

[5] Manos Antonakakis, Tim April, Michael Bailey, Matt Bernhard, Elie Bursztein, Jaime Cochran, Zakir Durumeric, J. Alex Halderman, Luca Invernizzi, Michalis Kallitsis, Deepak Kumar, Chaz Lever, Zane Ma, Joshua Mason, Damian Menscher, Chad Seaman, Nick Sullivan, Kurt Thomas, and Yi Zhou. 2017. Understanding the Mirai Botnet. In Proceedings of the 26th USENIX Security Symposium. USENIX, Vancouver, BC, Canada, 1093–1110. https://www.usenix.org/system/files/conference/usenixsecurity17/sec17-antonakakis.pdf

[6] ISC BIND. 2021. TsuNAME DNS Vulnerability and BIND 9. https://www.isc.org/blogs/2021_tsuname_vulnerability/

[7] Jonas Bushart and Christian Rossow. 2018. DNS Unchained: Amplified Application-Layer DoS Attacks Against DNS Authoritatives. In Research in Attacks, Intrusions, and Defenses, Michael Bailey, Thorsten Holz, Manolis Stamatogiannakis, and Sotiris Ioannidis (Eds.). Springer International Publishing, Cham, 139–160.

[8] Sebastian Castro, Duane Wessels, Marina Fomenkov, and Kimberly Claffy. 2008. A day at the root of the Internet. ACM Computer Communication Review 38, 5 (Oct. 2008), 41–46. https://doi.org/10.1145/1452335.1452341

[9] cert.gov. 2021. Vulnerability Disclosure Policy. https://vuls.cert.org/confluence/display/Wiki/Vulnerability+Disclosure+Policy

[10] CycleHunter. 2021. GitHub - SIDN/CycleHunter: Python software that reads zone files, extract NS records, and detect cyclic dependencies. https://github.com/SIDN/CycleHunter

[11] CZ-NIC. 2021. Knot DNS. https://www.knot-dns.cz/

[12] Peter B. Danzig, Katia Obraczka, and Anant Kumar. 1992. An Analysis of Wide-Area Name Server Traffic: A study of the Domain Name System. In Proceedings of the ACM SIGCOMM Conference (johnh: folder: networking/dns). ACM, Baltimore, Maryland, USA, 281–292. https://doi.org/10.1145/144191.144301

[13] Wouter B. De Vries, Roland Van Rijswijk-Deij, Pieter Tjerk De Boer, and Aiko Pras. 2018. Passive Observations of a Large DNS Service: 2.5 Years in the Life of Google. In 2018 Network Traffic Measurement and Analysis Conference (TMA). IEEE, United States. https://doi.org/10.23919/TMA.2018.8506536

[14] Batya Friedman, David G. Hendry, and Alan Borning. 2017. A Survey of Value Sensitive Design Methods. Foundations and Trends® in Human–Computer Interaction 11, 2 (2017), 63–125. https://doi.org/10.1561/1100000015

[15] Google. 2020. Public DNS. https://developers.google.com/speed/public-dns/

[16] Google Project Zero. 2021. Vulnerability Disclosure FAQ. https://googleprojectzero.blogspot.com/p/vulnerability-disclosure-faq.html

[17] Kenneth Einar Himma, Herman T Tavani, et al. 2008. The handbook of information and computer ethics. Wiley Online Library.

[18] P. Hoffman, A. Sullivan, and K. Fujiwara. 2018. DNS Terminology. RFC 8499. IETF. http://tools.ietf.org/rfc/rfc8499.txt

[19] ICANN. 2020. Centralized Zone Data Service. https://czds.icann.org/

[20] Internet Assigned Numbers Authority (IANA). 2020. Root Files. https://www.iana.org/domains/root/files

[21] Internetstiftelsen. 2020. Zone Data. https://zonedata.iis.se/

[22] ISC. 2021. BIND 9. https://www.isc.org/bind/

[23] Georgios Kambourakis, Tassos Moschos, Dimitris Geneiatakis, and Stefanos Gritzalis. 2007. A Fair Solution to DNS Amplification Attacks. In Proceedings of the Second IEEE International Workshop on Digital Forensics and Incident Analysis (WDFIA). IEEE, 38–47. https://doi.org/10.1109/WDFIA.2007.4299371

[24] Aqsa Kashaf, Vyas Sekar, and Yuvraj Agarwal. 2020. Analyzing Third Party Service Dependencies in Modern Web Services: Have We Learned from the Mirai-Dyn Incident? In Proceedings of the ACM Internet Measurement Conference (Virtual Event, USA) (IMC ’20). Association for Computing Machinery, New York, NY, USA, 634–647. https://doi.org/10.1145/3419394.3423664

[25] A. Kumar, J. Postel, C. Neuman, P. Danzig, and S. Miller. 1993. Common DNS Implementation Errors and Suggested Fixes. RFC 1536. IETF. http://tools.ietf.org/rfc/rfc1536.txt

[26] M. Larson and P. Barber. 2006. Observed DNS Resolution Misbehavior. RFC 4697. IETF. http://tools.ietf.org/rfc/rfc4697.txt

[27] P.V. Mockapetris. 1987. Domain names - concepts and facilities. RFC 1034. IETF. http://tools.ietf.org/rfc/rfc1034.txt

[28] P.V. Mockapetris. 1987. Domain names - implementation and specification. RFC 1035. IETF. http://tools.ietf.org/rfc/rfc1035.txt

[29] Giovane C. M. Moura. 2021. OARC Members Only Session: Vulnerability Disclosure (DDoS). https://indico.dns-oarc.net/event/37/contributions/821/

[30] Giovane C. M. Moura, Sebastian Castro, Wes Hardaker, Maarten Wullink, and Cristian Hesselman. 2020. Clouding up the Internet: How Centralized is DNS Traffic Becoming? In Proceedings of the ACM Internet Measurement Conference (Virtual Event, USA) (IMC ’20). Association for Computing Machinery, New York, NY, USA, 42–49.

[31] Giovane C. M. Moura, Sebastian Castro, John Heidemann, and Wes Hardaker. 2021. tsuNAME: Exploiting Misconfiguration and Vulnerability to DDoS DNS. Technical Report 2021-01. SIDN Labs. https://tsuname.io/tech_report.pdf

[32] Giovane C. M. Moura, Ricardo de O. Schmidt, John Heidemann, Wouter B. de Vries, Moritz Müller, Lan Wei, and Christian Hesselman. 2016. Anycast vs. DDoS: Evaluating the November 2015 Root DNS Event. In Proceedings of the ACM Internet Measurement Conference. ACM, Santa Monica, California, USA, 255–270. https://doi.org/10.1145/2987443.2987446

[33] Giovane C. M. Moura, John Heidemann, Ricardo de O. Schmidt, and Wes Hardaker. 2019. Cache Me If You Can: Effects of DNS Time-to-Live. In Proceedings of the ACM Internet Measurement Conference. ACM, Amsterdam, the Netherlands, 101–115. https://doi.org/10.1145/3355369.3355568

[34] Giovane C. M. Moura, John Heidemann, Moritz Müller, Ricardo de O. Schmidt, and Marco Davids. 2018. When the Dike Breaks: Dissecting DNS Defenses During DDoS. In Proceedings of the ACM Internet Measurement Conference. ACM, Boston, MA, USA, 8–21. https://doi.org/10.1145/3278532.3278534

[35] Giovane C. M. Moura, John Heidemann, Moritz Müller, Ricardo de O. Schmidt, and Marco Davids. 2018. When the Dike Breaks: Dissecting DNS Defenses During DDoS (extended). Technical Report ISI-TR-725. USC/Information Sciences Institute. https://www.isi.edu/~johnh/PAPERS/Moura18a.html

[36] NL Netlabs. 2021. UNBOUND. https://www.nlnetlabs.nl/projects/unbound/about/

[37] NLnetLabs. 2021. tsuNAME vulnerability and Unbound. https://nlnetlabs.nl/news/2021/May/10/tsuname-vulnerability-and-unbound/

[38] OpenDNS. 2021. Setup Guide: OpenDNS. https://www.opendns.com/

[39] Vasileios Pappas, Zhiguo Xu, Songwu Lu, Daniel Massey, Andreas Terzis, and Lixia Zhang. 2004. Impact of Configuration Errors on DNS Robustness. SIGCOMM Comput. Commun. Rev. 34, 4 (Aug. 2004), 319–330. https://doi.org/10.1145/1030194.1015503

[40] Nicole Perlroth. 2016. Hackers Used New Weapons to Disrupt Major Websites Across U.S. New York Times (Oct. 22 2016), A1. http://www.nytimes.com/2016/10/22/business/internet-problems-attack.html

[41] PowerDNS. 2021. Changelogs for all pre 4.0 releases. https://doc.powerdns.com/recursor/changelog/pre-4.0.html

[42] PowerDNS. 2021. TsuNAME vulnerability and PowerDNS Recursor. https://blog.powerdns.com/2021/05/10/tsuname-vulnerability-and-powerdns-recursor/

[43] Quad9. 2018. Quad9 | Internet Security & Privacy In a Few Easy Steps. https://quad9.net

[44] Audrey Randall, Enze Liu, Gautam Akiwate, Ramakrishna Padmanabhan, Geoffrey M. Voelker, Stefan Savage, and Aaron Schulman. 2020. Trufflehunter: Cache Snooping Rare Domains at Large Public DNS Resolvers. In Proceedings of the ACM Internet Measurement Conference (Virtual Event, USA) (IMC ’20). Association for Computing Machinery, New York, NY, USA, 50–64. https://doi.org/10.1145/3419394.3423640

[45] Y. Rekhter, B. Moskowitz, D. Karrenberg, G. J. de Groot, and E. Lear. 1996. Address Allocation for Private Internets. RFC 1918. IETF. http://tools.ietf.org/rfc/rfc1918.txt