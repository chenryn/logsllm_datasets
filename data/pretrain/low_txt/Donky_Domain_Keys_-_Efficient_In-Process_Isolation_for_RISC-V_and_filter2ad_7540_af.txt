# Manual, Volume II: Privileged Architecture

**Document Version:** 1.12-draft  
**Source:** [GitHub](https://github.com/riscv/riscv-isa-manual/releases/download/draft-20200212-c3d1f07/riscv-privileged.pdf)  
**Publication Year:** 2020

## References

### [30] In-Process Memory Isolation Extension
- **Authors:** Tommaso Frassetto, Patrick Jauernig, Christopher Liebchen, and Ahmad-Reza Sadeghi
- **Conference:** USENIX Security Symposium
- **Year:** 2018

### [31] Traps and Pitfalls: Practical Problems in System Call Interposition Based Security Tools
- **Author:** Tal Garfinkel
- **Conference:** NDSS
- **Year:** 2003

### [44] Lord of the x86 Rings: A Portable User Mode Privilege Separation Architecture on x86
- **Authors:** Hojoon Lee, Chihyun Song, and Brent ByungHoon Kang
- **Conference:** CCS
- **Year:** 2018

### [32] Microarchitectural Timing Attacks and Countermeasures on Contemporary Hardware
- **Authors:** Qian Ge, Yuval Yarom, David Cock, and Gernot Heiser
- **Journal:** Journal of Cryptographic Engineering
- **Volume:** 8
- **Year:** 2018

### [33] Case Study of JavaScript Engine Vulnerabilities
- **Source:** [GitHub](https://github.com/tunz/js-vuln-db)
- **Author:** Tunz

### [34] Clean Application Compartmentalization with SOAAP
- **Authors:** Khilan Gudka, Robert N. M. Watson, Jonathan Anderson, David Chisnall, Brooks Davis, Ben Laurie, Ilias Marinos, Peter G. Neumann, and Alex Richardson
- **Conference:** CCS
- **Year:** 2015

### [35] Enforcing Least Privilege Memory Views for Multithreaded Applications
- **Authors:** Terry Ching-Hsiang Hsu, Kevin J. Hoffman, Patrick Eugster, and Mathias Payer
- **Conference:** CCS
- **Year:** 2016

### [36] Identifying Arbitrary Memory Access Vulnerabilities in Privilege-Separated Software
- **Authors:** Hong Hu, Zheng Leong Chua, Zhenkai Liang, and Prateek Saxena
- **Conference:** ESORICS
- **LNCS Volume:** 9327
- **Pages:** 312–331
- **Year:** 2015

### [37] Power ISA Version 3.0b
- **Publisher:** IBM Corporation
- **Year:** 2017

### [38] Flipping Bits in Memory Without Accessing Them: An Experimental Study of DRAM Disturbance Errors
- **Authors:** Yoongu Kim, Ross Daly, Jeremie Kim, Chris Fallin, Ji-Hye Lee, Donghyuk Lee, Chris Wilkerson, Konrad Lai, and Onur Mutlu
- **Conference:** ISCA
- **Year:** 2014

### [39] DAWG: A Defense Against Cache Timing Attacks in Speculative Execution Processors
- **Authors:** Vladimir Kiriansky, Ilia Lebedev, Saman Amarasinghe, Srinivas Devadas, and Joel Emer
- **ePrint:** 2018/418
- **Month:** May
- **Year:** 2018

### [40] Spectre Attacks: Exploiting Speculative Execution
- **Authors:** Paul Kocher, Jann Horn, Anders Fogh, Daniel Genkin, Daniel Gruss, Werner Haas, Mike Hamburg, Moritz Lipp, Stefan Mangard, Thomas Prescher, Michael Schwarz, and Yuval Yarom
- **Conference:** S&P
- **Year:** 2019

### [41] No Need to Hide: Protecting Safe Regions on Commodity Hardware
- **Authors:** Koen Koning, Xi Chen, Herbert Bos, Cristiano Giuffrida, and Elias Athanasopoulos
- **Conference:** EUROSYS
- **Year:** 2017

### [42] Code-Pointer Integrity
- **Authors:** Volodymyr Kuznetsov, Laszlo Szekeres, Mathias Payer, George Candea, R. Sekar, and Dawn Song
- **Conference:** OSDI
- **Year:** 2014

### [43] Keystone: A Framework for Architecting TEEs
- **Authors:** Dayeol Lee, David Kohlbrenner, Shweta Shinde, Dawn Song, and Krste Asanovic
- **Source:** CoRR
- **abs/1907.10119**
- **Year:** 2019

### [45] TinyXML-2
- **Author:** Lee Thomason
- **Source:** [GitHub](https://github.com/leethomason/tinyxml2)
- **Year:** 2019

### [46] Memory Protection Keys
- **Source:** [Linux Kernel Documentation](https://www.kernel.org/doc/Documentation/x86/protection-keys.txt)
- **Year:** 2017

### [47] SECure COMPuting with Filters
- **Source:** [Linux Kernel Documentation](https://www.kernel.org/doc/Documentation/prctl/seccomp_filter.txt)
- **Year:** 2017

### [48] Meltdown: Reading Kernel Memory from User Space
- **Authors:** Moritz Lipp, Michael Schwarz, Daniel Gruss, Thomas Prescher, Werner Haas, Anders Fogh, Jann Horn, Stefan Mangard, Paul Kocher, Daniel Genkin, Yuval Yarom, and Mike Hamburg
- **Conference:** USENIX Security Symposium
- **Year:** 2018

### [49] A Linear Time Algorithm for Deciding Subject Security
- **Authors:** Richard J. Lipton and Lawrence Snyder
- **Journal:** Journal of the ACM (J. ACM)
- **Volume:** 24
- **Year:** 1977

### [50] Light-Weight Contexts: An OS Abstraction for Safety and Performance
- **Authors:** James Litton, Anjo Vahldiek-Oberwagner, Eslam Elnikety, Deepak Garg, Bobby Bhattacharjee, and Peter Druschel
- **Conference:** OSDI
- **Year:** 2016

### [51] Thwarting Memory Disclosure with Efficient Hypervisor-Enforced Intra-Domain Isolation
- **Authors:** Yutao Liu, Tianyu Zhou, Kexin Chen, Haibo Chen, and Yubin Xia
- **Conference:** CCS
- **Year:** 2015

### [52] BOOMERANG: Exploiting the Semantic Gap in Trusted Execution Environments
- **Authors:** Aravind Machiry, Eric Gustafson, Chad Spensky, Christopher Salls, Nick Stephens, Ruoyu Wang, Antonio Bianchi, Yung Ryn Choe, Christopher Kruegel, and Giovanni Vigna
- **Conference:** NDSS
- **Year:** 2017

### [53] Evaluating SFI for a CISC Architecture
- **Authors:** Stephen McCamant and Greg Morrisett
- **Conference:** USENIX Security Symposium
- **Year:** 2006

### [54] lmbench: Portable Tools for Performance Analysis
- **Authors:** Larry W. McVoy and Carl Staelin
- **Conference:** USENIX ATC
- **Year:** 1996

### [55] EnclaveDom: Privilege Separation for Large-TCB Applications in Trusted Execution Environments
- **Authors:** Marcela S. Melara, Michael J. Freedman, and Mic Bowman
- **Source:** CoRR
- **abs/1907.13245**
- **Year:** 2019

### [56] MicroStache: A Lightweight Execution Context for In-Process Safe Region Isolation
- **Authors:** Lucian Mogosanu, Ashay Rane, and Nathan Dautenhahn
- **Conference:** RAID
- **LNCS Volume:** 11050
- **Year:** 2018

### [57] Plundervolt: Software-Based Fault Injection Attacks Against Intel SGX
- **Authors:** Kit Murdock, David Oswald, Flavio D. Garcia, Jo Van Bulck, Daniel Gruss, and Frank Piessens
- **Conference:** Security and Privacy (S&P)
- **Year:** 2020

### [58] FRAMER: A Tagged-Pointer Capability System with Memory Safety Applications
- **Authors:** Myoung Jin Nam, Periklis Akritidis, and David J. Greaves
- **Conference:** ACSAC
- **Year:** 2019

### [59] Retrofitting Fine Grain Isolation in the Firefox Renderer (Extended Version)
- **Authors:** Shravan Narayan, Craig Disselkoen, Tal Garfinkel, Nathan Froyd, Eric Rahm, Sorin Lerner, Hovav Shacham, and Deian Stefan
- **Source:** CoRR
- **abs/2003.00572**
- **Year:** 2020

### [60] TrustZone Explained: Architectural Features and Use Cases
- **Authors:** Bernard Ngabonziza, Daniel Martin, Anna Bailey, Hae-hyun Cho, and Sarah Martin
- **Conference:** CIC
- **Year:** 2016

### [61] Node.js
- **Source:** [Node.js Documentation](https://nodejs.org/en/docs/es6/)
- **Year:** 2019

### [62] Sancus 2.0: A Low-Cost Security Architecture for IoT Devices
- **Authors:** Job Noorman, Jo Van Bulck, Jan Tobias Mühlberg, Frank Piessens, Pieter Maene, Bart Preneel, Ingrid Verbauwhede, Johannes Götzfried, Tilo Müller, and Felix C. Freiling
- **Journal:** ACM Transactions on Privacy and Security (TOPS)
- **Volume:** 20
- **Year:** 2017

### [63] PA-RISC 1.1 Architecture and Instruction Set Reference Manual, Third Edition
- **Publisher:** Hewlett Packard
- **Year:** 1994

### [64] libmpk: Software Abstraction for Intel Memory Protection Keys (Intel MPK)
- **Authors:** Soyeon Park, Sangho Lee, Wen Xu, Hyungon Moon, and Taesoo Kim
- **Conference:** USENIX ATC
- **Year:** 2019

### [65] User Mode Interrupts: A Must for Securing Embedded Systems
- **Authors:** Sandro Pinto and Cesare Garlati
- **Conference:** Embedded World Conference
- **Year:** 2019

### [66] Preventing Privilege Escalation
- **Authors:** Niels Provos, Markus Friedl, and Peter Honeyman
- **Conference:** USENIX Security Symposium
- **Year:** 2003

### [67] Site Isolation: Process Separation for Web Sites within the Browser
- **Authors:** Charles Reis, Alexander Moshchuk, and Nasko Oskov
- **Conference:** USENIX Security Symposium
- **Year:** 2019

### [68] Google Chrome 72.0.3626.121 / 74.0.3725.0 - 'NewFixedDoubleArray' Integer Overflow
- **Source:** [GitHub](https://github.com/riscv/riscv-isa-manual/releases/download/draft-20200212-c3d1f07/riscv-privileged.pdf)
- **Year:** 2020

### [69] The Protection of Information in Computer Systems
- **Authors:** Jerome H. Saltzer and Michael D. Schroeder
- **Journal:** Proceedings of the IEEE
- **Volume:** 63
- **Year:** 1975

### [70] Exploiting Logic Bugs in JavaScript JIT Engines
- **Author:** Samuel Gross
- **Source:** [Phrack](http://www.phrack.org/papers/jit_exploitation.html)

### [71] Practical Enclave Malware with Intel SGX
- **Authors:** Michael Schwarz, Samuel Weiser, and Daniel Gruss
- **Conference:** DIMVA
- **LNCS Volume:** 11543
- **Year:** 2019

### [72] Adapting Software Fault Isolation to Contemporary CPU Architectures
- **Authors:** David Sehr, Robert Muth, Cliff Biffle, Victor Khimenko, Egor Pasko, Karl Schimpf, Bennet Yee, and Brad Chen
- **Conference:** USENIX Security Symposium
- **Year:** 2010

### [73] SPEC CPU 2017
- **Source:** [Standard Performance Evaluation Corporation](https://www.spec.org/cpu2017)

### [74] Salus: Kernel Support for Secure Process Compartments
- **Authors:** Raoul Strackx, Pieter Agten, Niels Avonds, and Frank Piessens
- **Journal:** ICST Transactions on Security and Safety
- **Volume:** 2
- **Year:** 2015

### [75] CLKSCREW: Exposing the Perils of Security-Oblivious Energy Management
- **Authors:** Adrian Tang, Simha Sethumadhavan, and Salvatore J. Stolfo
- **Conference:** USENIX Security Symposium
- **Year:** 2017

### [76] Nbody C Benchmark
- **Source:** [The Computer Language Benchmarks Game Team](https://benchmarksgame-team.pages.debian.net/benchmarksgame/description/nbody.html#nbody)

### [77] How Can eBPF Be Compromised by Vulnerabilities?
- **Author:** Peter Teoh
- **Source:** [Blog Post](https://tthtlc.wordpress.com/2019/01/01/how-can-ebpf-be-compromised-by-vulnerabilities/)
- **Year:** 2019

### [78] The Loophole That Turns Your Apps Into Spies
- **Source:** [The New York Times](https://www.nytimes.com/2019/09/24/opinion/facebook-google-apps-data.html)
- **Year:** 2019

### [79] V8: The Official Mirror of the V8 Git Repository
- **Source:** [GitHub](https://github.com/v8/v8/blob/3fbeb93760bcf663dcf84b57597f49d7d3b29c02/src/flags/flag-definitions.h#L665)
- **Year:** 2020

### [80] V8 - Untrusted Code Mitigations
- **Source:** [V8 Developer Documentation](https://v8.dev/docs/untrusted-code-mitigations)
- **Year:** 2019

### [81] V8 Developer Blog
- **Source:** [V8 Developer Documentation](https://v8.dev/docs)
- **Year:** 2019

### [82] ERIM: Secure, Efficient In-Process Isolation with Protection Keys (MPK)
- **Authors:** Anjo Vahldiek-Oberwagner, Eslam Elnikety, Nuno O. Duarte, Michael Sammler, Peter Druschel, and Deepak Garg
- **Conference:** USENIX Security Symposium
- **Year:** 2019

### [83] Towards Fine-Grained, Automated Application Compartmentalization
- **Authors:** Nikos Vasilakis, Ben Karel, Nick Roessler, Nathan Dautenhahn, André DeHon, and Jonathan M. Smith
- **Journal:** PLOS
- **Year:** 2017

### [84] BreakApp: Automated, Flexible Application Compartmentalization
- **Authors:** Nikos Vasilakis, Ben Karel, Nick Roessler, Nathan Dautenhahn, André DeHon, and Jonathan M. Smith
- **Conference:** NDSS
- **Year:** 2018

### [85] CODOMs: Protecting Software with Code-Centric Memory Domains
- **Authors:** Lluís Vilanova, Muli Ben-Yehuda, Nacho Navarro, Yoav Etsion, and Mateo Valero
- **Conference:** ISCA
- **Year:** 2014

### [86] Efficient Software-Based Fault Isolation
- **Authors:** Robert Wahbe, Steven Lucco, Thomas E. Anderson, and Susan L. Graham
- **Conference:** SOSP
- **Year:** 1993

### [87] Between Mutual Trust and Mutual Distrust: Practical Fine-Grained Privilege Separation in Multithreaded Applications
- **Authors:** Jun Wang, Xi Xiong, and Peng Liu
- **Conference:** USENIX ATC
- **Year:** 2015

### [88] Fast Protection-Domain Crossing in the CHERI Capability-System Architecture
- **Authors:** Robert N. M. Watson, Robert M. Norton, Jonathan Woodruff, Simon W. Moore, Peter G. Neumann, Jonathan Anderson, David Chisnall, Brooks Davis, Ben Laurie, Michael Roe, Nirav H. Dave, Khilan Gudka, Alexandre Joannou, A. Theodore Markettos, Ed Maste, Steven J. Murdoch, Colin Rothwell, Stacey D. Son, and Munraj Vadera
- **Journal:** IEEE Micro
- **Volume:** 36
- **Year:** 2016

### [89] CHERI: A Hybrid Capability-System Architecture for Scalable Software Compartmentalization
- **Authors:** Robert N. M. Watson, Jonathan Woodruff, Peter G. Neumann, Simon W. Moore, Jonathan Anderson, David Chisnall, Nirav H. Dave, Brooks Davis, Khilan Gudka, Ben Laurie, Steven J. Murdoch, Robert M. Norton, Michael Roe, Stacey D. Son, and Munraj Vadera
- **Conference:** S&P
- **Year:** 2015

### [90] SGXJail: Defeating Enclave Malware via Confinement
- **Authors:** Samuel Weiser, Luca Mayr, Michael Schwarz, and Daniel Gruss
- **Conference:** RAID
- **Year:** 2019

### [91] Regaining Lost Cycles with HotCalls: A Fast Interface for SGX Secure Enclaves
- **Authors:** Ofer Weisse, Valeria Bertacco, and Todd M. Austin
- **Conference:** ISCA
- **Year:** 2017

### [92] ScatterCache: Thwarting Cache Attacks via Cache Set Randomization
- **Authors:** Mario Werner, Thomas Unterluggauer, Lukas Giner, Michael Schwarz, Daniel Gruss, and Stefan Mangard
- **Conference:** USENIX Security Symposium
- **Year:** 2019

### [93] Preventing Heartbleed
- **Author:** David A. Wheeler
- **Journal:** IEEE Computer
- **Volume:** 47
- **Year:** 2014

### [94] Mondrian Memory Protection
- **Authors:** Emmett Witchel, Josh Cates, and Krste Asanovic
- **Conference:** ASPLOS
- **Year:** 2002

### [95] Native Client: A Sandbox for Portable, Untrusted x86 Native Code
- **Authors:** Bennet Yee, David Sehr, Gregory Dardyk, J. Bradley Chen, Robert Muth, Tavis Ormandy, Shiki Okasaka, Neha Narula, and Nicholas Fullagar
- **Conference:** S&P
- **Year:** 2009

### [96] The Cost of Application-Class Processing: Energy and Performance Analysis of a Linux-Ready 1.7-GHz 64-Bit RISC-V Core in 22-nm FDSOI Technology
- **Authors:** Florian Zaruba and Luca Benini
- **Journal:** IEEE Transactions on Very Large Scale Integration (VLSI) Systems
- **Volume:** 27
- **Year:** 2019

### [97] executable-only-memory-switch (xom-switch): Hiding Your Code from Advanced Code Reuse Attacks in One Shot
- **Authors:** Mingwei Zhang, Ravi Sahita, and Daiping Liu
- **Conference:** Black Hat Asia
- **Year:** 2018

### [98] ARMor: Fully Verified Software Fault Isolation
- **Authors:** Lu Zhao, Guodong Li, Bjorn De Sutter, and John Regehr
- **Conference:** EMSOFT
- **Year:** 2011

### [99] ARMlock: Hardware-Based Fault Isolation for ARM
- **Authors:** Yajin Zhou, Xiaoguang Wang, Yue Chen, and Zhi Wang
- **Conference:** CCS
- **Year:** 2014

## A System Call Filter Example

```c
int interpose_socket(int dom, int type, int prot) {
    if (CURRENT_DOMAIN != 0) {
        errno = EACCES;
        return -1;
    }
    return socket(dom, type, prot);
}

int interpose_open(const char *path, int flags) {
    if (!login || strchr(path, '/')) {
        errno = EACCES;
        return -1;
    }
    return open(path, flags);
}
```

### Explanation
Listing 2 demonstrates how an application using Donky can restrict socket creation to the root domain (did=0) only (line 2). Additionally, file opening is bound to a global variable `login` and limited to the current directory (line 9).

Recent additions to the Linux kernel also allow similar filters in userspace [18]. However, unlike Donky, these require kernel interaction and a separate thread or process.

---

This version of the text has been optimized for clarity, coherence, and professionalism. Each reference is now clearly formatted, and the system call filter example is presented in a more readable manner.