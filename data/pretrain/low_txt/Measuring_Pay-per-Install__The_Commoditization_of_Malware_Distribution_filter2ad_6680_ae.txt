### Observations and Defensive Strategies

Many downloaders employ a straightforward download-and-execute strategy. This suggests that defenders could achieve significant protection by implementing taint-based approaches, which can identify and prevent the execution of downloaded data.

### Malware Families and Evasion Techniques

LoaderAdv (687b2125e0f8c4d3ae68be2f7182f444), Torpig (a4ab5d0472d8d979fe6e249b679542b1), Pinit (2a0a8bd396359fce6bd2ffe6cbabe60e), Ambler (c55c3dd560581bd0d56c934560d3f5a5), Zbot (e400573df78d3d82523edfa8559dc320), Rustock (fdc7d559e9db995b22ed3b857dca1b7e), GoldInstall (lista9de3aa03d35e07f2c73fe54aa9b08d6), Pushdo (d662395b8ca156cc76519ac16bd16d9), Rustock-dl (2982fb0cf2a6d77d6fc6bd3e8ddb557f), and GoldInstall-dl (9488bd937386ac84a6c70c8503541947) are some of the prominent malware families. LoaderAdv-ack (c3b7afc60b358bbe62ec625798116339) is another variant.

#### Evasion
Infiltrating the pay-per-install (PPI) command-and-control (C&C) protocols required substantial reverse-engineering efforts. As adversaries become more aware of these infiltration attempts, they are likely to evolve their C&C protocols, making future infiltration more challenging. Specifically, we anticipate that PPI services will harden their C&C protocols with more robust cryptographic techniques and incorporate anti-virtualization and triggering mechanisms to impede dynamic analysis. However, the fact that a relatively modest effort was sufficient to gain insights into many of today's top malware families is encouraging. Analysts should remain vigilant for opportunities to infiltrate core components of the modern malware ecosystem, which may provide broad insights into the malware landscape.

### Conclusion

We have presented the results of the first systematic study of the PPI ecosystem, conducted by infiltrating the malware distribution mechanism of PPI services. The ability to "milk" malware binaries directly from the source provides an unprecedented intelligence capability for defenders. We leveraged this approach to measure technical aspects of the market surrounding malware installation.

Starting with a network-behavioral classification of a one-month corpus of 313,791 binaries, we identified 12 of the 20 most prevalent malware families. We illustrated how several clickfraud and fake-AV families specifically target the United States and Europe, while other malware classes, such as spam bots, are distributed worldwide. Our examination of repacking rates of PPI-distributed malware showed that, on average, binaries are repacked every 11 days, with one family of malware repacking up to twice a day. Finally, we illuminated the relationships among actors in the PPI ecosystem, including the identification of LoaderAdv and GoldInstall affiliates that apparently engage in pricing arbitrage by becoming clients to other PPI providers.

### Acknowledgements

We would like to thank Atif Mushtaq for his help in understanding FireEye’s top 20 malware classification. We also thank the anonymous reviewers for their insightful comments.

This work was partially done while Juan Caballero was a visiting student researcher at the University of California, Berkeley, and a graduate student at Carnegie Mellon University. This work was supported in part by the National Science Foundation under grants NSF-0433702, CNS-0905631, and CNS-0831535, and by the Office of Naval Research under MURI Grant No. N000140911081. Juan Caballero was also partially supported by Grants FP7-ICT No. 256980 and FP7-PEOPLE-COFUND No. 229599. Opinions expressed in this material are those of the authors and do not necessarily reflect the views of the sponsors.

### References

[1] Anubis: Analyzing Unknown Binaries. http://anubis.iseclab.org/. Accessed on June 2011.
[2] Ulrich Bayer, Christopher Kruegel, and Engin Kirda. TTAnalyze: A Tool for Analyzing Malware. In European Institute for Computer Antivirus Research Annual Conference, April 2006.
[3] H. Binsalleeh, T. Ormerod, A. Boukhtouta, P. Sinha, A. Youssef, M. Debbabi, and L. Wang. On the Analysis of the Zeus Botnet Crimeware Toolkit. In International Conference on Privacy, Security and Trust, August 2010.
[4] AS-Troyak Exposes a Large Cybercrime Infrastructure, March 2010. http://blogs.rsa.com/rsafarl/as-troyak-exposes-a-large-cybercrime-infrastructure/.
[5] J. Caballero, N. M. Johnson, S. McCamant, and D. Song. Binary code extraction and interface identification for security applications. In Proceedings of the Network and Distributed System Security Symposium, February 2010.
[6] C. Y. Cho, J. Caballero, C. Grier, V. Paxson, and D. Song. Insights from the Inside: A View of Botnet Management from Infiltration. In Proceedings of the USENIX Workshop on Large-Scale Exploits and Emergent Threats, April 2010.
[7] N. Doshi, A. Athalye, and E. Chien. Pay-Per-Install: The New Malware Distribution Network, April 2010. http://www.symantec.com/content/en/us/enterprise/media/security-response/whitepapers/pay-per-install.pdf.
[8] H. Dreger, A. Feldmann, M. Mai, V. Paxson, and R. Sommer. Dynamic Application-Layer Protocol Analysis for Network Intrusion Detection. In Proceedings of the USENIX Security Symposium, April 2006.
[9] Amazon Elastic Compute Cloud. http://aws.amazon.com/ec2/. Accessed on June 2011.
[10] J. Franklin, V. Paxson, A. Perrig, and S. Savage. An Inquiry into the Nature and Causes of the Wealth of Internet Miscreants. In Proceedings of ACM Conference on Computer and Communications Security, October 2007.
[11] G. Gu, R. Perdisci, J. Zhang, and W. Lee. BotMiner: Clustering Analysis of Network Traffic for Protocol and Structure Independent Botnet Detection. In Proceedings of the 17th USENIX Security Symposium, July 2008.
[12] InstallsDealer. http://installsdealer.com/. Accessed on June 2011.
[13] InstallsForYou. http://installsforyou.biz/. Accessed on June 2011.
[14] Internet Archive. http://www.archive.org/. Accessed on June 2011.
[15] B. Koehl and J. Mieres. SpyEye Bot (Part two) Conversations with the Creator of Crimeware, February 2010. http://www.malwareint.com/docs/spyeye-analysis-ii-en.pdf.
[16] C. Kolbitsch, T. Holz, C. Kruegel, and E. Kirda. Inspector GAdget: Automated Extraction of Proprietary Gadgets from Malware Binaries. In Proceedings of the IEEE Symposium on Security and Privacy, May 2010.
[17] C. Kreibich, C. Kanich, K. Levchenko, B. Enright, G.M. Voelker, V. Paxson, and S. Savage. Spamcraft: An inside look at spam campaign orchestration. In USENIX Workshop on Large-Scale Exploits and Emergent Threats, 2009.
[18] Christian Kreibich, Nicholas Weaver, Chris Kanich, Weidong Cui, and Vern Paxson. GQ: Practical Containment for Measuring Modern Malware Systems. Technical Report TR-11-002, International Computer Science Institute, May 2011.
[19] LoadsSell. http://loadssell.net/. Accessed on June 2011.
[20] MaxMind. Resources for Developers. http://www.maxmind.com/app/api. Accessed on June 2011.
[21] J. Mieres. Russian prices of crimeware, March 2009. http://evilfingers.blogspot.com/2009/03/russian-prices-of-crimware.html.
[22] A. Mushtaq. World’s Top Malware, July 2010. http://blog.fireeye.com/research/2010/07/worlds-top-modern-malware.html.
[23] J. Oberheide, M. Bailey, and F. Jahanian. PolyPack: An Automated Online Packing Service for Optimal Antivirus Evasion. In Proceedings of the 3rd USENIX conference on Offensive technologies, August 2009.
[24] V. Paxson. Bro: A system for detecting network intruders in real-time. Computer Networks, 31:2435–2463, December 1999.
[25] R. Perdisci, W. Lee, and N. Feamster. Behavioral Clustering of HTTP-Based Malware and Signature Generation Using Malicious Network Traces. In Proceedings of the 7th USENIX conference on Networked Systems Design and Implementation, April 2010.
[26] D. Plonka and P. Barford. Context-Aware Clustering of DNS Query Traffic. In Proceedings of the 8th ACM SIGCOMM conference on Internet Measurement, October 2008.
[27] Best Pay-Per-Install Affiliate Program Reviews. http://pay-per-install.com. Accessed on June 2011.
[28] Pay-Per-Install Programs. https://www.pay-per-install.org/. Accessed on June 2011.
[29] K. Stevens. The Underground Economy of the Pay-Per-Install PPI Business, February 2010. Black Hat DC, Arlington, VA.
[30] ThreatExpert – Automated Threat Analysis. http://www.threatexpert.com/. Accessed on June 2011.
[31] The Tor Project. http://www.torproject.org/. Accessed on June 2011.
[32] VirusTotal – Free Online Virus, Malware and URL Scanner. http://www.virustotal.com/. Accessed on June 2011.
[33] ZeuS Tracker. https://zeustracker.abuse.ch/. Accessed on June 2011.

### Appendix: Examples of Signatures

This appendix provides concrete examples of several malware signatures that appear in Table 3. We include four popular but untagged clusters and two versions of Palevo for reference.

Each signature consists of three parts: URL, DOMAIN, and PAYLOAD statements, followed by associated contents. The URL can contain regular expressions; we only use it for HTTP-based protocols. DOMAINS can list IP addresses or domains (with or without subdomains). PAYLOAD statements specify the parameters for where, type, contents, and len.

- **where** specifies the location to match, with "begin" meaning at the beginning of the payload.
- **type** informs the engine whether to interpret the contents as a string or as an array of bytes.
- **len** restricts the length of the checked packet: a signature that specifies a len will only match if the packet has exactly the given length in bytes.

#### CLUSTER: A
- **URLS**: `/svc.php\?ver=`
- **DOMAINS**: 
  - `sy.perfectexe.com`
  - `sy2.perfectexe.com`
  - `sy3.perfectexe.com`

#### CLUSTER: B
- **URLS**: 
  - `/get.cgi\?.+`
  - `/data.cgi`
- **DOMAINS**: 
  - `f19dd4abb8b8bdf2.cn`
  - `2bff2694930d2e21.cn`
  - `697fe322c995da1a.net`
  - `89e3aaecc2ba1734.net`
  - `ade34ea82c4f7f2f.net`

#### CLUSTER: C
- **DOMAINS**: `ds.perfectexe.com`
- **URLS**: `/active.asp\?[0-9]{2}`

#### CLUSTER: D (URLs truncated for space)
- **DOMAINS**: `x.liruna.com`
- **URLS**: 
  - `/x.ashx\?`
  - `ashx\?a=get&v=`
  - `ashx\?a=[^&]+v=[^&]+&fid=[^&]+&id=...`

#### Palevo
- **DOMAINS**: 
  - `193.104.186.88`
  - `76.76.99.186`
  - `f5v9w.com`
  - `e7j0h7.cn`
  - `mp1r3n.ru`
- **URLS**: 
  - `/hygtrve.exe`
  - `/htrgef.exe`
  - `/htgref.exe`
  - `/hybtvr.exe`
- **PAYLOAD**: 
  - `where: begin,`
  - `type: bytes,`
  - `contents: [[0x61]],`
  - `len: 7`

#### Palevo2
- **DOMAINS**: 
  - `ff.fjpark.com`
  - `fifa2012terra.com`
  - `converter50.com`
- **URLS**: 
  - `/rip.exe, /usa.exe, /575.exe,`
  - `/adv.exe, /adv2.exe, /rip2.exe,`
  - `/prr.exe, /4757exe.exe`
- **PAYLOAD**: 
  - `where: begin,`
  - `type: bytes,`
  - `contents: [[0x18]],`
  - `len: 21`