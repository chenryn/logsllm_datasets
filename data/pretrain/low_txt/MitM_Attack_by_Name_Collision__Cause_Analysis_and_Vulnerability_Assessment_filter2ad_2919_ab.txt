### WPAD Name Collision Attack

#### Overview
The WPAD (Web Proxy Auto-Discovery) name collision attack is a significant security threat that can be easily exploited, especially when an internal namespace Top-Level Domain (iTLD) is delegated as a new generic Top-Level Domain (gTLD). This scenario allows internal namespace WPAD queries to leak and be exploited by malicious actors using Man-in-the-Middle (MitM) attacks from anywhere on the Internet.

#### Illustration of the Attack
Figure 1 illustrates the WPAD name collision attack. In this scenario, a malicious domain registrant can exploit leaked WPAD queries and launch MitM attacks. The victim devices are configured to use DNS WPAD for automatic proxy discovery, issuing WPAD queries in an internal DNS namespace, such as `company.ntld`. Here, `.ntld` is used as an iTLD but is also delegated in the public DNS namespace. Under certain common settings, these queries can mistakenly leak out.

An attacker can register the domain `company.ntld` in the new gTLD `.ntld`, causing the leaked WPAD queries to be directed to the attacker's authoritative name server. The attacker then provides a proxy configuration file, redirecting all subsequent web traffic through a proxy controlled by the attacker. The victim user may not even recognize the attack because WPAD proxy discovery is fully automated at browser launch, and some operating systems and browsers enable it by default without explicit user consent (as shown in Table I).

The attacker can leverage this MitM position to eavesdrop on sensitive data, manipulate traffic to inject malicious code, or launch phishing attacks. This attack is particularly dangerous because it does not require spoofing, eliminating the need for the attacker to be on the network path. Additionally, the authoritative nature of the malicious responses makes this attack exploitable even with DNSSEC [18], [19].

#### Stealth and Detection
This attack is highly stealthy. Once the domain name is registered, privacy protection makes it difficult for both new gTLD registries and third parties to examine subdomains for attack attempts. We do not assume that the attacker is fully aware of all vulnerable domains; they may discover them through analysis, such as sniffing local network queries or accessing DNS traffic collected by organizations like DNS-OARC [8]. The registrants may also be initially innocent but start exploitation after observing misdirected WPAD queries. Another possibility is that the DNS servers are compromised by an attacker.

#### Attack Surface
To characterize the magnitude of this MitM threat, we propose a methodology to quantify the WPAD attack surface exposed by new gTLD registrations. Our threat model focuses on clients who issue WPAD queries to domain names controlled by attackers. Most domains in leaked query traffic appear infrequently with low query volume, suggesting they may not be easily exploited in practice. For example, for the delegated new gTLD `.network`, 42.3% of the domains with leaked queries appeared in less than 14 days within a one-year period, and less than 4% of these domains account for more than 98% of all leaked WPAD traffic observed at two DNS root servers.

We define "highly-vulnerable domains" (HVDs) as those WPAD query domains persistently exposing a large number of victims. These HVDs must have two properties: high persistence (queries frequently leaked over a long time) and high query volume (many victims can be continuously exploited). This definition allows us to estimate the size and composition of domains that, when registered, constitute the bulk of WPAD name collision vulnerabilities.

#### Dataset
Our study uses the following datasets:
- **New gTLD List**: Obtained from the ICANN website [16], considering new gTLDs delegated before August 25, 2015, totaling 738.
- **Root NXD WPAD**: Leaked internal namespace queries captured and replied with NXD by DNS root servers A and J, managed by Verisign. This dataset was collected from September 2013 to July 2015, covering all new gTLDs delegated so far.
- **New gTLD Zone Files and WHOIS Data**: Used to study the registration status and patterns of HVDs, pulled daily from February 2014 to September 2015 from ICANN Centralized Zone Data Service (CZDS) [15] and BestWhois service [1].

#### WPAD Query Leakage Characterization
The WPAD name collision attack stems from the unintentional leakage of internal WPAD DNS queries into the public DNS namespace. This problem emerged with the popularization of the WPAD protocol [31], [33] but remained understudied until the expansion of new gTLDs.

To systematically characterize this threat, we first measure the severity of leaked WPAD query traffic seen in DNS root servers. Figure 2 shows the popular first labels ranked by their average daily query numbers in NXD traffic at DNS root servers A and J from January to July 2015. WPAD protocol is ranked top 4, with over 20 million leaked queries every day, indicating a high severity.

For these leaked WPAD queries to be exploitable, their TLD domains need to be delegated. We studied 738 new gTLDs delegated before August 25, 2015, and found that 65.7% (485) exhibited leaked WPAD queries before their delegation, revealing a significant attack surface. Figure 3 shows the daily query volume and overall query percentage for delegated new gTLD strings with leaked queries, indicating that even though the query percentage is not high, some top ones such as `.global` already have over 30,000 leaked WPAD queries every day. In total, 2.3% of the daily leaked WPAD queries, which are over 238,000 queries per day on average from just two DNS root servers, belong to the delegated new gTLD set.

This comprehensive approach helps in understanding the vulnerability exposed by the new gTLDs and in finding effective solutions to mitigate this threat.