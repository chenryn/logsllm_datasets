### Definition of MPLS Tunnel
An MPLS tunnel is defined as a consecutive series of label-switched routers (LSRs) within the same autonomous system (AS). As described in Section 2, LSRs can be identified by the presence of MPLS extension information in an ICMP "time exceeded" message from a router. It is important to note that this definition only considers the innermost label-switched path (LSP), i.e., the length of the tunnel identified by the sequence of labels at the bottom of the label stack, and does not account for nested LSPs. We will discuss nested tunnels and their lengths later. Additionally, within an AS, there may be some number of Layer 3 (IP) hops before entering or after exiting a tunnel.

In our analysis, we did not detect any instances of a tunnel spanning multiple ASes.

### Data Collection and Analysis
The data used in this study are collected as part of the Archipelago (Ark) project, which includes traceroute measurements to all routed /24 prefixes in the IPv4 Internet, initiated from a set of widely distributed probing hosts. The probing tool used in Ark is Scamper [26], and the specific traceroute method used is ICMP Paris [28]. The Ark project was initiated in 2007, with data available starting from September of that year. However, the version of Scamper used at that time did not support the ICMP extensions for MPLS. Support for these extensions was introduced into Scamper in early 2008, and a version with this support was rolled out to Ark in mid-May 2008 [21, 27]. Therefore, we restrict our analysis to Ark data from June 2008 to August 2011. Instead of analyzing all available Ark data from June 2008 onward, we selected the first full set of data available for each month, resulting in a corpus of over 250 million individual traceroute measurements. Investigating MPLS deployment dynamics at finer levels of granularity is a topic for future study.

The scope of our characterizations is bounded by the Ark measurement data and the placement of probing nodes. However, the Ark project has made significant efforts to be comprehensive, and we believe it provides an important and representative view of Internet structure.

### Additional Data Sources
In addition to Ark data, we used CAIDA's IPv4 prefix-to-AS mapping data, which is based on analysis of Routeviews data [1]. We also used UCLA Cyclops data to classify ASes as tier 1, large ISP, small ISP, or stub network [2]. These data were used to perform AS-specific analyses and to identify the number and characteristics of ASes employing MPLS for traffic management. Since the prefix-to-AS mapping data are based on a measured perspective of Internet routing activity, there are imperfections and complications. In our analyses, we omitted any traceroute paths that had IP addresses for which we did not know the AS number and any IP addresses that had multiple ASes identified in the prefix-to-AS mapping. The overall amount of discarded data is small (under 1%), so we do not believe this materially affects our results.

### Identifying Unique Tunnels
For many analyses, we aimed to identify the set of unique tunnels within an AS. We found that using either the sequence of IP addresses of the LSRs or the sequence of MPLS labels at the bottom of the label stack yielded virtually equivalent results, with differences under 0.01% of the total number of observed tunnels.

### Limitations of Our Analysis
Our analysis relies on the presence of ICMP extension information to positively identify MPLS LSRs. Thus, our analysis is limited to MPLS tunnels configured in uniform mode. While we are certain that there are tunnels configured in pipe mode that evade our analysis, we have no way to quantify or characterize these tunnels. For example, there are ISP-published maps of MPLS networks for which we do not see any (or very few) LSRs in our data (e.g., Sprint’s [6] network map and other maps available at the Internet Topology Zoo project [7]). Additionally, we have no visibility into any MPLS virtual private networks since our measurements are taken from hosts attached to the public Internet.

### MPLS Prevalence
We begin by examining the prevalence of MPLS tunnels and how many ASes appear to use MPLS. The top plot of Figure 2 shows that the number of ASes using MPLS has remained fairly steady over the past three years, at around 7%.

The bottom plot of Figure 2 shows the fraction of ASes, classified by AS type, that are empirically observed to employ MPLS. We observe that nearly all tier 1 providers use MPLS (in October 2008, there were 8 tier 1 providers, and in August 2011, there were 11). A lesser percentage of large ISPs (50–55%) and an even smaller percentage of small ISPs (25–30%) use MPLS. Few stub networks (around 5%) use MPLS. Because there are many stub networks (13,817 in August 2011), the overall percentage of ASes using MPLS is relatively low (around 7%).

### Trends in MPLS Deployment
Figure 3 plots the total number of unique tunnels observed in a given measurement period over the past three years. The figure shows a significant dip in the total number of tunnels beginning in 2008, a rebound in mid-2009, and a steady increase to the current peak of nearly 350,000 tunnels. For comparison, we also plot the Dow Jones Industrial Average in the figure. Interestingly, the total number of MPLS tunnels over time appears to indirectly track this economic indicator (and other similar indicators such as the S&P 500, not shown). While the sheer number of ASes using MPLS is independent of economic activity, the deployment of tunnels within these ASes roughly correlates with economic conditions. Our conjecture is that this phenomenon reflects merger and acquisition activity within the telecom industry. We have engaged ISPs to better understand the underlying reasons behind our observations and hope to report on our findings in the future.

### Distribution of Tunnels
Table 1 identifies the numbers and names of the top 10 ASes in terms of the number of observed MPLS tunnels. The table shows the top 10 ASes for six-month periods starting from mid-2008. These results support the intuition and evidence in the bottom plot of Figure 2 that larger and more complex infrastructures are more likely to use MPLS tunnels.

### Path Characteristics
Lastly, we examine the fraction of paths probed by Ark that include one or more MPLS tunnels. Figure 6 shows the fraction of probing paths that cross at least one MPLS tunnel and the fraction of paths that cross exactly one, two, or three tunnels. Although only about 7% of all ASes are observed to use MPLS, about 25% of all probing paths crossed at least one tunnel in the most recent measurement data. Approximately 4% of all paths cross more than one MPLS tunnel, and this observation holds across the three years. The increase in the likelihood of crossing at least one MPLS tunnel from about 20% in June 2008 to about 25% in August 2011 is primarily due to higher occurrences of encountering a single tunnel on a path. This result is consistent with the fact that larger networks are more likely to appear on end-to-end paths and are more likely to deploy MPLS.

### MPLS Tunnel Characteristics
We now examine characteristics of observed MPLS tunnels, both globally and within different ASes. We first examine first-order path length statistics in ASes. We consider three segments of a path through an AS: IP hops before a tunnel is entered, hops within a tunnel, and IP hops after a tunnel, prior to exiting the AS. For this analysis, we omitted any paths through an AS that contained multiple separate tunnels. Figure 7 shows the average number of pre-tunnel, post-tunnel, and in-tunnel hops over the past three years. We see that the average length of an MPLS tunnel has decreased over the measurement period from just over 4 hops to around 3 hops. This change is likely due to changes in operational policy or underlying infrastructure. We also see that the average number of pre- and post-tunnel hops has remained roughly constant over the past three years, at around 1 hop and 1.8 hops, respectively.

### Average Tunnel Lengths
Figure 8 plots average tunnel lengths over time for four different ASes. We observe a variety of behaviors. While the average length of a tunnel in AS7018 has decreased by around 1 hop over the past three years, the average length of a tunnel in AS6461 has increased by around 2 hops. The average length of a tunnel in AS4230 has increased but is quite short, and the plot for AS3320 shows that tunnels in that AS are currently an average of about 1 hop long.

### One-Hop Tunnels
An interesting phenomenon suggested by Figure 8 is that of very short one-hop MPLS tunnels. In Figure 9, we show the fraction of tunnels over time that consist of one hop, for a set of ASes and globally across all tunnels. We again see a variety of behaviors. While most ASes have very few tunnels of just one hop, the majority of tunnels in AS4134 consist of only one hop, and tunnel lengths in AS3320 have decreased to close to a single hop.

### Label Stack Depths
Virtually no ASes use stacks of three labels. (We observed only a single instance of a label stack of four labels, which was AS3549 in April 2011.) The three ASes shown exhibit much different behavior. While AS7018 used only single-level labels in the earliest measurement period, the majority of its tunnels now employ stacks of two labels. AS2119 was one of the few ASes we observed to employ label stacks of depth 3 (we never observed more than 10 ASes to use 3-deep stacks). We also see that it has very few tunnels that have just a single label on the stack. Lastly, we see that AS19262 has made roughly equal use of label stacks with 1 or 2 labels. In future work, we hope to gain insight into the operational practices that lead to these observed behaviors.

### Traffic Class Identifiers
The MPLS header contains a 3-bit traffic class field, which can be used by ISPs for implementing different quality of service policies and for prioritizing LSPs. Table 2 shows the fraction of ASes employing different unique traffic class identifiers over the first month of the past three years. We see that in January 2009, 68% of all ASes used a single traffic class, 22% used two classes, and about 10% used more than two classes. We also see that traffic class identifier usage was roughly the same in January 2010 and 2011.