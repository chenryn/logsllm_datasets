# Distribution of Packet Loss Over HTTP and HTTPS Sessions in Cellular Networks

In this section, we analyze the distribution of packet loss for HTTP and HTTPS sessions across various cellular networks in different countries. The data presented in Figure 1 illustrates the packet loss percentages for both HTTP and HTTPS sessions, which helps in identifying the presence or absence of Connection Terminating Proxies (CTPs) in these networks.

## Canada
- **Bell Canada**
  - HTTP: 40%
  - HTTPS: 60%
- **Rogers**
  - HTTP: 70%
  - HTTPS: 10%

In Figure 1(b), we observe that both Bell Canada and Rogers networks exhibit similar packet loss for both HTTP and HTTPS sessions. This suggests that either CTPs are not employed in the Bell Canada network, or if they are, they experience the same network conditions as the Rogers network, which does not use CTPs.

## United States
- **Verizon, AT&T, and Sprint**
  - For HTTP sessions, CDN servers experience low packet loss.
  - For HTTPS sessions, CDN servers experience significantly higher packet loss, indicating the presence of CTPs for HTTP sessions.
- **T-Mobile**
  - HTTP: Slightly higher packet loss compared to other networks, suggesting T-Mobile may employ CTPs at only a few locations and domain names in the US.

## Great Britain
- **Telefonica**
  - HTTP: 40%
  - HTTPS: 70%
- **Vodafone**
  - HTTP: 60%
  - HTTPS: 10%

In Figure 1(c), the packet loss for HTTP sessions is significantly lower than for HTTPS sessions, indicating the presence of CTPs for HTTP sessions.

## Germany
- **DTAG**
  - HTTP: 40%
  - HTTPS: 70%
- **Vodafone**
  - HTTP: 60%
  - HTTPS: 10%

Similarly, in Figure 1(d), the packet loss for HTTP sessions is much lower than for HTTPS sessions, indicating the presence of CTPs for HTTP sessions.

## France
- **Bouygues**
  - HTTP: 30%
  - HTTPS: 20%
- **France Telecom**
  - HTTP: 50%
  - HTTPS: 0%
- **SFR**
  - HTTP: 30%
  - HTTPS: 20%

In Figure 1(e), the packet loss for HTTPS sessions in the France Telecom network is similar to that for HTTP sessions, with both being almost zero. This indicates that CTPs are employed by France Telecom for splitting both HTTP and HTTPS sessions.

## Spain
- **Telefonica**
  - HTTP: 40%
  - HTTPS: 70%
- **Vodafone**
  - HTTP: 60%
  - HTTPS: 10%
- **Uni2**
  - HTTP: 30%
  - HTTPS: 20%
- **Jazztel**
  - HTTP: 50%
  - HTTPS: 0%

In Figure 1(f), the packet loss for HTTP sessions is much lower than for HTTPS sessions in Vodafone and Telefonica networks, indicating the presence of CTPs for only HTTP connections. For Uni2 and Jazztel, the packet loss for both HTTP and HTTPS is similar, suggesting that CTPs are used for both types of sessions.

## Detecting CTPs from TCP SYN Characteristics

Our third technique involves analyzing TCP SYN packets to detect the presence of CTPs in cellular networks. We observed that the Initial Congestion Window Size (ICWS), TCP Timestamp, and Maximum Segment Size (MSS) values differ across different types of mobile devices and even when the same device connects to Wi-Fi and cellular networks. By analyzing these characteristics, we can determine whether the SYN packets are generated by a single machine (a CTP) or multiple mobile devices.

### Results
- For cellular carriers where our latency and packet loss-based techniques suggest the presence of CTPs for HTTP sessions, the ICWS and MSS fields in the TCP SYN packets have the same value, and the TCP Timestamp option has monotonically increasing values, indicating the presence of CTPs.
- For networks where our techniques suggest the absence of CTPs for HTTPS sessions, we observed varying values of ICWS, MSS, and TCP Timestamp, indicating that the SYN packets are likely generated by different mobile devices.

### Examples
- **France Telecom (France)**
  - Characteristics of all observed TCP SYN packets to port 443 were similar, indicating the presence of CTPs for HTTPS connections.
- **Telefonica (Spain)**
  - No similar characteristics of observed TCP SYN packets to port 443, indicating the absence of CTPs for splitting HTTPS sessions.

## Discussion

We believe that our latency-based technique can be leveraged to identify the cellular latency offered by carriers where CTPs are present. For such carriers, Client RTT is a reliable indicator of the cellular latency, comprising the sum of radio latency and latency within the cellular backbone.

### Example
- **Telefonica (Spain)**
  - p25 of Client RTT for HTTP sessions (55 ms) reflects Telefonica’s latency over its 4G network.
  - p75 latency (372 ms) reflects its 3G latency.
- **Etisalat (AE)**
  - Wide deployment of 4G, thus the HTTP latency shown in both p25 (30 ms) and p75 (49 ms) represents the latency offered by Etisalat’s 4G network.

## Conclusions

Connection Terminating Proxies (CTPs) are widely used by cellular carriers to optimize TCP connections between servers and client devices. In this paper, we propose three techniques based on latency, loss, and TCP SYN characteristics to passively identify the presence of CTPs. Our extensive measurement study using Akamai server logs demonstrates that these techniques can reliably detect CTPs in cellular networks worldwide. Server operators can use these techniques to optimize communications for different cellular networks, aiming for faster content delivery to end-users.

## Acknowledgments

We thank Ruomei Gao, Chris Heller, Ajay Kumar Miyyapuram, and Kanika Shah for their invaluable insights on refining our data collection process. We also thank the National Science Foundation for supporting this work through grant NSF CNS-1555591.

## References

1. Navigation Timing, August 2015. <http://w3c.github.io/navigation-timing/>
2. NSF Workshop on Achieving Ultra-Low Latencies in Wireless Networks, March 2015. <http://inlab.lab.asu.edu/nsf/files/WorkshopReport.pdf>
3. Real User Monitoring, August 2015. <https://www.akamai.com/us/en/resources/real-user-monitoring.jsp>
4. Unbiased Wireless Network Information, August 2015. <http://www.sensorly.com>
5. Border, J., Kojo, M., Griner, J., Montenegro, G., Shelby, Z.: Performance Enhancing Proxies Intended to Mitigate Link-Related Degradations, June 2001. <https://tools.ietf.org/html/rfc3135>
6. Botta, A., Pescape, A.: Monitoring and measuring wireless network performance in the presence of middleboxes. In: Conference on Wireless On-Demand Network Systems and Services, January 2012
7. Dukkipati, N., Reﬁce, T., Cheng, Y., Chu, J., Herbert, T., Agarwal, A., Jain, A., Sutin, N.: An argument for increasing TCP’s initial congestion window. SIGCOMM CCR 40(3), 26–33 (2010)
8. Ehsan, N., Liu, M., Ragland, R.J.: Evaluation of performance enhancing proxies in internet over satellite. Int. J. Commun. Syst. 16(6), 513–534 (2003)
9. Farkas, V., Héder, B., Nováczki, S.: A split connection TCP proxy in LTE networks. In: Szabó, R., Vidács, A. (eds.) EUNICE 2012. LNCS, vol. 7479, pp. 263–274. Springer, Heidelberg (2012)
10. Gomez, C., Catalan, M., Viamonte, D., Paradells, J., Calveras, A.: Web browsing optimization over 2.5G and 3G: end-to-end mechanisms vs. usage of performance enhancing proxies. Wireless Commun. Mob. Comput. 8, 213–230 (2008)
11. Ivanovich, M., Bickerdike, P., Li, J.: On TCP performance enhancing proxies in a wireless environment. IEEE Commun. Mag. 46, 76–83 (2008)
12. Naylor, D., Schomp, K., Varvello, M., Leontiadis, I., Blackburn, J., Lopez, D., Papagiannaki, K., Rodriguez, P.R., Steenkiste, P.: Investigating transparent web proxies in cellular networks. In: ACM SIGCOMM, August 2015
13. Necker, M., Scharf, M., Weber, A.: Performance of different proxy concepts in UMTS networks. In: Wireless Systems and Mobility in Next Generation Internet, June 2004
14. Thomson, M.: Blind Proxy Caching, July 2015. <https://httpworkshop.github.io/workshop/presentations/thomson-cache.pdf>
15. Wang, Z., Qian, Z., Xu, Q., Mao, Z., Zhang, M.: An untold story of middleboxes in cellular networks. In: ACM SIGCOMM, August 2011
16. Weaver, N., Kreibich, C., Dam, M., Paxson, V.: Here be web proxies. In: Faloutsos, M., Kuzmanovic, A. (eds.) PAM 2014. LNCS, vol. 8362, pp. 183–192. Springer, Heidelberg (2014)
17. Xu, X., Jiang, Y., Flach, T., Katz-Bassett, E., Choffnes, D., Govindan, R.: Investigating transparent web proxies in cellular networks. In: Mirkovic, J., Liu, Y. (eds.) PAM 2015. LNCS, vol. 8995, pp. 262–276. Springer, Heidelberg (2015)