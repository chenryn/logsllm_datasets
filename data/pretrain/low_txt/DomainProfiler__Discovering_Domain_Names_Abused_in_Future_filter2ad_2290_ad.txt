### 数据概览

- **FQDNs数量:**
  - 173,409
  - 172,657
  - 172,384
  - 172,364
  - 172,364

- **TPR/召回率:**
  - 0.973
  - 0.756
  - 0.700
  - 0.746
  - 0.975

- **TNR:**
  - 0.991
  - 0.639
  - 0.815
  - 0.852
  - 0.991

- **精度:**
  - 0.990
  - 0.660
  - 0.779
  - 0.824
  - 0.990

- **F-measure:**
  - 0.982
  - 0.705
  - 0.737
  - 0.783
  - 0.983

- **AUC:**
  - 0.983
  - 0.722
  - 0.794
  - 0.855
  - 0.996

### 随机森林参数优化

如第三节B部分所述，随机森林由多个决策树组成。因此，我们需要预先确定决策树的数量。类似于时间窗口大小的优化，我们通过改变决策树的数量进行10折交叉验证（10-fold CV），以决定最优的决策树数量。图10左侧展示了决策树数量与F-measure的关系。从图中可以看出，当决策树数量超过100时，F-measure趋于稳定。因此，我们决定在后续评估中使用100棵决策树。

另一个参数是每个决策树中采样的特征数量。随机森林通过从输入数据中随机采样特征来构建决策树，从而提高整体准确性。我们再次进行了10折交叉验证，以寻找最优的采样特征数量。图10右侧显示，当采样特征数量为7时，F-measure达到最佳。

### 特征集选择

在选择了最优参数（时间窗口大小、决策树数量和每棵树的采样特征数量）后，本节比较了不同特征集的检测性能。特征集包括时间变化模式（TVP）、相关IP地址（rIP）、相关域名（rDomain）、rIP和rDomain的组合（rIP+rDomain）以及TVP、rIP和rDomain的组合（TVP+rIP+rDomain）。我们使用训练集和最优参数进行了10折交叉验证，以估计每个特征集的理论性能。表IV展示了使用上述评估标准的检测性能。需要注意的是，由于每个特征的可用性不同，FQDN的数量会有所变化。例如，某些域名可能没有rIP或rDomain。此外，图11展示了接收者操作特征曲线（ROC曲线）。ROC曲线显示了一对（FPR, TPR）对应于特定的决策阈值。因此，如果某个特征集的ROC曲线上升得更快，说明该特征集的性能更好。曲线下面积（AUC）是ROC曲线下的面积，通常用于评估二分类器。我们计算了每条ROC曲线的AUC，并将结果列在表IV中。

表IV和图11表明，使用我们的TVP特征可以显著提高检测性能，优于仅使用DNS基础特征。仅使用DNS基础特征（rIP、rDomain和rIP+rDomain）在任何评估标准下都无法超过0.90。这些结果表明，仅使用常见的DNS基础特征不足以在当前攻击生态系统中检测恶意域名。然而，结合DNS基础特征和我们的TVP特征（TVP+rIP+rDomain）达到了最佳结果，即TPR/召回率为0.975，TNR为0.991，精度为0.990，F-measure为0.983。这些结果表明，基于TVP的关键思想对于同时提高TPR和TNR非常有效。

### 系统性能评估

我们评估了DOMAINPROFILER原型版本的系统性能。具体来说，我们在使用训练集和最优参数及最佳特征集（TVP+rIP+rDomain）进行10折交叉验证时，计算了每个步骤的执行时间和数据大小。步骤1（识别TVP）在一个具有10核2.2GHz CPU和128GB RAM的单服务器上执行。从173,409个FQDN中提取TVP特征的执行时间为61秒，相当于每个FQDN 0.0004秒。Alexa和hpHosts的域名列表数据库（SQL）文件大小分别为1.4 GB和300 MB。步骤2（附加DNS基础特征）作为MapReduce作业在Hadoop集群上执行，该集群有2台主服务器（16核2.4GHz CPU，128GB RAM）和16台从服务器（16核2.4GHz CPU，64GB RAM）。从173,409个FQDN中提取rIP特征的执行时间为20小时（每个FQDN 0.42秒），而提取rDomain特征的执行时间为96小时（每个FQDN 1.99秒）。用于提取这些DNS基础特征的历史DNS日志文件大小为212 GB。步骤3（应用机器学习）在同一台服务器上执行。从156,068个FQDN中进行一次性训练的执行时间为28秒（每个FQDN 0.0001秒），从17,341个FQDN中进行测试的执行时间为8秒（每个FQDN 0.0005秒）。这些评估证明了我们所提出系统的可行性，并揭示了步骤2需要比步骤1和步骤3更多的资源和时间。原因是rIP和rDomain的图规模较大。今天，一些超大型公司（如Google、Amazon和Akamai）使用的某些域名具有大量的rIP和rDomain（超过一万个）。这导致提取常见DNS基础特征的成本很高。然而，根据第四节C部分的结果，如果我们使用TVP特征集而不是TVP+rIP+rDomain，可以在牺牲0.002的TPR的情况下解决这个问题。这是系统性能和检测性能之间的权衡。因此，我们应该根据实际情况配置系统。

### 预测检测性能评估

我们评估了DOMAINPROFILER的预测检测性能，即是否能够发现未来可能被滥用的域名。之前的评估基于交叉验证（CV），但本节重点评估使用截至2015年2月28日的信息，对2015年3月1日之后首次出现的新恶意域名的检测性能。具体来说，我们使用表III中的训练集创建了一个学习模型，然后输入表III中的测试集来评估预测检测性能。在这个评估中，我们设置了第四节B部分讨论的最优参数。第四节C部分讨论的最佳特征集（TVP+rIP+rDomain）与仅有常见DNS基础特征的特征集（rIP+rDomain）进行了比较。表V列出了使用TVP+rIP+rDomain的评估结果，表VI列出了使用rIP+rDomain的评估结果。请注意，测试集仅包含恶意域名，因此没有假阳性（FP）和真阴性（TN）及其相关的评估标准。

在真正例率（TPR/召回率）方面，DOMAINPROFILER和特征集（TVP+rIP+rDomain）在所有测试集中都实现了极高的TPR；我们的系统在Honeyclient-Exploit和Honeyclient-Malware中分别实现了0.985的TPR。此外，我们的系统准确地检测/预测了Sandbox-C&C和Pro-C&C中的命令与控制（C&C）域名，尽管我们的训练集中不包含标记的C&C域名。这不是一个令人惊讶的结果，因为我们的TVP旨在利用攻击者域名的共同特征。另一方面，仅使用典型特征（rIP+rDomain）的最佳TPR仅为0.402。比较这些结果表明，我们的TVP特征成功地有助于预测未来可能被使用的恶意域名。

在早期检测未来恶意域名方面，我们调查了系统何时能够检测到这些域名。具体来说，我们分析了从2015年2月28日（学习模型创建的时间）到恶意域名被系统检测到所经过的天数。例如，如果系统在2015年3月7日正确检测并识别了一个新的恶意域名，则该域名的经过天数为7天。表V和表VI还显示了每个特征集的恶意域名经过天数的描述性统计。请注意，我们只统计每个数据集中的TP域名。描述性统计包括最小值（days Min）、第一四分位数（days 1stQu，即切掉前25%数据的值）、第二四分位数（days 2ndQu，也称为中位数，即切掉前50%数据的值）、均值（days Mean）、第三四分位数（days 3rdQu，即切掉前75%数据的值）和最大值（days Max）。表V显示，我们的系统在大多数数据集中都能在较短时间内检测到恶意域名。