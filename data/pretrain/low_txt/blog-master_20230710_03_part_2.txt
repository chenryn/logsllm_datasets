以下是优化后的文本，使其更加清晰、连贯和专业：

---

### 1. 文件列表

```plaintext
-r-xr-xr-x@  1 digoal  staff   6.3M Jan 26  2017 libnnz12.so
-rwxrwxr-x@  1 digoal  staff    43K Jan 26  2017 adrci
-rw-rw-r--@  1 digoal  staff   363B Jan 26  2017 BASIC_README
-rw-rw-r--@  1 digoal  staff    72K Jan 26  2017 xstreams.jar
-r--r--r--@  1 digoal  staff   3.8M Jan 26  2017 ojdbc8.jar
-r-xr-xr-x@  1 digoal  staff   155K Jan 26  2017 libocijdbc12.so
-rwxrwxr-x@  1 digoal  staff   2.1M Jan 26  2017 libocci.so.12.1
-r-xr-xr-x@  1 digoal  staff   526K Jan 26  2017 libmql1.so
-r-xr-xr-x@  1 digoal  staff   2.8M Jan 26  2017 libipc1.so
-rwxrwxr-x@  1 digoal  staff   7.7M Jan 26  2017 libclntshcore.so.12.1
-rwxrwxr-x@  1 digoal  staff    68M Jan 26  2017 libclntsh.so.12.1
drwxrwxr-x@  8 digoal  staff   256B Jan 26  2017 sdk
drwxr-xr-x   9 digoal  staff   288B Jul 12 12:43 ..
lrwxr-xr-x   1 digoal  staff    17B Jul 12 12:44 libclntsh.so -> libclntsh.so.12.1
drwxr-xr-x@ 20 digoal  staff   640B Jul 12 12:44 .

./instantclient_12_2/sdk:
total 632
-rw-rw-r--@  1 digoal  staff   359B Jan 26  2017 SDK_README
drwxrwxr-x@ 31 digoal  staff   992B Jan 26  2017 include
drwxrwxr-x@  3 digoal  staff    96B Jan 26  2017 admin
-rw-rw-r--@  1 digoal  staff   306K Jan 26  2017 ottclasses.zip
-r-xr-xr-x@  1 digoal  staff   874B Jan 26  2017 ott
drwxrwxr-x@ 11 digoal  staff   352B Jan 26  2017 demo
drwxrwxr-x@  8 digoal  staff   256B Jan 26  2017 .
drwxr-xr-x@ 20 digoal  staff   640B Jul 12 12:44 ..

./instantclient_12_2/sdk/include:
total 3408
-r-xr-xr-x@  1 digoal  staff    24K Jan 26  2017 occiObjects.h
-r-xr-xr-x@  1 digoal  staff    39K Jan 26  2017 occiData.h
-r-xr-xr-x@  1 digoal  staff    71K Jan 26  2017 occiControl.h
-r-xr-xr-x@  1 digoal  staff    35K Jan 26  2017 occiCommon.h
-r-xr-xr-x@  1 digoal  staff   2.1K Jan 26  2017 occi.h
-r-xr-xr-x@  1 digoal  staff   8.7K Jan 26  2017 ociextp.h
-r-xr-xr-x@  1 digoal  staff    12K Jan 26  2017 ocidfn.h
-r-xr-xr-x@  1 digoal  staff   4.0K Jan 26  2017 ocidem.h
-r-xr-xr-x@  1 digoal  staff    42K Jan 26  2017 ocidef.h
-r-xr-xr-x@  1 digoal  staff   6.1K Jan 26  2017 ociapr.h
-r-xr-xr-x@  1 digoal  staff   428K Jan 26  2017 ociap.h
-r-xr-xr-x@  1 digoal  staff    10K Jan 26  2017 oci8dp.h
-r-xr-xr-x@  1 digoal  staff   7.0K Jan 26  2017 oci1.h
-r-xr-xr-x@  1 digoal  staff   190K Jan 26  2017 oci.h
-r-xr-xr-x@  1 digoal  staff    11K Jan 26  2017 occiAQ.h
-r-xr-xr-x@  1 digoal  staff   9.7K Jan 26  2017 xa.h
-r-xr-xr-x@  1 digoal  staff   121K Jan 26  2017 ort.h
-r-xr-xr-x@  1 digoal  staff    42K Jan 26  2017 oro.h
-r-xr-xr-x@  1 digoal  staff   155K Jan 26  2017 orl.h
-r-xr-xr-x@  1 digoal  staff    15K Jan 26  2017 orid.h
-r-xr-xr-x@  1 digoal  staff   100K Jan 26  2017 ori.h
-r-xr-xr-x@  1 digoal  staff   6.4K Jan 26  2017 oratypes.h
-r-xr-xr-x@  1 digoal  staff    32K Jan 26  2017 odci.h
-r-xr-xr-x@  1 digoal  staff   109K Jan 26  2017 ocixstream.h
-r-xr-xr-x@  1 digoal  staff   7.9K Jan 26  2017 ocixmldb.h
-r-xr-xr-x@  1 digoal  staff   6.3K Jan 26  2017 ocikpr.h
-r-xr-xr-x@  1 digoal  staff    77K Jan 26  2017 nzt.h
-r-xr-xr-x@  1 digoal  staff    37K Jan 26  2017 nzerror.h
-r-xr-xr-x@  1 digoal  staff    44K Jan 26  2017 ldap.h
drwxrwxr-x@ 31 digoal  staff   992B Jan 26  2017 .
drwxrwxr-x@  8 digoal  staff   256B Jan 26  2017 ..

./instantclient_12_2/sdk/admin:
total 24
-r-xr-xr-x@ 1 digoal  staff   9.8K Jan 26  2017 oraaccess.xsd
drwxrwxr-x@ 3 digoal  staff    96B Jan 26  2017 .
drwxrwxr-x@ 8 digoal  staff   256B Jan 26  2017 ..

./instantclient_12_2/sdk/demo:
total 152
-rwxrwxr-x@  1 digoal  staff   4.2K Jan 26  2017 demo.mk
-r-xr-xr-x@  1 digoal  staff   6.6K Jan 26  2017 setuporamysql.sh
-r-xr-xr-x@  1 digoal  staff   1.1K Jan 26  2017 oraaccess.xml
-r-xr-xr-x@  1 digoal  staff    60B Jan 26  2017 occiobj.typ
-r-xr-xr-x@  1 digoal  staff   4.8K Jan 26  2017 occiobj.cpp
-r-xr-xr-x@  1 digoal  staff   7.5K Jan 26  2017 occidml.cpp
-r-xr-xr-x@  1 digoal  staff   1.9K Jan 26  2017 occidemod.sql
-r-xr-xr-x@  1 digoal  staff   8.2K Jan 26  2017 occidemo.sql
-r-xr-xr-x@  1 digoal  staff    17K Jan 26  2017 cdemo81.c
drwxrwxr-x@  8 digoal  staff   256B Jan 26  2017 ..
drwxrwxr-x@ 11 digoal  staff   352B Jan 26  2017 .
```

### 2. 下载大型源码包

为减少在Docker构建过程中因下载失败导致的构建失败概率，请下载以下较大的源码包：

```bash
cd ~/pg14
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L http://faculty.cse.tamu.edu/davis/GraphBLAS/GraphBLAS-3.1.1.tar.gz -o GraphBLAS-3.1.1.tar.gz
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://api.pgxn.org/dist/datasketches/1.7.0/datasketches-1.7.0.zip -o datasketches-1.7.0.zip
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://github.com/duckdb/duckdb/releases/download/v0.9.2/libduckdb-linux-amd64.zip -o libduckdb-linux-amd64.zip
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://github.com/duckdb/duckdb/releases/download/v0.9.2/libduckdb-src.zip -o libduckdb-src.zip
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://github.com/duckdb/duckdb/releases/download/v0.9.2/duckdb_cli-linux-amd64.zip -o duckdb_cli-linux-amd64.zip
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://github.com/Kitware/CMake/releases/download/v3.27.4/cmake-3.27.4.tar.gz -o cmake-3.27.4.tar.gz
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://github.com/Kitware/CMake/releases/download/v3.27.9/cmake-3.27.9-linux-x86_64.tar.gz -o cmake-3.27.9-linux-x86_64.tar.gz
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://github.com/mongodb/mongo-c-driver/releases/download/1.17.3/mongo-c-driver-1.17.3.tar.gz -o mongo-c-driver-1.17.3.tar.gz
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://github.com/json-c/json-c/archive/json-c-0.15-20200726.tar.gz -o json-c-0.15-20200726.tar.gz
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://github.com/microsoft/onnxruntime/releases/download/v1.15.1/onnxruntime-linux-x64-1.15.1.tgz -o onnxruntime-linux-x64-1.15.1.tgz
curl -Z --connect-timeout 120 -m 36000 --retry 12000 --retry-delay 5 --retry-max-time 1200 -L https://nodejs.org/download/release/v14.21.3/node-v14.21.3.tar.gz -o node-v14.21.3.tar.gz
```

### 3. 预编译 `pg_task` 模块

为了防止在制作Docker镜像时因下载失败而导致构建失败，可以预编译 `pg_task` 模块：

```bash
cd pg14
docker cp pg:/usr/lib/postgresql/14/lib/pg_task.so ./
docker cp pg:/usr/lib/postgresql/14/lib/bitcode/pg_task ./
docker cp pg:/usr/lib/postgresql/14/lib/bitcode/pg_task.index.bc ./
docker cp pg:/usr/share/postgresql/14/extension/pg_task.control ./
docker cp pg:/usr/share/postgresql/14/extension/pg_task--1.0.sql ./
```

### 4. 安装 `pghero`

`pghero` 目前仅支持x86版本。请确保网络授权已开启，否则无法访问。

```bash
cd /tmp
wget -T 36000 -t 0 --waitretry=5 -qO- https://dl.packager.io/srv/pghero/pghero/key | apt-key add -
echo "deb https://dl.packager.io/srv/deb/pghero/pghero/master/debian 11 main" > /etc/apt/sources.list.d/pghero.list

for ((i=1;i>=0;i=1))
do
  apt-get update
  if [ $? -eq 0 ]; then
    break 
  fi
done

for ((i=1;i>=0;i=1))
do
  apt-get install -y --download-only pghero
  if [ $? -eq 0 ]; then
    break 
  fi
done

# 如果apt-get install报错, 表示 pghero 网络问题导致无法apt安装, 直接下载.
wget https://dl.packager.io/srv/pghero/pghero/downloads/223434?token=eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJkbC5wYWNrYWdlci5pbyIsInN1YiI6InBhY2thZ2UjMjIzNDM0IiwiaWF0IjoxNzA0MTg0OTEzLCJleHAiOiIxNzA0MTg4NTEzIn0.gxdWl8Cr5R3AXVI36s2W2e_i5w27kcxQTMthl1MS72g -O pghero_3.4.0-1701207987.0382b812.bullseye_amd64.deb
dpkg -i pghero_3.4.0-1701207987.0382b812.bullseye_amd64.deb
```

### 5. 其他插件和工具

#### `plrust`
- ARM版本编译：[plrust arm版本编译](https://github.com/digoal/blog/blob/master/202402/20240201_04.md)
- DEB包下载：[plrust releases](https://github.com/tcdi/plrust/releases)

#### `pgroll`
- BIN包下载：[pgroll releases](https://github.com/xataio/pgroll/releases)（文件名全部更名为 `pgroll`）

#### 参考文档
- **pg_tiktoken**：[PostgreSQL 或PolarDB 使用插件pg_tiktoken](../202307/20230706_05.md)
- **lantern_extras**：[PolarDB|PG AI 功能练习插件: lantern_extras](../202309/20230922_01.md)
- **pg_bm25, pg_search, svector, pg_analytics**：[PostgreSQL pg_bm25(open source by paradedb)](../202310/20231016_03.md), [Introducing ParadeDB](https://blog.paradedb.com/pages/introducing_paradedb)
- **pg_idkit**：[PostgreSQL pg_idkit: 集成大量uuid方法和函数插件](../202312/20231224_01.md)
- **PgDD**：[PostgreSQL PgDD: PostgreSQL Data Dictionary for 开发者](../202312/20231224_03.md)
- **pgmq, pg_later, pg_vectorize**：[PGMQ](../202401/20240108_01.md), [pg_later](../202401/20240108_02.md), [pg_vectorize](../202401/20240108_03.md)

### 6. 准备脚本

为减少Dockerfile步骤，建议先手工制作后再用Dockerfile来制作。以下是准备脚本的示例：

```bash
cd ~/pg14
vi 1.sh
```

```bash
#!/bin/bash
set -vx
cd /tmp
sed -i "s@http://\(deb\|security\).debian.org@http://mirrors.aliyun.com@g" /etc/apt/sources.list
apt-get update
apt-get reinstall -y apt-transport-https ca-certificates
sed -i "s@http://mirrors.aliyun.com@https://mirrors.aliyun.com@g" /etc/apt/sources.list
apt-get update
apt-get install -y lsb-release wget vim man
echo "deb https://mirrors.tuna.tsinghua.edu.cn/postgresql/repos/apt/ $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list
apt-get install -y gnupg2
wget --quiet -O - https://mirrors.tuna.tsinghua.edu.cn/postgresql/repos/apt/ACCC4CF8.asc | apt-key add -
apt-get update
apt-get install -y locales
localedef -i en_US -f UTF-8 en_US.UTF-8
apt-get install -y curl libicu-dev icu-devtools libbison-dev libfl-dev git libreadline-dev libedit-dev g++ make cmake man-db dnsutils clang libssl-dev default-jdk strace gdb libsqlite3-dev lsof blktrace
apt-get install -y unixodbc unixodbc-dev bash-completion m4 python3-distutils python glibc-source zlib1g-dev pkg-config default-jre openjdk-17-jdk openjdk-17-jdk-headless
apt-get install -y postgresql-14 postgresql-client-14 postgresql-server-dev-14 postgresql-doc-14
apt-get install -y postgresql-14-dirtyread postgresql-14-extra-window-functions postgresql-14-first-last-agg postgresql-14-hll postgresql-14-hypopg
apt-get install -y postgresql-14-ip4r postgresql-14-mysql-fdw postgresql-14-jsquery postgresql-14-ogr-fdw postgresql-14-oracle-fdw postgresql-14-pgmemcache
apt-get install -y postgresql-14-pljava postgresql-14-pllua postgresql-14-plpgsql-check postgresql-14-plproxy postgresql-14-prefix postgresql-14-rational
apt-get install -y postgresql-14-rdkit postgresql-14-orafce postgresql-14-pg-qualstats postgresql-14-pg-stat-kcache
apt-get install -y postgresql-14-pg-wait-sampling postgresql-14-pgfincore postgresql-14-pgaudit postgresql-14-pgpool2 postgresql-14-pgrouting postgresql-14-pgrouting-doc
apt-get install -y postgresql-14-pgrouting-scripts postgresql-14-pgsphere postgresql-14-pgvector postgresql-14-pldebugger postgresql-14-pointcloud postgresql-14-plr
apt-get install -y postgresql-14-postgis-3 postgresql-14-postgis-3-scripts postgresql-14-powa powa-collector postgresql-14-q3c postgresql-14-repack
apt-get install -y postgresql-14-rum postgresql-14-show-plans postgresql-14-similarity postgresql-14-tablelog postgresql-14-tdigest postgresql-14-wal2json
apt-get install -y postgresql-14-tds-fdw postgresql-14-plprofiler postgresql-14-cron
apt-get install -y pgagroal pgpool2 pgbouncer pgxnclient pgagent postgresql-plpython3-14 postgresql-14-icu-ext libpq-dev pgreplay pgbackrest pgbackrest-doc elephant-shed-pgbackrest postgresql-14-partman
cd /tmp
dpkg -i pghero_3.4.0-1701207987.0382b812.bullseye_amd64.deb
echo "deb https://packagecloud.io/timescale/timescaledb/debian/ $(lsb_release -c -s) main" | tee /etc/apt/sources.list.d/timescaledb.list
wget --quiet -O - https://packagecloud.io/timescale/timescaledb/gpgkey | gpg --dearmor -o /etc/apt/trusted.gpg.d/timescaledb.gpg
apt-get update
apt-get install -y timescaledb-2-postgresql-14
wget https://packages.groonga.org/debian/groonga-apt-source-latest-bullseye.deb
apt-get install -y -V ./groonga-apt-source-latest-bullseye.deb
apt-get update
apt-get install -y postgresql-14-pgdg-pgroonga
apt-get install -y postgresql-14-credcheck postgresql-14-decoderbufs postgresql-14-mimeo postgresql-14-pgmp postgresql-14-preprepare postgresql-14-prioritize postgresql-14-squeeze postgresql-14-toastinfo postgresql-14-unit pgbadger pg-auto-failover-cli postgresql-14-auto-failover net-tools apt-utils ora2pg pgloader pg-activity
cd /tmp
wget -T 36000 -t 0 --waitretry=5 https://repo.mysql.com//mysql-apt-config_0.8.29-1_all.deb
dpkg -i mysql-apt-config_0.8.29-1_all.deb
apt-key adv --keyserver pgp.mit.edu --recv-keys 3A79BD29
apt-get update
apt-get install -y mysql-server
```

---

希望这些优化后的文本能帮助你更好地理解和执行相关操作。