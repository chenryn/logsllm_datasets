### Figures and Data

- **Figure 18: Median Latency for All Files Fetched**
- **Figure 19: Median Latency for Files Smaller than 1KB**
- **Figure 20: Median Latency for Files Larger than 8KB**

### Analysis of Latency Data

In Figure 18, we present the median latencies experienced by each client. The data indicates that ETX (Expected Transmission Count) reduces latencies for clients farther from the web server. This aligns with our earlier findings, which show that ETX generally outperforms HOP (Hop Count) on longer paths. For hosts 23, 100, and 20, the median latency under ETX is approximately 20% lower than under HOP. These hosts are relatively distant from the web server running on host 128. Conversely, for host 1, which is just one hop away from the web server, the median latency under HOP is 20% lower. These results are consistent with those in Section 5.4, where it was observed that ETX performs better on longer paths, while HOP can be more effective on one-hop paths.

To further investigate the impact of ETX on different file sizes, we analyzed the median response times for small objects (files less than 1KB) and large objects (files over 8KB). These medians are depicted in Figures 19 and 20, respectively. The benefits of ETX are more pronounced for larger transfers, but it also significantly reduces the latency of small transfers. This is particularly interesting because the data sent in small transfers fits within a single TCP packet. Even for such short transfers, the paths selected by ETX are superior.

### Discussion

From our results, we conclude that load sensitivity is the primary factor determining the relative performance of the three metrics. The RTT (Round-Trip Time) metric is the most sensitive to load, suffering from self-interference even on one-hop paths and showing the worst performance. The PktPair (Packet Pair) metric, while not affected by load generated by the probing node, is sensitive to other channel loads, leading to self-interference on multi-hop paths and degraded performance. The ETX metric, with the least sensitivity to load, performs the best.

Our experience with HOP suggests that its performance is highly sensitive to competing factors controlling the presence of poor links in the link cache. During a long data transfer, the link cache initially contains a complete topology, including many poor links. The shortest-path Dijkstra computation selects a route that may include these poor links. As the transfer progresses, Route Maintenance detects link failures and removes failed links from the link caches. Since poor links fail more frequently, the route gradually improves. However, if too many links are removed, the route can become increasingly longer, eventually leading to no available route and triggering Route Discovery again. Conversely, background network traffic tends to repopulate the link cache with both good and bad links, due to the caching of link existence from overheard or forwarded packets. The balance between these two factors—removing and adding links—determines the quality of the HOP metric's routes. For example, when we modified LQSR (Link Quality Source Routing) to stop sending Link Info messages, we observed a significant improvement in median TCP throughput. This is because the background load of Link Info messages was repopulating the link caches too quickly, reducing the effectiveness of Route Error messages.

### Limitations and Future Work

Our study has several limitations. First, our data traffic is entirely artificial; we would prefer to measure the performance of real network traffic generated by actual users. Second, we did not investigate packet loss and jitter with constant-bit-rate datagram traffic, which is relevant to multimedia traffic. We also plan to study other wireless link quality metrics, such as signal strength.

### Mobile Scenario

In previous traffic scenarios, all nodes were stationary. In community networks like [6, 27, 26], most nodes are likely to be stationary. However, in many ad hoc wireless networks, at least some nodes are mobile. Here, we consider a scenario involving a single mobile node and compare the performance of ETX and HOP metrics.

The layout of our testbed is shown in Figure 2. We set up a TCP receiver on node 100. We slowly and steadily walked around the periphery of the network with a Dell Latitude Laptop equipped with a NetGear card. A process running on this laptop repeatedly established a TCP connection to the receiver on node 100 and transferred as much data as possible in 1 minute. We conducted 15 such transfers in each walk-about, performing 3 walk-abouts each for ETX and HOP, resulting in 45 TCP transfers for each metric. The median throughput of these 45 transfers, along with SIQR (Semi-Interquartile Range), is shown in Figure 21. We chose the median over the mean due to the highly skewed distribution of throughputs. The median throughput under HOP is 36% higher than under ETX. Note that the SIQR for ETX is 173, comparable to the SIQR of 188 for HOP. Since the median throughput under ETX is lower, the higher SIQR indicates greater variability in throughput under ETX.

As the sender moves, the ETX metric does not react quickly enough to track changes in link quality, leading to routing based on stale and sometimes incorrect information. The salvaging mechanisms in LQSR help to some extent but do not fully overcome the problem. Our results with PktPair (not included here) indicate that this issue is not limited to ETX. Any approach measuring link quality needs time to stabilize, and if the mobile user moves significantly during this period, the link quality measurements will be inaccurate. We are investigating the possibility of improving ETX performance by more aggressively penalizing the metric on data packet drops.

The HOP metric, on the other hand, quickly uses new links as they are discovered. The efficacy of various DSR (Dynamic Source Routing) mechanisms in improving performance in mobile environments is well-documented [15]. The metric also removes any link from the link cache after a single packet loss, a mechanism that, while detrimental under heavy load, benefits it in mobile scenarios.

We emphasize that this experiment is not intended to draw general conclusions about the suitability of any metric for routing in mobile wireless networks. Such conclusions cannot be drawn from a single experiment. This experiment underscores that static and mobile wireless networks present different challenges, and solutions effective in one setting may not be as effective in another.

### Related Work

There is extensive literature comparing the performance of various ad hoc routing protocols, primarily through simulations. Most studies focus on scenarios with significant node mobility. For example, Broch et al. [7] compared the performance of DSDV [23], TORA [22], DSR [15], and AODV [24] via simulations.

The problem of devising a link-quality metric for static 802.11 ad hoc networks has been studied previously. De Couto et al. [9] proposed ETX and compared its performance to HOP using DSDV and DSR with a small-datagram workload. Their study differed from ours in several aspects. They concluded that ETX outperformed HOP with DSDV but found little benefit with DSR. They only studied the throughput of single, short (30-second) data transfers using small datagrams and included no mobility.

In contrast, we studied TCP transfers, examined the impact of multiple simultaneous data transfers, and looked at variable-length data transfers, particularly web-like workloads where latency is more important than throughput. Our work also includes a scenario with some mobility. Differences in DSR implementation may partly explain the different results. Their implementation lacked Metric Maintenance mechanisms and used 802.11 link-layer acknowledgments for failure detection, making their link-failure detection less vulnerable to loss or perceived loss due to delay. They also did not support salvaging and used a "blacklist" mechanism for asymmetric links.

Woo et al. [28] examined the interaction of link quality and ad hoc routing for sensor networks, using passive observation of packet reception probability. They compared several routing protocols, including shortest-path routing with thresholding and ETX-based distance-vector routing. Their study used rate-limited datagram traffic and concluded that ETX-based routing is more robust.

Signal-to-noise ratio (SNR) has been used as a link quality metric in several routing schemes for mobile ad hoc networks. For example, [12] uses an SNR threshold value to filter links discovered by DSR Route Discovery. The main problem with these schemes is that they may exclude necessary links for maintaining connectivity. Another approach, used in [11], classifies links as good or bad based on a threshold but allows the use of poor-quality links to maintain connectivity. Punnoose et al. [25] also use signal strength as a link quality metric, converting predicted signal strength into a link quality factor. Zhao and Govindan [29] studied packet delivery performance in sensor networks and found that high signal strength implies low packet loss, but low signal strength does not necessarily imply high packet loss. We plan to study the SNR metric in our testbed as part of future work.

Awerbuch et al. [4] studied the impact of automatic rate selection on the performance of ad hoc networks, proposing a routing algorithm that selects a path with minimum transmission time. Their metric does not account for packet loss, and it is possible to combine this metric with ETX to study the performance of the combined metric. This is also part of our future work.

An implementation of AODV that uses the link-filtering approach, based on measurement of unicast probe loss rates, was demonstrated in a recent IETF meeting [3, 19]. We plan to test this implementation in our testbed.

### Conclusions

We have examined the performance of three candidate link-quality metrics for ad hoc routing and compared them to minimum hop-count routing. Our results, based on several months of experiments using a 23-node static ad hoc network in an office environment, show that with stationary nodes, the ETX metric significantly outperforms hop-count. The RTT and PktPair metrics perform poorly due to load sensitivity and self-interference. However, in a mobile scenario, hop-count performs better because it reacts more quickly to fast topology changes.

### Acknowledgments

Yih-Chun Hu implemented DSR within the MCL framework as part of his internship project, which was our starting point for developing LQSR. We thank Atul Adya, Victor Bahl, and Alec Wolman for their helpful discussions and suggestions. We also thank the anonymous reviewers for their feedback and the support staff at Microsoft Research for their assistance with system administration issues.

### References

[1] A. Adya, P. Bahl, J. Padhye, A. Wolman, and L. Zhou. A multi-radio unification protocol for IEEE 802.11 wireless networks. In BroadNets, 2004.
[2] D. G. Andersen, H. Balakrishnan, M. F. Kaashoek, and R. Morris. Resilient overlay networks. In SOSP, 2001.
[3] AODV@IETF. http://moment.cs.ucsb.edu/aodv-ietf/.
[4] B. Awerbuch, D. Holmer, and H. Rubens. High throughput route selection in multirate ad hoc wireless networks. Technical report, Johns Hopkins CS Dept, March 2003. v 2.
[5] P. Bardford and M. Crovella. Generating representative web workloads for network and server performance evaluation. In SIGMETRICS, Nov. 1998.
[6] Bay Area Wireless Users Group. http://www.bawug.org/.
[7] J. Broch, D. Maltz, D. Johnson, Y.-C. Hu, and J. Jetcheva. A performance comparison of multi-hop wireless ad hoc network routing protocols. In MOBICOM, Oct. 1998.
[8] D. De Couto. Personal communication, Nov. 2003.
[9] D. De Couto, D. Aguayo, J. Bicket, and R. Morris. High-throughput path metric for multi-hop wireless routing. In MOBICOM, Sep 2003.
[10] R. Draves, J. Padhye, and B. Zill. The architecture of the Link Quality Source Routing Protocol. Technical Report MSR-TR-2004-57, Microsoft Research, 2004.
[11] T. Goﬀ, N. Abu-Aahazaleh, D. Phatak, and R. Kahvecioglu. Preemptive routing in ad hoc networks. In MOBICOM, 2001.