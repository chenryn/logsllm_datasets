**主文件表（MFT）概述**

主文件表（Master File Table，简称MFT）是NTFS文件系统的核心组成部分。MFT由一系列称为MFT项或文件记录的条目组成，每个条目的前16字节为头结构，用于描述该MFT项的相关信息；其余部分则存储了各种属性。

- 每个文件和目录在MFT中至少对应一个条目。
- 访问除引导扇区外的所有其他文件之前都需要先访问MFT，并通过查找相应的MFT项来获取文件的具体位置及其它相关信息。

**MFT的分类**

MFT中的条目可以分为两类：元文件与普通文件。

- **元文件**：用户无法直接访问，MFT保留了最初的16个文件记录专门用于存放这些系统级别的元数据文件。
- **普通文件**：除了上述元文件之外的所有文件记录均属于这一类别，涵盖了常规用户文件及目录等。

**元文件详解**

这16个特殊的元文件实际上也是遵循MFT格式的特殊文件，它们主要负责记录有关MFT自身的信息。具体来说：

- `#define MFT_IDX_MFT 0` —— 主文件表
- `#define MFT_IDX_MFT_MIRR 1` —— MFT镜像
- `#define MFT_IDX_LOG_FILE 2` —— 日志文件
- ...
- `#define MFT_IDX_USER 16` —— 用户定义起始点

例如，解析`MFT_IDX_VOLUME (索引3)`这个MFT结构能够帮助我们获得关于NTFS卷版本(`ATTR_TYPE_VOLUME_INFORMATION`)以及名称(`ATTR_TYPE_VOLUME_NAME`)的信息。

**如何解析元文件的MFT结构？**

要访问特定的元文件，首先需要定位到MBR（主引导记录），然后通过DBR（DOS引导记录）找到MFT。从这里开始，按照固定的偏移量依次读取各个元文件对应的MFT条目。

**解析元文件的作用**

通过对这些预设的元文件进行分析，我们可以了解到整个文件系统的许多关键细节，比如总容量、已用空间、重要配置参数等等。

**普通MFT项**

当遍历MFT时，只有从第17个条目开始才是真正的用户级文件和目录信息。

**MFT的数据结构**

- 文件记录头部包含一些基本信息如类型标识符(`FILE`)、更新序列号偏移等。
- 接下来的部分则是具体的属性列表，每个属性都有自己的头部和体部。常见的属性包括文件名(`AttributeFileName, 0x30`)和数据块(`AttributeData, 0x80`)等。

这种层次化的组织方式使得NTFS能够在保持高效的同时提供丰富的功能支持。