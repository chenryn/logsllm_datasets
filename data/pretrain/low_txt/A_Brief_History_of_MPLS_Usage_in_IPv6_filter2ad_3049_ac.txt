### Purpose and Methodology

To achieve our objective, we selected a subset of MPLS traces obtained before October 2014 and attempted to find similar pure IP traces after this date. Specifically, we checked whether the same sequence of IP addresses between Ingress and Egress Label Edge Routers (LERs) existed both before and after October 2014, or if the two edge routers appeared to be directly connected afterward. Our analysis revealed that equivalent traces were found before and after the specified date, with the only difference being the absence of MPLS labels post-October 2014. This led us to conclude that Cogent had phased out MPLS, as they had done for IPv4 two years prior. To validate this conclusion, we contacted a Cogent network administrator who confirmed our findings.

### Key Observations

The second, and more intriguing, observation is that although most of Cogent's Label Switched Paths (LSPs) have a stack size of at least 2, they never use a bottom label of 2, which is the default value for 6PE (IPv6 Provider Edge). This contrasts with the dominant usage in other Autonomous Systems (ASes), as discussed in Section 3.2. It is important to note that RFC 4798 [18] does not mandate the use of label 2 as the bottom label. Instead, BGP at the Egress router assigns a label to each IPv6 prefix and announces it to its iBGP peers. Consequently, a 6PE implementation can choose any arbitrary label for 6PE or assign a different label for each prefix or set of prefixes.

Upon analyzing Cogent's LSP stacks, it became evident that the bottom label is not fixed but varies significantly. For example, we found one instance where 38 distinct bottom labels were in use for a given (Ingress, Egress) pair. Theoretically, this could indicate 38 distinct Virtual Private Networks (VPNs) or, more likely, the Egress router using a distinct bottom label for each (group of) IPv6 prefix. Our Cogent contact helped us rule out the VPN scenario, confirming that Cogent did not use this technology but only 6PE before discontinuing MPLS for IPv6 in October 2014.

### Load Sharing and ECMP

One potential purpose of using distinct bottom labels is load sharing. In a network utilizing Equal Cost Multipath (ECMP), packets arriving at a router with two equal-cost routes for the destination are distributed along these routes based on a packet header hash. In an MPLS and ECMP environment, LSPs constructed by LDP signaling can leverage multiple paths, creating several LSPs between the same pair of Label Switching Routers (LSRs). For Cogent, it is clear that ECMP is employed in the core network. For instance, in the case of the Egress router with 38 distinct bottom labels, after removing the bottom label, there still exist 8 distinct LSPs between this pair of routers (considering IP addresses and top labels).

For IPv4 packets, the hash function considers at least the IP addresses to ensure all packets in the same flow follow the same route, thus avoiding ordering issues with TCP. The same can be done for IPv6 packets, though it is more computationally expensive due to the length of IPv6 addresses. In the context of 6PE, core routers may be entirely unaware of IPv6. In such cases, using the bottom label to split the load makes sense, as mentioned in Cisco documentation [26]. The combination of many routes (ECMP), hence top labels, and many distinct 6PE bottom labels results in a large number of unique LSPs when considering the full label stack. This partially explains why Cogent is so prevalent in terms of unique IPv6 MPLS tunnels in our dataset, beyond its sheer size. Several mechanisms, such as those proposed by Kompella et al. [27], have been suggested to enable MPLS networks to benefit from multiple paths. Additionally, there have been proposals to allow RSVP-TE to directly use multiple ECMP paths [28].

### Analysis Using LPR

To further investigate and identify the root cause of this variety of label stacks, we applied the Label Pattern Recognition (LPR) algorithm [7] to the top labels of Cogent's IPv6 MPLS traces. This was done to quantify the usage of LDP (for IGP-BGP scalability purposes—Mono-FEC in Table 2) and/or RSVP-TE (for traffic engineering purposes—Multi-FEC in Table 2). The LPR algorithm analyzes LSPs going through the same Ingress-Egress pair. If two LSPs are built through LDP, the incoming top labels should be identical at converging routers. Conversely, if they are built through RSVP-TE, the incoming top labels should differ. There is also the possibility that both protocols are used, constructing different LSPs according to the intended service. Our analysis, already apparent in the case of the Egress with 38 distinct LSPs, shows that the top label is mostly generated by LDP (Mono-FEC line in Table 2). Therefore, our interpretation is that the bottom label is assigned by the Egress router on a per IPv6 prefix basis using a variant of 6PE, to make more efficient use of ECMP, while the top label (i.e., the LSP itself) is built using LDP for IPv4.

### Conclusion

In recent years, the deployment and usage of IPv6 have increased, driven by the depletion of IPv4 addresses. This trend is expected to accelerate, leading to more IPv6 networks in the near future. In this paper, we focused on a specific aspect of IPv6 deployment related to MPLS: how is MPLS deployed and used under IPv6, and is its usage significantly different from IPv4? Based on traceroute data collected by CAIDA, we sought to answer these questions.

Our initial observations indicated that the technical usage of MPLS differs significantly between IPv4 and IPv6. Specifically, in the way label stacks are used, we found that while stacks of more than one label are not common in IPv4, they are the norm in IPv6. However, this difference is not due to an increase in BGP MPLS VPN usage. We explained that IPv6 MPLS primarily uses 6PE tunnels, which are built using an IPv4 signaling protocol (particularly LDP for IPv4). This allows MPLS for IPv6 to be deployed across a network where some routers are not dual-stack, or where LDP is not available for IPv6 (the IPv6 version was only recently released). Thus, this can be seen as a transitional mechanism, and it will be interesting to observe how this usage evolves as more networks become fully IPv6 compliant.

The special case of the Cogent network provided insights into the use of ECMP multipath in conjunction with MPLS. We argued that this network uses a specific form of 6PE to facilitate the selection of outgoing interfaces by IPv6 routers.

### References

1. Dhamdhere, A., Luckie, M., Huﬀaker, B., Claﬀy, K., ELmokashﬁ, A., Aben, E.: Measuring the deployment of IPv6: topology, routing, and performance. In: Proceedings of ACM Internet Measurement Conference (IMC), November 2012
2. Czyz, J., Allman, M., Zhang, J., Iekel-Johnson, S., Osterweil, E., Bailey, M.: Measuring IPv6 adoption. In: Proceedings of ACM SIGCOMM, August 2014
3. American Registry for Internet Numbers (ARIN): IPv4 depletion, September 2015. https://www.arin.net/resources/request/ipv4 countdown.html
4. Sommers, J., Eriksson, B., Barford, P.: On the prevalence and characteristics of MPLS deployments in the open Internet. In: Proceedings of ACM Internet Measurement Conference (IMC), November 2011
5. Donnet, B., Luckie, M., M´erindol, P., Pansiot, J.J.: Revealing MPLS tunnels obscured by traceroute. ACM SIGCOMM Comput. Commun. Rev. 42(2), 87–93 (2012)
6. Pathak, A., Zhang, M., Hu, Y.C., Mahajan, R., Maltz, D.: Latency inflation with MPLS-based traffic engineering. In: Proceedings of ACM Internet Measurement Conference (IMC), November 2011
7. Vanaubel, Y., M´erindol, P., Pansiot, J.J., Donnet, B.: MPLS under the microscope: revealing actual transit path diversity. In: Proceedings of ACM Internet Measurement Conference (IMC), October 2015
8. Rosen, E., Visanathan, A., Callon, R.: Multiprotocol label switching architecture. RFC 3031, Internet Engineering Task Force, January 2001
9. Andersson, L., Asati, R.: Multiprotocol label switching (MPLS) label stack entry: EXP field renamed to traffic class field. RFC 5462, Internet Engineering Task Force, February 2009
10. Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y., Farinacci, D., Li, T., Conta, A.: MPLS label stack encoding. RFC 3032, Internet Engineering Task Force, January 2001
11. Agarwal, P., Akyol, B.: Time-to-live (TTL) processing in multiprotocol label switching (MPLS) networks. RFC 3443, Internet Engineering Task Force, January 2003
12. Andersson, L., Minei, I., Thomas, T.: LDP specifications. RFC 5036, Internet Engineering Task Force, October 2007
13. Awduche, D., Berger, L., Gan, D., Li, T., Srinivasan, V., Swallow, G.: RSVP-TE: extensions to RSVP for LSP tunnels. RFC 3209, Internet Engineering Task Force, December 2001
14. Muthukrishnan, K., Malis, A.: A core MPLS IP VPN architecture. RFC 2917, Internet Engineering Task Force, September 2000
15. George, W., Pignataro, C.: Gap analysis for operating IPv6-only MPLS networks. RFC 7439, Internet Engineering Task Force, January 2015
16. Asati, R., Pignataro, C., Raza, K., Manral, V., Papneja, R.: Updates to LDP for IPv6. RFC 7552, Internet Engineering Task Force, June 2015
17. De Clercq, J., Ooms, D., Carugi, M., Le Faucheur, F.: BGP-MPLS IP virtual private network (VPN) extension for IPv6 VPN. RFC 4659, Internet Engineering Task Force, September 2006
18. De Clercq, J., Ooms, D., Prevost, S., Le Faucheur, F.: Connecting IPv6 islands over IPv4 MPLS using IPv6 provider edge routers (6PE). RFC 4798, Internet Engineering Task Force, February 2007
19. Bonica, R., Gan, D., Tappan, D., Pignataro, C.: ICMP extensions for multiprotocol label switching. RFC 4950, Internet Engineering Task Force, August 2007
20. Hinden, R., Deering, S.: IP version 6 addressing architecture. RFC 4291, Internet Engineering Task Force, February 2006
21. CAIDA: The CAIDA UCSD IPv6 topology dataset, September 2015. http://www.caida.org/data/active/ipv6 allpref topology dataset.xml
22. Augustin, B., Cuvellier, X., Orgogozo, B., Viger, F., Friedman, T., Latapy, M., Magnien, C., Teixeira, R.: Avoiding traceroute anomalies with Paris traceroute. In: Proceedings of ACM Internet Measurement Conference (IMC), October 2006
23. Luckie, M.: Scamper: a scalable and extensible packet prober for active measurement of the Internet. In: Proceedings of ACM Internet Measurement Conference, November 2010
24. Giotsas, V., Luckie, M., Huﬀaker, B., Claﬀy, K.: IPv6 AS relationships, clique, and congruence. In: Proceedings of Passive and Active Measurement Conference (PAM), March 2015
25. Leber, M.: IPv6 Internet broken, Cogent/Telia/Hurricane not peering, October 2009. Nanog Mailing-list. http://mailman.nanog.org/pipermail/nanog/2009-October/014017.html
26. Cisco: Cisco IOS IPv6 over MPLS, products data sheet. http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/provider router (6PE) edge, October 2015. http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/09186a008052edd3.html#wp39913
27. Kompella, K., Drake, J., Amante, S., Henderickx, W., Yong, L.: The use of entropy labels in MPLS forwarding. RFC 6790, Internet Engineering Task Force, November 2012
28. Kompella, K., Hellers, M., Singh, R.: Multi-path label switched paths signaled using RSVP-TE. Internet Draft (Work in Progress) draft-kompella-mpls-rsvp-ecmp-06, Internet Engineering Task Force, March 2015