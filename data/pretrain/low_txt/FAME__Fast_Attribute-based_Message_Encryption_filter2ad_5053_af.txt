### Per Matrix Row and Decryption Requirements
For each matrix row, the decryption process requires 9 pairings per attribute. In contrast, our KP-ABE scheme (Figure B.1) performs significantly better.

### References
1. Zeutro LLC - Encryption and Data Security. <http://www.zeutro.com/>
2. Attribute-based Encryption. <https://github.com/sagrawal87/ABE>, 2017.
3. M. Abe, J. Groth, M. Ohkubo, and T. Tango. Converting cryptographic schemes from symmetric to asymmetric bilinear groups. In J. A. Garay and R. Gennaro, editors, CRYPTO 2014, Part I, volume 8616 of LNCS, pages 241–260. Springer, Heidelberg, Aug. 2014.
4. S. Agrawal and M. Chase. A study of pair encodings: Predicate encryption in prime order groups. In E. Kushilevitz and T. Malkin, editors, TCC 2016-A, Part II, volume 9563 of LNCS, pages 259–288. Springer, Heidelberg, Jan. 2016.
5. S. Agrawal and M. Chase. Simplifying design and analysis of complex predicate encryption schemes. In J. Coron and J. B. Nielsen, editors, EUROCRYPT 2017, Part I, volume 10210 of LNCS, pages 627–656. Springer, Heidelberg, May 2017.
6. J. A. Akinyele, C. Garman, and S. Hohenberger. Automating fast and secure translations from type-I to type-III pairing schemes. In I. Ray, N. Li, and C. Kruegel, editors, ACM CCS 15, pages 1370–1381. ACM Press, Oct. 2015.
7. J. A. Akinyele, C. Garman, I. Miers, M. W. Pagano, M. Rushanan, M. Green, and A. D. Rubin. Charm: a framework for rapidly prototyping cryptosystems. Journal of Cryptographic Engineering, pages 111–128, 2013.
8. J. A. Akinyele, M. Green, and S. Hohenberger. Using SMT solvers to automate design tasks for encryption and signature schemes. In A.-R. Sadeghi, V. D. Gligor, and M. Yung, editors, ACM CCS 13, pages 399–410. ACM Press, Nov. 2013.
9. J. A. Akinyele, M. W. Pagano, M. D. Green, C. U. Lehmann, Z. N. J. Peterson, and A. D. Rubin. Securing electronic medical records using attribute-based encryption on mobile devices. In SPSM '11, pages 75–86, 2011.
10. N. Attrapadung. Dual system encryption via doubly selective security: Framework, fully secure functional encryption for regular languages, and more. In P. Q. Nguyen and E. Oswald, editors, EUROCRYPT 2014, volume 8441 of LNCS, pages 557–577. Springer, Heidelberg, May 2014.
11. N. Attrapadung. Dual system encryption framework in prime-order groups via computational pair encodings. In J. H. Cheon and T. Takagi, editors, ASIACRYPT 2016, Part II, volume 10032 of LNCS, pages 591–623. Springer, Heidelberg, Dec. 2016.
12. R. Baden, A. Bender, N. Spring, B. Bhattacharjee, and D. Starin. Persona: an online social network with user-defined privacy. In ACM SIGCOMM 2009, pages 135–146, 2009.
13. A. Beimel. Secret-sharing schemes: A survey. In Coding and Cryptology, pages 11–46, 2011.
14. M. Bellare and P. Rogaway. Random oracles are practical: A paradigm for designing efficient protocols. In V. Ashby, editor, ACM CCS 93, pages 62–73. ACM Press, Nov. 1993.
15. M. Bellare and P. Rogaway. Optimal asymmetric encryption. In A. D. Santis, editor, EUROCRYPT'94, volume 950 of LNCS, pages 92–111. Springer, Heidelberg, May 1995.
16. J. Bethencourt, A. Sahai, and B. Waters. Ciphertext-policy attribute-based encryption. In 2007 IEEE Symposium on Security and Privacy, pages 321–334. IEEE Computer Society Press, May 2007.
17. D. Boneh, X. Boyen, and H. Shacham. Short group signatures. In M. Franklin, editor, CRYPTO 2004, volume 3152 of LNCS, pages 41–55. Springer, Heidelberg, Aug. 2004.
18. J. Camenisch, M. Dubovitskaya, R. R. Enderlein, and G. Neven. Oblivious transfer with hidden access control from attribute-based encryption. In I. Visconti and R. D. Prisco, editors, SCN 12, volume 7485 of LNCS, pages 559–579. Springer, Heidelberg, Sept. 2012.
19. J. Chen, R. Gay, and H. Wee. Improved dual system ABE in prime-order groups via predicate encodings. In E. Oswald and M. Fischlin, editors, EUROCRYPT 2015, Part II, volume 9057 of LNCS, pages 595–624. Springer, Heidelberg, Apr. 2015.
20. J. Chen, R. Gay, and H. Wee. Improved dual system ABE in prime-order groups via predicate encodings. Cryptology ePrint Archive, Report 2015/409, 2015. <http://eprint.iacr.org/2015/409>
21. J. Chen and H. Wee. Fully, (almost) tightly secure IBE and dual system groups. In R. Canetti and J. A. Garay, editors, CRYPTO 2013, Part II, volume 8043 of LNCS, pages 435–460. Springer, Heidelberg, Aug. 2013.
22. A. Escala, G. Herold, E. Kiltz, C. Ràfols, and J. Villar. An algebraic framework for Diffie-Hellman assumptions. In R. Canetti and J. A. Garay, editors, CRYPTO 2013, Part II, volume 8043 of LNCS, pages 129–147. Springer, Heidelberg, Aug. 2013.
23. D. M. Freeman. Converting pairing-based cryptosystems from composite-order groups to prime-order groups. In H. Gilbert, editor, EUROCRYPT 2010, volume 6110 of LNCS, pages 44–61. Springer, Heidelberg, May 2010.
24. S. Galbraith. New discrete logarithm records, and the death of type-1 pairings. <https://ellipticnews.wordpress.com/2014/02/01/new-discrete-logarithm-records-and-the-death-of-type-1-pairings/>, 2014.
25. S. D. Galbraith, K. G. Paterson, and N. P. Smart. Pairings for cryptographers. Discrete Applied Mathematics, pages 3113–3121, 2008.
26. E. Ghadafi, N. P. Smart, and B. Warinschi. Groth-Sahai proofs revisited. In P. Q. Nguyen and D. Pointcheval, editors, PKC 2010, volume 6056 of LNCS, pages 177–192. Springer, Heidelberg, May 2010.
27. V. Goyal, A. Jain, O. Pandey, and A. Sahai. Bounded ciphertext policy attribute based encryption. In L. Aceto, I. Damgård, L. A. Goldberg, M. M. Halldórsson, A. Ingólfsdóttir, and I. Walukiewicz, editors, ICALP 2008, Part II, volume 5126 of LNCS, pages 579–591. Springer, Heidelberg, July 2008.
28. V. Goyal, O. Pandey, A. Sahai, and B. Waters. Attribute-based encryption for fine-grained access control of encrypted data. In A. Juels, R. N. Wright, and S. Vimercati, editors, ACM CCS 06, pages 89–98. ACM Press, Oct. / Nov. 2006. Available as Cryptology ePrint Archive Report 2006/309.
29. V. Goyal, O. Pandey, A. Sahai, and B. Waters. Attribute-based encryption for fine-grained access control of encrypted data. Cryptology ePrint Archive, Report 2006/309, 2006. <http://eprint.iacr.org/2006/309>
30. M. Green and S. Hohenberger. Universally composable adaptive oblivious transfer. In J. Pieprzyk, editor, ASIACRYPT 2008, volume 5350 of LNCS, pages 179–197. Springer, Heidelberg, Dec. 2008.
31. M. Green, S. Hohenberger, and B. Waters. Outsourcing the decryption of ABE ciphertexts. In USENIX Security Symposium 2011, pages 34–34, 2011.
32. M. D. Green and I. Miers. Forward secure asynchronous messaging from puncturable encryption. In 2015 IEEE Symposium on Security and Privacy, pages 305–320. IEEE Computer Society Press, May 2015.
33. A. Guillevic. Comparing the pairing efficiency over composite-order and prime-order elliptic curves. In M. J. Jacobson Jr., M. E. Locasto, P. Mohassel, and R. Safavi-Naini, editors, ACNS 13, volume 7954 of LNCS, pages 357–372. Springer, Heidelberg, June 2013.
34. A. Guillevic, F. Morain, and E. Thomé. Solving discrete logarithms on a 170-bit MNT curve by pairing reduction. Cryptology ePrint Archive, Report 2016/507, 2016. <http://eprint.iacr.org/2016/507>
35. G. Herold, J. Hesse, D. Hofheinz, C. Ràfols, and A. Rupp. Polynomial spaces: A new framework for composite-to-prime-order transformations. In J. A. Garay and R. Gennaro, editors, CRYPTO 2014, Part I, volume 8616 of LNCS, pages 261–279. Springer, Heidelberg, Aug. 2014.
36. S. Hohenberger and B. Waters. Attribute-based encryption with fast decryption. In K. Kurosawa and G. Hanaoka, editors, PKC 2013, volume 7778 of LNCS, pages 162–179. Springer, Heidelberg, Feb. / Mar. 2013.
37. A. Joux. SAC 2013, chapter A New Index Calculus Algorithm with Complexity \(L(1/4+o(1))\) in Small Characteristic, pages 355–379, 2014.
38. J. Katz, A. Sahai, and B. Waters. Predicate encryption supporting disjunctions, polynomial equations, and inner products. In N. P. Smart, editor, EUROCRYPT 2008, volume 4965 of LNCS, pages 146–162. Springer, Heidelberg, Apr. 2008.
39. T. Kim and R. Barbulescu. Extended tower number field sieve: A new complexity for the medium prime case. In M. Robshaw and J. Katz, editors, CRYPTO 2016, Part I, volume 9814 of LNCS, pages 543–571. Springer, Heidelberg, Aug. 2016.
40. L. Kowalczyk and A. B. Lewko. Bilinear entropy expansion from the decisional linear assumption. In R. Gennaro and M. J. B. Robshaw, editors, CRYPTO 2015, Part II, volume 9216 of LNCS, pages 524–541. Springer, Heidelberg, Aug. 2015.
41. A. B. Lewko. Tools for simulating features of composite order bilinear groups in the prime order setting. In D. Pointcheval and T. Johansson, editors, EUROCRYPT 2012, volume 7237 of LNCS, pages 318–335. Springer, Heidelberg, Apr. 2012.
42. A. B. Lewko, T. Okamoto, A. Sahai, K. Takashima, and B. Waters. Fully secure functional encryption: Attribute-based encryption and (hierarchical) inner product encryption. In H. Gilbert, editor, EUROCRYPT 2010, volume 6110 of LNCS, pages 62–91. Springer, Heidelberg, May 2010.
43. A. B. Lewko, A. Sahai, and B. Waters. Revocation systems with very small private keys. In 2010 IEEE Symposium on Security and Privacy, pages 273–285. IEEE Computer Society Press, May 2010.
44. A. B. Lewko and B. Waters. Unbounded HIBE and attribute-based encryption. In K. G. Paterson, editor, EUROCRYPT 2011, volume 6632 of LNCS, pages 547–567. Springer, Heidelberg, May 2011.
45. B. Libert, T. Peters, M. Joye, and M. Yung. Compactly hiding linear spans - tightly secure constant-size simulation-sound QA-NIZK proofs and applications. In T. Iwata and J. H. Cheon, editors, ASIACRYPT 2015, Part I, volume 9452 of LNCS, pages 681–707. Springer, Heidelberg, Nov. / Dec. 2015.
46. T. Okamoto and K. Takashima. Fully secure functional encryption with general relations from the decisional linear assumption. In T. Rabin, editor, CRYPTO 2010, volume 6223 of LNCS, pages 191–208. Springer, Heidelberg, Aug. 2010.
47. T. Okamoto and K. Takashima. Fully secure unbounded inner-product and attribute-based encryption. In X. Wang and K. Sako, editors, ASIACRYPT 2012, volume 7658 of LNCS, pages 349–366. Springer, Heidelberg, Dec. 2012.
48. R. Ostrovsky, A. Sahai, and B. Waters. Attribute-based encryption with non-monotonic access structures. In P. Ning, S. D. C. di Vimercati, and P. F. Syverson, editors, ACM CCS 07, pages 195–203. ACM Press, Oct. 2007.
49. B. Parno, M. Raykova, and V. Vaikuntanathan. How to delegate and verify in public: Verifiable computation from attribute-based encryption. In R. Cramer, editor, TCC 2012, volume 7194 of LNCS, pages 422–439. Springer, Heidelberg, Mar. 2012.
50. Y. Rouselakis and B. Waters. Practical constructions and new proof methods for large universe attribute-based encryption. In A.-R. Sadeghi, V. D. Gligor, and M. Yung, editors, ACM CCS 13, pages 463–474. ACM Press, Nov. 2013.
51. Y. Rouselakis and B. Waters. Efficient statically-secure large-universe multi-authority attribute-based encryption. In R. Böhme and T. Okamoto, editors, FC 2015, volume 8975 of LNCS, pages 315–332. Springer, Heidelberg, Jan. 2015.
52. A. Sahai and B. R. Waters. Fuzzy identity-based encryption. In R. Cramer, editor, EUROCRYPT 2005, volume 3494 of LNCS, pages 457–473. Springer, Heidelberg, May 2005.
53. N. Santos, R. Rodrigues, K. P. Gummadi, and S. Saroiu. Policy-sealed data: A new abstraction for building trusted cloud services. In USENIX Security Symposium 2012, pages 175–188, 2012.
54. H. Shacham. A Cramer-Shoup encryption scheme from the linear assumption and from progressively weaker linear variants. Cryptology ePrint Archive, Report 2007/074, 2007. <http://eprint.iacr.org/2007/074>
55. P. Traynor, K. R. B. Butler, W. Enck, and P. McDaniel. Realizing massive-scale conditional access systems through attribute-based cryptosystems. In NDSS 2008. The Internet Society, Feb. 2008.
56. B. Waters. Dual system encryption: Realizing fully secure IBE and HIBE under simple assumptions. In S. Halevi, editor, CRYPTO 2009, volume 5677 of LNCS, pages 619–636. Springer, Heidelberg, Aug. 2009.
57. B. Waters. Ciphertext-policy attribute-based encryption: An expressive, efficient, and provably secure realization. In D. Catalano, N. Fazio, R. Gennaro, and A. Nicolosi, editors, PKC 2011, volume 6571 of LNCS, pages 53–70. Springer, Heidelberg, Mar. 2011.
58. H. Wee. Dual system encryption via predicate encodings. In Y. Lindell, editor, TCC 2014, volume 8349 of LNCS, pages 616–637. Springer, Heidelberg, Feb. 2014.
59. B. Yang, K. Yang, Y. Qin, Z. Zhang, and D. Feng. DAA-TZ: An efficient DAA scheme for mobile devices using ARM TrustZone, pages 209–227. Springer International Publishing, Cham, 2015.

### CP-ABE Correctness
We show that when \( S \) satisfies \((M, \pi)\), decryption recovers the correct message with probability 1. For \(\ell = 1, 2, 3\),

\[
\prod_{i \in I} \text{ct}_{\gamma_i, i, \ell} = \prod_{i \in I} \left( \prod_{j=1}^{n^2} H(\pi(i)_{\ell 1})^{\gamma_i s_1} \cdot H(\pi(i)_{\ell 2})^{\gamma_i s_2} \right) \cdot \left( \prod_{j=1}^{n^2} H(0_{j \ell 1})^{s_1} \cdot H(0_{j \ell 2})^{s_2} \right)^{\gamma_i (M)_{i, j}}
\]

\[
= \left( \prod_{j=1}^{n^2} H(0_{j \ell 1})^{s_1} \cdot H(0_{j \ell 2})^{s_2} \right)^{\sum_{i \in I} \gamma_i (M)_{i, j}} \cdot \prod_{i \in I} \left( H(\pi(i)_{\ell 1})^{\gamma_i s_1} \cdot H(\pi(i)_{\ell 2})^{\gamma_i s_2} \right)
\]

\[
= H(0_{1 \ell 1})^{s_1} \cdot H(0_{1 \ell 2})^{s_2} \cdot \prod_{i \in I} \left( H(\pi(i)_{\ell 1})^{\gamma_i s_1} \cdot H(\pi(i)_{\ell 2})^{\gamma_i s_2} \right)
\]

where the third equality follows from (2.1).

Now, the product of all but the first term in the numerator is given by

\[
\prod_{t \in \{1, 2\}} \left( \prod_{i \in I} e(H(0_{1 t}), h)^{b_1 r_1 s_t} \cdot e(H(0_{2 t}), h)^{b_2 r_2 s_t} \cdot e(H(\pi(i)_{1 t})^{\gamma_i}, h)^{b_1 r_1 s_t} \cdot e(H(\pi(i)_{2 t})^{\gamma_i}, h)^{b_2 r_2 s_t} \cdot e(H(\pi(i)_{3 t})^{\gamma_i}, h)^{(r_1 + r_2) s_t} \right)
\]

When the above product is divided by the denominator, it is easy to see that we are only left with the inverse of

\[
\left( \prod_{t \in \{1, 2\}} \left( \prod_{i \in I} \sigma'_{a_t}^{\gamma_i \sigma_{\pi(i)}} \right) \cdot \left( \prod_{i \in I} \sigma'_{a_3}^{-\gamma_i \sigma_{\pi(i)}} \right) \right)
\]

which is just equal to \( e(g, h)^{d_1 a_1 s_1 + d_2 a_2 s_2 + d_3 (s_1 + s_2)} \). Hence, the message is successfully recovered.

### KP-ABE Scheme
The scheme is formally described in Figure B.1. Correctness and security of this scheme can be proved in a manner very similar to that of Fame. Note that unlike CGW’s KP-ABE scheme [20, Appendix B.1], our scheme does not put an a-priori bound on the number of columns in the MSP.

### Proof of Main Theorem
#### Description of Hybrids
Hyb1 has already been discussed at length in §4.1. We now provide a formal description of the rest of the hybrids and then prove the security of Fame. Before that, it would be useful to give names to the various forms of ciphertext and keys that will be used. A key can be in one of the following forms:
- **Normal**: Generated in Hyb1.
- **P-normal**: \( B_r \) replaced by \( B_r + \hat{r} a^\perp \) in a Normal key, where \(\hat{r} \leftarrow_R \mathbb{Z}_p\).
- **P-normal\(^*\)**: \(\sigma_y a^\perp\) for all \( y \in S \) and \(\sigma' a^\perp\) removed from a P-normal key.
- **Normal\(^*\)**: \( B_r + \hat{r} a^\perp \) replaced by \( B_r \) in a P-normal\(^*\) key.
- **P-SF\(^*\)**: \(\alpha a^\perp\) added to the last component (sk') of a P-normal\(^*\) key, where \(\alpha \leftarrow_R \mathbb{Z}_p\).
- **SF\(^*\)**: \( B_r + \hat{r} a^\perp \) replaced by \( B_r \) in a P-SF\(^*\) key.

A ciphertext can be either:
- **Normal\(^*\)**: Generated in Hyb1.
- **SF\(^*\)**: \( A_s \) replaced by \( A_s + \hat{s} b^\perp \) in a Normal\(^*\) ciphertext, where \(\hat{s} \leftarrow_R \mathbb{Z}_p\).
- **Rnd\(^*\)**: \( \text{msg} b \) replaced by \( \text{msg}^* \), where \( \text{msg}^* \leftarrow_R \mathbb{G}_T \).

P and SF stand for pseudo and semi-functional, respectively, following the terminology in previous work [19, 21, 42, 56].

The first objective of our proof is to remove the extra \(\sigma_y a^\perp\) and \(\sigma' a^\perp\) components from all the keys. To do this, we change the form of the very first key from Normal to P-normal in Hyb2,1,1, then change it to P-normal\(^*\) in Hyb2,2,1, and finally to Normal\(^*\).