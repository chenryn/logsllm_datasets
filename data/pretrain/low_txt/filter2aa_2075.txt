# "Get Off of My Cloud": Cloud Credential Compromise and Exposure

**Authors:**
- Ben Feinstein
- Jeff Jarmoc

**Organization:**
- Dell SecureWorks Counter Threat Unit℠

---

## 1. The Public Cloud

### 1.1 Brief Introduction to the Amazon Cloud

#### Terminology and Definitions:
- **Amazon Web Services (AWS):** A comprehensive and broadly adopted cloud platform, offering over 200 fully featured services from data centers globally.
- **Elastic Compute Cloud (EC2):** A web service that provides resizable compute capacity in the cloud.
- **Amazon Machine Image (AMI):** A pre-configured template for an EC2 instance.
- **Simple Storage Service (S3):** An object storage service that offers industry-leading scalability, data availability, security, and performance.
- **Elastic Block Store (EBS):** A block storage system designed for use with EC2 instances.

---

## 2. AWS Security Credentials

### 2.1 Access Credentials
- **Access Keys:**
  - **Access Key ID:** A unique identifier included in each API request.
  - **Secret Access Key:** Used to calculate a digital signature for API requests, ensuring their authenticity.
  - Managed via the "Access Keys" tab on the "AWS Security Credentials" page.
  - Used for REST, Query, and SOAP APIs of various AWS products.
  - Amazon recommends rotating Access Keys every 90 days for security.

- **X.509 Certificates:**
  - Can be generated by AWS or provided by the user.
  - Managed via the "X.509 Certificates" tab on the "AWS Security Credentials" page.
  - Used for making requests to AWS product SOAP APIs (except S3 and Mechanical Turk).
  - Also used for bundling AMIs, which are encrypted and signed using the user’s certificate and private key.
  - Amazon recommends replacing X.509 Certificates every 90 days.

- **Amazon EC2 Key Pairs:**
  - Created and managed through the Amazon EC2 API or any tool using the API.
  - Comprised of a private key, public key, and a key pair name.
  - Used for launching and connecting to EC2 instances, including root SSH access for Linux/UNIX instances and administrative Remote Desktop access for Windows instances.
  - No explicit rotation recommendations from Amazon.

- **CloudFront Key Pairs:**
  - Can be generated by AWS or provided by the user.
  - Comprised of a private key, public key, and a key pair name.
  - Used to generate signed URLs for accessing private CloudFront content.
  - Amazon recommends rotating CloudFront key pairs every 90 days.
  - CloudFront also uses Access Keys to authenticate requests to the CloudFront control API.

### 2.2 Sign-In Credentials
- **Email Address & Password:**
  - An Amazon.com account activated for AWS services.
  - Used for accessing secure areas of the AWS website, Management Console, Discussion Forums, and Premium Support.
  - Recommended password complexity includes at least 8 characters, both uppercase and lowercase letters, at least one numeric digit, and one special character.
  - AWS Multi-Factor Authentication is recommended for additional protection but is not enforced.

- **AWS Multi-Factor Authentication:**
  - An optional feature for enhanced security.
  - Uses a six-digit code generated by a user’s authentication device, such as the Gemalto Ezio Time Token.
  - Protects secure pages on the AWS Portal and the Management Console but not the Premium Support site or AWS service APIs.

### 2.3 Account Identifiers
- **AWS Account ID:**
  - A 12-digit number used for bundling Linux/UNIX AMIs and sharing AWS resources with other accounts.
- **Canonical User ID:**
  - Used to share Amazon S3 resources with other AWS accounts.

---

## 3. Prior Research and Precedents

### 3.1 Previous Studies
- **"Cloud Computing Models and Vulnerabilities: Raining on the Trendy New Parade"**
  - Authors: Alex Stamos, Andrew Becherer, Nathan Wilcox
  - Presented at Black Hat USA 2009 and DEF CON 17.
  - Demonstrated methods to gain prime placement in the AWS list of available AMIs and the ease of getting users to run untrustworthy AMIs.

- **"Cloud Security: Amazon's EC2 serves up 'certified pre-owned' server images"**
  - Author: Alen Puzic, TippingPoint DVLabs
  - Published on April 11, 2011.
  - Discussed the risks associated with certified pre-owned server images on AWS.

### 3.2 Related Research
- **Center for Advanced Security Research Darmstadt:**
  - Released the AMI aiD (AMID) tool on Google Code, which helps detect and mitigate security issues in AMIs.

---

## 4. Common Mistakes and Pitfalls

### 4.1 Mistakes When Creating Public or Shared AMIs
- **AMI Filesystem:**
  - Inclusion of sensitive information such as AWS Cert + Private Key, SSH Key Pairs, SSL certs and private keys, Bash history files, and environmental variable exports.
  
### 4.2 Signs of a Compromised / Malicious AMI
- **Indicators:**
  - Presence of unauthorized SSH keys, rootkits, trojaned binaries, open sockets, and trojaned custom Xen kernels.

### 4.3 Expanding on "Evil AMIs"
- **Quantifying the Scale of Potential Victims:**
  - Analyzing the size and number of instances, AWS Regions and Availability Zones, and the impact of AWS Security Groups on remote SSH access.

---

## 5. Tools and Frameworks

### 5.1 AMIexposed Tool
- **Overview:**
  - An extensible framework for scanning AMIs for common credential leakage and security problems.
  - Uses Amazon's APIs to automate the generation of image lists, launching instances, running tests, and recording findings to a database.

### 5.2 Test Modules
- **Tests:**
  - Presence of SSH authorized_keys, SSH identity keys, AWS x.509 certificate (.pem) files, active connections to other hosts, and enabled SSH password authentication.

### 5.3 System File Tests
- **Files:**
  - .bash_history, .vim_info, .bash_profile, .bashrc, and anything under /etc/profile.d.
  - Checks for AWS Access Key or Secret Key strings, Canonical ID, AWS Account ID, and environment variable names.

---

## 6. Results and Findings

- **Findings:**
  - Coordinated with the Amazon Web Services security team.
  - To be presented during DEF CON, with updated slides available online after the presentation.

---

## 7. New Guidance from Amazon

- **Resources:**
  - **"Sharing AMIs Safely"** in the Amazon EC2 User Guide.
  - **"Reminder about Safely Sharing and Using Public AMIs"** in the AWS Security Bulletin.
  - **"How To Share and Use Public AMIs in A Secure Manner"** in the AWS Tutorial.

---

## 8. Obtaining Trustworthy Amazon Machine Images

- **Options:**
  - **AWS-Supported and Maintained Images:**
    - Available with support from the AWS Premium Support service.
    - Regular security updates via AWS package repositories.
    - Predictable and documented product lifecycle and AMI updates.
  - **Third-Party Vendors:**
    - Provide their own images.
  - **Customized Images:**
    - Organizations can use AWS-supported images as a foundation for their own customized images.

---

## 9. Q&A

---