# Shaping Detection Results per ISP

Table 5: Shaping detection results for six popular applications (YouTube, Netflix, Spotify, Skype, Viber, and Google Hangout) across different ISPs in our dataset. The table indicates the difference in average throughput (%) when shaping occurs. A dash (-) signifies no differentiation, (f) indicates that IP addresses change for each connection, (p) indicates a "translucent" proxy modifies connection behavior, and (m) indicates that a middlebox modified content in flight between client and server. *For the H2O network, replays with random payloads perform better than VPN and exposed replays, indicating a policy that favors non-video HTTP over streaming video.

## Observations and Challenges

While attempting to detect differentiation, we identified other behaviors that prevented us from identifying shaping. For example, Boost transcodes YouTube videos to a lower quality and caches the result for future requests. Other networks use proxies to alter TCP behavior. Such devices are common in mobile networks.

## Discussion

### Assigning Blame
When differentiation is detected, we generally attribute it to the access network from which the test was launched. While theoretically, any network along the path could cause differentiation, transit networks typically lack the incentive to do so. Future work will involve combining results from multiple vantage points to identify cases where differentiation is caused by an intermediate network rather than the access network.

### Differentiation Against VPN Traffic
A challenge arises when recording traces of app-generated network traffic over a production network. If both recorded and replayed traffic are shaped, a naive detector might indicate no differentiation. One solution is to allow users to run traces captured from a well-provisioned network that does not shape traffic. This approach, however, does not reveal when there is a problem. To address this, we need to detect if the VPN traffic itself is subject to differentiation. We can attempt to disguise replay traffic using different servers, ports, and control traffic techniques.

### Data Caps
Some providers offer "unlimited" data plans with reduced data rates after a certain cap. We may be able to identify this by combining results from multiple users or by monitoring data usage via Android APIs.

## Conclusion

We presented and evaluated a new tool for accurately detecting differentiation using a VPN to record and replay traffic generated by apps, improving transparency in mobile networks. Our findings show extensive use of middleboxes that break end-to-end principles in mobile networks and their impact on applications. From a network neutrality perspective, observed shaping policies and third-party modifications are concerning. There is little research into the impact of such devices, and policymakers have limited guidance. We are making our results public through a website to improve transparency and guide future policies. Additionally, we are investigating how to fingerprint middleboxes and understand their impacts on a wide range of applications.

## Acknowledgements

We thank the anonymous reviewers for their helpful comments. This research was partially supported by NSF grants CNS-1054233, CNS-1318396, CNS-1319019, CNS-1350720, and a Google Faculty Research Award.

## References

[1] Experimenting with QUIC. http://blog.chromium.org/2013/06/experimenting-with-quic.html.
[2] Neubot – the network neutrality bot. http://www.neubot.org.
[3] V. Bashko, N. Melnikov, A. Sehgal, and J. Schonwalder. Bonaﬁde: A traffic shaping detection tool for mobile networks. In IFIP/IEEE International Symposium on Integrated Network Management (IM2013), 2013.
[4] D. Clark. Network neutrality: Words of power and 800-pound gorillas. International Journal of Communication, 2007.
[5] W. Cui, V. Paxson, N. Weaver, and R. H. Katz. Protocol-independent adaptive replay of application dialog. In Proc. of NDSS, 2006.
[6] M. Dischinger, M. Marcon, S. Guha, K. P. Gummadi, R. Mahajan, and S. Saroiu. Glasnost: Enabling end users to detect traffic differentiation. In Proc. of USENIX NSDI, 2010.
[7] FCC announces “Measuring Mobile America” program. http://www.fcc.gov/document/fcc-announces-measuring-mobile-america-program.
[8] FCC. Order 10-201: Preserving the open internet. https://apps.fcc.gov/edocs_public/attachmatch/FCC-10-201A1_Rcd.pdf, December 2010.
[9] FCC. Protecting and promoting the open internet. https://www.federalregister.gov/articles/2015/04/13/2015-07841/protecting-and-promoting-the-open-internet, April 2015.
[10] G. Hasslinger and O. Hohlfeld. The Gilbert-Elliott model for packet loss in real-time services on the Internet, 2008.
[11] S. Higginbotham. The Netflix–Comcast agreement isn’t a network neutrality violation, but it is a problem. http://gigaom.com/2014/02/23/the-netflix-comcast-agreement-isnt-a-network-neutrality-violation-but-it-is-a-problem/, February 2014.
[12] J. Hui, K. Lau, A. Jain, A. Terzis, and J. Smith. How YouTube performance is improved in T-Mobile network. http://velocityconf.com/velocity2014/public/schedule/detail/35350.
[13] P. Kanuparthy and C. Dovrolis. ShaperProbe: end-to-end detection of ISP traffic shaping using active methods. In Proc. of IMC, 2011.
[14] C. Kreibich, N. Weaver, B. Nechaev, and V. Paxson. Netalyzr: Illuminating the edge network. In Proc. of IMC, 2010.
[15] M. Luckie, A. Dhamdhere, D. Clark, B. Huffaker, and k. claffy. Challenges in inferring internet interdomain congestion. In Proc. of IMC, 2014.
[16] R. Mahajan, M. Zhang, L. Poole, and V. Pai. Uncovering performance differences among backbone ISPs with Netdiff. In Proc. of USENIX NSDI, 2008.
[17] J. Mayer. How Verizon’s advertising header works. http://webpolicy.org/2014/10/24/how-verizons-advertising-header-works/.
[18] Measurement Lab Consortium. ISP interconnection and its impact on consumer internet performance. http://www.measurementlab.net/blog/2014_interconnection_report, October 2014.
[19] A. Nikravesh, H. Yao, S. Xu, D. R. Choffnes, and Z. M. Mao. Mobilyzer: An open platform for controllable mobile network measurements. In Proc. of MobiSys, 2015.
[20] A. Norberg. uTorrent transport protocol. http://www.bittorrent.org/beps/bep_0029.html.
[21] B. Obama. Net neutrality: President Obama’s plan for a free and open internet. http://www.whitehouse.gov/net-neutrality#section-read-the-presidents-statement.
[22] A. Rao, J. Sherry, A. Legout, W. Dabbout, A. Krishnamurthy, and D. Choffnes. Meddle: Middleboxes for increased transparency and control of mobile traffic. In Proc. of CoNEXT 2012 Student Workshop, 2012.
[23] D. Rayburn. Cogent now admits they slowed down Netflix’s traffic, creating a fast lane & slow lane. http://blog.streamingmedia.com/2014/11/cogent-now-admits-slowed-netflixs-traffic-creating-fast-lane-slow-lane.html, November 2014.
[24] C. Reis, S. D. Gribble, T. Kohno, and N. C. Weaver. Detecting In-Flight Page Changes with Web Tripwires. In Proc. of USENIX NSDI, 2008.
[25] Sandvine - intelligent broadband networks. http://www.sandvine.com.
[26] F. Sarkar. Prevention of bandwidth abuse of a communications system, Jan. 9 2014. US Patent App. 14/025,213.
[27] Strongswan. www.strongswan.org.
[28] P. Svensson. Comcast blocks some internet traffic. http://www.washingtonpost.com/wp-dyn/content/article/2007/10/19/AR2007101900842.html, October 2007.
[29] Switzerland network testing tool. https://www.eff.org/pages/switzerland-network-testing-tool.
[30] M. B. Tariq, M. Motiwala, N. Feamster, and M. Ammar. Detecting network neutrality violations with causal inference. In CoNEXT, 2009.
[31] N. Vallina-Rodriguez, S. Sundaresan, C. Kreibich, N. Weaver, and V. Paxson. Beyond the radio: Illuminating the higher layers of mobile networks. In Proc. of MobiSys, 2015.
[32] N. Weaver, C. Kreibich, M. Dam, and V. Paxson. Here Be Web Proxies. In Proc. PAM, 2014.
[33] N. Weaver, R. Sommer, and V. Paxson. Detecting forged TCP reset packets. In Proc. of NDSS, 2009.
[34] X. Xu, Y. Jiang, T. Flach, E. Katz-Bassett, D. Choffnes, and R. Govindan. Investigating transparent web proxies in cellular networks. In Proc. PAM, 2015.
[35] F. Zarinni, A. Chakraborty, V. Sekar, S. Das, and P. Gill. A first look at performance in mobile virtual network operators. In Proc. of IMC, 2014.
[36] Y. Zhang, Z. M. Mao, and M. Zhang. Detecting Traffic Differentiation in Backbone ISPs with NetPolice. In Proc. of IMC, 2009.
[37] Z. Zhang, O. Mara, and K. Argyraki. Network neutrality inference. In Proc. of ACM SIGCOMM, 2014.