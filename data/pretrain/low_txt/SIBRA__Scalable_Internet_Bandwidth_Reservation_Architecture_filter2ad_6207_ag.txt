### Acknowledgments

This research was supported by the European Union's Seventh Framework Programme (FP7/2007-2013) under ERC grant agreement 617605. We also gratefully acknowledge support from ETH Zurich and the National Science Foundation (NSF) under award number CNS-1040801. Additional support was provided by a gift from KDDI.

### References

[1] "Inter-domain controller (IDC) protocol specification," ControlPlane, 2010. [Online]. Available: http://www.controlplane.net/idcp-v1.1-ns/idc-protocol-specification-v1.1.pdf

[2] "Center for Applied Internet Data Analysis (CAIDA)," CAIDA, 2014. [Online]. Available: http://www.caida.org/home/

[3] "Netflix congesting the Australian Internet," The Sydney Morning Herald, 2015. [Online]. Available: http://www.smh.com.au/digital-life/digital-life-news/these-graphs-show-the-impact-netflix-is-having-on-the-australian-internet-20150402-1mdc1i.html

[4] "North American Network Operators’ Group (NANOG)," NANOG, 2015. [Online]. Available: https://www.nanog.org/list

[5] "Technical Details Behind a 400Gbps NTP Amplification DDoS Attack," Cloudflare Blog, 2015. [Online]. Available: https://blog.cloudflare.com/technical-details-behind-a-400gbps-ntp-amplification-ddos-attack

[6] D. G. Andersen, H. Balakrishnan, N. Feamster, T. Koponen, D. Moon, and S. Shenker, "Accountable Internet Protocol (AIP)," in Proceedings of the ACM SIGCOMM Conference, 2008.

[7] T. Anderson, T. Roscoe, and D. Wetherall, "Preventing Internet Denial-of-Service with Capabilities," ACM SIGCOMM Computer Communication Review, 2004.

[8] K. Argyraki and D. R. Cheriton, "Network Capabilities: The Good, the Bad and the Ugly," in Proceedings of the ACM HotNets Workshop, 2005.

[9] D. Barrera, R. M. Reischuk, P. Szalachowski, and A. Perrig, "SCION Five Years Later: Revisiting Scalability, Control, and Isolation on Next-Generation Networks," arXiv e-prints, 2015.

[10] B. H. Bloom, "Space/time trade-offs in hash coding with allowable errors," Communications of the ACM, 1970.

[11] H. Chan, D. Dash, A. Perrig, and H. Zhang, "Modeling Adoptability of Secure BGP Protocol," in Proceedings of the ACM SIGCOMM Conference, 2006.

[12] A. Demers, S. Keshav, and S. Shenker, "Analysis and Simulation of a Fair Queueing Algorithm," ACM SIGCOMM Computer Communication Review, 1989.

[13] A. Farrel, J.-P. Vasseur, and J. Ash, "A Path Computation Element (PCE)-Based Architecture," Technical Report, 2006.

[14] GEANT, "Bandwidth on Demand," GEANT, 2015. [Online]. Available: http://geant3.archive.geant.net/service/BoD/pages/home.aspx

[15] P. Godfrey, I. Ganichev, S. Shenker, and I. Stoica, "Pathlet Routing," in Proceedings of the ACM SIGCOMM Computer Communication Review, 2009.

[16] S. Gueron, "Intel Advanced Encryption Standard (AES) New Instructions Set," Intel, 2010. [Online]. Available: white paper 323641-001, Revision 3

[17] G. Hardin, "The Tragedy of the Commons," Science, 1968.

[18] T. Heer and S. Varjonen, "Host Identity Protocol Certificates," 2011.

[19] H.-C. Hsiao, T. H.-J. Kim, S. B. Lee, X. Zhang, S. Yoo, V. Gligor, and A. Perrig, "STRIDE: Sanctuary Trail – Refuge from Internet DDoS Entrapment," in Proceedings of the AsiaCCS Conference, 2013.

[20] F. B. J. Babiarz and K. Chan, "Configuration Guidelines for DiffServ Service Classes."

[21] M. S. Kang, S. B. Lee, and V. D. Gligor, "The Crossfire Attack," in Proceedings of the IEEE S&P Symposium, 2013.

[22] C. Labovitz, S. Iekel-Johnson, D. McPherson, J. Oberheide, and F. Jahanian, "Internet Inter-Domain Traffic," ACM SIGCOMM, 2010.

[23] P. Laskowski, B. Johnson, and J. Chuang, "User-directed routing: From Theory, Towards Practice," in Proceedings of the ACM NetEcon Workshop, 2008.

[24] S. B. Lee and V. D. Gligor, "FLoc: Dependable Link Access for Legitimate Traffic in Flooding Attacks," in Proceedings of the IEEE ICDCS Conference, 2010.

[25] S. B. Lee, M. S. Kang, and V. D. Gligor, "CoDef: Collaborative Defense Against Large-Scale Link-Flooding Attacks," in Proceedings of the ACM CoNEXT Conference, 2013.

[26] R. Margolis, L. Derr, M. Dunn, M. Huerta, J. Larkin, J. Sheehan, M. Guyer, and E. D. Green, "The National Institutes of Health’s Big Data to Knowledge (BD2K) Initiative: Capitalizing on Biomedical Big Data," Journal of the American Medical Informatics Association, 2014.

[27] J. Mirkovic, S. Fahmy, P. Reiher, and R. K. Thomas, "How to Test DoS Defenses," in Proceedings of the CATCH Workshop, 2009.

[28] R. Moskowitz, P. Jokela, T. R. Henderson, and T. Heer, "Host Identity Protocol Version 2."

[29] J. Nagle, "On Packet Switches with Infinite Storage," 1985.

[30] M. Natu and J. Mirkovic, "Fine-Grained Capabilities for Flooding DDoS Defense Using Client Reputations," in Proceedings of the ACM LSAD Workshop, 2007.

[31] R. Pan, B. Prabhakar, and K. Psounis, "CHOKe: A Stateless Active Queue Management Scheme for Approximating Fair Bandwidth Allocation," in Proceedings of the IEEE INFOCOM Conference, 2000.

[32] B. Parno, D. Wendlandt, E. Shi, A. Perrig, B. Maggs, and Y.-C. Hu, "Portcullis: Protecting Connection Setup from Denial-of-Capability Attacks," in Proceedings of the ACM SIGCOMM Conference, 2007.

[33] B. Raghavan, P. Verkaik, and A. C. Snoeren, "Secure and Policy-Compliant Source Routing," IEEE/ACM Transactions on Networking, vol. 17, no. 3, 2009.

[34] M. Schuchard, A. Mohaisen, D. Foo Kune, N. Hopper, Y. Kim, and E. Y. Vasserman, "Losing Control of the Internet: Using the Data Plane to Attack the Control Plane," in Proceedings of the ACM CCS Conference, 2010.

[35] M. Shreedhar and G. Varghese, "Efficient Fair Queuing Using Deficit Round-Robin," IEEE/ACM Transactions on Networking, 1996.

[36] I. Stoica, D. Adkins, S. Zhuang, S. Shenker, and S. Surana, "Internet Indirection Infrastructure," ACM SIGCOMM Computer Communication Review, 2002.

[37] I. Stoica, S. Shenker, and H. Zhang, "Core-Stateless Fair Queueing: A Scalable Architecture to Approximate Fair Bandwidth Allocations in High-Speed Networks," IEEE/ACM Transactions on Networking, 2003.

[38] A. Studer and A. Perrig, "The Coremelt Attack," in Proceedings of the ESORICS Conference, 2009.

[39] B. Trammell and D. Schatzmann, "On Flow Concurrency in the Internet and its Implications for Capacity Sharing," in Proceedings of the ACM CSWS Workshop, 2012.

[40] J. Vasseur and J. Le Roux, "Path Computation Element Communication Protocol," IETF RFC 5557, 2009.

[41] H. Welte and P. N. Ayuso, "The netfilter.org libnetfilter queue project," 2014. [Online]. Available: http://www.netfilter.org/projects/libnetfilter_queue/

[42] J. Wroclawski, "The Use of RSVP with IETF Integrated Services," 1997.

[43] H. Wu, H.-C. Hsiao, and Y.-C. Hu, "Efficient Large Flow Detection Over Arbitrary Windows: An Algorithm Exact Outside an Ambiguity Region," in Proceedings of the ACM IMC Conference, 2014.

[44] A. Yaar, A. Perrig, and D. Song, "SIFF: A Stateless Internet Flow Filter to Mitigate DDoS Flooding Attacks," in Proceedings of the IEEE S&P Symposium, 2004.

[45] X. Yang, D. Clark, and A. W. Berger, "Nira: A New Inter-Domain Routing Architecture," IEEE/ACM Transactions on Networking, 2007.

[46] X. Yang, D. Wetherall, and T. Anderson, "A DoS-Limiting Network Architecture," ACM SIGCOMM Computer Communication Review, 2005.

[47] L. Zhang, S. Deering, D. Estrin, S. Shenker, and D. Zappala, "RSVP: A New Resource Reservation Protocol," IEEE Network, 1993.

### Appendix

#### A. Fair Sharing of Steady Down-Paths

Recall from Section III-B that core Autonomous Systems (ASes) negotiate core contracts to set up core paths among each other (the double continuous lines in Figure 1). The reserved bandwidth for these core paths is negotiated based on aggregated traffic volumes observed in the past. The following section discusses how the reserved bandwidth is split among the customers of the core ASes. Specifically, we describe a sharing mechanism that assigns each leaf AS \( E \) a fair amount of bandwidth for \( E \)'s traffic traversing the core paths. Intuitively, "fair" in this context means proportional to the amount of bandwidth that \( E \) has purchased for its steady up-paths to the core AS. In contrast to the fair sharing mechanism for ephemeral paths (Section III-D), the equations introduced here do not require the additional weighting factor given by the ratio of ephemeral and steady bandwidth.

**Steady Bandwidth on Core Links:**
The steady bandwidth of a core path \( C = \langle ASC_1, \ldots, ASC_n \rangle \) between core \( ASC_1 \) and a destination core \( ASC_n \) is split among all customer ASes of \( ASC_1 \), weighted by the bandwidth of the steady up-path each customer AS uses.

Let \( sBW_{u*} \) be the total amount of steady bandwidth sold by a core \( ASC_1 \) for all its steady paths. Let \( sBW_u \) be the reserved bandwidth sold by \( ASC_1 \) for a particular steady up-path \( S_u \). Let further \( sBWC \) be the steady bandwidth of core path \( C \). Then the steady traffic on \( C \) launched via \( S_u \) can be up to:

\[
sBW_{uC} = \frac{sBW_u}{sBW_{u*}} \cdot sBWC
\]

**Steady Bandwidth in the Destination ISD:**
In the destination ISD, the weighted fair sharing follows the same intuition, consisting first of a fair sharing mechanism between different ISDs, then between the ASes in the same ISD. More precisely, steady traffic launched over steady up-path \( S_u \) and steady down-path \( S_d \), with core path \( C \) in between, obtains a throughput:

\[
sBW_{uCd} = \frac{C_{C1 \rightarrow Cn}}{C_{* \rightarrow Cn}} \cdot \frac{sBW_u}{sBW_{u*}} \cdot sBW_d
\]

where \( C_{C1 \rightarrow Cn} \) is the bandwidth negotiated in \( C \)'s core contract between core \( ASC_1 \) (source ISD) and core \( ASC_n \) (destination ISD), \( C_{* \rightarrow Cn} \) is the total amount of bandwidth negotiated in the core contracts between any core AS and the destination ISD's core \( ASC_n \), and \( sBW_d \) is the reserved bandwidth sold by core \( ASC_n \) for steady down-path \( d \).

**Local Steady Traffic in the Destination ISD:**
This case introduces a preference \( \rho \in (0,1) \) that splits the bandwidth of the steady down-path between traffic that traverses core paths and traffic that does not. Let \( sBW_{u*} \) be the total bandwidth of all steady up-paths to a given core AS in the destination ISD. Then, a particular steady up-path among them, say with bandwidth \( sBW_u \), obtains steady bandwidth on the down-path \( d \) of:

\[
sBW_{ud}^\rho = \frac{sBW_u}{sBW_{u*}} \cdot \rho \cdot sBW_d
\]

Traffic from external ISDs is weighted accordingly, extending Equation 6:

\[
sBW_{uCd}^\rho = (1 - \rho) \cdot sBW_{uCd}
\]

**Authentication of Bandwidth Values:**
To compute \( sBW_{uC} \) and \( sBW_{uCd} \), ASes use the bandwidth values for steady up-paths and core paths included in the SIBRA packet headers. To prevent a malicious AS from increasing its fair share by tampering with the bandwidth values, SIBRA requires the core ASes of each ISD to sign the bandwidth of steady up-paths inside the ISD, as well as the bandwidth of core paths starting at the ISD core. Signing can take place when the steady paths are registered at the ISD core. Each AS first verifies the signatures, and then computes the fair shares. Fast signing and verification can be implemented using the public-key high-speed signature scheme ed25519. The private key used for signing by an ISD core can be shared among the core ASes in each ISD. For signature verification, the corresponding public key of an ISD core is distributed to all other ISDs, which disseminate the key to all ASes inside the ISD. In practice, only about 100 public keys need to be distributed. Since ISD cores are typically stable, key change and re-distribution should be infrequent.

**Dynamic Fair Sharing:**
A pertinent question is whether the computed fair share is large enough to be useful. On core links, whose capacity exceeds hundreds of Gbps (as in the example of Australia in Section VIII), even a ratio of only 1% steady bandwidth is on the order of a few Gbps, which would give each AS outside Australia tens of Mbps of steady traffic. However, in the destination ISD, given that steady down-paths' capacity is merely a few Mbps, the fair share obtained for each leaf AS is less than 1 kbps — too small to be useful. A popular destination AS could register several steady down-paths to increase the steady fair share, but the increase factor is still small compared to the number of possible source ASes.

The key observation is that SIBRA enforces the fair share on steady traffic dynamically, i.e., only when a steady down-path becomes congested. The fair share is computed between the ASes that actively use the steady down-path, as opposed to all possible ASes in the Internet. The fair share is reserved for 1 second, which allows the AS two retry attempts if an ephemeral reservation fails (considering an RTT of 300 ms — a conservative value, according to measurements performed by CAIDA13).

[13] https://www.caida.org/research/performance/rtt/walrus0202/