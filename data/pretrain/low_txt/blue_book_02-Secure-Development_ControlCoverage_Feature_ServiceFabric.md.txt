## IMPORTANT: DevOps Kit (AzSK) Sunset Notice
The DevOps Kit (AzSK) will be sunset by the end of FY21. For more details, please refer to the [AzSK Sunset Notice](../../../ReleaseNotes/AzSKSunsetNotice.md).

### Service Fabric Security Controls and Rationale

| Description | Rationale | Control Severity | Automated Fix Script |
|-------------|-----------|-----------------|----------------------|
| **Publicly Exposed Microservice Endpoints Must Have Authentication and Authorization Enforced** | If authentication and authorization are not correctly implemented, microservice endpoints may be easily accessed by anyone on the internet, leading to the compromise of sensitive data. | High | No |
| **Publicly Exposed Endpoints Must Be Secured Using SSL** | Use of SSL ensures server/service authentication and protects data in transit from man-in-the-middle, eavesdropping, and session-hijacking attacks. | High | Yes |
| **Application Secrets Must Be Encrypted with a Certificate** | Protecting connection strings, storage account keys, passwords, etc., (stored in `Settings.xml` file in `ConfigPackage`, `ServiceManifest.xml`, and `ApplicationManifest.xml`) ensures that these secrets do not get compromised through unprotected copies of the settings/manifest files. | High | No |
| **Data Replication Must Be Secured with a Certificate** | The replication traffic of microservices must be protected using a certificate to prevent microservices from seeing each other's replication traffic. | Medium | No |
| **Sensitive Data Must Not Be Stored Inside DataPackage** | `DataPackage` files can be accessed by other microservices running on the same node (VM). These files are distributed along with the application package during publishing/deployment, which can lead to the compromise of sensitive data if left unprotected. | High | No |
| **Replica Set Size for Stateful Services Must Be Set to a Minimum of 3** | A replica set size of 3 or more for stateful services ensures that data is not lost in the event of a single node failure. | Medium | Yes |
| **Instance Count for Stateless Services Must Be Set to a Minimum of 3** | An instance count of 3 or more guarantees high availability for stateless services in the event of a single node failure. | Medium | Yes |
| **Service Fabric Cluster Security Must Be Enabled Using Security Mode Option** | A secure cluster prevents unauthorized access to management operations, including deployment, upgrade, and deletion of microservices. It also provides encryption for node-to-node and client-to-node communication. In contrast, an unsecured cluster can be connected by any anonymous user. | High | Yes |
| **Service Fabric Cluster Must Contain Only Microservices That Trust Each Other** | Microservices hosted on the same Service Fabric cluster can monitor each other's traffic and access files hosted on the cluster. Therefore, the cluster should not host microservices that do not trust each other. | High | No |
| **Self-Signed Certificates Must Not Be Used for Service Fabric Cluster Primary Certificate** | The primary certificate of the Service Fabric cluster must be obtained from a trusted certification authority to ensure that client applications/endpoints can validate the identities of microservices in the cluster securely. | High | Yes |
| **Client Authentication Must Be Performed Only via Azure Active Directory** | Using the native enterprise directory for authentication ensures a high level of assurance in the user identity established for subsequent access control. All Enterprise subscriptions are automatically associated with their enterprise directory (e.g., `xxx.onmicrosoft.com`), and users in the native directory are trusted for authentication to enterprise subscriptions. | High | Yes |
| **ClusterProtectionLevel Property Must Be Set to EncryptAndSign** | With the cluster protection level set to `EncryptAndSign`, all node-to-node messages are encrypted and digitally signed, protecting intra-cluster communication from eavesdropping, tampering, and man-in-the-middle attacks. | High | Yes |
| **Network Security Group (NSG) Must Be Enabled on Subnets of Service Fabric Cluster** | Appropriate NSG rules can limit the exposure of the Service Fabric cluster in multiple scenarios, such as restricting RDP connections to specific admin machines, limiting incoming requests to specific clients, and restricting deployments to allowed IP addresses. | Medium | Yes |
| **Encryption Must Be Enabled on All Storage Accounts Storing VHDs of Service Fabric Cluster VMs** | This feature ensures that sensitive data is stored encrypted at rest, minimizing the risk of data loss from physical theft and helping meet regulatory compliance requirements. | High | Yes |
| **Diagnostics Must Be Enabled for Service Fabric Cluster** | Diagnostics logs are needed to create an activity trail for incident investigation and compromise detection. | Medium | Yes |
| **Monitor Publicly Exposed Ports on Load Balancers Used by Service Fabric Cluster** | Publicly exposed ports must be monitored to detect suspicious and malicious activities early and respond in a timely manner. | Medium | No |
| **Reverse Proxy Service Should Be Secured Using SSL** | Use of SSL ensures server/service authentication and protects data in transit from man-in-the-middle, eavesdropping, and session-hijacking attacks. | Medium | No |
| **Reverse Proxy Port Must Not Be Exposed Publicly** | Configuring the reverse proxy's port in the Load Balancer with a public IP will expose all microservices with HTTP endpoints. Microservices meant to be internal may be discoverable by a determined malicious user. | High | Yes |
| **Upgrade Mode Should Be Set to Automatic for Cluster** | Clusters with unsupported fabric versions can become targets for compromise from malware/trojan attacks that exploit known vulnerabilities in software. | Medium | Yes |

This table outlines the necessary security controls for Service Fabric, providing a clear rationale for each control, its severity, and whether an automated fix script is available.