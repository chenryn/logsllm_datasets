### 摘要
本文介绍了一种基于草图的数据结构，能够提供每一流的一向延迟估计。尽管草图技术自然地为较大流量提供了最佳估计，但该数据结构可以提高任意流量的准确性。对于存在丢包情况的网络测量，我们结合了最近出现的一种称为“Lossy Difference Aggregator”的数据结构。现有技术依赖于延迟的时间相关性来生成估计值，但在实际中，路由器可以使用多种队列策略处理不同类型的流量，这大大降低了这些技术的有效性。我们的评估表明，即使在存在丢包的情况下，我们的技术在使用相似内存的情况下也能比现有技术获得更高的准确性。

### 相关工作
除了包延迟测量技术外，草图技术也与本研究密切相关。与我们最相关的两种数据结构是：多阶段过滤器（Multi-Stage Filters），设计用于大象流检测；以及Count-Min Sketch，它能提供具有概率准确度保证的每一流估计。其他草图技术在文献[8]中进行了回顾和比较。

### 结论
我们提出了一种基于草图的数据结构，能够生成每一流的一向延迟估计。虽然草图技术天然适合于大流量的估计，但该数据结构也可以增强任意流量的准确性。对于存在丢包的网络测量，我们将草图技术与一种新近出现的数据结构——Lossy Difference Aggregator相结合。现有的技术依赖于延迟的时间相关性来生成估计值，但在实践中，路由器可以对不同类型的数据采用不同的排队策略，从而大大降低这些技术的有效性。我们的评估表明，即使在存在丢包的情况下，我们的技术在使用相似内存的情况下也能比现有技术获得更高的准确性。

此外，我们还展示了一个实用的部署场景，其中我们的技术及其改善任意流量测量的能力非常有用。特别是在共享资源的数据中心环境中，各种应用程序对网络延迟有不同的依赖程度。在这种情况下，我们的技术可以为最关键的应用程序提供极其精确的测量，同时仍然为其他应用程序提供可接受的准确度。

### 致谢
本研究由西班牙科学与创新部通过合同TEC2011-27474（NOMADS项目）资助，并得到了加泰罗尼亚自治区大学和研究委员会的支持（编号2009SGR-1140）。

### 参考文献
[1] Corvil. http://www.corvil.com/.
[2] Juniper Networks T系列核心路由器架构概览. www.juniper.net/us/en/local/pdf/whitepapers/2000302-en.pdf.
[3] M. Alizadeh, A. Greenberg, D. A. Maltz, J. Padhye, P. Patel, B. Prabhakar, S. Sengupta, and M. Sridharan. 数据中心TCP (DCTCP). 在ACM SIGCOMM会议上发表, 2010.
[4] P. Barlet-Ros, G. Iannaccone, J. Sanjuás-Cuxart, D. Amores-López, 和 J. Solé-Pareta. 网络监控应用中的负载卸载. 在USENIX年度技术会议发表, 2007.
[5] J. Bolot. 互联网端到端包延迟和丢失的特征分析. 高速网络杂志, 2(3):289–298, 1993.
[6] B. Choi, S. Moon, R. Cruz, Z. Zhang, 和 C. Diot. 实用的ISP延迟监控. 在ACM CoNEXT会议上发表, 2005.
[7] Cisco. NetFlow. http://www.cisco.com/web/go/netflow.
[8] G. Cormode 和 M. Hadjieleftheriou. 数据流中频繁项查找方法. VLDB期刊, 19(1):3–20, 2010.
[9] G. Cormode 和 S. Muthukrishnan. 改进的数据流摘要: Count-Min Sketch及其应用. 算法杂志, 55(1):58 – 75, 2005.
[10] L. De Vito, S. Rapuano, 和 L. Tomaciello. 单向延迟测量: 最新进展. IEEE仪器与测量学报, 57(12):2742–2750, 2008.
[11] N. Duffield 和 M. Grossglauser. 轨迹采样直接流量观测. IEEE/ACM网络交易, 9(3):280–292, 2001.
[12] Endace. DAG网络监控卡. http://www.endace.com.
[13] C. Estan 和 G. Varghese. 流量测量和计费的新方向: 关注大象流, 忽略小流. ACM计算机系统交易, 21(3):270–313, 2003.
[14] H. Finucane 和 M. Mitzenmacher. Lossy Difference Aggregator改进分析. ACM通信评论, 40(2):4–11, 2010.
[15] S. Fred, T. Bonald, A. Proutiere, G. Regnie, 和 J. Roberts. 统计带宽共享: 流级拥塞研究. 在ACM SIGCOMM会议上发表, 2001.
[16] IEEE. IEEE/ANSI 1588标准: 网络化测量和控制系统中的高精度时钟同步协议, 2002.
[17] R. Kompella, K. Levchenko, A. Snoeren, 和 G. Varghese. 每微秒都很重要: 使用Lossy Difference Aggregator跟踪细粒度延迟. 在ACM SIGCOMM会议上发表, 2009.
[18] M. Lee, N. Duffield, 和 R. Kompella. 并非所有微秒都相等: 使用参考延迟插值进行细粒度每流测量. 在ACM SIGCOMM会议上发表, 2010.
[19] M. Lee, N. Duffield, 和 R. Kompella. 两个样本就足够: 利用NetFlow进行机会性流级延迟估计. 在IEEE INFOCOM会议上发表, 2010.
[20] M. Lee, S. Goldberg, R. Kompella, 和 G. Varghese. 存在乱序情况下的细粒度延迟和丢失测量. 在ACM SIGMETRICS会议上发表, 2011.
[21] R. Martin. 华尔街追求光速数据处理. www.informationweek.com/news/infrastructure/showArticle.jhtml?articleID=199200297.
[22] S. Moon, P. Skelly, 和 D. Towsley. 从网络延迟测量中估计和消除时钟偏移. 在IEEE INFOCOM会议上发表, 1999.
[23] K. Park, G. Kim, 和 M. Crovella. 文件大小、传输协议和自相似网络流量之间的关系. 在国际网络协议会议上发表, 2002.
[24] V. Paxson. 端到端互联网动态的测量与分析. 技术报告CSD-97-945, 加州大学伯克利分校, 1998.
[25] V. Paxson. 校准包传输时间测量. 在ACM SIGMETRICS性能评估评论, 卷26, 页11–21. ACM, 1998.
[26] C. Y. Robert 和 J. Segers. 大数量轻尾项随机和的尾部分布. 保险: 数学与经济学, 43(1):85 – 92, 2008.
[27] J. Sanjuas-Cuxart, P. Barlet-Ros, 和 J. Solé-Pareta. Lossy Difference Aggregator的验证与改进以测量包延迟. 流量监控与分析研讨会, 2010.
[28] J. Sommers, P. Barford, N. Duffield, 和 A. Ron. 准确高效的SLA合规性监控. 在ACM SIGCOMM会议上发表, 2007.
[29] L. Zhang, Z. Liu, 和 C. Honghui Xia. 网络测量的时钟同步算法. 在IEEE INFOCOM会议上发表, 2002.

### 审稿意见总结

#### 审稿人1
**优点:**
- 整个方案已在真实追踪数据上实现并测试。
- 对数据结构的空间需求和准确性进行了合理的分析。

**缺点:**
- 方法相对增量。
- 方案需要O(#flows)的状态；可能无法避免。
- 论文中的某些声明（准确性/状态需求）被夸大。
- 论文未描述如何设置许多不同的参数。

**作者建议:**
- 同步时钟的假设非常重要，但没有得到足够的重视。
- 算法的准确性完全取决于发送方和接收方时钟的同步：DAG卡用于时间戳记的成本是多少？这个成本与引言中提到的高频主动探测相比如何？
- LDS算法是现有技术的简单合并。处理丢失/重新排序的包是最困难的问题，而这一点通过将测量结果分散到多个桶中并希望某些测量结果存活下来的方式解决。
- 虚拟LDS方案在某些流发生严重损失时可能无效，例如尽力而为的流。评估仅假设<1%的损失过于保守。
- 如何设置α参数？选择较小的α是否会导结果的高方差？
- x参数（按包数计算的碰撞阈值）忽略了每流的变异性。如果一个低延迟流映射到少于x个包但每个包具有更高延迟的流，则该低延迟流的估计会受到不成比例的影响。不清楚为什么选择干扰包的数量作为干扰度量。

**评价:**
- 基本参数使用了一半的计数器。使用的总内存是否不足以维护每流统计信息？某些实验使用了比流数多10倍的计数器——为什么不直接保持每流状态？
- 实验参数是根据追踪统计数据选择的，这并不能说明如何在实时网络中设置参数。
- 实验是在事后对追踪数据进行的。是否可以在高速链路上进行实时实验？其他方法（如NetFlow MPE）是在实时链路上运行的，离线比较似乎不公平，特别是当比较需要O(#flow)状态来提供每流延迟测量时。

#### 审稿人2
**优点:**
- 作者提供了直观的算法优化，以推进流级延迟估计的技术水平。

**缺点:**
- 该工作相对于一些作者以前的工作显得过于增量。

**作者建议:**
- 论文很好地构建了一个针对所提问题的算法解决方案。结果表明，所提出的方案在性能和准确性方面具有优势。
- 然而，我的理解是，这篇论文相对于先前的工作来说是相当增量的。描述的LDS方案似乎是LDA方案与一些基于草图的数据结构的结合，以更好地跟踪流。这看起来是对先前工作的非常简单的优化。
- 不幸的是，我无法判断这篇论文是如何显著超越现有技术的。

#### 审稿人3
**优点:**
- 巧妙的想法
- 相关的问题
- 使用真实追踪数据进行了广泛的评估
- 写得很好

**缺点:**
- 相对于作者自己以前的工作来说是相当增量的
- 不确定同步假设的可行性

**作者建议:**
- 微秒级同步的可行性如何？论文对此依赖很重。我认为这应该没问题，因为这种同步在某些系统中经常实现（例如蜂窝无线网络）。但是成本是多少？
- 实验中的一些参数不明确。例如，如何设置α参数？
- 如果包丢失会发生什么？会不会扭曲测量结果？

#### 审稿人4
**优点:**
- 估算网络延迟的新方法，即使不假设流的时间相关性。
- 实验证据显示在现实场景中优于现有技术。

**缺点:**
- 缺乏足够的理论误差保证来验证LDS方法的有效性。

**作者建议:**
1. 本文去除了时间相关性的假设，但流并不一定是“不相关”的。
2. 在第3.2节中，不清楚为什么最小化问题(U_l + V_l)被简化为V_l的最小化问题。这个假设是否实用？
3. 在丢包场景下，结果显示MB-LDS比LDS表现更好，但没有与其他现有技术进行比较。
4. MB-LDS在更高的丢包场景下表现如何？
5. 在图8中，青铜客户的准确性看起来不受黄金和白银较高权重的影响。这是由于流量比例的原因。有趣的是，首先看看当它们不对称时，比例如何影响青铜客户。

#### 审稿人5
**优点:**
- 一种更实用且有效的每流延迟测量技术；扎实的呈现；良好的评估。

**缺点:**
- 评估集中在平均延迟上。

**作者建议:**
- 论文提出了LDS，一种新的基于草图的技术和关联的数据结构，用于获取每流延迟测量。LDS不依赖于关于跨流延迟关系的模型假设，比现有技术具有更低的内存需求和网络开销，并且可以根据必要的准确性调整数据结构的大小。
- 我期望看到但没有找到关于优先级、负载均衡等对其他技术有效性影响的参考文献。
- LDS的呈现很好，逐步介绍了从SDS开始并放松假设引入LDS、流加权和多银行LDS的思想。
- 评估部分包括使用从连接研究和大学网络到（其余）互联网的链路收集的数据对LDS的评估。评估部分很好地展示了该技术的优势和潜在问题。
- 我没有看到对捕获除平均值之外的其他估计值的有效性的分析。第4.3节简要讨论了如何挖掘其他信息，但在评估中没有跟进该方法在捕捉延迟变化等方面的有效性。
- 举一个例子，多少流量使得收集和交换每流状态变得昂贵。

### 作者回应
第一和第三审稿人对时钟同步假设提出了担忧。这一假设是许多单向延迟测量方法的共同假设，包括基于探测的主动技术。作者同意这是一个带来困难的假设，即使可以通过文中提出的方法解决。去除这一假设超出了本文的范围。我们提供了专门处理时钟同步问题的论文参考。

论文引入了“一半计数器对应一半流”的配置，因为它具有与其他需要类似内存使用的方法（例如MPE）进行公平比较的优势。评估还测试了较少计数器的配置，结果令人满意（图5）。我们进一步强调，即使使用10%的内存，LDS仍优于竞争方法。

审稿人提出了LDS在高丢包情况下的适用性问题。低丢包率是我们论文的假设（第2.1节）。我们认为，在高丢包率情况下，延迟测量可能不太有趣，因为TCP在这种情况下无法正常工作。我们现在指出，在这种条件下，其他耐丢包的方法可能是比LDS更好的选择，因为k需要更大，从而需要更多内存。

每个桶中的包数量提供了干扰包数量（x）的评估，尽管审稿人提出了有效观点，即如果延迟差异很大，测量可能会受到影响。虽然存在其他替代方案（例如组合多个单元格），但我们捍卫我们在第2.2节中的选择。此外，我们扩展了关于如何将包映射到每个虚拟LDA单元格的讨论（第2.3.3节）。

在评估中，我们包含了α参数的选择。我们也解释了实验结果相当于在线设置，LDS实际上可以在线运行，并讨论了在丢包情况下的参考方法的准确性。评估还承认，加权仅对提高一小部分流的准确性有用。

我们确保在论文中尽最大努力讨论了审稿人提出的其他不太关键的意见。