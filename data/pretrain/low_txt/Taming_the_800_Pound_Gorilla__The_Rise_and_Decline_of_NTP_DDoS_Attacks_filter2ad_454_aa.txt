# Taming the 800-Pound Gorilla: The Rise and Decline of NTP DDoS Attacks

**Authors:**
- Jakub Czyz, University of Michigan
- Michael Kallitsis, Merit Network, Inc.
- Manaf Gharaibeh, Colorado State University
- Christos Papadopoulos, Colorado State University
- Michael Bailey, University of Michigan
- Manish Karir, Merit Network, Inc.

## Abstract
Distributed Denial of Service (DDoS) attacks based on Network Time Protocol (NTP) amplification, which became prominent in December 2013, have received significant global attention. This paper chronicles how this attack rapidly rose from obscurity to become the dominant large DDoS vector. Using five distinct datasets, we characterize the advent and evolution of these attacks. Through a dataset that measures a large fraction of global Internet traffic, we show a three-order-of-magnitude rise in NTP. A large darknet dataset reveals a similar rise in global scanning activity, both malicious and research. An active probing dataset reveals that the pool of amplifiers totaled 2.2 million unique IPs, including a small number of "mega amplifiers" that responded to a single tiny probe packet with gigabytes of data. This dataset also allows us, for the first time, to analyze global DDoS attack victims, including ports attacked and incidents, where we show 437,000 unique IPs targeted with at least 3 trillion packets, totaling more than a petabyte. Finally, ISP datasets shed light on the local impact of these attacks. In aggregate, we show the magnitude of this major Internet threat, the community’s response, and the effect of that response.

**Categories and Subject Descriptors:**
C.2.3 [Computer-Communication Networks]: Network Operations—Network management, Network monitoring

**General Terms:**
Measurement, Networking, Security

**Keywords:**
DDoS, NTP, Darknet

## 1. Introduction
Although Distributed Denial of Service (DDoS) attacks have become increasingly commonplace, the scope and magnitude of the firepower that can now be unleashed on a target is unprecedented. A comprehensive recent study described various DDoS amplification attack vectors and their potential, predicting the rise of Network Time Protocol (NTP) as one of the most potent. In the weeks since, data published by efforts such as the OpenNTPProject.org painted a bleak picture of millions of devices readily available to facilitate these attacks. Indeed, in the first quarter of 2014, 85% of DDoS attacks larger than 100 Gbps were using NTP reflection. Used for everything from gaining a gaming edge to extortion, DDoS attacks have been a scourge for years, but this new attack vector has made them even more powerful.

We study the dramatic rise of NTP-based DDoS attacks, which, over just a few months, went from a mere trickle to become the primary DDoS vector for large attacks. We show who the amplifiers are, what they are capable of, who they attack, and what the attacks looked like. We present findings from the vantage points of five unique datasets: a global traffic profile and attack dataset from a large analytics and DDoS mitigation vendor; a global probing dataset that sheds light on potential amplifiers, their victims, and attacks; a large darknet that observes Internet-scale scanning activities; and, finally, two regional Internet service providers that give us a local perspective on attack mechanics and evolution.

### NTP DDoS Mechanics
Much has been written on the general ideas of reflection and amplification, so we discuss attack mechanics only briefly. For these attacks, the first step is the identification of vulnerable amplifiers, which attackers can accomplish via large-scale scanning. An amplifier is simply a host running a protocol (e.g., NTP, DNS) that, when sent a query packet, responds with one or more packets whose aggregate size is larger than the query it received. Once suitable amplifiers have been identified, an attacker, directly or via intermediate hosts he controls, sends small UDP packets with the spoofed source address set to the IP of the intended attack victim and the destination address a vulnerable amplifier. Such spoofing is possible because many networks do not follow best security practices (e.g., BCP 38/84). In turn, large amounts of traffic from amplifiers may saturate bandwidth at the victim. These attacks are reflected as they are executed via an intermediate host (the amplifier); attacks are amplified in that more bandwidth is used at the victim than the attacker (or its bots) need to expend. In the case of NTP, the protocol feature that has been used in large attacks is the monlist command. Intended only for diagnostics, it returns the last 600 clients of the amplifier, producing a typically very large, multi-packet reply to a single small query packet—an ideal amplification attack vector.

The rest of our paper and highlighted findings are as follows. In §2, we describe the rapid rise of NTP traffic to become the most potent DDoS attack vector. In §3, we explore the amplifier pool that enabled this rapid rise in traffic and attacks—a pool of 2.2 million vulnerable NTP servers. In §4, we seek to answer the questions of who is being DDoSed, when, and how badly. In §5 and §6, we show a dramatic increase in scanning for NTP over eight months as attackers scramble to build lists of vulnerable IPs, and then discuss how the pool of NTP monlist amplifiers being scanned for has itself decreased rapidly, especially relative to other amplifier pools. In §7, we highlight the effect on and mitigation at two regional networks that actively worked to respond to attacks, including local confirmation of some of our global dataset findings and several new insights. Finally, in §8, we describe some related work, and in §9, we summarize key conclusions and future work.

## 2. Global NTP Traffic and Attacks
### 2.1 Global Internet NTP Traffic
In late 2013 and early 2014, public attack disclosures suggested that NTP-based DDoS attacks were very large and increasingly common. To gauge the global prevalence of these types of attacks, we obtained traffic statistics from Arbor Networks, a provider of network analytics and attack mitigation services. Arbor Networks collects traffic data via appliances that export network flow statistics from a global set of over 300 generally large and typically global network operators, including tier-1 ISPs, tier-2/regional ISPs, mobile service providers, and two dozen large enterprise customers. Arbor Networks estimates that their netflow traffic dataset represents between a third and a half of all Internet traffic.

In Figure 1, we show the relative fraction of all measured Internet traffic that NTP and DNS represent, observed by Arbor over six months, between November 1st, 2013, and May 1st, 2014. The data lines are the ratio of each protocol’s daily bits-per-second averages to all Internet traffic seen. The overall daily average of Internet traffic represented in this dataset is 71.5 Tbps. As the figure shows, NTP starts this period off at a level that constitutes only about 0.001% of daily bits per second transferred. By March 1st, NTP had grown to use up about 1% of global Internet traffic, surpassing even DNS, which hovers at around 0.15% of traffic throughout this period. The dramatic three-order-of-magnitude rise of NTP traffic in both absolute and relative terms translates to noticeable financial impact, even at service providers who host not only victims but the NTP amplifiers used in attacks. It is possible that this impact is part of the reason for rapid remediation, which we discuss in §6. After peaking on February 11th, NTP traffic appears to have begun a decline and is at around 0.1% of Internet traffic at the beginning of May, still two orders of magnitude higher than at the start of November 2013, but a tenth of what it was at peak.

**Figure 1: Fraction of Internet traffic that is NTP and DNS for November 2013 – April 2014. There is a nearly three-order-of-magnitude growth in the fraction of global traffic that is NTP, peaking at 1% of all traffic in mid-February, but then dropping to around 0.1%.**

### 2.2 Global NTP DDoS Attacks
In addition to the traffic statistics described in §2.1, the Arbor Networks devices also collect labeled attack counts, which detail the types of attacks that are being seen by Arbor Networks’ customers, including the prevalent protocols used in the attacks (e.g., ICMP flooding, TCP SYN flooding, bandwidth exhaustion using DNS, etc.). The exact mechanism for labeling a traffic spike as an attack is proprietary, and any method is likely to miss some attacks—especially small ones—but our aim here is merely to show the relative trend in attack categories.

**Figure 2: Fraction of all monthly global DDoS attacks in three size ranges and overall that are NTP-based. Note that NTP quickly rises from obscurity to dominate medium and large attacks. Mitigation appears to have had an impact with NTP-based attacks declining substantially in April.**

In Figure 2, we show the attacks seen by Arbor Networks’ customers in the six months starting in November 2013. For each month, we bin attacks into three size categories: Small, consisting of aggregate bandwidth less than 2 Gbps; Medium, which are attacks between 2 and 20 Gbps; and Large, which are any attacks larger than 20 Gbps. In the figure, a different bar represents the fraction of all DDoS attacks in each category as well as of all attacks that were NTP-based. We do not show the frequency of attacks in each category, but there are approximately 300,000 monthly attacks seen globally by Arbor Networks, and approximately 90% of them are Small, 10% Medium, and 1% Large. While the raw number of attacks was never dominated by NTP, the majority of Medium and Large DDoS attacks in February and March were, a dramatic change from just three months earlier, when only 0.07% of attacks involved NTP. The first quarter 2014 attack fractions were confirmed by Prolexic, who reported NTP used in 17% of attacks. In the first quarter of 2014, 85% of attacks exceeding 100 Gbps were using NTP reflection. Fortunately, as evidence that the community’s mitigation efforts are starting to pay off, the fraction of attacks using NTP has started to decline in April and is now below February levels.

These traffic and attack statistics point to NTP-based DDoS as a major new vector and as another reminder of the power of reflected amplification DDoS attacks. This was a category of attacks that have been seen for some time but gained notoriety in recent years when unsecured open DNS resolvers started being used to amplify attackers’ ability to exhaust targets’ bandwidth. To better understand the amplifiers that miscreants are using to generate the NTP traffic, we next delve into the vulnerable NTP server population.

## 3. Global NTP Amplifiers
The linchpin in NTP-based reflected amplification attacks is a large pool of globally-reachable NTP servers that are configured in a way that allows them to serve as reflectors and amplifiers.

### 3.1 The Amplifier Population
**Figure 3: Count of NTP monlist amplifiers, including aggregations at the /24, routed block, and AS level, and subsets of IPs under Merit and CSU/FRGP address space. Remediation at IP levels has been swift, though many networks and nearly half of ASes still have some amplifiers.**

Since January 10th, 2014, the OpenNTPProject.org has been conducting weekly Internet-wide scans of the entire IPv4 address space in an effort to estimate and identify the global population of NTP servers that are vulnerable to being used as reflectors and amplifiers in DDoS attacks. These measurements entail simply sending a single NTP packet that requests a target server return the results of a monlist query, as described in §1, and capturing all response packets. Since the size of the single query packet is known, when servers reply with their packets of monlist table data, we are able to determine if each server can be used for attacks, and we can measure its amplification factor. We analyzed the response data that the OpenNTPProject.org shared with us (ONP data) in order to learn about the amplifier population as well as other facets of the NTP DDoS phenomenon. We report on fifteen weekly measurements through April 18th, 2014, except where noted.

Before continuing, we discuss several limitations of this data. First, we note that one important source of error in the ONP dataset has to do with the type of monlist query packet that was issued. There are several implementations of the NTP service, and they do not all respond to the same packet format. The Linux ntpdc tool, for example, when used to query a server with the monlist command, tries each of two implementation types, one at a time, before failing. The ONP monlist scans in the dataset shared with us only used one of the two implementation values in the one NTP packet they send each IP. However, the implementation used appears to be more commonly present in the attacker scripts and darknet scanning data we have observed. Further, the raw numbers we report match those published by an independent scanning effort, reported in Kührer et al. Although the same error might affect both datasets. We also note that Internet-wide scans conducted from a single source IP, as the ONP scans were, are prone to be affected by some networks eventually blocking or filtering the scanning IP over time. The ONP data was not measured for this effect, but in their study, Kührer found an additional 9% amplifiers when scanning from a secondary network versus repeated scans from their main network. For these reasons, our numbers likely under-represent the full population of amplifiers. Finally, we note that the data only speaks to the amplifiers that respond to monlist and version queries, and not other NTP queries. Although these two are most commonly discussed in literature, there are other NTP queries that could potentially be used for amplification.