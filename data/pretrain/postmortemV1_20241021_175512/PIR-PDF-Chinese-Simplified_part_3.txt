Atlassian
因此，我们需要大规模实现恢复过程并行化和自动化，以帮助受影响客户尽快恢复对
产品的访问权限。
1
工作流 需要大量开发团队执行以下活动：
•
为管道中的成批站点确定并执行恢复步骤。
•
编写并改进自动化功能，以便团队批量执行大量站点的恢复步骤。
2 “ 1”
工作流 ：早期恢复和 恢复 方法
1-4 4 5 9
时间戳：第 天（ 月 日至 日）
4 5 08:53
在脚本运行完成后一个小时，也就是世界标准时间 月 日 ，我们弄清了导致站点被删除
的原因。我们还确定了恢复流程，该流程之前曾用于恢复少量站点的运行。但是，还未明确定义
用于恢复如此大规模被删站点的恢复流程。
为了快速采取行动，该事件的早期阶段分给了以下两个工作组负责：
•
人工工作组负责验证所需步骤，并人工执行少量站点的恢复流程。
•
自动化工作组负责执行现有修复流程，并构建自动化，以便对更大批量的站点执行
这些步骤。
16

“ 1” 7
恢复 方法概述（见下方图 ）：
•
这需要为每个被删除的站点创建新的站点，随后再为每个需要恢复数据的下游产品、
服务和数据创建新站点。
• ID cloudId ID ID
新站点将获得新的 ，比如 。这些 都是不可变的，意味着很多系统会将这些
ID
嵌入到数据记录中。因此，如果这些 发生改变，我们需要更新大量数据，这对于第三
方生态系统应用来说尤为不妥。
•
修改新站点以复制被删除站点状态的各个步骤非常复杂，并且经常存在不可预见
的依赖性。
7 “ 1”
图 ：恢复 方法中的关键步骤。
“ 1” 70
恢复 方法包含约 个独立步骤，这些步骤在较高层次上汇总时，基本上会遵循一个连
续流程：
• Cloud ID
创建新站点、许可证、 并激活正确的产品集
•
将站点迁移到正确的区域
•
恢复并重新映射站点的核心元数据和配置
• —
恢复并重新映射站点的身份数据 用户、群组、权限等
•
恢复站点的主要产品数据库
• —
恢复并重新映射站点的媒体关联 附件等
17

•
为站点设置正确的功能标记
•
跨所有服务恢复并重新映射站点数据
•
恢复并重新映射站点的第三方应用
• Atlassian
验证站点能否正常运行
•
客户验证站点能否正常运行
“ 1” 48 4 5 4 14
优化后， 恢复 方法需要约 小时恢复一批站点，自 月 日至 月 日，这种方法帮助
53% 112
的受影响用户恢复了 个站点。
3 “ 2 ”
工作流 ：加速恢复和 恢复 方法
4-13 4 9 17
时间戳：第 天（ 月 日至 日）
“ 1” 4 9
使用 恢复 方法，我们需要三个星期才能恢复所有客户。因此， 月 日，我们提出了一种加快
“ 2” 8
恢复所有站点的新方法，即 恢复 （见下方图 ）。
“ 2” “ 1”
恢复 方法通过降低 恢复 方法的复杂性和依赖关系数量，提升了恢复步骤之间的并行性。
“ 2”
恢复 方法涉及在所有相关系统中重新创建（或取消删除）与该特定站点相关的记录，首先是
ID
目录服务记录。这种新方法的一个关键因素是可以沿用旧站点的 。由此消除了之前的方法中用
ID ID
于将旧 映射到新 的一半以上的步骤，包括与每个站点的每个第三方应用供应商进行协调的
步骤。
“ 1” “ 2”
不过，从 恢复 方法改为 恢复 方法大幅增加了事件响应的开支：
• “ 1” “ 2”
在 恢复 方法中构建的很多自动化脚本和流程都要修改后才能用于 恢复 方法。
•
执行恢复的团队（包括事件协调员）必须在两种方法中管理并行的恢复批次，同时我们还
“ 2”
要测试和验证 恢复 流程。
• “ 2”
使用新方法意味着我们要在扩展 恢复 流程前对其进行测试和验证，这就需要重复之前
“ 1”
对 恢复 执行的验证工作。
18

8 “ 2”
图 ：恢复 方法中的关键步骤。
“ 2” 30
上图显示的是 恢复 方法，其中包含 多个步骤，这些步骤遵循基本并行的流程：
•
在所有对应系统中重新创建与站点关联的记录
• —
恢复站点的身份数据 用户、群组、权限等
•
恢复站点的主要产品数据库
•
跨所有服务恢复站点数据
•
恢复站点的第三方应用
•
自动验证
•
客户验证站点能否正常运行
在加速恢复过程中，我们还采取了一些措施来预先加载和自动执行站点恢复，因为手动恢复不适
/
合大批量恢复。恢复过程的顺序性意味着对于大型数据库恢复和用户基础 权限恢复，站点恢复可
能会比较慢。我们完成的优化包括：
•
我们开发了所需工具和防护规则，以预先加载长期运行的步骤，如数据库恢复和身份同
步，从而在其他恢复步骤之前完成这些步骤。
•
工程团队为各个步骤构建了自动化程序，从而可以安全执行大批恢复工作。
•
构建自动化程序是为了在所有恢复步骤完成后验证站点能否正常运行。
19

“ 2” 12 4 14 17 47%
加速的 恢复 方法恢复一个站点需要约 个小时，自 月 日至 日，这种方法帮助 的
771
受影响客户恢复了 个站点。
恢复已删除的站点时，最大限度减少数据丢失
“ ”
我们的数据库将完整备份与增量备份相结合来实施备份，因此我们可以选择特定 时间点 ，
30
以便在备份保留期（ 天）内恢复我们的数据存储。对于此次事件中的大部分客户，我们确定了
我们产品的主要数据存储，并决定使用被删站点前五分钟的恢复点作为安全同步点。我们将非主
数据存储恢复到了同一点，或通过重放记录事件进行了恢复。对主存储使用固定的恢复点，
以便在所有数据存储中实现数据一致性。
57
对于我们在事件响应初期恢复的 个客户，由于缺乏一致的政策和手动检索数据库备份快照，
Confluence Insight
导致一些 和 数据库被恢复到了站点删除前五分钟之前的时间点。这种不一
致是在后恢复审计过程中发现的。此后，我们又恢复了剩余的数据，联系了受此影响的客户，
并帮助他们应用变更以进一步恢复其数据。
总结：
• (RPO)
此次事件中，我们达到了一小时的恢复点目标 。
•
事件中最多丢失了站点删除前五分钟的数据。
• Confluence Insight
少数客户的 或 数据库被恢复到了站点删除前五分钟之前的位置，
不过我们可以恢复数据，目前正在与客户合作恢复相应数据。
事件沟通
谈到事件沟通，其涵盖与客户、合作伙伴、媒体、行业分析师、投资者和规模更大的技术社区的
接触点。
20

情况说明
9
图 ：关键事件沟通节点时间线。
21

1-3 4 5 7
时间戳：第 天（ 月 日至 日）
早期响应
4 5 7:46 Atlassian
第一张支持请求单于世界标准时间 月 日 创建， 支持人员于世界标准时间
8:31 9:03 Statuspage
之前做出了回应，确认了这一事件。在世界标准时间 ，发布了第一条 更
11:13 Statuspage
新，告知客户我们正在调查这一事件。在世界标准时间 ，我们通过 确认我们
4 6 1:00
已找到根本原因，并且我们在努力修复。截至世界标准时间 月 日 ，最初的客户请求单
Atlassian 4 6
沟通表明中断源于维护脚本，我们预计数据丢失很少。 于世界标准时间 月 日
17:30 4 7 00:56 Atlassian
发表声明，回应了媒体的询问。在世界标准时间 月 日 ， 在推特上广
泛发布了第一条外部消息，承认了这一事件。
4-7 4 8 11
时间戳：第 天（ 月 日至 日）
开始更广泛的个性化外展活动
4 8 1:50 Atlassian
世界标准时间 月 日 ， 通过电子邮件向受影响客户发送了联合创始人兼联席首
Scott Farquhar
席执行官 的道歉信。接下来的几天，我们努力恢复被删除的联系信息，
并为所有尚未提交的受影响站点创建了支持请求单。然后，我们的支持团队继续通过每个受影响
站点的相关支持请求单定期发送有关恢复工作的最新消息。
8-14 4 12 18
时间戳：第 天（ 月 日至 日）
事件情况更清晰，并完成了恢复
4 12 Atlassian Sri Viswanath
月 日， 发布了来自首席技术官 的更新，提供了更多技术细节，
包括情况说明、受影响群体、有没有数据丢失以及我们的恢复进度，并说明了可能需要两周时间
Sri Stephen
来完全恢复所有站点。该博客还另外附有一份 撰写的新闻声明。我们在工程主管
Deasy Atlassian Sri
主动发表的第一篇 社区文章中提到了 的博客，这篇博客后来成了更多更新
4 18
和更广泛公众问答的专门渠道。 月 日，该贴更新宣布所有受影响的客户站点均已全面恢复。
22

我们为什么没有早点公开回应？
