{"input": "", "instruction": "Identifies a Logging bucket deletion in Google Cloud Platform (GCP). Log buckets are containers that store and organizelog data. A deleted bucket stays in a pending state for 7 days, and Logging continues to route logs to the bucket duringthat time. To stop routing logs to a deleted bucket, you can delete the log sinks that have the bucket as theirdestination, or modify the filter for the sinks to stop it from routing logs to the deleted bucket. An adversary maydelete a log bucket to evade detection.", "output": "event.dataset:gcp.audit AND action:google.logging.v*.ConfigServiceV*.DeleteBucket AND event.outcome:success"}
{"input": "", "instruction": "Identifies when the configuration is modified for a storage bucket in Google Cloud Platform (GCP). An adversary maymodify the configuration of a storage bucket in order to weaken the security controls of their target's environment.", "output": "event.dataset:gcp.audit AND action:\"storage.buckets.update\" AND event.outcome:success"}
{"input": "", "instruction": "Identifies when the Identity and Access Management (IAM) permissions are modified for a Google Cloud Platform (GCP)storage bucket. An adversary may modify the permissions on a storage bucket to weaken their target's security controlsor an administrator may inadvertently modify the permissions, which could lead to data exposure or loss.", "output": "event.dataset:gcp.audit AND action:\"storage.setIamPermissions\" AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a Google Cloud Platform (GCP) storage bucket is deleted. An adversary may delete a storage bucket inorder to disrupt their target's business operations.", "output": "event.dataset:gcp.audit AND action:\"storage.buckets.delete\""}
{"input": "", "instruction": "查找 category 为 process 的事件，并且事件类型是 start 或 process_started。同时，process 名称是 chmod，进程阐述包含 g+s 或者以 /2开头后面跟 4 个数字的字符串。另外，发起这些进程的用户不是 root。", "output": "event.category:process AND (event_type:start OR event_type:process_started) AND process:chmod AND (process.args:g+s OR process.args:/2[0-9]{3}/) AND NOT user.name:root"}
{"input": "", "instruction": "找非 root 用户执行 chmod 命令设置 SGID 位或设置文件权限为 /2000/ 格式的事件。", "output": "event.category:process AND (event_type:start OR event_type:process_started) AND process:chmod AND (process.args:g+s OR process.args:/2[0-9]{3}/) AND NOT user.name:root"}
{"input": "", "instruction": "查找具有以下特征的事件: 1. 事件类别为process,类型为start 或 process_started; 2. 进程名称为chmod; 3. 进程参数包含\"+s\"、\"u+s\"、\"/4[0-9]{3}/\"、\"g+s\"或\"/2[0-9]{3}/\"之一; 4. 进程参数不包含一系列路径,如\"/Applications/\"、\"/usr/lib/\"等; 5. 父进程可执行文件不包含\"/var/lib/docker/\"或\"/System/Library/PrivateFrameworks/PackageKit.framework/\"等路径", "output": "event.category:process AND (event_type:start OR event_type:process_started) AND process:chmod AND (process.args:\"+s\" OR process.args:\"u+s\" OR process.args:/4[0-9]{3}/ OR process.args:g+s OR process.args:/2[0-9]{3}/) AND NOT (process.args:/.*\\/Applications\\/VirtualBox.app\\/.+/ OR process.args:/\\/usr\\/local\\/lib\\/python.+/ OR process.args:/\\/var\\/folders\\/.+\\/FP.*nstallHelper/ OR process.args:/\\/Library\\/Filesystems\\/.+/ OR process.args:/\\/usr\\/lib\\/virtualbox\\/.+/ OR process.args:/\\/Library\\/Application.*/ OR process.args:\"/run/postgresql\" OR process.args:\"/var/crash\" OR process.args:\"/var/run/postgresql\" OR process.args:/\\/usr\\/bin\\/.+/ OR process.args:/\\/usr\\/local\\/share\\/.+/ OR process.args:/\\/Applications\\/.+/ OR process.args:/\\/usr\\/libexec\\/.+/ OR process.args:\"/var/metrics\" OR process.args:/\\/var\\/lib\\/dpkg\\/.+/ OR process.args:/\\/run\\/log\\/journal\\/.*/ OR process.args:\\/Users\\/*\\/.minikube\\/bin\\/docker-machine-driver-hyperkit ) AND NOT ( f_process_path:/\\/var\\/lib\\/docker\\/.+/ OR f_process_path:\"/System/Library/PrivateFrameworks/PackageKit.framework/Versions/A/XPCServices/package_script_service.xpc/Contents/MacOS/package_script_service\" OR f_process_path:\"/var/lib/dpkg/info/whoopsie.postinst\" )"}
{"input": "", "instruction": "找启用了SUID或SGID位的chmod进程事件,同时过滤掉一些无关进程和Docker相关进程。", "output": "event.category:process AND (event_type:start OR event_type:process_started) AND process:chmod AND (process.args:\"+s\" OR process.args:\"u+s\" OR process.args:/4[0-9]{3}/ OR process.args:g+s OR process.args:/2[0-9]{3}/) AND NOT (process.args:/.*\\/Applications\\/VirtualBox.app\\/.+/ OR process.args:/\\/usr\\/local\\/lib\\/python.+/ OR process.args:/\\/var\\/folders\\/.+\\/FP.*nstallHelper/ OR process.args:/\\/Library\\/Filesystems\\/.+/ OR process.args:/\\/usr\\/lib\\/virtualbox\\/.+/ OR process.args:/\\/Library\\/Application.*/ OR process.args:\"/run/postgresql\" OR process.args:\"/var/crash\" OR process.args:\"/var/run/postgresql\" OR process.args:/\\/usr\\/bin\\/.+/ OR process.args:/\\/usr\\/local\\/share\\/.+/ OR process.args:/\\/Applications\\/.+/ OR process.args:/\\/usr\\/libexec\\/.+/ OR process.args:\"/var/metrics\" OR process.args:/\\/var\\/lib\\/dpkg\\/.+/ OR process.args:/\\/run\\/log\\/journal\\/.*/ OR process.args:\\/Users\\/*\\/.minikube\\/bin\\/docker-machine-driver-hyperkit ) AND NOT ( f_process_path:/\\/var\\/lib\\/docker\\/.+/ OR f_process_path:\"/System/Library/PrivateFrameworks/PackageKit.framework/Versions/A/XPCServices/package_script_service.xpc/Contents/MacOS/package_script_service\" OR f_process_path:\"/var/lib/dpkg/info/whoopsie.postinst\" )"}
{"input": "", "instruction": "事件分类为网络或网络流量，事件类型是 TLS 或 HTTP，传输协议是TCP，目标域名匹配 3 个小写字母.stage.8个数字.任意字符。", "output": "(event.category:network OR event.category:network_traffic) AND (type:tls OR type:http) AND network.transport:tcp AND destination.domain:/[a-z]{3}.stage.[0-9]{8}\\..*/"}
{"input": "", "instruction": "事件分类为网络或网络流量，事件类型是 TLS 或 HTTP，传输协议是TCP，目标域名匹配 4-5 个字母加上pw,us,club,info,site,top结尾，并且不是 zoom.us 的日志。", "output": "(event.category:network OR event.category:network_traffic) AND (type:tls OR type:http) AND network.transport:tcp AND destination.domain:/[a-zA-Z]{4,5}\\.(pw|us|club|info|site|top)/ AND NOT destination.domain:zoom.us"}
{"input": "", "instruction": "查找网络事件中,协议是http和tcp,URL包含http://和/cd/,并且目标端口是常见的HTTP端口的事件", "output": "(event.category:network OR event.category:network_traffic) AND network.protocol:http AND  network.transport:tcp AND url.full:/http:\\/\\/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}\\/cd/ AND (dst_port:53 OR dst_port:80 OR dst_port:8080 OR dst_port:443)"}
{"input": "", "instruction": "查找HTTP请求中访问/cd/资源的日志", "output": "(event.category:network OR event.category:network_traffic) AND network.protocol:http AND  network.transport:tcp AND url.full:/http:\\/\\/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}\\/cd/ AND (dst_port:53 OR dst_port:80 OR dst_port:8080 OR dst_port:443)"}
{"input": "", "instruction": "在网络流量数据中检索成功的入站HTTP请求,目的端口是9200,响应不包含image/x-icon内容类型,请求不包含授权头", "output": "event.category:network_traffic AND network.protocol:http AND status:OK AND dst_port:9200 AND network.direction:inbound AND NOT http.response.headers.content-type:\"image/x-icon\" AND NOT _exists_:http.request.headers.authorization"}
{"input": "", "instruction": "This rule detects when an internal network client sends DNS traffic directly to the Internet. This is atypical behaviorfor a managed network and can be indicative of malware, exfiltration, command and control, or simplymisconfiguration. This DNS activity also impacts your organization's ability to provide enterprise monitoring andlogging of DNS, and it opens your network to a variety of abuses and malicious communications.", "output": "event.category:(network OR network_traffic) AND (event_type:connection OR type:dns) AND (dst_port:53 OR event.dataset:zeek.dns) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.0.0.0/24\" OR \"192.0.0.0/29\" OR \"192.0.0.8/32\" OR \"192.0.0.9/32\" OR \"192.0.0.10/32\" OR \"192.0.0.170/32\" OR \"192.0.0.171/32\" OR \"192.0.2.0/24\" OR \"192.31.196.0/24\" OR \"192.52.193.0/24\" OR \"192.168.0.0/16\" OR \"192.88.99.0/24\" OR \"224.0.0.0/4\" OR \"100.64.0.0/10\" OR \"192.175.48.0/24\" OR \"198.18.0.0/15\" OR \"198.51.100.0/24\" OR \"203.0.113.0/24\" OR \"240.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "This rule detects events that may indicate the use of FTP network connections to the Internet. The File TransferProtocol (FTP) has been around in its current form since the \"1980s. It can be a common and efficient procedure on yournetwork to send and receive files. Because of this, adversaries will also often use this protocol to exfiltrate datafrom your network or download new tools. Additionally, FTP is a plain-text protocol which, if intercepted, may exposeusernames and passwords. FTP activity involving servers subject to regulations or compliance standards may beunauthorized.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(20 OR 21) OR event.dataset:zeek.ftp) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "This rule detects events that use common ports for Internet Relay Chat (IRC) to the Internet. IRC is a common protocolthat can be used for chat and file transfers. This protocol is also a good candidate for remote control of malware anddata transfers to and from a network.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(6667 OR 6697) OR event.dataset:zeek.irc) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "TCP Port 8000 is commonly used for development environments of web server software. It generally should not be exposeddirectly to the Internet. If you are running software like this on the Internet, you should consider placing it behind areverse proxy.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND dst_port:8000 AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "This rule detects events that may indicate use of a PPTP VPN connection. Some threat actors use these types ofconnections to tunnel their traffic while avoiding detection.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND dst_port:1723"}
{"input": "", "instruction": "This rule detects events that may describe network events of proxy use to the Internet. It includes popular HTTP proxyports and SOCKS proxy ports. Typically, environments will use an internal IP address for a proxy server. It can also beused to circumvent network controls and detection mechanisms.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(1080 OR 3128 OR 8080) OR event.dataset:zeek.socks) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "This rule detects events that may describe SMTP traffic from internal hosts to a host across the Internet. In anenterprise network, there is typically a dedicated internal host that performs this function. It is also frequentlyabused by threat actors for command and control, or data exfiltration.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(25 OR 465 OR 587) OR event.dataset:zeek.smtp) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "This rule detects events that may describe database traffic (MS SQL, Oracle, MySQL, and Postgresql) across the Internet.Databases should almost never be directly exposed to the Internet, as they are frequently targeted by threat actors togain initial access to network resources.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(1433 OR 1521 OR 3306 OR 5432) OR event.dataset:zeek.mysql) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "This rule detects network events that may indicate the use of SSH traffic from the Internet. SSH is commonly used bysystem administrators to remotely control a system using the command line shell. If it is exposed to the Internet, itshould be done with strong security controls as it is frequently targeted and exploited by threat actors as an initialaccess or backdoor vector.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:22 OR event.dataset:zeek.ssh) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "This rule detects network events that may indicate the use of Tor traffic to the Internet. Tor is a network protocolthat sends traffic through a series of encrypted tunnels used to conceal a user's location and usage. Tor may be used bythreat actors as an alternate communication pathway to conceal the actor's identity and avoid detection.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND dst_port:(9001 OR 9030) AND src_ip:(\"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16) AND NOT dst_ip:(\"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\")"}
{"input": "", "instruction": "The Tcpdump program ran on a Linux host. Tcpdump is a network monitoring or packet sniffing tool that can be used tocapture insecure credentials or data in motion. Sniffing can also be used to discover details of network services as aprelude to lateral movement or defense evasion.", "output": "event.category:process AND event_type:(start OR process_started) AND process:tcpdump"}
{"input": "", "instruction": "Adversaries may attempt to disable the iptables or firewall service in an attempt to affect how a host is allowed toreceive or send network traffic.", "output": "event.category:process AND event_type:(start OR process_started) AND process:ufw AND process.args:(allow OR disable OR reset) OR (((process:service AND process.args:stop) OR (process:chkconfig AND process.args:off) OR (process:systemctl AND process.args:(disable OR stop OR kill))) AND process.args:(firewalld OR ip6tables OR iptables))"}
{"input": "", "instruction": "The whoami application was executed on a Linux host. This is often used by tools and persistence mechanisms to test forprivileged access.", "output": "event.category:process AND event_type:(start OR process_started) AND process:whoami"}
{"input": "", "instruction": "RegSvcs.exe and RegAsm.exe are Windows command line utilities that are used to register .NET Component Object Model(COM) assemblies. Adversaries can use RegSvcs.exe and RegAsm.exe to proxy execution of code through a trusted Windowsutility.", "output": "event.category:process AND event_type:(start OR process_started) AND process:(RegAsm.exe OR RegSvcs.exe)"}
{"input": "", "instruction": "This rule detects network events that may indicate the use of RDP traffic to the Internet. RDP is commonly used bysystem administrators to remotely control a system for maintenance or to use shared resources. It should almost never bedirectly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access orbackdoor vector.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:3389 OR event.dataset:zeek.rdp) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "The Linux mknod program is sometimes used in the command payload of a remote command injection (RCI) and other exploits.It is used to export a command shell when the traditional version of netcat is not available to the payload.", "output": "event.category:process AND event_type:(start OR process_started) AND process:mknod"}
{"input": "", "instruction": "Nmap was executed on a Linux host. Nmap is a FOSS tool for network scanning and security testing. It can map anddiscover networks, and identify listening services and operating systems. It is sometimes used to gather information insupport of exploitation, execution or lateral movement.", "output": "event.category:process AND event_type:(start OR process_started) AND process:nmap"}
{"input": "", "instruction": "A Socat process is running on a Linux host. Socat is often used as a persistence mechanism by exporting a reverse shell,or by serving a shell on a listening port. Socat is also sometimes used for lateral movement.", "output": "event.category:process AND event_type:(start OR process_started) AND process:socat AND NOT process.args:-V"}
{"input": "", "instruction": "Identifies the creation or execution of a cron job. Adversaries may abuse cron jobs to perform task scheduling forinitial or recurring execution of malicious code.", "output": "event.category:process AND event_type:(start OR process_started OR info) AND NOT user.name:root AND ((process:crontab AND NOT process.args:(\"-l\" OR \"-r\" OR \"-e\" OR \"-help\" OR \"-h\")) OR (process.parent.name:cron AND NOT process:\"running job\" AND NOT process.executable:(\"/Applications/Docker.app/Contents/Resources/bin/docker\" OR \"/usr/bin/killall\" OR \"/usr/sbin/sendmail\" OR \"/usr/bin/env\" OR \"/usr/bin/timeshift\" OR \"/bin/rm\")))"}
{"input": "", "instruction": "User groups in Google Workspace are created to help manage users permissions and access to various resources andapplications. The security label is only applied to a group when users within that group are expected to accesssensitive data and/or resources so administrators add this label to easily manage security groups better. Adversarieswith administrator access may modify a security group to allow external access from members outside the organization.This detection does not capture all modifications to security groups, but only those that could increase the riskassociated with them.", "output": "event.dataset:\"google_workspace.admin\" AND action:\"CHANGE_GROUP_SETTING\" AND event.category:\"iam\" AND ((google_workspace.admin.setting.name:\"ALLOW_EXTERNAL_MEMBERS\" AND google_workspace.admin.new_value:\"true\") OR (google_workspace.admin.setting.name:\"WHO_CAN_JOIN\" AND NOT (google_workspace.admin.new_value:\"INVITED_CAN_JOIN\" OR google_workspace.admin.new_value:\"CAN_REQUEST_TO_JOIN\")))"}
{"input": "", "instruction": "Identifies the creation or patching of potentially malicious role bindings. Users can use role bindings and cluster rolebindings to assign roles to Kubernetes subjects (users, groups, or service accounts).", "output": "event.dataset:(googlecloud.audit OR gcp.audit) AND action:(io.k8s.authorization.rbac.v*.clusterrolebindings.create orio.k8s.authorization.rbac.v*.rolebindings.create OR io.k8s.authorization.rbac.v*.clusterrolebindings.patch orio.k8s.authorization.rbac.v*.rolebindings.patch) AND event.outcome:success AND NOT gcp.audit.authentication_info.principal_email:\"system:addon-manager\""}
{"input": "", "instruction": "Strace is a useful diagnostic, instructional, and debugging tool. This rule identifies a privileged context execution ofstrace which can be used to escape restrictive environments by instantiating a shell in order to elevate privileges ormove laterally.", "output": "event.category:process AND event_type:(start OR process_started) AND process:strace"}
{"input": "", "instruction": "occurs when the expected agent ID associated with the API key does not match the actual agent ID in an event. This couldindicate attempts to spoof events in order to masquerade actual activity to evade detection.", "output": "event.agent_id_status:agent_id_mismatch"}
{"input": "", "instruction": "being taken over and used to inject illegitimate documents into an instance as an attempt to spoof events in order tomasquerade actual activity to evade detection.", "output": "event.agent_id_status:*"}
{"input": "", "instruction": "This rule identifies Zoom meetings that are created without a passcode. Meetings without a passcode are susceptible toZoombombing. Zoombombing is carried out by taking advantage of Zoom sessions that are not protected with a passcode.Zoombombing refers to the unwanted, disruptive intrusion, generally by Internet trolls and hackers, into a videoconference call. In a typical Zoombombing incident, a teleconferencing session is hijacked by the insertion of materialthat is lewd, obscene, racist, or antisemitic in nature, typically resulting of the shutdown of the session.", "output": "event_type:creation AND event.module:zoom AND event.dataset:zoom.webhook AND action:meeting.created AND NOT zoom.meeting.password:*"}
{"input": "", "instruction": "Adversaries may modify the standard authentication module for persistence via patching the normal authorization processor modifying the login configuration to allow unauthorized access or elevate privileges.", "output": "event.category:file AND event_type:change AND (file.name:pam_*.so OR file.path:(\\/etc\\/pam.d\\/* OR \\/private\\/etc\\/pam.d\\/* OR \\/usr\\/lib64\\/security\\/*)) AND process.executable: (* AND NOT ( \"/bin/yum\" OR \"/usr/sbin/pam-auth-update\" OR \"/usr/libexec/packagekitd\" OR \"/usr/bin/dpkg\" OR \"/usr/bin/vim\" OR \"/usr/libexec/xpcproxy\" OR \"/usr/bin/bsdtar\" OR \"/usr/local/bin/brew\" OR \"/usr/bin/rsync\" OR \"/usr/bin/yum\" OR \\/var\\/lib\\/docker\\/*\\/bin\\/yum OR \\/var\\/lib\\/docker\\/*\\/bin\\/dpkg OR .\\/merged\\/var\\/lib\\/docker\\/*\\/bin\\/dpkg OR \"\"/System/Library/PrivateFrameworks/PackageKit.framework/Versions/A/XPCServices/package_script_service.xpc/Contents/MacOS/package_script_service\" ) ) AND NOT file.path: ( \\/tmp\\/snap.rootfs_*\\/pam_*.so OR \\/tmp\\/newroot\\/lib\\/*\\/pam_*.so OR \\/private\\/var\\/folders\\/*\\/T\\/com.apple.fileprovider.ArchiveService\\/TemporaryItems\\/*\\/lib\\/security\\/pam_*.so OR \\/tmp\\/newroot\\/usr\\/lib64\\/security\\/pam_*.so )"}
{"input": "", "instruction": "Both ~/.bash_profile and ~/.bashrc are files containing shell commands that are run when Bash is invoked. These filesare executed in a user's context, either interactively or non-interactively, when a user logs in so that theirenvironment is set correctly. Adversaries may abuse this to establish persistence by executing malicious contenttriggered by a user’s shell.", "output": "event.category:file AND event_type:change AND process:(* AND NOT (sudo OR vim OR zsh OR env OR nano OR bash OR Terminal OR xpcproxy OR login OR cat OR cp OR launchctl OR java)) AND NOT process.executable:(\\/Applications\\/* OR \\/private\\/var\\/folders\\/* OR \\/usr\\/local\\/*) AND file.path:(\\/private\\/etc\\/rc.local OR \\/etc\\/rc.local OR \\/home\\/*\\/.profile OR \\/home\\/*\\/.profile1 OR \\/home\\/*\\/.bash_profile OR \\/home\\/*\\/.bash_profile1 OR \\/home\\/*\\/.bashrc OR \\/Users\\/*\\/.bash_profile OR \\/Users\\/*\\/.zshenv)"}
{"input": "", "instruction": "The Secure Shell (SSH) authorized_keys file specifies which users are allowed to log into a server using public keyauthentication. Adversaries may modify it to maintain persistence on a victim host by adding their own public key(s).", "output": "event.category:file AND event_type:(change OR creation) AND file.name:(\"authorized_keys\" OR \"authorized_keys2\" OR \"/etc/ssh/sshd_config\" OR \"/root/.ssh\") AND NOT process.executable: (\\/Library\\/Developer\\/CommANDLineTools\\/usr\\/bin\\/git OR \\/usr\\/local\\/Cellar\\/maven\\/*\\/libexec\\/bin\\/mvn OR \\/Library\\/Java\\/JavaVirtualMachines\\/jdk*.jdk\\/Contents\\/Home\\/bin\\/java OR \\/usr\\/bin\\/vim OR \\/usr\\/local\\/Cellar\\/coreutils\\/*\\/bin\\/gcat OR \\/usr\\/bin\\/bsdtar OR \\/usr\\/bin\\/nautilus OR \\/usr\\/bin\\/scp OR \\/usr\\/bin\\/touch OR \\/var\\/lib\\/docker\\/* OR \\/usr\\/bin\\/google_guest_agent OR \\/opt\\/jc\\/bin\\/jumpcloud-agent)"}
{"input": "", "instruction": "A sudoers file specifies the commands users or groups can run and from which terminals. Adversaries can take advantageof these configurations to execute commands as other users or spawn processes with higher privileges.", "output": "event.category:process AND event_type:start AND process.args:(echo AND *NOPASSWD*ALL*)"}
{"input": "", "instruction": "Identifies the attempted use of a heap-based buffer overflow vulnerability for the Sudo binary in Unix-like systems(CVE-2021-3156). Successful exploitation allows an unprivileged user to escalate to the root user.", "output": "event.category:process AND event_type:start AND process:(sudo OR sudoedit) AND process.args:(*\\ AND (\"-i\" OR \"-s\"))"}
{"input": "", "instruction": "A sudoers file specifies the commands that users or groups can run and from which terminals. Adversaries can takeadvantage of these configurations to execute commands as other users or spawn processes with higher privileges.", "output": "event.category:file AND event_type:change AND file.path:(\\/etc\\/sudoers* OR \\/private\\/etc\\/sudoers*)"}
{"input": "", "instruction": "This rule is triggered when indicators from the Threat Intel Filebeat module (v8.x) has a match against local file or network observations.", "output": "starttime=\"now-30d/d\" event.module:threatintel AND (threat.indicator.file.hash.*:* OR threat.indicator.file.pe.imphash:* OR threat.indicator.ip:* OR threat.indicator.registry.path:* OR threat.indicator.url.full:*)"}
{"input": "", "instruction": "This rule is triggered when indicators from the Threat Intel integrations have a match against local file or network observations.", "output": "starttime=\"now-30d/d\" AND event.dataset:ti_* AND (threat.indicator.file.hash.*:* OR threat.indicator.file.pe.imphash:* OR threat.indicator.ip:* OR threat.indicator.registry.path:* OR threat.indicator.url.full:*)"}
{"input": "", "instruction": "Identifies a high number of failed attempts to assume an AWS Identity and Access Management (IAM) role. IAM roles areused to delegate access to users or services. An adversary may attempt to enumerate IAM roles in order to determine if arole exists before attempting to assume or hijack the discovered role.", "output": "event.dataset:aws.cloudtrail AND event.provider:iam.amazonaws.com AND action:UpdateAssumeRolePolicy AND aws.cloudtrail.error_code:MalformedPolicyDocumentException AND event.outcome:failure"}
{"input": "", "instruction": "An adversary equipped with compromised credentials may attempt to access the secrets in secrets manager to stealcertificates, credentials, or other sensitive material.", "output": "event.dataset:aws.cloudtrail AND event.provider:secretsmanager.amazonaws.com AND action:GetSecretValue AND event.outcome:success AND NOT user_agent.name: (\"Chrome\" OR \"Firefox\" OR \"Safari\" OR \"Edge\" OR \"Brave\" OR \"Opera\" OR \"aws-cli\")"}
{"input": "", "instruction": "Identifies a high number of failed authentication attempts to the AWS management console for the Root uidentity. Anadversary may attempt to brute force the password for the Root uidentity, as it has complete access to all servicesand resources for the AWS account.", "output": "event.dataset:aws.cloudtrail AND event.provider:signin.amazonaws.com AND action:ConsoleLogin AND aws.cloudtrail.uidentity.type:Root AND event.outcome:failure"}
{"input": "", "instruction": "Identifies suspending the recording of AWS API calls and log file delivery for the specified trail. An adversary maysuspend trails in an attempt to evade defenses.", "output": "event.dataset:aws.cloudtrail AND event.provider:cloudtrail.amazonaws.com AND action:StopLogging AND event.outcome:success"}
{"input": "", "instruction": "Identifies attempts to delete an AWS Config Service resource. An adversary may tamper with Config services in order toreduce visibility into the security posture of an account and / or its workload instances.", "output": "event.dataset:aws.cloudtrail AND event.provider:config.amazonaws.com AND action:(DeleteConfigRule OR DeleteOrganizationConfigRule OR DeleteConfigurationAggregator OR DeleteConfigurationRecorder OR DeleteConformancePack OR DeleteOrganizationConformancePack OR DeleteDeliveryChannel OR DeleteRemediationConfiguration OR DeleteRetentionConfiguration)"}
{"input": "", "instruction": "Identifies the deletion of one or more flow logs in AWS Elastic Compute Cloud (EC2). An adversary may delete flow logsin an attempt to evade defenses.", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:DeleteFlowLogs AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of an Amazon Elastic Compute Cloud (EC2) network access control list (ACL) or one of itsingress/egress entries.", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:(DeleteNetworkAcl OR DeleteNetworkAclEntry) AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of an Amazon GuardDuty detector. Upon deletion, GuardDuty stops monitoring the environment andall existing findings are lost.", "output": "event.dataset:aws.cloudtrail AND event.provider:guardduty.amazonaws.com AND action:DeleteDetector AND event.outcome:success"}
{"input": "", "instruction": "Identifies potential Traffic Mirroring in an Amazon Elastic Compute Cloud (EC2) instance. Traffic Mirroring is an AmazonVPC feature that you can use to copy network traffic from an Elastic network interface. This feature can potentially beabused to exfiltrate sensitive data from unencrypted internal traffic.", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com ANDaction:(CreateTrafficMirrorFilter OR CreateTrafficMirrorFilterRule OR CreateTrafficMirrorSession OR CreateTrafficMirrorTarget) AND event.outcome:success"}
{"input": "", "instruction": "An attempt was made to modify AWS EC2 snapshot attributes. Snapshots are sometimes shared by threat actors in order toexfiltrate bulk data from an EC2 fleet. If the permissions were modified, verify the snapshot was not shared with anunauthorized or unexpected AWS account.", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:ModifySnapshotAttribute"}
{"input": "", "instruction": "Identifies an attempt to export an AWS EC2 instance. A virtual machine (VM) export may indicate an attempt to extract orexfiltrate information.", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:CreateInstanceExportTask AND event.outcome:failure"}
{"input": "", "instruction": "Identifies when an attempt was made to restore an RDS Snapshot. Snapshots are sometimes shared by threat actors in orderto exfiltrate bulk data or evade detection after performing malicious activities. If the permissions were modified,verify if the snapshot was shared with an unauthorized or unexpected AWS account.", "output": "event.dataset:aws.cloudtrail AND event.provider:rds.amazonaws.com AND action:RestoreDBInstanceFromDBSnapshot ANDevent.outcome:success"}
{"input": "", "instruction": "Identifies when a user has disabled or deleted an EventBridge rule. This activity can result in an unintended loss ofvisibility in applications or a break in the flow with other AWS services.", "output": "event.dataset:aws.cloudtrail AND event.provider:eventbridge.amazonaws.com AND action:(DeleteRule OR DisableRule) ANDevent.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of a specified AWS CloudWatch log group. When a log group is deleted, all the archived logevents associated with the log group are also permanently deleted.", "output": "event.dataset:aws.cloudtrail AND event.provider:logs.amazonaws.com AND action:DeleteLogGroup AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of an AWS CloudWatch log stream, which permanently deletes all associated archived log eventswith the stream.", "output": "event.dataset:aws.cloudtrail AND event.provider:logs.amazonaws.com AND action:DeleteLogStream AND event.outcome:success"}
{"input": "", "instruction": "Identifies disabling of Amazon Elastic Block Store (EBS) encryption by default in the current region. Disablingencryption by default does not change the encryption status of your existing volumes.", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:DisableEbsEncryptionByDefault AND event.outcome:success"}
{"input": "", "instruction": "Detects when an EFS File System or Mount is deleted. An adversary could break any file system using the mount targetthat is being deleted, which might disrupt instances or applications using those mounts. The mount must be deleted priorto deleting the File System, or the adversary will be unable to delete the File System.", "output": "event.dataset:aws.cloudtrail AND event.provider:elasticfilesystem.amazonaws.com ANDaction:(DeleteMountTarget OR DeleteFileSystem) AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deactivation of a specified multi-factor authentication (MFA) device and removes it from association withthe user name for which it was originally enabled. In AWS Identity and Access Management (IAM), a device must bedeactivated before it can be deleted.", "output": "event.dataset:aws.cloudtrail AND event.provider:iam.amazonaws.com AND action:(DeactivateMFADevice OR DeleteVirtualMFADevice) AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of a specified AWS Identity and Access Management (IAM) resource group. Deleting a resourcegroup does not delete resources that are members of the group; it only deletes the group structure.", "output": "event.dataset:aws.cloudtrail AND event.provider:iam.amazonaws.com AND action:DeleteGroup AND event.outcome:success"}
{"input": "", "instruction": "Identifies attempts to disable or schedule the deletion of an AWS KMS Customer Managed Key (CMK). Deleting an AWS KMSkey is destructive and potentially dangerous. It deletes the key material and all metadata associated with the KMS keyand is irreversible. After a KMS key is deleted, the data that was encrypted under that KMS key can no longer bedecrypted, which means that data becomes unrecoverable.", "output": "event.dataset:aws.cloudtrail AND event.provider:kms.amazonaws.com AND action:(\"DisableKey\" OR \"ScheduleKeyDeletion\") AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of an Amazon Relational Database Service (RDS) Aurora database cluster, global database cluster,or database instance.", "output": "event.dataset:aws.cloudtrail AND event.provider:rds.amazonaws.com AND action:(DeleteDBCluster OR DeleteGlobalCluster OR DeleteDBInstance)AND event.outcome:success"}
{"input": "", "instruction": "Identifies AWS IAM password recovery requests. An adversary may attempt to gain unauthorized AWS access by abusingpassword recovery mechanisms.", "output": "event.dataset:aws.cloudtrail AND event.provider:signin.amazonaws.com AND action:PasswordRecoveryRequested AND event.outcome:success"}
{"input": "", "instruction": "Identifies the execution of commands and scripts via System Manager. Execution methods such as RunShellScript,RunPowerShellScript, and alike can be abused by an authenticated attacker to install a backdoor or to interact with acompromised instance via reverse-shell using system only commands.", "output": "event.dataset:aws.cloudtrail AND event.provider:ssm.amazonaws.com AND action:SendCommAND AND event.outcome:success"}
{"input": "", "instruction": "Identifies the creation of an AWS Elastic Compute Cloud (EC2) network access control list (ACL) or an entry in a networkACL with a specified rule number.", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:(CreateNetworkAcl OR CreateNetworkAclEntry) AND event.outcome:success"}
{"input": "", "instruction": "Identifies a change to an AWS Security Group Configuration. A security group is like a virtual firewall, and modifyingconfigurations may allow unauthorized access. Threat actors may abuse this to establish persistence, exfiltrate data, orpivot in an AWS environment.", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:(AuthorizeSecurityGroupEgress ORCreateSecurityGroup OR ModifyInstanceAttribute OR ModifySecurityGroupRules OR RevokeSecurityGroupEgress ORRevokeSecurityGroupIngress) AND event.outcome:success"}
{"input": "", "instruction": "Identifies the creation of a group in AWS Identity and Access Management (IAM). Groups specify permissions for multipleusers. Any user in a group automatically has the permissions that are assigned to the group.", "output": "event.dataset:aws.cloudtrail AND event.provider:iam.amazonaws.com AND action:CreateGroup AND event.outcome:success"}
{"input": "", "instruction": "Identifies the creation of a new Amazon Relational Database Service (RDS) Aurora DB cluster or global database spreadacross multiple regions.", "output": "event.dataset:aws.cloudtrail AND event.provider:rds.amazonaws.com AND action:(CreateDBCluster OR CreateGlobalCluster) AND event.outcome:success"}
{"input": "", "instruction": "Identifies the creation of an Amazon Redshift cluster. Unexpected creation of this cluster by a non-administrative usermay indicate a permission or role issue with current users. If unexpected, the resource may not properly be configuredand could introduce security vulnerabilities.", "output": "event.dataset:aws.cloudtrail AND event.provider:redshift.amazonaws.com AND action:CreateCluster AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a transfer lock was removed from a Route 53 domain. It is recommended to refrain from performing thisaction unless intending to transfer the domain to a different registrar.", "output": "event.dataset:aws.cloudtrail AND event.provider:route53.amazonaws.com AND action:DisableDomainTransferLock AND event.outcome:success"}
{"input": "", "instruction": "Identifies attempts to login to AWS as the root user without using multi-factor authentication (MFA). Amazon AWS bestpractices indicate that the root user should be protected by MFA.", "output": "event.dataset:aws.cloudtrail AND event.provider:signin.amazonaws.com AND action:ConsoleLogin AND aws.cloudtrail.uidentity.type:Root AND aws.cloudtrail.console_login.additional_eventdata.mfa_used:false AND event.outcome:success"}
{"input": "", "instruction": "Identifies the use of AssumeRole. AssumeRole returns a set of temporary security credentials that can be used to accessAWS resources. An adversary could use those credentials to move laterally and escalate privileges.", "output": "event.dataset:aws.cloudtrail AND event.provider:sts.amazonaws.com AND action:AssumedRole ANDaws.cloudtrail.uidentity.session_context.session_issuer.type:Role AND event.outcome:success"}
{"input": "", "instruction": "Identifies the suspicious use of GetSessionToken. Tokens could be created and used by attackers to move laterally andescalate privileges.", "output": "event.dataset:aws.cloudtrail AND event.provider:sts.amazonaws.com AND action:GetSessionToken ANDaws.cloudtrail.uidentity.type:IAMUser AND event.outcome:success"}
{"input": "", "instruction": "Identifies attempts to modify an AWS IAM Assume Role Policy. An adversary may attempt to modify the AssumeRolePolicy ofa misconfigured role in order to gain the privileges of that role.", "output": "event.dataset:aws.cloudtrail AND event.provider:iam.amazonaws.com AND action:UpdateAssumeRolePolicy AND event.outcome:success"}
{"input": "", "instruction": "Identifies when an Event Hub Authorization Rule is created or updated in Azure. An authorization rule is associated withspecific rights, and carries a pair of cryptographic keys. When you create an Event Hubs namespace, a policy rule namedRootManageSharedAccessKey is created for the namespace. This has manage permissions for the entire namespace and it'srecommended that you treat this rule like an administrative root account and don't use it in your application.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies potential full network packet capture in Azure. Packet Capture is an Azure Network Watcher feature that canbe used to inspect network traffic. This feature can potentially be abused to read sensitive data from unencryptedinternal traffic.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name: ( \"MICROSOFT.NETWORK/*/STARTPACKETCAPTURE/ACTION\" OR \"MICROSOFT.NETWORK/*/VPNCONNECTIONS/STARTPACKETCAPTURE/ACTION\" OR \"MICROSOFT.NETWORK/*/PACKETCAPTURES/WRITE\" ) ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies modifications to a Key Vault in Azure. The Key Vault is a service that safeguards encryption keys and secretslike certificates, connection strings, and passwords. Because this data is sensitive and business critical, access tokey vaults should be secured to allow only authorized applications and users.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.KEYVAULT/VAULTS/WRITE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies a rotation to storage account access keys in Azure. Regenerating access keys can affect any applications orAzure services that are dependent on the storage account key. Adversaries may regenerate a key as a means of acquiringcredentials to access systems and resources.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when a new credential is added to an application in Azure. An application may use a certificate or secretstring to prove its identity when requesting a token. Multiple certificates and secrets can be added for an applicationand an adversary may abuse this by creating an additional authentication method to evade defenses or persist in anenvironment.", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Update application - Certificates AND secrets management\" AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "Identifies when an Azure Automation runbook is deleted. An adversary may delete an Azure Automation runbook in order todisrupt their target's automated business operations or to remove a malicious runbook for defense evasion.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when the Azure role-based access control (Azure RBAC) permissions are modified for an Azure Blob. Anadversary may modify the permissions on a blob to weaken their target's security controls or an administrator mayinadvertently modify the permissions, which could lead to data exposure or loss.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:( \"MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MANAGEOWNERSHIP/ACTION\" OR \"MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MODIFYPERMISSIONS/ACTION\") AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies the deletion of diagnostic settings in Azure, which send platform logs and metrics to different destinations.An adversary may delete diagnostic settings in an attempt to evade defenses.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when a new service principal is added in Azure. An application, hosted service, or automated tool thataccesses or modifies resources needs an identity created. This identity is known as a service principal. For securityreasons, it's always recommended to use service principals with automated tools rather than allowing them to log in witha uidentity.", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Add service principal\" AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "Identifies an Event Hub deletion in Azure. An Event Hub is an event processing service that ingests and processes largevolumes of events and data. An adversary may delete an Event Hub in an attempt to evade detection.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies the deletion of a firewall policy in Azure. An adversary may delete a firewall policy in an attempt to evadedefenses and/or to eliminate barriers to their objective.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies the deletion of a Frontdoor Web Application Firewall (WAF) Policy in Azure. An adversary may delete aFrontdoor Web Application Firewall (WAF) Policy in an attempt to evade defenses and/or to eliminate barriers to theirobjective.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.NETWORK/FRONTDOORWEBAPPLICATIONFIREWALLPOLICIES/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when events are deleted in Azure Kubernetes. Kubernetes events are objects that log any state changes.Example events are a container creation, an image pull, or a pod scheduling on a node. An adversary may delete events inAzure Kubernetes in an attempt to evade detection.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE\" ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies the deletion of a Network Watcher in Azure. Network Watchers are used to monitor, diagnose, view metrics, andenable or disable logs for resources in an Azure virtual network. An adversary may delete a Network Watcher in anattempt to evade defenses.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.NETWORK/NETWORKWATCHERS/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies the creation of suppression rules in Azure. Suppression rules are a mechanism used to suppress alertspreviously identified as false positives or too noisy to be in production. This mechanism can be abused or mistakenlyconfigured, resulting in defense evasions and loss of security visibility.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.SECURITY/ALERTSSUPPRESSIONRULES/WRITE\" ANDevent.outcome: \"success\""}
{"input": "", "instruction": "Identifies changes to container access levels in Azure. Anonymous public read access to containers and blobs in Azure isa way to share data broadly, but can present a security risk if access to sensitive data is not managed judiciously.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/WRITE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies command execution on a virtual machine (VM) in Azure. A Virtual Machine Contributor role lets you managevirtual machines, but not access them, nor access the virtual network or storage account they’re connected to. However,commands can be run via PowerShell on the VM, which execute as System. Other roles, such as certain Administrator rolesmay be able to execute commands on a VM as well.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.COMPUTE/VIRTUALMACHINES/RUNCOMMAND/ACTION\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when new Service Principal credentials have been added in Azure. In most organizations, credentials will beadded to service principals infrequently. Hijacking an application (by adding a rogue secret or certificate) withgranted permissions will allow the attacker to access data that is normally protected by MFA requirements.", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Add service principal credentials\" AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "Identifies the deletion of Azure Kubernetes Pods. Adversaries may delete a Kubernetes pod to disrupt the normal behaviorof the environment.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/PODS/DELETE\" ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies the deletion of a resource group in Azure, which includes all resources within the group. Deletion ispermanent and irreversible. An adversary may delete a resource group in an attempt to evade defenses or intentionallydestroy data.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when a virtual network device is modified or deleted. This can be a network virtual appliance, virtual hub,or virtual router.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:(\"MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/WRITE\" OR\"MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/DELETE\" OR \"MICROSOFT.NETWORK/NETWORKINTERFACES/WRITE\" OR\"MICROSOFT.NETWORK/NETWORKINTERFACES/JOIN/ACTION\" OR \"MICROSOFT.NETWORK/NETWORKINTERFACES/DELETE\" OR\"MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/DELETE\" OR \"MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/WRITE\" OR\"MICROSOFT.NETWORK/VIRTUALHUBS/DELETE\" OR \"MICROSOFT.NETWORK/VIRTUALHUBS/WRITE\" OR\"MICROSOFT.NETWORK/VIRTUALROUTERS/WRITE\" OR \"MICROSOFT.NETWORK/VIRTUALROUTERS/DELETE\") ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies high risk Azure Active Directory (AD) sign-ins by leveraging Microsoft's Identity Protection machine learningand heuristics. Identity Protection categorizes risk into three tiers: low, medium, and high. While Microsoft does notprovide specific details about how risk is calculated, each level brings higher confidence that the user or sign-in iscompromised.", "output": "event.dataset:azure.signinlogs AND (azure.signinlogs.properties.risk_level_during_signin:high OR azure.signinlogs.properties.risk_level_aggregated:high) AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "Identifies high risk Azure Active Directory (AD) sign-ins by leveraging Microsoft Identity Protection machine learningand heuristics.", "output": "event.dataset:azure.signinlogs AND azure.signinlogs.properties.risk_state:(\"confirmedCompromised\" OR \"atRisk\") AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "Identifies a sign-in using the Azure Active Directory PowerShell module. PowerShell for Azure Active Directory allowsfor managing settings from the command line, which is intended for users who are members of an admin role.", "output": "event.dataset:azure.signinlogs AND azure.signinlogs.properties.app_display_name:\"Azure Active Directory PowerShell\" AND azure.signinlogs.properties.token_issuer_type:AzureAD AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "Detects when a user grants permissions to an Azure-registered application or when an administrator grants tenant-widepermissions to an application. An adversary may create an Azure-registered application that requests access to data suchas contact information, email, or documents.", "output": "event.dataset:(azure.activitylogs OR azure.auditlogs OR o365.audit) AND ( azure.activitylogs.operation_name:\"Consent to application\" OR azure.auditlogs.operation_name:\"Consent to application\" OR o365.audit.Operation:\"Consent to application.\" ) AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies an invitation to an external user in Azure Active Directory (AD). Azure AD is extended to includecollaboration, allowing you to invite people from outside your organization to be guest users in your cloud account.Unless there is a business need to provision guest access, it is best practice avoid creating guest users. Guest userscould potentially be overlooked indefinitely leading to a potential vulnerability.", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Invite external user\" AND azure.auditlogs.properties.target_resources.*.display_name:guest AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when an Azure Automation account is created. Azure Automation accounts can be used to automate managementtasks and orchestrate actions across systems. An adversary may create an Automation account in order to maintainpersistence in their target's environment.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when an Azure Automation runbook is created or modified. An adversary may create or modify an AzureAutomation runbook to execute malicious code and maintain persistence in their target's environment.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name: ( \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE\" OR \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE\" OR \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION\" ) AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when an Azure Automation webhook is created. Azure Automation runbooks can be configured to execute via awebhook. A webhook uses a custom URL passed to Azure Automation along with a data payload specific to the runbook. Anadversary may create a webhook in order to trigger a runbook that contains malicious code.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name: ( \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION\" OR \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE\" ) AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when an Azure Conditional Access policy is modified. Azure Conditional Access policies control access toresources via if-then statements. For example, if a user wants to access a resource, then they must complete an actionsuch as using multi-factor authentication to access it. An adversary may modify a Conditional Access policy in order toweaken their target's security controls.", "output": "event.dataset:(azure.activitylogs OR azure.auditlogs) ANDaction:\"Update conditional access policy\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies an Azure Active Directory (AD) Global Administrator role addition to a Privileged Identity Management (PIM)user account. PIM is a service that enables you to manage, control, and monitor access to important resources in anorganization. Users who are assigned to the Global administrator role can read and modify any administrative setting inyour Azure AD organization.", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.properties.category:RoleManagement AND azure.auditlogs.operation_name:(\"Add eligible member to role in PIM completed (permanent)\" OR \"Add member to role in PIM completed (timebound)\") AND azure.auditlogs.properties.target_resources.*.display_name:\"Global Administrator\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Azure Active Directory (AD) Privileged Identity Management (PIM) is a service that enables you to manage, control, andmonitor access to important resources in an organization. PIM can be used to manage the built-in Azure resource rolessuch as Global Administrator and Application Administrator. An adversary may add a user to a PIM role in order tomaintain persistence in their target's environment or modify a PIM role to weaken their target's security controls.", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Update role setting in PIM\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when multi-factor authentication (MFA) is disabled for an Azure user account. An adversary may disable MFAfor a user account in order to weaken the authentication requirements for the account.", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Disable Strong Authentication\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when a user is added as an owner for an Azure application. An adversary may add a user account as an ownerfor an Azure application in order to grant additional permissions and modify the application's configuration usinganother account.", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Add owner to application\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies when a user is added as an owner for an Azure service principal. The service principal object defines whatthe application can do in the specific tenant, who can access the application, and what resources the app can access. Aservice principal object is created when an application is given permission to access resources in a tenant. Anadversary may add a user account as an owner for a service principal and use that account in order to define what anapplication can do in the Azure AD tenant.", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Add owner to service principal\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "Identifies the creation of role binding or cluster role bindings. You can assign these roles to Kubernetes subjects(users, groups, or service accounts) with role bindings and cluster role bindings. An adversary who has permissions tocreate bindings and cluster-bindings in the cluster can create a binding to the cluster-admin ClusterRole or to otherhigh privileges roles.", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name: (\"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLEBINDINGS/WRITE\" OR \"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLEBINDINGS/WRITE\") ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "Generates a detection alert each time a 'Container Workload Protection' alert is received. Enabling this rule allows you toimmediately begin triaging and investigating these alerts.", "output": "event.kind:alert AND event.module:cloud_defend"}
{"input": "", "instruction": "Identifies the occurrence of a CyberArk Privileged Access Security (PAS) error level audit event. The event_idcorrelates to the CyberArk Vault Audit Action Code.", "output": "event.dataset:cyberarkpas.audit AND event_type:error"}
{"input": "", "instruction": "Identifies the occurrence of a CyberArk Privileged Access Security (PAS) non-error level audit event which isrecommended for monitoring by the vendor. The event_id correlates to the CyberArk Vault Audit Action Code.", "output": "event.dataset:cyberarkpas.audit AND event_id:(4 OR 22 OR 24 OR 31 OR 38 OR 57 OR 60 OR 130 OR 295 OR 300 OR 302 OR 308 OR 319 OR 344 OR 346 OR 359 OR 361 OR 378 OR 380 OR 411) AND NOT event_type:error"}
{"input": "", "instruction": "Generates a detection alert each time an Endpoint Security alert is received. Enabling this rule allows you toimmediately begin investigating your Endpoint alerts.", "output": "event.kind:alert AND event.module:(endpoint AND NOT endgame)"}
{"input": "", "instruction": "Identifies the creation of a subscription in Google Cloud Platform (GCP). In GCP, the publisher-subscriber relationship(Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing services. Asubscription is a named resource representing the stream of messages to be delivered to the subscribing application.", "output": "event.dataset:gcp.audit AND action:google.pubsub.v*.Subscriber.CreateSubscription AND event.outcome:success"}
{"input": "", "instruction": "Identifies the creation of a topic in Google Cloud Platform (GCP). In GCP, the publisher-subscriber relationship(Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing services. A topic isused to forward messages from publishers to subscribers.", "output": "event.dataset:gcp.audit AND action:google.pubsub.v*.Publisher.CreateTopic AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a firewall rule is created in Google Cloud Platform (GCP) for Virtual Private Cloud (VPC) or App Engine.These firewall rules can be configured to allow or deny connections to or from virtual machine (VM) instances orspecific applications. An adversary may create a new firewall rule in order to weaken their target's security controlsand allow more permissive ingress or egress traffic flows for their benefit.", "output": "event.dataset:gcp.audit AND action:(*.compute.firewalls.insert OR google.appengine.*.Firewall.Create*Rule)"}
{"input": "", "instruction": "Identifies when a firewall rule is deleted in Google Cloud Platform (GCP) for Virtual Private Cloud (VPC) or App Engine.These firewall rules can be configured to allow or deny connections to or from virtual machine (VM) instances orspecific applications. An adversary may delete a firewall rule in order to weaken their target's security controls.", "output": "event.dataset:gcp.audit AND action:(*.compute.firewalls.delete OR google.appengine.*.Firewall.Delete*Rule)"}
{"input": "", "instruction": "Identifies when a firewall rule is modified in Google Cloud Platform (GCP) for Virtual Private Cloud (VPC) or AppEngine. These firewall rules can be modified to allow or deny connections to or from virtual machine (VM) instances orspecific applications. An adversary may modify an existing firewall rule in order to weaken their target's securitycontrols and allow more permissive ingress or egress traffic flows for their benefit.", "output": "event.dataset:gcp.audit AND action:(*.compute.firewalls.patch OR google.appengine.*.Firewall.Update*Rule)"}
{"input": "", "instruction": "Identifies a Logging sink deletion in Google Cloud Platform (GCP). Every time a log entry arrives, Logging compares thelog entry to the sinks in that resource. Each sink whose filter matches the log entry writes a copy of the log entry tothe sink's export destination. An adversary may delete a Logging sink to evade detection.", "output": "event.dataset:gcp.audit AND action:google.logging.v*.ConfigServiceV*.DeleteSink AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of a subscription in Google Cloud Platform (GCP). In GCP, the publisher-subscriber relationship(Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing services. Asubscription is a named resource representing the stream of messages to be delivered to the subscribing application.", "output": "event.dataset:gcp.audit AND action:google.pubsub.v*.Subscriber.DeleteSubscription AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of a topic in Google Cloud Platform (GCP). In GCP, the publisher-subscriber relationship(Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing services. A publisherapplication creates and sends messages to a topic. Deleting a topic can interrupt message flow in the Pub/Sub pipeline.", "output": "event.dataset:gcp.audit AND action:google.pubsub.v*.Publisher.DeleteTopic AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a Virtual Private Cloud (VPC) network is deleted in Google Cloud Platform (GCP). A VPC network is avirtual version of a physical network within a GCP project. Each VPC network has its own subnets, routes, and firewall,as well as other elements. An adversary may delete a VPC network in order to disrupt their target's network and businessoperations.", "output": "event.dataset:gcp.audit AND action:v*.compute.networks.delete AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a virtual private cloud (VPC) route is created in Google Cloud Platform (GCP). Google Cloud routesdefine the paths that network traffic takes from a virtual machine (VM) instance to other destinations. Thesedestinations can be inside a Google VPC network or outside it. An adversary may create a route in order to impact theflow of network traffic in their target's cloud environment.", "output": "event.dataset:gcp.audit AND action:(v*.compute.routes.insert OR \"beta.compute.routes.insert\")"}
{"input": "", "instruction": "Identifies when a Virtual Private Cloud (VPC) route is deleted in Google Cloud Platform (GCP). Google Cloud routesdefine the paths that network traffic takes from a virtual machine (VM) instance to other destinations. Thesedestinations can be inside a Google VPC network or outside it. An adversary may delete a route in order to impact theflow of network traffic in their target's cloud environment.", "output": "event.dataset:gcp.audit AND action:v*.compute.routes.delete AND event.outcome:success"}
{"input": "", "instruction": "Identifies a modification to a Logging sink in Google Cloud Platform (GCP). Logging compares the log entry to the sinksin that resource. Each sink whose filter matches the log entry writes a copy of the log entry to the sink's exportdestination. An adversary may update a Logging sink to exfiltrate logs to a different export destination.", "output": "event.dataset:gcp.audit AND action:google.logging.v*.ConfigServiceV*.UpdateSink AND event.outcome:success"}
{"input": "", "instruction": "Identifies an Identity and Access Management (IAM) role deletion in Google Cloud Platform (GCP). A role contains a setof permissions that allows you to perform specific actions on Google Cloud resources. An adversary may delete an IAMrole to inhibit access to accounts utilized by legitimate users.", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.DeleteRole AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a service account is deleted in Google Cloud Platform (GCP). A service account is a special type ofaccount used by an application or a virtual machine (VM) instance, not a person. Applications use service accounts tomake authorized API calls, authorized as either the service account itself, or as G Suite or Cloud Identity usersthrough domain-wide delegation. An adversary may delete a service account in order to disrupt their target's businessoperations.", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.DeleteServiceAccount AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a service account is disabled in Google Cloud Platform (GCP). A service account is a special type ofaccount used by an application or a virtual machine (VM) instance, not a person. Applications use service accounts tomake authorized API calls, authorized as either the service account itself, or as G Suite or Cloud Identity usersthrough domain-wide delegation. An adversary may disable a service account in order to disrupt to disrupt their target'sbusiness operations.", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.DisableServiceAccount AND event.outcome:success"}
{"input": "", "instruction": "Identifies an Identity and Access Management (IAM) custom role creation in Google Cloud Platform (GCP). Custom roles areuser-defined, and allow for the bundling of one or more supported permissions to meet specific needs. Custom roles willnot be updated automatically and could lead to privilege creep if not carefully scrutinized.", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.CreateRole AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of an Identity and Access Management (IAM) service account key in Google Cloud Platform (GCP).Each service account is associated with two sets of public/private RSA key pairs that are used to authenticate. If a keyis deleted, the application will no longer be able to access Google Cloud resources using that key. A security bestpractice is to rotate your service account keys regularly.", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.DeleteServiceAccountKey AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a new key is created for a service account in Google Cloud Platform (GCP). A service account is aspecial type of account used by an application or a virtual machine (VM) instance, not a person. Applications useservice accounts to make authorized API calls, authorized as either the service account itself, or as G Suite or CloudIdentity users through domain-wide delegation. If private keys are not tracked and managed properly, they can present asecurity risk. An adversary may create a new key for a service account in order to attempt to abuse the permissionsassigned to that account and evade detection.", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.CreateServiceAccountKey AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a new service account is created in Google Cloud Platform (GCP). A service account is a special type ofaccount used by an application or a virtual machine (VM) instance, not a person. Applications use service accounts tomake authorized API calls, authorized as either the service account itself, or as G Suite or Cloud Identity usersthrough domain-wide delegation. If service accounts are not tracked and managed properly, they can present a securityrisk. An adversary may create a new service account to use during their operations in order to avoid using a standarduser account and attempt to evade detection.", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.CreateServiceAccount AND event.outcome:success"}
{"input": "", "instruction": "Drive and Docs is a Google Workspace service that allows users to leverage Google Drive and Google Docs. Access to filesis based on inherited permissions from the child organizational unit the user belongs to which is scoped byadministrators. Typically if a user is removed, their files can be transferred to another user by the administrator.This service can also be abused by adversaries to transfer files to an adversary account for potential exfiltration.", "output": "event.dataset:\"google_workspace.admin\" AND action:\"CREATE_DATA_TRANSFER_REQUEST\" AND event.category:\"iam\" AND google_workspace.admin.application.name:Drive*"}
{"input": "", "instruction": "Detects when a custom Gmail route is added or modified in Google Workspace. Adversaries can add a custom e-mail routefor outbound mail to route these e-mails to their own inbox of choice for data gathering. This allows adversaries tocapture sensitive information from e-mail and potential attachments, such as invoices or payment documents. By default,all email from current Google Workspace users with accounts are routed through a domain's mail server for inbound andoutbound mail.", "output": "event.dataset:\"google_workspace.admin\" AND action:(\"CREATE_GMAIL_SETTING\" OR \"CHANGE_GMAIL_SETTING\") AND google_workspace.event_type:\"EMAIL_SETTINGS\" AND google_workspace.admin.setting.name:(\"EMAIL_ROUTE\" OR \"MESSAGE_SECURITY_RULE\")"}
{"input": "", "instruction": "Google Workspace administrators may be aware of malicious applications within the Google marketplace and block theseapplications for user security purposes. An adversary, with administrative privileges, may remove this application fromthe explicit block list to allow distribution of the application amongst users. This may also indicate the unauthorizeduse of an application that had been previously blocked before by a user with admin privileges.", "output": "event.dataset:\"google_workspace.admin\" AND event.category:\"iam\" AND event_type:\"change\" AND action:\"CHANGE_APPLICATION_SETTING\" AND google_workspace.admin.application.name:\"Google Workspace Marketplace\" AND google_workspace.admin.old_value: *allowed*false* AND google_workspace.admin.new_value: *allowed*true*"}
{"input": "", "instruction": "Detects when a domain is added to the list of trusted Google Workspace domains. An adversary may add a trusted domain inorder to collect and exfiltrate data from their target’s organization with less restrictive security controls.", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:ADD_TRUSTED_DOMAINS"}
{"input": "", "instruction": "Google Workspace administrators whom manage Windows devices and have Windows device management enabled may also enableBitLocker drive encryption to mitigate unauthorized data access on lost or stolen computers. Adversaries with validaccount access may disable BitLocker to access sensitive data on an endpoint added to Google Workspace devicemanagement.", "output": "event.dataset:\"google_workspace.admin\" AND action:\"CHANGE_APPLICATION_SETTING\" AND event.category:(iam OR configuration) AND google_workspace.admin.new_value:\"Disabled\" AND google_workspace.admin.setting.name:BitLocker*"}
{"input": "", "instruction": "Detects the first time a third-party application logs in and authenticated with OAuth. OAuth is used to grant permissions to specific resources and services in Google Workspace. Compromised credentials or service accounts could allow an adversary to authenticate to Google Workspace as a valid user and inherit their privileges.", "output": "event.dataset: \"google_workspace.token\" AND action: \"authorize\" ANDgoogle_workspace.token.scope.data.scope_name: *Login AND google_workspace.token.client.id: *apps.googleusercontent.com"}
{"input": "", "instruction": "Detects when the Google Marketplace restrictions are changed to allow any application for users in Google Workspace.Malicious APKs created by adversaries may be uploaded to the Google marketplace but not installed on devices managedwithin Google Workspace. Administrators should set restrictions to not allow any application from the marketplace forsecurity reasons. Adversaries may enable any app to be installed and executed on mobile devices within a GoogleWorkspace environment prior to distributing the malicious APK to the end user.", "output": "event.dataset:\"google_workspace.admin\" AND action:\"CHANGE_APPLICATION_SETTING\" AND event.category:(iam OR configuration) AND google_workspace.event_type:\"APPLICATION_SETTINGS\" AND google_workspace.admin.application.name:\"Google Workspace Marketplace\" AND google_workspace.admin.setting.name:\"Apps Access Setting Allowlist access\" AND google_workspace.admin.new_value:\"ALLOW_ALL\""}
{"input": "", "instruction": "Identifies the occurrence of a security alert from the Google Workspace alerts center. Google Workspace's security alertcenter provides an overview of actionable alerts that may be affecting an organization's domain. An alert is a warningof a potential security issue that Google has detected.", "output": "event.dataset: google_workspace.alert"}
{"input": "", "instruction": "Detects when a custom admin role is deleted. An adversary may delete a custom admin role in order to impact thepermissions or capabilities of system administrators.", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:DELETE_ROLE"}
{"input": "", "instruction": "Detects when multi-factor authentication (MFA) enforcement is disabled for Google Workspace users. An adversary maydisable MFA enforcement in order to weaken an organization’s security controls.", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:ENForCE_STRONG_AUTHENTICATION AND google_workspace.admin.new_value:false"}
{"input": "", "instruction": "Detects when a previously suspended user's account is renewed in Google Workspace. An adversary may renew a suspendeduser account to maintain access to the Google Workspace organization with a valid account.", "output": "event.dataset:google_workspace.admin AND event.category:iam AND action:UNSUSPEND_USER"}
{"input": "", "instruction": "Detects when a Google marketplace application is added to the Google Workspace domain. An adversary may add a maliciousapplication to an organization’s Google Workspace domain in order to maintain a presence in their target’s organizationand steal data.", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:ADD_APPLICATION"}
{"input": "", "instruction": "Google Workspace admins may setup 2-step verification (2SV) to add an extra layer of security to user accounts by askingusers to verify their identity when they use login credentials. Admins have the ability to enforce 2SV from the adminconsole as well as the methods acceptable for verification and enrollment period. 2SV requires enablement on adminaccounts prior to it being enabled for users within organization units. Adversaries may disable 2SV to lower thesecurity requirements to access a valid account.", "output": "event.dataset:\"google_workspace.login\" AND action:\"2sv_disable\""}
{"input": "", "instruction": "Assigning the administrative role to a user will grant them access to the Google Admin console and grant themadministrator privileges which allow them to access and manage various resources and applications. An adversary maycreate a new administrator account for persistence or apply the admin role to an existing user to carry out furtherintrusion efforts. Users with super-admin privileges can bypass single-sign on if enabled in Google Workspace.", "output": "event.dataset:\"google_workspace.admin\" AND event.category:\"iam\" AND action:\"ASSIGN_ROLE\" AND google_workspace.event_type:\"DELEGATED_ADMIN_SETTINGS\" AND google_workspace.admin.role.name : *_ADMIN_ROLE"}
{"input": "", "instruction": "Detects when a domain-wide delegation of authority is granted to a service account. Domain-wide delegation can beconfigured to grant third-party and internal applications to access the data of Google Workspace users. An adversary mayconfigure domain-wide delegation to maintain access to their target’s data.", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:AUTHORIZE_API_CLIENT_ACCESS"}
{"input": "", "instruction": "Detects when a custom admin role is created in Google Workspace. An adversary may create a custom admin role in order toelevate the permissions of other user accounts and persist in their target’s environment.", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:CREATE_ROLE"}
{"input": "", "instruction": "Detects when a Google Workspace password policy is modified. An adversary may attempt to modify a password policy inorder to weaken an organization’s security controls.", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:(CHANGE_APPLICATION_SETTING OR CREATE_APPLICATION_SETTING) AND google_workspace.admin.setting.name:( \"Password Management - Enforce strong password\" OR \"Password Management - Password reset frequency\" OR \"Password Management - Enable password reuse\" OR \"Password Management - Enforce password policy at next login\" OR \"Password Management - Minimum password length\" OR \"Password Management - Maximum password length\" )"}
{"input": "", "instruction": "Detects when a custom admin role or its permissions are modified. An adversary may modify a custom admin role in orderto elevate the permissions of other user accounts and persist in their target’s environment.", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:(ADD_PRIVILEGE OR UPDATE_ROLE)"}
{"input": "", "instruction": "Users in Google Workspace are typically assigned a specific organizational unit that grants them permissions to certainservices and roles that are inherited from this organizational unit. Adversaries may compromise a valid account andchange which organizational account the user belongs to which then could allow them to inherit permissions toapplications and resources inaccessible prior to.", "output": "event.dataset:\"google_workspace.admin\" AND event_type:change AND event.category:iam AND google_workspace.event_type:\"USER_SETTINGS\" AND action:\"MOVE_USER_TO_ORG_UNIT\""}
{"input": "", "instruction": "Detects when multi-factor authentication (MFA) is disabled for a Google Workspace organization. An adversary may attemptto modify a password policy in order to weaken an organization’s security controls.", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:(ENForCE_STRONG_AUTHENTICATION OR ALLOW_STRONG_AUTHENTICATION) AND google_workspace.admin.new_value:false"}
{"input": "", "instruction": "This rule detects when a service account makes an unauthorized request for resources from the API server. Serviceaccounts follow a very predictable pattern of behavior. A service account should never send an unauthorized request tothe API server. This behavior is likely an indicator of compromise or of a problem within the cluster. An adversary mayhave gained access to credentials/tokens and this could be an attempt to access or create resources to facilitatefurther movement or execution within the cluster.", "output": "event.dataset: \"kubernetes.audit_logs\" AND kubernetes.audit.user.username: system\\:serviceaccount\\:* AND kubernetes.audit.annotations.authorization_k8s_io/decision: \"forbid\""}
{"input": "", "instruction": "This rule detects when a service account or node attempts to enumerate their own permissions via theselfsubjectaccessreview or selfsubjectrulesreview APIs. This is highly unusual behavior for non-human identities likeservice accounts and nodes. An adversary may have gained access to credentials/tokens and this could be an attempt todetermine what privileges they have to facilitate further movement or execution within the cluster.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.verb:\"create\" AND kubernetes.audit.objectRef.resource:(\"selfsubjectaccessreviews\" OR \"selfsubjectrulesreviews\") AND (kubernetes.audit.user.username:(system\\:serviceaccount\\:* OR system\\:node\\:*) OR kubernetes.audit.impersonatedUser.username:(system\\:serviceaccount\\:* OR system\\:node\\:*))"}
{"input": "", "instruction": "This rule detects a user attempt to establish a shell session into a pod using the 'exec' command. Using the 'exec'command in a pod allows a user to establish a temporary shell session and execute any process/commands in the pod. Anadversary may call bash to gain a persistent interactive shell which will allow access to any data the pod haspermissions to, including secrets.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.verb:\"create\" AND kubernetes.audit.objectRef.resource:\"pods\" AND kubernetes.audit.objectRef.subresource:\"exec\""}
{"input": "", "instruction": "This rule detects when an unauthenticated user request is authorized within the cluster. Attackers may attempt to useanonymous accounts to gain initial access to the cluster or to avoid attribution of their activities within the cluster.This rule excludes the /healthz, /livez and /readyz endpoints which are commonly accessed anonymously.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND (kubernetes.audit.user.username:(\"system:anonymous\" OR \"system:unauthenticated\") OR not kubernetes.audit.user.username:*) AND NOT kubernetes.audit.objectRef.resource:(\"healthz\" OR \"livez\" OR \"readyz\")"}
{"input": "", "instruction": "This rule detects an attempt to create or modify a service as type NodePort. The NodePort service allows a user toexternally expose a set of labeled pods to the internet. This creates an open port on every worker node in the clusterthat has a pod for that service. When external traffic is received on that open port, it directs it to the specific podthrough the service representing it. A malicious user can configure a service as type Nodeport in order to intercepttraffic from other pods or nodes, bypassing firewalls and other network security measures configured for load balancerswithin a cluster. This creates a direct method of communication between the cluster and the outside world, which couldbe used for more malicious behavior and certainly widens the attack surface of your cluster.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.objectRef.resource:\"services\" AND kubernetes.audit.verb:(\"create\" OR \"update\" OR \"patch\") AND kubernetes.audit.requestObject.spec.type:\"NodePort\""}
{"input": "", "instruction": "This rule detects a container deployed with one or more dangerously permissive Linux capabilities. An attacker with theability to deploy a container with added capabilities could use this for further execution, lateral movement, orprivilege escalation within a cluster. The capabilities detected in this rule have been used in container escapes to thehost machine.", "output": "event.dataset: kubernetes.audit_logs AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.verb: create AND kubernetes.audit.objectRef.resource: pods AND kubernetes.audit.requestObject.spec.containers.securityContext.capabilities.add: (\"BPF\" OR \"DAC_READ_SEARCH\" OR \"NET_ADMIN\" OR \"SYS_ADMIN\" OR \"SYS_BOOT\" OR \"SYS_MODULE\" OR \"SYS_PTRACE\" OR \"SYS_RAWIO\" OR \"SYSLOG\") AND NOT kubernetes.audit.requestObject.spec.containers.image : (\"docker.elastic.co/beats/elastic-agent:8.4.0\" OR \"rancher/klipper-lb:v0.3.5\" OR \"\")"}
{"input": "", "instruction": "This rule detects an attempt to create or modify a pod using the host IPC namespace. This gives access to data used byany pod that also use the hosts IPC namespace. If any process on the host or any processes in a pod uses the hostsinter-process communication mechanisms (shared memory, semaphore arrays, message queues, etc.), an attacker canread/write to those same mechanisms. They may look for files in /dev/shm or use ipcs to check for any IPC facilitiesbeing used.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.objectRef.resource:\"pods\" AND kubernetes.audit.verb:(\"create\" OR \"update\" OR \"patch\") AND kubernetes.audit.requestObject.spec.hostIPC:true AND NOT kubernetes.audit.requestObject.spec.containers.image: (\"docker.elastic.co/beats/elastic-agent:8.4.0\")"}
{"input": "", "instruction": "This rules detects an attempt to create or modify a pod attached to the host network. HostNetwork allows a pod to usethe node network namespace. Doing so gives the pod access to any service running on localhost of the host. An attackercould use this access to snoop on network activity of other pods on the same node or bypass restrictive network policiesapplied to its given namespace.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.objectRef.resource:\"pods\" AND kubernetes.audit.verb:(\"create\" OR \"update\" OR \"patch\") AND kubernetes.audit.requestObject.spec.hostNetwork:true AND NOT kubernetes.audit.requestObject.spec.containers.image: (\"docker.elastic.co/beats/elastic-agent:8.4.0\")"}
{"input": "", "instruction": "This rule detects an attempt to create or modify a pod attached to the host PID namespace. HostPID allows a pod toaccess all the processes running on the host and could allow an attacker to take malicious action. When paired withptrace this can be used to escalate privileges outside of the container. When paired with a privileged container, thepod can see all of the processes on the host. An attacker can enter the init system (PID 1) on the host. From there,they could execute a shell and continue to escalate privileges to root.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.objectRef.resource:\"pods\" AND kubernetes.audit.verb:(\"create\" OR \"update\" OR \"patch\") AND kubernetes.audit.requestObject.spec.hostPID:true AND NOT kubernetes.audit.requestObject.spec.containers.image: (\"docker.elastic.co/beats/elastic-agent:8.4.0\")"}
{"input": "", "instruction": "This rule detects when a pod is created with a sensitive volume of type hostPath. A hostPath volume type mounts asensitive file or folder from the node to the container. If the container gets compromised, the attacker can use thismount for gaining access to the node. There are many ways a container with unrestricted access to the host filesystemcan escalate privileges, including reading data from other containers, and accessing tokens of more privileged pods.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.objectRef.resource:\"pods\" AND kubernetes.audit.verb:(\"create\" OR \"update\" OR \"patch\") AND kubernetes.audit.requestObject.spec.volumes.hostPath.path: (\"/\" OR \"/proc\" OR \"/root\" OR \"/var\" OR \"/var/run\" OR \"/var/run/docker.sock\" OR \"/var/run/crio/crio.sock\" OR \"/var/run/cri-dockerd.sock\" OR \"/var/lib/kubelet\" OR \"/var/lib/kubelet/pki\" OR \"/var/lib/docker/overlay2\" OR \"/etc\" OR \"/etc/kubernetes\" OR \"/etc/kubernetes/manifests\" OR \"/etc/kubernetes/pki\" OR \"/home/admin\") AND NOT kubernetes.audit.requestObject.spec.containers.image: (\"docker.elastic.co/beats/elastic-agent:8.4.0\")"}
{"input": "", "instruction": "This rule detects when a user creates a pod/container running in privileged mode. A highly privileged container hasaccess to the node's resources and breaks the isolation between containers. If compromised, an attacker can use theprivileged container to gain access to the underlying host. Gaining access to the host may provide the adversary withthe opportunity to achieve follow-on objectives, such as establishing persistence, moving laterally within theenvironment, or setting up a command and control channel on the host.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.objectRef.resource:pods AND kubernetes.audit.verb:create AND kubernetes.audit.requestObject.spec.containers.securityContext.privileged:true AND NOT kubernetes.audit.requestObject.spec.containers.image: (\"docker.elastic.co/beats/elastic-agent:8.4.0\")"}
{"input": "", "instruction": "This rule detects a request to attach a controller service account to an existing or new pod running in the kube-systemnamespace. By default, controllers running as part of the API Server utilize admin-equivalent service accounts hosted inthe kube-system namespace. Controller service accounts aren't normally assigned to running pods and could indicateadversary behavior within the cluster. An attacker that can create or modify pods or pod controllers in the kube-systemnamespace, can assign one of these admin-equivalent service accounts to a pod and abuse their powerful token to escalateprivileges and gain complete cluster control.", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.verb : \"create\" AND kubernetes.audit.objectRef.resource : \"pods\" AND kubernetes.audit.objectRef.namespace : \"kube-system\" AND kubernetes.audit.requestObject.spec.serviceAccountName:*controller"}
{"input": "", "instruction": "Identifies when a new Inbox forwarding rule is created in Microsoft 365. Inbox rules process messages in the Inbox basedon conditions and take actions. In this case, the rules will forward the emails to a defined address. Attackers canabuse Inbox Rules to intercept and exfiltrate email data without making organization-wide configuration changes orhaving the corresponding privileges.", "output": "event.dataset:o365.audit AND event.provider:Exchange ANDevent.category:web AND action:(\"New-InboxRule\" OR \"Set-InboxRule\") AND ( o365.audit.Parameters.ForwardTo:* OR o365.audit.Parameters.ForwardAsAttachmentTo:* OR o365.audit.Parameters.RedirectTo:* ) AND event.outcome:success"}
{"input": "", "instruction": "Identifies attempts to brute force a Microsoft 365 user account. An adversary may attempt a brute force attack to obtainunauthorized access to user accounts.", "output": "event.dataset:o365.audit AND event.provider:(AzureActiveDirectory OR Exchange) AND event.category:authentication AND action:(UserLoginFailed OR PasswordLogonInitialAuthUsingPassword) AND NOT o365.audit.LogonError:(UserAccountNotFound OR EntitlementGrantsNotFound OR UserStrongAuthEnrollmentRequired OR UserStrongAuthClientAuthNRequired OR InvalidReplyTo)"}
{"input": "", "instruction": "Identifies a high number (25) of failed Microsoft 365 user authentication attempts from a single IP address within 30minutes, which could be indicative of a password spraying attack. An adversary may attempt a password spraying attack toobtain unauthorized access to user accounts.", "output": "event.dataset:o365.audit AND event.provider:(Exchange OR AzureActiveDirectory) AND event.category:authentication ANDaction:(\"UserLoginFailed\" OR \"PasswordLogonInitialAuthUsingPassword\")"}
{"input": "", "instruction": "Identifies accounts with a high number of single sign-on (SSO) logon errors. Excessive logon errors may indicate anattempt to brute force a password or SSO token.", "output": "event.dataset:o365.audit AND event.provider:AzureActiveDirectory AND event.category:authentication AND o365.audit.LogonError:\"SsoArtifactInvalidOrExpired\""}
{"input": "", "instruction": "Identifies when a Data Loss Prevention (DLP) policy is removed in Microsoft 365. An adversary may remove a DLP policy toevade existing DLP monitoring.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"Remove-DlpPolicy\" AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a malware filter policy has been deleted in Microsoft 365. A malware filter policy is used to alertadministrators that an internal user sent a message that contained malware. This may indicate an account or machinecompromise that would need to be investigated. Deletion of a malware filter policy may be done to evade detection.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"Remove-MalwareFilterPolicy\" AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a malware filter rule has been deleted or disabled in Microsoft 365. An adversary or insider threat maywant to modify a malware filter rule to evade detection.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:(\"Remove-MalwareFilterRule\" OR \"Disable-MalwareFilterRule\") AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a safe attachment rule is disabled in Microsoft 365. Safe attachment rules can extend malwareprotections to include routing all messages and attachments without a known malware signature to a special hypervisorenvironment. An adversary or insider threat may disable a safe attachment rule to exfiltrate data or evade defenses.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"Disable-SafeAttachmentRule\" AND event.outcome:success"}
{"input": "", "instruction": "Detects the occurrence of mailbox audit bypass associations. The mailbox audit is responsible for logging specifiedmailbox events (like accessing a folder or a message or permanently deleting a message). However, actions taken by someauthorized accounts, such as accounts used by third-party tools or accounts used for lawful monitoring, can create alarge number of mailbox audit log entries and may not be of interest to your organization. Because of this,administrators can create bypass associations, allowing certain accounts to perform their tasks without being logged.Attackers can abuse this allowlist mechanism to conceal actions taken, as the mailbox audit will log no activity done bythe account.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND action:Set-MailboxAuditBypassAssociation AND event.outcome:success"}
{"input": "", "instruction": "Identifies a transport rule creation in Microsoft 365. As a best practice, Exchange Online mail transport rules shouldnot be set to forward email to domains outside of your organization. An adversary may create transport rules toexfiltrate data.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"New-TransportRule\" AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a transport rule has been disabled or deleted in Microsoft 365. Mail flow rules (also known as transportrules) are used to identify and take action on messages that flow through your organization. An adversary or insiderthreat may modify a transport rule to exfiltrate data or evade defenses.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:(\"Remove-TransportRule\" OR \"Disable-TransportRule\") AND event.outcome:success"}
{"input": "", "instruction": "Identifies when Microsoft Cloud App Security reports that a user has uploaded files to the cloud that might be infectedwith ransomware.", "output": "event.dataset:o365.audit AND event.provider:SecurityComplianceCenter AND event.category:web AND action:\"Potential ransomware activity\" AND event.outcome:success"}
{"input": "", "instruction": "Identifies the deletion of an anti-phishing policy in Microsoft 365. By default, Microsoft 365 includes built-infeatures that help protect users from phishing attacks. Anti-phishing polices increase this protection by refiningsettings to better detect and prevent attacks.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"Remove-AntiPhishPolicy\" AND event.outcome:success"}
{"input": "", "instruction": "Identifies the modification of an anti-phishing rule in Microsoft 365. By default, Microsoft 365 includes built-infeatures that help protect users from phishing attacks. Anti-phishing rules increase this protection by refiningsettings to better detect and prevent attacks.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:(\"Remove-AntiPhishRule\" OR \"Disable-AntiPhishRule\") AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a Safe Link policy is disabled in Microsoft 365. Safe Link policies for Office applications extendphishing protection to documents that contain hyperlinks, even after they have been delivered to a user.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"Disable-SafeLinksRule\" AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a Microsoft Cloud App Security reported a risky sign-in attempt due to a login associated with animpossible travel.", "output": "event.dataset:o365.audit AND event.provider:SecurityComplianceCenter AND event.category:web AND action:\"Impossible travel activity\" AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a user has been restricted from sending email due to exceeding sending limits of the service policiesper the Security Compliance Center.", "output": "event.dataset:o365.audit AND event.provider:SecurityComplianceCenter AND event.category:web AND action:\"User restricted from sending email\" AND event.outcome:success"}
{"input": "", "instruction": "Detects the occurrence of emails reported as Phishing or Malware by Users. Security Awareness training is essential tostay ahead of scammers and threat actors, as security products can be bypassed, and the user can still receive amalicious message. Educating users to report suspicious messages can help identify gaps in security controls and preventmalware infections and Business Email Compromise attacks.", "output": "event.dataset:o365.audit AND event.provider:SecurityComplianceCenter AND action:AlertTriggered AND rule.name:\"Email reported by user as malware OR phish\""}
{"input": "", "instruction": "Identifies the occurence of files uploaded to OneDrive being detected as Malware by the file scanning engine. Attackerscan use File Sharing and Organization Repositories to spread laterally within the company and amplify their access.Users can inadvertently share these files without knowing their maliciousness, giving adversaries opportunity to gaininitial access to other endpoints in the environment.", "output": "event.dataset:o365.audit AND event.provider:OneDrive AND event_id:SharePointFileOperation AND action:FileMalwareDetected"}
{"input": "", "instruction": "Identifies the occurence of files uploaded to SharePoint being detected as Malware by the file scanning engine.Attackers can use File Sharing and Organization Repositories to spread laterally within the company and amplify theiraccess. Users can inadvertently share these files without knowing their maliciousness, giving adversaries opportunitiesto gain initial access to other endpoints in the environment.", "output": "event.dataset:o365.audit AND event.provider:SharePoint AND event_id:SharePointFileOperation AND action:FileMalwareDetected"}
{"input": "", "instruction": "Identifies the assignment of rights to access content from another mailbox. An adversary may use the compromised accountto send messages to other accounts in the network of the target organization while creating inbox rules, so messages canevade spam/phishing detection mechanisms.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND action:Add-MailboxPermission ANDo365.audit.Parameters.AccessRights:(FullAccess OR SendAs OR SendOnBehalf) AND event.outcome:success ANDnot uid : \"NT AUTHORITY\\SYSTEM (Microsoft.Exchange.Servicehost)\""}
{"input": "", "instruction": "Identifies when a DomainKeys Identified Mail (DKIM) signing configuration is disabled in Microsoft 365. With DKIM inMicrosoft 365, messages that are sent from Exchange Online will be cryptographically signed. This will allow thereceiving email system to validate that the messages were generated by a server that the organization authorized andwere not spoofed.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"Set-DkimSigningConfig\" AND o365.audit.Parameters.Enabled:False AND event.outcome:success"}
{"input": "", "instruction": "Identifies when a new role is assigned to a management group in Microsoft 365. An adversary may attempt to add a role inorder to maintain persistence in an environment.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"New-ManagementRoleAssignment\" AND event.outcome:success"}
{"input": "", "instruction": "In Azure Active Directory (Azure AD), permissions to manage resources are assigned using roles. The Global Administratoris a role that enables users to have access to all administrative features in Azure AD and services that use Azure ADidentities like the Microsoft 365 Defender portal, the Microsoft 365 compliance center, Exchange, SharePoint Online, andSkype for Business Online. Attackers can add users as Global Administrators to maintain access and manage allsubscriptions and their settings and resources.", "output": "event.dataset:o365.audit AND event_id:\"AzureActiveDirectory\" AND action:\"Add member to role.\" ANDo365.audit.ModifiedProperties.Role_DisplayName.NewValue:\"Global Administrator\""}
{"input": "", "instruction": "Identifies when custom applications are allowed in Microsoft Teams. If an organization requires applications other thanthose available in the Teams app store, custom applications can be developed as packages and uploaded. An adversary mayabuse this behavior to establish persistence in an environment.", "output": "event.dataset:o365.audit AND event.provider:MicrosoftTeams ANDevent.category:web AND action:TeamsTenantSettingChanged ANDo365.audit.Name:\"Allow sideloading AND interaction of custom apps\" ANDo365.audit.NewValue:True AND event.outcome:success"}
{"input": "", "instruction": "Identifies when external access is enabled in Microsoft Teams. External access lets Teams and Skype for Business userscommunicate with other users that are outside their organization. An adversary may enable external access or add anallowed domain to exfiltrate data or maintain persistence in an environment.", "output": "event.dataset:o365.audit AND event.provider:(SkypeForBusiness OR MicrosoftTeams) ANDevent.category:web AND action:\"Set-CsTenantFederationConfiguration\" ANDo365.audit.Parameters.AllowFederatedUsers:True AND event.outcome:success"}
{"input": "", "instruction": "Identifies when guest access is enabled in Microsoft Teams. Guest access in Teams allows people outside the organizationto access teams and channels. An adversary may enable guest access to maintain persistence in an environment.", "output": "event.dataset:o365.audit AND event.provider:(SkypeForBusiness OR MicrosoftTeams) ANDevent.category:web AND action:\"Set-CsTeamsClientConfiguration\" ANDo365.audit.Parameters.AllowGuestUser:True AND event.outcome:success"}
{"input": "", "instruction": "Identifies a new or modified federation domain, which can be used to create a trust between O365 and an externalidentity provider.", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:(\"Set-AcceptedDomain\" OR\"Set-MsolDomainFederationSettings\" OR \"Add-FederatedDomain\" OR \"New-AcceptedDomain\" OR \"Remove-AcceptedDomain\" OR \"Remove-FederatedDomain\") ANDevent.outcome:success"}
{"input": "", "instruction": "Detects attempts to bypass Okta multi-factor authentication (MFA). An adversary may attempt to bypass the Okta MFApolicies configured for an organization in order to obtain unauthorized access to an application.", "output": "event.dataset:okta.system AND action:user.mfa.attempt_bypass"}
{"input": "", "instruction": "Identifies when an Okta user account is locked out 3 times within a 3 hour window. An adversary may attempt a bruteforce or password spraying attack to obtain unauthorized access to user accounts. The default Okta authentication policyensures that a user account is locked out after \"10 failed authentication attempts.", "output": "event.dataset:okta.system AND action:user.account.lock"}
{"input": "", "instruction": "Identifies a high number of failed Okta user authentication attempts from a single IP address, which could be indicativeof a brute force or password spraying attack. An adversary may attempt a brute force or password spraying attack toobtain unauthorized access to user accounts.", "output": "event.dataset:okta.system AND event.category:authentication AND event.outcome:failure"}
{"input": "", "instruction": "A user has initiated a session impersonation granting them access to the environment with the permissions of the userthey are impersonating. This would likely indicate Okta administrative access and should only ever occur if requestedand expected.", "output": "event.dataset:okta.system AND action:user.session.impersonation.initiate"}
{"input": "", "instruction": "Detects attempts to deactivate an Okta network zone. Okta network zones can be configured to limit or restrict access toa network based on IP addresses or geolocations. An adversary may attempt to modify, delete, or deactivate an Oktanetwork zone in order to remove or weaken an organization's security controls.", "output": "event.dataset:okta.system AND action:zone.deactivate"}
{"input": "", "instruction": "Detects attempts to delete an Okta network zone. Okta network zones can be configured to limit or restrict access to anetwork based on IP addresses or geolocations. An adversary may attempt to modify, delete, or deactivate an Okta networkzone in order to remove or weaken an organization's security controls.", "output": "event.dataset:okta.system AND action:zone.delete"}
{"input": "", "instruction": "Detects attempts to deactivate an Okta policy. An adversary may attempt to deactivate an Okta policy in order to weakenan organization's security controls. For example, an adversary may attempt to deactivate an Okta multi-factorauthentication (MFA) policy in order to weaken the authentication requirements for user accounts.", "output": "event.dataset:okta.system AND action:policy.lifecycle.deactivate"}
{"input": "", "instruction": "Detects attempts to deactivate a rule within an Okta policy. An adversary may attempt to deactivate a rule within anOkta policy in order to remove or weaken an organization's security controls.", "output": "event.dataset:okta.system AND action:policy.rule.deactivate"}
{"input": "", "instruction": "Detects attempts to delete an Okta policy. An adversary may attempt to delete an Okta policy in order to weaken anorganization's security controls. For example, an adversary may attempt to delete an Okta multi-factor authentication(MFA) policy in order to weaken the authentication requirements for user accounts.", "output": "event.dataset:okta.system AND action:policy.lifecycle.delete"}
{"input": "", "instruction": "Detects attempts to delete a rule within an Okta policy. An adversary may attempt to delete an Okta policy rule in orderto weaken an organization's security controls.", "output": "event.dataset:okta.system AND action:policy.rule.delete"}
{"input": "", "instruction": "Detects attempts to modify an Okta network zone. Okta network zones can be configured to limit or restrict access to anetwork based on IP addresses or geolocations. An adversary may attempt to modify, delete, or deactivate an Okta networkzone in order to remove or weaken an organization's security controls.", "output": "event.dataset:okta.system AND action:(zone.update OR network_zone.rule.disabled OR zone.remove_blacklist)"}
{"input": "", "instruction": "Detects attempts to modify an Okta policy. An adversary may attempt to modify an Okta policy in order to weaken anorganization's security controls. For example, an adversary may attempt to modify an Okta multi-factor authentication(MFA) policy in order to weaken the authentication requirements for user accounts.", "output": "event.dataset:okta.system AND action:policy.lifecycle.update"}
{"input": "", "instruction": "Detects attempts to modify a rule within an Okta policy. An adversary may attempt to modify an Okta policy rule in orderto weaken an organization's security controls.", "output": "event.dataset:okta.system AND action:policy.rule.update"}
{"input": "", "instruction": "Identifies a high number of Okta user password reset or account unlock attempts. An adversary may attempt to obtainunauthorized access to Okta user accounts using these methods and attempt to blend in with normal activity in theirtarget's environment and evade detection.", "output": "event.dataset:okta.system AND action:(system.email.account_unlock.sent_message OR system.email.password_reset.sent_message OR system.sms.send_account_unlock_message OR system.sms.send_password_reset_message OR system.voice.send_account_unlock_call OR system.voice.send_password_reset_call OR user.account.unlock_token)"}
{"input": "", "instruction": "Identifies attempts to revoke an Okta API token. An adversary may attempt to revoke or delete an Okta API token todisrupt an organization's business operations.", "output": "event.dataset:okta.system AND action:system.api_token.revoke"}
{"input": "", "instruction": "Detects attempts to deactivate an Okta application. An adversary may attempt to modify, deactivate, or delete an Oktaapplication in order to weaken an organization's security controls or disrupt their business operations.", "output": "event.dataset:okta.system AND action:application.lifecycle.deactivate"}
{"input": "", "instruction": "Detects attempts to delete an Okta application. An adversary may attempt to modify, deactivate, or delete an Oktaapplication in order to weaken an organization's security controls or disrupt their business operations.", "output": "event.dataset:okta.system AND action:application.lifecycle.delete"}
{"input": "", "instruction": "Detects attempts to modify an Okta application. An adversary may attempt to modify, deactivate, or delete an Oktaapplication in order to weaken an organization's security controls or disrupt their business operations.", "output": "event.dataset:okta.system AND action:application.lifecycle.update"}
{"input": "", "instruction": "Detects possible Denial of Service (DoS) attacks against an Okta organization. An adversary may attempt to disrupt anorganization's business operations by performing a DoS attack against its Okta service.", "output": "event.dataset:okta.system AND action:(application.integration.rate_limit_exceeded OR system.org.rate_limit.warning OR system.org.rate_limit.violation OR core.concurrency.org.limit.violation)"}
{"input": "", "instruction": "Detects when a user reports suspicious activity for their Okta account. These events should be investigated, as they canhelp security teams identify when an adversary is attempting to gain access to their network.", "output": "event.dataset:okta.system AND action:user.account.report_suspicious_activity_by_enduser"}
{"input": "", "instruction": "Detects when Okta ThreatInsight identifies a request from a malicious IP address. Investigating requests from IPaddresses identified as malicious by Okta ThreatInsight can help security teams monitor for and respond to credentialbased attacks against their organization, such as brute force and password spraying attacks.", "output": "event.dataset:okta.system AND action:security.threat.detected"}
{"input": "", "instruction": "Detects when an administrator role is assigned to an Okta group. An adversary may attempt to assign administratorprivileges to an Okta group in order to assign additional permissions to compromised user accounts and maintain accessto their target organization.", "output": "event.dataset:okta.system AND action:group.privilege.grant"}
{"input": "", "instruction": "Identifies when an administrator role is assigned to an Okta user. An adversary may attempt to assign an administratorrole to an Okta user in order to assign additional permissions to a user account and maintain access to their target'senvironment.", "output": "event.dataset:okta.system AND action:user.account.privilege.grant"}
{"input": "", "instruction": "Detects attempts to create an Okta API token. An adversary may create an Okta API token to maintain access to anorganization's network while they work to achieve their objectives. An attacker may abuse an API token to executetechniques such as creating user accounts or disabling security rules or policies.", "output": "event.dataset:okta.system AND action:system.api_token.create"}
{"input": "", "instruction": "Detects attempts to deactivate multi-factor authentication (MFA) for an Okta user. An adversary may deactivate MFA foran Okta user account in order to weaken the authentication requirements for the account.", "output": "event.dataset:okta.system AND action:user.mfa.factor.deactivate"}
{"input": "", "instruction": "Detects attempts to reset an Okta user's enrolled multi-factor authentication (MFA) factors. An adversary may attempt toreset the MFA factors for an Okta user's account in order to register new MFA factors and abuse the account to blend inwith normal activity in the victim's environment.", "output": "event.dataset:okta.system AND action:user.mfa.factor.reset_all"}
{"input": "", "instruction": "Detects attempts to modify or delete a sign on policy for an Okta application. An adversary may attempt to modify ordelete the sign on policy for an Okta application in order to remove or weaken an organization's security controls.", "output": "event.dataset:okta.system AND action:(application.policy.sign_on.update OR application.policy.sign_on.rule.delete)"}
{"input": "", "instruction": "Iodine is a tool for tunneling Internet protocol version 4 (IPV4) traffic over the DNS protocol to circumvent firewalls,network security groups, and network access lists while evading detection.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:(iodine OR iodined)"}
{"input": "", "instruction": "This rule monitors for network connectivity to the internet from a previously unknown executable located in a suspiciousdirectory to a previously unknown dst_ip. An alert from this rule can indicate the presence of potentially malicious activity, such as the execution of unauthorized or suspicious processes attempting to establish connections to unknown or suspicious destinations such as a command and control server. Detecting and investigating such behavior can help identify and mitigate potential security threats, protecting the system and its data from potential compromise.", "output": "appname : \"linux\" AND event.category : \"network\" AND action : (\"connection_attempted\" OR \"ipv4_connection_attempt_event\") AND process.executable : ( \\/tmp\\/* OR \\/var\\/tmp\\/* OR \\/dev\\/shm\\/* OR \\/etc\\/init.d\\/* OR \\/etc\\/rc*.d\\/* OR \\/etc\\/crontab OR \\/etc\\/cron.*\\/* OR \\/etc\\/update-motd.d\\/* OR \\/usr\\/lib\\/update-notifier\\/* OR \\/home\\/*\\/.* OR \\/boot\\/* OR \\/srv\\/* OR \\/run\\/* OR \\/etc\\/rc.local ) AND src_ip : ( \"127.0.0.0/8\" OR \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip : ( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.0.0.0/24\" OR \"192.0.0.0/29\" OR \"192.0.0.8/32\" OR \"192.0.0.9/32\" OR \"192.0.0.10/32\" OR \"192.0.0.170/32\" OR \"192.0.0.171/32\" OR \"192.0.2.0/24\" OR \"192.31.196.0/24\" OR \"192.52.193.0/24\" OR \"192.168.0.0/16\" OR \"192.88.99.0/24\" OR \"224.0.0.0/4\" OR \"100.64.0.0/10 OR \"192.175.48.0/24\" OR \"198.18.0.0/15\" OR \"198.51.100.0/24\" OR \"203.0.113.0/24\" OR \"240.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" ) AND NOT process.executable : ( \"/usr/bin/wget\" OR \"/usr/bin/curl\" OR \"/usr/bin/apt\" OR \"/usr/bin/dpkg\" OR \"/usr/bin/yum\" OR \"/usr/bin/rpm\" OR \"/usr/bin/dnf\" OR \"/usr/bin/dockerd\" )"}
{"input": "", "instruction": "Identifies the use of a compression utility to collect known files containing sensitive information, such as credentialsand system configurations.", "output": "event.category:process AND appname:linux AND event_type:start AND process:(zip OR tar OR gzip OR hdiutil OR 7z) AND process.args: ( \\/root\\/.ssh\\/id_rsa OR \\/root\\/.ssh\\/id_rsa.pub OR \\/root\\/.ssh\\/id_ed25519 OR \\/root\\/.ssh\\/id_ed25519.pub OR \\/root\\/.ssh\\/authorized_keys OR \\/root\\/.ssh\\/authorized_keys2 OR \\/root\\/.ssh\\/known_hosts OR \\/root\\/.bash_history OR \\/etc\\/hosts OR \\/home\\/*\\/.ssh\\/id_rsa OR \\/home\\/*\\/.ssh\\/id_rsa.pub OR \\/home\\/*\\/.ssh\\/id_ed25519 OR \\/home\\/*\\/.ssh\\/id_ed25519.pub OR \\/home\\/*\\/.ssh\\/authorized_keys OR \\/home\\/*\\/.ssh\\/authorized_keys2 OR \\/home\\/*\\/.ssh\\/known_hosts OR \\/home\\/*\\/.bash_history OR \\/root\\/.aws\\/credentials OR \\/root\\/.aws\\/config OR \\/home\\/*\\/.aws\\/credentials OR \\/home\\/*\\/.aws\\/config OR \\/root\\/.docker\\/config.json OR \\/home\\/*\\/.docker\\/config.json OR \\/etc\\/group OR \\/etc\\/passwd OR \\/etc\\/shadow OR \\/etc\\/gshadow )"}
{"input": "", "instruction": "Adversaries may attempt to disable the syslog service in an attempt to an attempt to disrupt event logging and evadedetection by security controls.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND ((process:service AND process.args:stop) OR (process:chkconfig AND process.args:off) OR (process:systemctl AND process.args:(disable OR stop OR kill))) AND process.args:(syslog OR rsyslog OR \"syslog-ng\")"}
{"input": "", "instruction": "Identifies potential attempts to disable Security-Enhanced Linux (SELinux), which is a Linux kernel security feature tosupport access control policies. Adversaries may disable security tools to avoid possible detection of their tools andactivities.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:setenforce AND process.args:0"}
{"input": "", "instruction": "Malware or other files dropped or created on a system by an adversary may leave traces behind as to what was done withina network and how. Adversaries may remove these files over the course of an intrusion to keep their footprint low orremove them at the end as part of the post-intrusion cleanup process.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:shred AND process.args:(\"-u\" OR \"--remove\" OR \"-z\" OR \"--zero\")"}
{"input": "", "instruction": "Identifies file permission modifications in common writable directories by a non-root user. Adversaries often drop filesor payloads into a writable directory and change permissions prior to execution.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:(chmod OR chown OR chattr OR chgrp) AND process.working_directory:(\"/tmp\" OR \"/var/tmp\" OR \"/dev/shm\") AND NOT user.name:root"}
{"input": "", "instruction": "Kernel modules are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend thefunctionality of the kernel without the need to reboot the system. This rule identifies attempts to remove a kernelmodule.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process.args:((rmmod AND sudo) OR (modprobe AND sudo AND (\"--remove\" OR \"-r\")))"}
{"input": "", "instruction": "Loadable Kernel Modules (or LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. Theyextend the functionality of the kernel without the need to reboot the system. This identifies attempts to enumerateinformation about a kernel module.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process.args:(kmod AND list AND sudo OR sudo AND (depmod OR lsmod OR modinfo))"}
{"input": "", "instruction": "Hping ran on a Linux host. Hping is a FOSS command-line packet analyzer and has the ability to construct network packetsfor a wide variety of network security testing applications, including scanning and firewall auditing.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:(hping OR hping2 OR hping3)"}
{"input": "", "instruction": "Nping ran on a Linux host. Nping is part of the Nmap tool suite and has the ability to construct raw packets for a widevariety of security testing applications, including denial of service testing.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:nping"}
{"input": "", "instruction": "An adversary may attempt to get detailed information about the operating system and hardware. This rule identifiescommon locations used to discover virtual machine hardware by a non-root user. This technique has been used by the PupyRAT and other malware.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process.args:(\"/sys/class/dmi/id/bios_version\" OR \"/sys/class/dmi/id/product_name\" OR \"/sys/class/dmi/id/chassis_vendor\" OR \"/proc/scsi/scsi\" OR \"/proc/ide/hd0/model\") AND NOT user.name:root"}
{"input": "", "instruction": "Identifies when a terminal (tty) is spawned via Perl. Attackers may upgrade a simple reverse shell to a fullyinteractive tty after obtaining initial access to a host.", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:perl AND process.args:(\"exec \"/bin/sh\";\" OR \"exec \"/bin/dash\";\" OR \"exec \"/bin/bash\";\")"}
{"input": "", "instruction": "Adversaries may modify SSH related binaries for persistence or credential access by patching sensitive functions toenable unauthorized access or by logging SSH credentials for exfiltration.", "output": "event.category:file AND appname:linux AND event_type:change AND process:* AND (file.path:(\"/usr/sbin/sshd\" OR \"/usr/bin/ssh\" OR \"/usr/bin/sftp\" OR \"/usr/bin/scp\") OR file.name:libkeyutils.so) AND NOT process:(\"dpkg\" OR \"yum\" OR \"dnf\" OR \"dnf-automatic\")"}
{"input": "", "instruction": "Linux cron jobs are scheduled tasks that can be leveraged by malicious actors for persistence, privilege escalation andcommand execution. By creating or modifying cron job configurations, attackers can execute malicious commands or scriptsat predefined intervals, ensuring their continued presence and enabling unauthorized activities.", "output": "appname : \"linux\" AND action : (\"change\" OR \"file_modify_event\" OR \"creation\" OR \"file_create_event\") AND file.path:(\\/etc\\/cron.allow OR \\/etc\\/cron.deny OR \\/etc\\/cron.d\\/* OR \\/etc\\/cron.hourly\\/* OR \\/etc\\/cron.daily\\/* OR \\/etc\\/cron.weekly\\/* OR \\/etc\\/cron.monthly\\/* OR \\/etc\\/crontab OR \\/var\\/spool\\/cron\\/* OR \\/usr\\/sbin\\/cron OR \\/usr\\/sbin\\/anacron) AND NOT (process:(\"dpkg\" OR \"dockerd\" OR \"rpm\" OR \"snapd\") OR file.extension : \"swp\")"}
{"input": "", "instruction": "Files that are placed in the /etc/init.d/ directory in Unix can be used to start custom applications,services, scripts or commands during start-up. Init.d has been mostly replaced in favor of Systemd, however, through the \"systemd-sysv-generator\" init.d files can be converted to service unit files that run at boot.Adversaries may add or alter files located in the /etc/init.d/ directory to execute malicious code on boottime in order to gain persistence onto the system. ", "output": "appname :\"linux\" AND action:(\"creation\" OR \"file_create_event\" OR \"rename\" OR \"file_rename_event\") AND file.path : /etc/init.d/* AND NOT process.executable : (\"/usr/bin/dpkg\" OR \"/usr/bin/dockerd\" OR \"/bin/rpm\") AND NOT file.extension : \"swp\""}
{"input": "", "instruction": "Message of the day (MOTD) is the message that is presented to the user when a user connects to a Linux server via SSH ora serial connection. Linux systems contain several default MOTD files located in the \"/etc/update-motd.d/\" and\"/usr/lib/update-notifier/\" directories. These scripts run as the root user every time a user connects over SSH or aserial connection. Adversaries may create malicious MOTD files that grant them persistence onto the target every time auser connects to the system by executing a backdoor script or command. This rule detects the creation of potentiallymalicious files within the default MOTD file directories.", "output": "appname :\"linux\" AND action:(\"creation\" OR \"file_create_event\" OR \"rename\" OR \"file_rename_event\") AND file.path:(\\/etc\\/update-motd.d\\/* OR \\/usr\\/lib\\/update-notifier\\/*) AND NOT process.executable : (\"/usr/bin/dpkg\" OR \"/usr/bin/dockerd\" OR \"/bin/rpm\") AND NOT file.extension : \"swp\""}
{"input": "", "instruction": "This rule monitors the creation of shared object files by previously unknown processes. The creation of a shared object file involves compiling code into a dynamically linked library that can be loaded by other programs at runtime. While this process is typically used for legitimate purposes, malicious actors can leverage shared object files to execute unauthorized code, inject malicious functionality into legitimate processes, or bypass security controls. This allows malware to persist on the system, evade detection, and potentially compromise the integrity and confidentiality of the affected system and its data.", "output": "appname : \"linux\" AND action:(\"creation\" OR \"file_create_event\" OR \"rename\" OR \"file_rename_event\") AND file.path : (\\/usr\\/lib\\/* OR \\/dev\\/shm\\/*) AND file.extension : \"so\" AND process : * AND NOT process : (\"dpkg\" OR \"dockerd\" OR \"rpm\" OR \"snapd\" OR \"5\")"}
{"input": "", "instruction": "Detects the creation of a systemd timer within any of the default systemd timer directories. Systemd timers can be used by an attacker to gain persistence, by scheduling the execution of a command or script. Similarly to cron/at, systemd timers can be set up to execute on boot time, or on a specific point in time, which allows attackers to regain access in case the connection to the infected asset was lost. ", "output": "appname : \"linux\" AND action : (\"creation\" OR \"file_create_event\") AND file.extension : \"timer\" ANDfile.path:(\\/etc\\/systemd\\/system\\/* OR \\/usr\\/local\\/lib\\/systemd\\/system\\/* OR \\/lib\\/systemd\\/system\\/* OR \\/usr\\/lib\\/systemd\\/system\\/* OR \\/home\\/*\\/.config\\/systemd\\/user\\/*) AND NOT process.executable : (\"/usr/bin/dpkg\" OR \"/usr/bin/dockerd\" OR \"/bin/rpm\")"}
{"input": "", "instruction": "Systemd service files are configuration files in Linux systems used to define and manage system services. Malicious actors can leverage systemd service files to achieve persistence by creating or modifying service files to execute malicious commands or payloads during system startup. This allows them to maintain unauthorized access, execute additional malicious activities, or evade detection.", "output": "appname : \"linux\" AND action : (\"creation\" OR \"file_create_event\") AND file.path:(\\/etc\\/systemd\\/system\\/* OR \\/usr\\/local\\/lib\\/systemd\\/system\\/* OR \\/lib\\/systemd\\/system\\/* OR \\/usr\\/lib\\/systemd\\/system\\/* OR \\/home\\/*\\/.config\\/systemd\\/user\\/*) AND NOT (process : (\"dpkg\" OR \"dockerd\" OR \"rpm\" OR \"snapd\") OR file.extension : \"swp\")"}
{"input": "", "instruction": "Identifies modification of the dynamic linker preload shared object (ld.so.preload). Adversaries may execute maliciouspayloads by hijacking the dynamic linker used to load libraries.", "output": "event.category:file AND appname:linux AND NOT event_type:deletion AND file.path:\"/etc/ld.so.preload\""}
{"input": "", "instruction": "Identifies the execution of macOS built-in commands used to dump user account hashes. Adversaries may attempt to dumpcredentials to obtain account login information in the form of a hash. These hashes can be cracked or leveraged forlateral movement.", "output": "event.category:process AND appname:macos AND event_type:start AND process:(defaults OR mkpassdb) AND process.args:(ShadowHashData OR \"-dump\")"}
{"input": "", "instruction": "Identifies the use of the Kerberos credential cache (kcc) utility to dump locally cached Kerberos tickets. Adversariesmay attempt to dump credential material in the form of tickets that can be leveraged for lateral movement.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:kcc AND process.args:copy_cred_cache"}
{"input": "", "instruction": "Identifies the use of the built-in networksetup command to configure webproxy settings. This may indicate an attempt tohijack web browser traffic for credential access via traffic sniffing or redirection.", "output": "event.category:process AND appname:macos AND event_type:start AND process : networksetup AND process.args : ((\"-setwebproxy\" OR \"-setsecurewebproxy\" OR \"-setautoproxyurl\") AND NOT (Bluetooth OR off)) AND NOT f_process_path : (\"/Library/PrivilegedHelperTools/com.80pct.FreedomHelper\" OR \"/Applications/Fiddler Everywhere.app/Contents/Resources/app/out/WebServer/Fiddler.WebUi\" OR \"/usr/libexec/xpcproxy\")"}
{"input": "", "instruction": "Identifies a high number (20) of macOS SSH KeyGen process executions from the same host. An adversary may attempt abrute force attack to obtain unauthorized access to user accounts.", "output": "event.category:process AND appname:macos AND event_type:start AND process:\"sshd-keygen-wrapper\" AND process.parent.name:launchd"}
{"input": "", "instruction": "Keychains are the built-in way for macOS to keep track of users' passwords and credentials for many services andfeatures, including Wi-Fi and website passwords, secure notes, certificates, and Kerberos. Adversaries may collect thekeychain storage data from a system to acquire credentials.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process.args:(\"/private/var/db/SystemKey\" OR \"/var/db/SystemKey\")"}
{"input": "", "instruction": "Identifies changes to the SoftwareUpdate preferences using the built-in defaults command. Adversaries may abuse this inan attempt to disable security updates.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:defaults AND process.args:(write AND \"-bool\" AND (com.apple.SoftwareUpdate OR /Library/Preferences/com.apple.SoftwareUpdate.plist) AND NOT (TRUE OR true))"}
{"input": "", "instruction": "Detects attempts to disable Gatekeeper on macOS. Gatekeeper is a security feature that's designed to ensure that onlytrusted software is run. Adversaries may attempt to disable Gatekeeper before executing malicious code.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process.args:(spctl AND \"--master-disable\")"}
{"input": "", "instruction": "Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to their commandand control servers. Root certificates are used in public key cryptography to identify a root certificate authority(CA). When a root certificate is installed, the system or application will trust certificates in the root's chain oftrust that have been signed by the root certificate.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:security AND process.args:\"add-trusted-cert\" AND NOT f_process_path:(\"/Library/Bitdefender/AVP/product/bin/BDCoreIssues\" OR \"/Applications/Bitdefender/SecurityNetworkInstallerApp.app/Contents/MacOS/SecurityNetworkInstallerApp\")"}
{"input": "", "instruction": "Identifies modifications to an environment variable using the built-in launchctl command. Adversaries may execute theirown malicious payloads by hijacking certain environment variables to load arbitrary libraries or bypass certainrestrictions.", "output": "event.category:process AND appname:macos AND event_type:start AND process:launchctl AND process.args:(setenv AND NOT (JAVA*_HOME OR RUNTIME_JAVA_HOME OR DBUS_LAUNCHD_SESSION_BUS_SOCKET OR ANT_HOME OR LG_WEBOS_TV_SDK_HOME OR WEBOS_CLI_TV OR EDEN_ENV) ) AND NOT f_process_path:(\"/Applications/NoMachine.app/Contents/Frameworks/bin/nxserver.bin\" OR \"/usr/local/bin/kr\" OR \"/Applications/NoMachine.app/Contents/Frameworks/bin/nxserver.bin\" OR \"/Applications/IntelliJ IDEA CE.app/Contents/jbr/Contents/Home/lib/jspawnhelper\") AND NOT process.args : \"*.vmoptions\""}
{"input": "", "instruction": "Identifies changes to the Safari configuration using the built-in defaults command. Adversaries may attempt to enable ordisable certain Safari settings, such as enabling JavaScript from Apple Events to ease in the hijacking of the usersbrowser.", "output": "event.category:process AND appname:macos AND event_type:start AND process:defaults AND process.args: (com.apple.Safari AND write AND NOT ( UniversalSearchEnabled OR SuppressSearchSuggestions OR WebKitTabToLinksPreferenceKey OR ShowFullURLInSmartSearchField OR com.apple.Safari.ContentPageGroupIdentifier.WebKit2TabsToLinks ) )"}
{"input": "", "instruction": "Identifies the creation of a suspicious zip file prepended with special characters. Sandboxed Microsoft Officeapplications on macOS are allowed to write files that start with special characters, which can be combined with anAutoStart location to achieve sandbox evasion.", "output": "event.category:file AND appname:macos AND NOT event_type:deletion AND file.name:~$*.zip AND appname:macos"}
{"input": "", "instruction": "Identifies the use of the mount_apfs command to mount the entire file system through Apple File System (APFS) snapshotsas read-only and with the noowners flag set. This action enables the adversary to access almost any file in the filesystem, including all user data and files protected by Apple’s privacy framework (TCC).", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:mount_apfs AND process.args:(\"/System/Volumes/Data\" AND noowners)"}
{"input": "", "instruction": "Identifies attempts to execute a child process from within the context of an Electron application using thechild_process Node.js module. Adversaries may abuse this technique to inherit permissions from parent processes.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process.args:(\"-e\" AND const*require*child_process*)"}
{"input": "", "instruction": "Identifies use of Bifrost, a known macOS Kerberos pentesting tool, which can be used to dump cached Kerberos tickets orattempt unauthorized authentication techniques such as pass-the-ticket/hash and kerberoasting.", "output": "event.category:process AND appname:macos AND event_type:start AND process.args:(\"-action\" AND (\"-kerberoast\" OR askhash OR asktgs OR asktgt OR s4u OR (\"-ticket\" AND ptt) OR (dump AND (tickets OR keytab))))"}
{"input": "", "instruction": "Identifies attempts to create a local account that will be hidden from the macOS logon window. This may indicate anattempt to evade user attention while maintaining persistence using a separate local account.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:dscl AND process.args:(IsHidden AND create AND (true OR 1 OR yes))"}
{"input": "", "instruction": "Authorization plugins are used to extend the authorization services API and implement mechanisms that are not nativelysupported by the OS, such as multi-factor authentication with third party software. Adversaries may abuse this featureto persist and/or collect clear text credentials as they traverse the registered plugins during user logon.", "output": "event.category:file AND appname:macos AND NOT event_type:deletion AND file.path:(\\/Library\\/Security\\/SecurityAgentPlugins\\/* AND NOT \\/Library\\/Security\\/SecurityAgentPlugins\\/TeamViewerAuthPlugin.bundle\\/*) AND NOT process:shove AND process.code_signature.trusted:true"}
{"input": "", "instruction": "Identifies the execution of a launchd child process with a hidden file. An adversary can establish persistence byinstalling a new logon item, launch agent, or daemon that executes upon login.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:.* AND f_process_path:\"/sbin/launchd\""}
{"input": "", "instruction": "Identifies the creation or modification of a DirectoryService PlugIns (dsplug) file. The DirectoryService daemonlaunches on each system boot and automatically reloads after crash. It scans and executes bundles that are located inthe DirectoryServices PlugIns folder and can be abused by adversaries to maintain persistence.", "output": "event.category:file AND appname:macos AND NOT event_type:deletion AND file.path:\\/Library\\/DirectoryServices\\/PlugIns\\/*.dsplug"}
{"input": "", "instruction": "An adversary can establish persistence by modifying an existing macOS dock property list in order to execute a maliciousapplication instead of the intended one when invoked.", "output": "event.category:file AND appname:macos AND action:modification AND file.path:\\/Users\\/*\\/Library\\/Preferences\\/com.apple.dock.plist AND NOT process:(xpcproxy OR cfprefsd OR plutil OR jamf OR PlistBuddy OR InstallerRemotePluginService)"}
{"input": "", "instruction": "Identifies attempts to enable the root account using the dsenableroot command. This command may be abused by adversariesfor persistence, as the root account is disabled by default.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:dsenableroot AND NOT process.args:\"-d\""}
{"input": "", "instruction": "Identifies the creation or modification of the login window property list (plist). Adversaries may modify plist files torun a program during system boot or user login for persistence.", "output": "event.category:file AND appname:macos AND NOT event_type:\"deletion\" AND file.name:\"com.apple.loginwindow.plist\" AND process:(* AND NOT (systemmigrationd OR DesktopServicesHelper OR diskmanagementd OR rsync OR launchd OR cfprefsd OR xpcproxy OR ManagedClient OR MCXCompositor OR backupd OR \"iMazing Profile Editor\"))"}
{"input": "", "instruction": "Identifies the creation or modification of the default configuration for periodic tasks. Adversaries may abuse periodictasks to execute malicious code or maintain persistence.", "output": "event.category:file AND appname:macos AND NOT event_type:\"deletion\" AND file.path:(\\/private\\/etc\\/periodic\\/* OR \\/private\\/etc\\/defaults\\/periodic.conf OR \\/private\\/etc\\/periodic.conf)"}
{"input": "", "instruction": "Identifies suspicious modifications of the calendar file by an unusual process. Adversaries may create a custom calendarnotification procedure to execute a malicious program at a recurring interval to establish persistence.", "output": "event.category:file AND appname:macos AND action:modification AND file.path:\\/Users\\/*\\/Library\\/Calendars\\/*.calendar\\/Events\\/*.ics AND process.executable: (* AND NOT ( \\/System\\/Library\\/* OR \\/System\\/Applications\\/Calendar.app\\/Contents\\/MacOS\\/* OR \\/System\\/Applications\\/Mail.app\\/Contents\\/MacOS\\/Mail OR \\/usr\\/libexec\\/xpcproxy OR \\/sbin\\/launchd OR \\/Applications\\/* ) )"}
{"input": "", "instruction": "Identifies modifications to the Atom desktop text editor Init File. Adversaries may add malicious JavaScript code to theinit.coffee file that will be executed upon the Atom application opening.", "output": "event.category:file AND appname:macos AND NOT event_type:\"deletion\" AND file.path:/Users/*/.atom/init.coffee AND NOT process:(Atom OR xpcproxy) AND NOT user.name:root"}
{"input": "", "instruction": "Identifies execution of the security_authtrampoline process via a scripting interpreter. This occurs when programs useAuthorizationExecute-WithPrivileges from the Security.framework to run another program with root privileges. It shouldnot be run by itself, as this is a sign of execution with explicit logon credentials.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:\"security_authtrampoline\" AND process.parent.name:(osascript OR com.apple.automator.runner OR sh OR bash OR dash OR zsh OR python* OR Python OR perl* OR php* OR ruby OR pwsh)"}
{"input": "", "instruction": "Detects attempts to exploit privilege escalation vulnerabilities related to the Adobe Acrobat ReaderPrivilegedHelperTool responsible for installing updates. For more information, refer to CVE-2020-9615, CVE-2020-9614 andCVE-2020-9613 and verify that the impacted system is patched.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process.parent.name:com.adobe.ARMDC.SMJobBlessHelper AND user.name:root AND NOT process.executable: (\\/Library\\/PrivilegedHelperTools\\/com.adobe.ARMDC.SMJobBlessHelper OR \\/usr\\/bin\\/codesign OR \\/private\\/var\\/folders\\/zz\\/*\\/T\\/download\\/ARMDCHammer OR \\/usr\\/sbin\\/pkgutil OR \\/usr\\/bin\\/shasum OR \\/usr\\/bin\\/perl* OR \\/usr\\/sbin\\/spctl OR \\/usr\\/sbin\\/installer OR \\/usr\\/bin\\/csrutil)"}
{"input": "", "instruction": "Identifies attempts to add an account to the admin group via the command line. This could be an indication of privilegeescalation activity.", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:(dscl OR dseditgroup) AND process.args:((\"/Groups/admin\" OR admin) AND (\"-a\" OR \"-append\"))"}
{"input": "", "instruction": "Identifies modifications to the root crontab file. Adversaries may overwrite this file to gain code execution with rootprivileges by exploiting privileged file write or move related vulnerabilities.", "output": "event.category:file AND appname:macos AND NOT event_type:deletion AND file.path:\"/private/var/at/tabs/root\" AND NOT process.executable:\"/usr/bin/crontab\""}
{"input": "", "instruction": "This rule detects network events that may indicate the use of Telnet traffic. Telnet is commonly used by systemadministrators to remotely control older or embedded systems using the command line shell. It should almost never bedirectly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access orbackdoor vector. As a plain-text protocol, it may also expose usernames and passwords to anyone capable of observing thetraffic.", "output": "event.category:(network OR network_traffic) AND dst_port:23 AND network.direction:(inbound OR ingress OR outbound OR egress) AND NOT action:( flow_dropped OR denied OR deny OR flow_terminated OR timeout OR Reject OR network_flow)"}
{"input": "", "instruction": "This rule detects the use of the default Cobalt Strike Team Server TLS certificate. Cobalt Strike is software forAdversary Simulations and Red Team Operations which are security assessments that replicate the tactics and techniquesof an advanced adversary in a network. Modifications to the Packetbeat configuration can be made to include MD5 andSHA256 hashing algorithms (the default is SHA1). See the References section for additional information on moduleconfiguration.", "output": "event.category:(network OR network_traffic) AND (tls.server.hash.md5:950098276A495286EB2A2556FBAB6D83 OR tls.server.hash.sha1:6ECE5ECE4192683D2D84E25B0BA7E04F9CB7EB7C OR tls.server.hash.sha256:87F2085C32B6A2CC709B365F55873E207A9CAA10BFFECF2FD16D3CF9D94D390C)"}
{"input": "", "instruction": "Detects a Roshal Archive (RAR) file or PowerShell script downloaded from the internet by an internal host. Gaininginitial access to a system and then downloading encoded or encrypted tools to move laterally is a common practice foradversaries as a way to protect their more valuable tools and tactics, techniques, and procedures (TTPs). This may beatypical behavior for a managed network and can be indicative of malware, exfiltration, or command and control.", "output": "event.category:(network OR network_traffic) AND network.protocol:http AND (url.extension:(ps1 OR rar) OR url.path:(*.ps1 OR *.rar)) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.0.0.0/24\" OR \"192.0.0.0/29\" OR \"192.0.0.8/32\" OR \"192.0.0.9/32\" OR \"192.0.0.10/32\" OR \"192.0.0.170/32\" OR \"192.0.0.171/32\" OR \"192.0.2.0/24\" OR \"192.31.196.0/24\" OR \"192.52.193.0/24\" OR \"192.168.0.0/16\" OR \"192.88.99.0/24\" OR \"224.0.0.0/4\" OR \"100.64.0.0/10 OR \"192.175.48.0/24\" OR \"198.18.0.0/15\" OR \"198.51.100.0/24\" OR \"203.0.113.0/24\" OR \"240.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" ) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" )"}
{"input": "", "instruction": "This rule detects events that could be describing IPSEC NAT Traversal traffic. IPSEC is a VPN technology that allows onesystem to talk to another using encrypted tunnels. NAT Traversal enables these tunnels to communicate over the Internetwhere one of the sides is behind a NAT router gateway. This may be common on your network, but this technique is alsoused by threat actors to avoid detection.", "output": "event.category:(network OR network_traffic) AND network.transport:udp AND dst_port:4500"}
{"input": "", "instruction": "This rule detects events that may indicate use of SMTP on TCP port 26. This port is commonly used by several popularmail transfer agents to deconflict with the default SMTP port 25. This port has also been used by a malware familycalled BadPatch for command and control of Windows systems.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:26 OR (event.dataset:zeek.smtp AND dst_port:26))"}
{"input": "", "instruction": "This rule detects network events that may indicate the use of RDP traffic from the Internet. RDP is commonly used bysystem administrators to remotely control a system for maintenance or to use shared resources. It should almost never bedirectly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access orbackdoor vector.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:3389 OR event.dataset:zeek.rdp) AND NOT src_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.0.0.0/24\" OR \"192.0.0.0/29\" OR \"192.0.0.8/32\" OR \"192.0.0.9/32\" OR \"192.0.0.10/32\" OR \"192.0.0.170/32\" OR \"192.0.0.171/32\" OR \"192.0.2.0/24\" OR \"192.31.196.0/24\" OR \"192.52.193.0/24\" OR \"192.168.0.0/16\" OR \"192.88.99.0/24\" OR \"224.0.0.0/4\" OR \"100.64.0.0/10 OR \"192.175.48.0/24\" OR \"198.18.0.0/15\" OR \"198.51.100.0/24\" OR \"203.0.113.0/24\" OR \"240.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" ) AND dst_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" )"}
{"input": "", "instruction": "This rule detects network events that may indicate the use of VNC traffic from the Internet. VNC is commonly used bysystem administrators to remotely control a system for maintenance or to use shared resources. It should almost never bedirectly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access orbackdoor vector.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND dst_port:>= 5800 AND dst_port:<= 5810 AND NOT src_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.0.0.0/24\" OR \"192.0.0.0/29\" OR \"192.0.0.8/32\" OR \"192.0.0.9/32\" OR \"192.0.0.10/32\" OR \"192.0.0.170/32\" OR \"192.0.0.171/32\" OR \"192.0.2.0/24\" OR \"192.31.196.0/24\" OR \"192.52.193.0/24\" OR \"192.168.0.0/16\" OR \"192.88.99.0/24\" OR \"224.0.0.0/4\" OR \"100.64.0.0/10 OR \"192.175.48.0/24\" OR \"198.18.0.0/15\" OR \"198.51.100.0/24\" OR \"203.0.113.0/24\" OR \"240.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" ) AND dst_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" )"}
{"input": "", "instruction": "This rule detects network events that may indicate the use of VNC traffic to the Internet. VNC is commonly used bysystem administrators to remotely control a system for maintenance or to use shared resources. It should almost never bedirectly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access orbackdoor vector.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND dst_port:>= 5800 AND dst_port:<= 5810 AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.0.0.0/24\" OR \"192.0.0.0/29\" OR \"192.0.0.8/32\" OR \"192.0.0.9/32\" OR \"192.0.0.10/32\" OR \"192.0.0.170/32\" OR \"192.0.0.171/32\" OR \"192.0.2.0/24\" OR \"192.31.196.0/24\" OR \"192.52.193.0/24\" OR \"192.168.0.0/16\" OR \"192.88.99.0/24\" OR \"224.0.0.0/4\" OR \"100.64.0.0/10 OR \"192.175.48.0/24\" OR \"198.18.0.0/15\" OR \"198.51.100.0/24\" OR \"203.0.113.0/24\" OR \"240.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "This rule detects network events that may indicate the use of RPC traffic from the Internet. RPC is commonly used bysystem administrators to remotely control a system for maintenance or to use shared resources. It should almost never bedirectly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access orbackdoor vector.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:135 OR event.dataset:zeek.dce_rpc) AND NOT src_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.0.0.0/24\" OR \"192.0.0.0/29\" OR \"192.0.0.8/32\" OR \"192.0.0.9/32\" OR \"192.0.0.10/32\" OR \"192.0.0.170/32\" OR \"192.0.0.171/32\" OR \"192.0.2.0/24\" OR \"192.31.196.0/24\" OR \"192.52.193.0/24\" OR \"192.168.0.0/16\" OR \"192.88.99.0/24\" OR \"224.0.0.0/4\" OR \"100.64.0.0/10 OR \"192.175.48.0/24\" OR \"198.18.0.0/15\" OR \"198.51.100.0/24\" OR \"203.0.113.0/24\" OR \"240.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" ) AND dst_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" )"}
{"input": "", "instruction": "This rule detects network events that may indicate the use of RPC traffic to the Internet. RPC is commonly used bysystem administrators to remotely control a system for maintenance or to use shared resources. It should almost never bedirectly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access orbackdoor vector.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:135 OR event.dataset:zeek.dce_rpc) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.0.0.0/24\" OR \"192.0.0.0/29\" OR \"192.0.0.8/32\" OR \"192.0.0.9/32\" OR \"192.0.0.10/32\" OR \"192.0.0.170/32\" OR \"192.0.0.171/32\" OR \"192.0.2.0/24\" OR \"192.31.196.0/24\" OR \"192.52.193.0/24\" OR \"192.168.0.0/16\" OR \"192.88.99.0/24\" OR \"224.0.0.0/4\" OR \"100.64.0.0/10 OR \"192.175.48.0/24\" OR \"198.18.0.0/15\" OR \"198.51.100.0/24\" OR \"203.0.113.0/24\" OR \"240.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "This rule detects network events that may indicate the use of Windows file sharing (also called SMB or CIFS) traffic tothe Internet. SMB is commonly used within networks to share files, printers, and other system resources amongst trustedsystems. It should almost never be directly exposed to the Internet, as it is frequently targeted and exploited bythreat actors as an initial access or backdoor vector or for data exfiltration.", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(139 OR 445) OR event.dataset:zeek.smb) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.0.0.0/24\" OR \"192.0.0.0/29\" OR \"192.0.0.8/32\" OR \"192.0.0.9/32\" OR \"192.0.0.10/32\" OR \"192.0.0.170/32\" OR \"192.0.0.171/32\" OR \"192.0.2.0/24\" OR \"192.31.196.0/24\" OR \"192.52.193.0/24\" OR \"192.168.0.0/16\" OR \"192.88.99.0/24\" OR \"224.0.0.0/4\" OR \"100.64.0.0/10 OR \"192.175.48.0/24\" OR \"198.18.0.0/15\" OR \"198.51.100.0/24\" OR \"203.0.113.0/24\" OR \"240.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "Specially crafted DNS requests can manipulate a known overflow vulnerability in some Windows DNS servers, resulting inRemote Code Execution (RCE) or a Denial of Service (DoS) from crashing the service.", "output": "event.category:(network OR network_traffic) AND dst_port:53 AND (event.dataset:zeek.dns OR type:dns OR event_type:connection) AND network.bytes:>60000"}
{"input": "", "instruction": "search the alert event from endgame module that detected Credential Dumping.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:detection AND (action:cred_theft_event OR endgame.event_subtype_full:cred_theft_event)"}
{"input": "", "instruction": "search the alert event from endgame module that prevented Credential Dumping.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:prevention AND (action:cred_theft_event OR endgame.event_subtype_full:cred_theft_event)"}
{"input": "", "instruction": "search the alert event from endgame module that detected an Adversary Behavior.", "output": "event.kind:alert AND event.module:endgame AND (action:behavior_protection_event OR endgame.event_subtype_full:behavior_protection_event)"}
{"input": "", "instruction": "search the alert event from endgame module that detected Malware.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:detection AND (action:file_classification_event OR endgame.event_subtype_full:file_classification_event)"}
{"input": "", "instruction": "search the alert event from endgame module that prevented Malware.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:prevention AND (action:file_classification_event OR endgame.event_subtype_full:file_classification_event)"}
{"input": "", "instruction": "search the alert event from endgame module that detected ransomware.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:detection AND (action:ransomware_event OR endgame.event_subtype_full:ransomware_event)"}
{"input": "", "instruction": "search the alert event from endgame module that prevented ransomware.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:prevention AND (action:ransomware_event OR endgame.event_subtype_full:ransomware_event)"}
{"input": "", "instruction": "search the alert event from endgame module that detected an Exploit.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:detection AND (action:exploit_event OR endgame.event_subtype_full:exploit_event)"}
{"input": "", "instruction": "search the alert event from endgame module that prevented an Exploit.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:prevention AND (action:exploit_event OR endgame.event_subtype_full:exploit_event)"}
{"input": "", "instruction": "Generates a detection alert for each external alert written to the configured indices. Enabling this rule allows you toimmediately begin investigating external alerts in the app.", "output": "event.kind:alert AND NOT event.module:(endgame OR endpoint OR cloud_defend)"}
{"input": "", "instruction": "search the alert event from endgame module that detected Credential Manipulation.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:detection AND (action:token_manipulation_event OR endgame.event_subtype_full:token_manipulation_event)"}
{"input": "", "instruction": "search the alert event from endgame module that prevented Credential Manipulation.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:prevention AND (action:token_manipulation_event OR endgame.event_subtype_full:token_manipulation_event)"}
{"input": "", "instruction": "search the alert event from endgame module that detected Permission Theft.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:detection AND (action:token_protection_event OR endgame.event_subtype_full:token_protection_event)"}
{"input": "", "instruction": "search the alert event from endgame module that prevented Permission Theft.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:prevention AND (action:token_protection_event OR endgame.event_subtype_full:token_protection_event)"}
{"input": "", "instruction": "search the alert event from endgame module that detected Process Injection.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:detection AND (action:kernel_shellcode_event OR endgame.event_subtype_full:kernel_shellcode_event)"}
{"input": "", "instruction": "search the alert event from endgame module that prevented Process Injection.", "output": "event.kind:alert AND event.module:endgame AND endgame.metadata.type:prevention AND (action:kernel_shellcode_event OR endgame.event_subtype_full:kernel_shellcode_event)"}
{"input": "", "instruction": "Identifies the use of the Exchange PowerShell cmdlet, New-MailBoxExportRequest, to export the contents of a primary mailbox or archive to a .pst file. Adversaries may target user email to collect sensitive information.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : \"New-MailboxExportRequest\""}
{"input": "", "instruction": "Detects PowerShell scripts that can get the contents of the clipboard, which attackers can abuse to retrieve sensitiveinformation like credentials, messages, etc.", "output": "event.category:process AND appname:windows AND (powershell.file.script_block_text : ( \"Windows.Clipboard\" OR \"Windows.Forms.Clipboard\" OR \"Windows.Forms.TextBox\" ) AND powershell.file.script_block_text : ( \"]::GetText\" OR \".Paste()\" )) OR powershell.file.script_block_text : \"Get-Clipboard\" AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "Detects the use of Win32 API Functions that can be used to capture user keystrokes in PowerShell scripts. Attackers usethis technique to capture user input, looking for credentials and/or other valuable data.", "output": "event.category:process AND appname:windows AND ( powershell.file.script_block_text : (GetAsyncKeyState OR NtUserGetAsyncKeyState OR GetKeyboardState OR \"Get-Keystrokes\") OR powershell.file.script_block_text : ( (SetWindowsHookA OR SetWindowsHookW OR SetWindowsHookEx OR SetWindowsHookExA OR NtUserSetWindowsHookEx) AND (GetForegroundWindow OR GetWindowTextA OR GetWindowTextW OR \"WM_KEYBOARD_LL\") ) ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "Detects PowerShell scripts that can be used to collect data from mailboxes. Adversaries may target user email to collectsensitive information.", "output": "event.category:process AND appname:windows AND ( powershell.file.script_block_text : ( \"Microsoft.Office.Interop.Outlook\" OR \"Interop.Outlook.olDefaultFolders\" OR \"::olFolderInBox\" ) OR powershell.file.script_block_text : ( \"Microsoft.Exchange.WebServices.Data.Folder\" OR \"Microsoft.Exchange.WebServices.Data.FileAttachment\" ) )"}
{"input": "", "instruction": "Detects PowerShell scripts that can take screenshots, which is a common feature in post-exploitation kits and remoteaccess tools (RATs).", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( CopyFromScreen AND (\"System.Drawing.Bitmap\" OR \"Drawing.Bitmap\") ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "This rule identifies a large number (15) of nslookup.exe executions with an explicit query type from the same host. Thismay indicate command and control activity utilizing the DNS protocol.", "output": "event.category:process AND appname:windows AND event_type:start AND process:nslookup.exe AND process.args:(-querytype=* OR -qt=* OR -q=* OR -type=*)"}
{"input": "", "instruction": "Adversaries may install legitimate remote access tools (RAT) to compromised endpoints for further command-and-control(C2). Adversaries can rely on installed RATs for persistence, execution of native commands and more. This rule detectswhen a process is started whose name or code signature resembles commonly abused RATs. This is a New Terms rule typeindicating the host has not seen this RAT process started before within the last 30 days.", "output": "appname: \"windows\" AND event.category: \"process\" AND event_type : \"start\" AND ( process.code_signature.subject_name : ( TeamViewer* OR \"NetSupport Ltd\" OR \"GlavSoft\" OR \"LogMeIn, Inc.\" OR \"Ammyy LLC\" OR \"Nanosystems S.r.l.\" OR \"Remote Utilities LLC\" OR \"ShowMyPC\" OR \"Splashtop Inc.\" OR \"Yakhnovets Denis AleksANDrovich IP\" OR \"Pro Softnet Corporation\" OR \"BeamYourScreen GmbH\" OR \"RealVNC\" OR \"uvnc\" OR \"SAFIB\") OR process.caseless : ( \"teamviewer.exe\" OR \"apc_Admin.exe\" OR \"apc_host.exe\" OR \"SupremoHelper.exe\" OR \"rfusclient.exe\" OR \"spclink.exe\" OR \"smpcview.exe\" OR \"ROMServer.exe\" OR \"strwinclt.exe\" OR \"RPCSuite.exe\" OR \"RemotePCDesktop.exe\" OR \"RemotePCService.exe\" OR \"tvn.exe\" OR \"LMIIgnition.exe\" OR \"B4-Service.exe\" OR \"Mikogo-Service.exe\" OR \"AnyDesk.exe\" OR \"Splashtop-streamer.exe\" OR AA_v*.exe, OR \"rutserv.exe\" OR \"rutview.exe\" OR \"vncserver.exe\" OR \"vncviewer.exe\" OR \"tvnserver.exe\" OR \"tvnviewer.exe\" OR \"winvnc.exe\" OR \"RemoteDesktopManager.exe\" OR \"LogMeIn.exe\" OR ScreenConnect*.exe OR \"RemotePC.exe\" OR \"r_server.exe\" OR \"radmin.exe\" OR \"ROMServer.exe\" OR \"ROMViewer.exe\" OR \"DWRCC.exe\" OR \"AeroAdmin.exe\" OR \"ISLLightClient.exe\" OR \"ISLLight.exe\" OR \"AteraAgent.exe\" OR \"SRService.exe\") ) AND NOT (process.pe.original_file_name : (\"G2M.exe\" OR \"Updater.exe\" OR \"powershell.exe\") AND process.code_signature.subject_name : \"LogMeIn, Inc.\")"}
{"input": "", "instruction": "This rule identifies when a User Account starts the Active Directory Replication Process for the first time. Attackers can use the DCSync technique to get credential information of individual accounts or the entire domain, thus compromising the entire domain.", "output": "action:\"Directory Service Access\" AND event_id:\"4662\" AND json.event_data.Properties:(*DS-Replication-Get-Changes* OR *DS-Replication-Get-Changes-All* OR *DS-Replication-Get-Changes-In-Filtered-Set* OR *1131f6ad-9c07-11d1-f79f-00c04fc2dcd2* OR *1131f6aa-9c07-11d1-f79f-00c04fc2dcd2* OR *89e95b76-444d-4c62-991a-0facbeda640c*) AND NOT json.event_data.SubjectUserName:(*$ OR MSOL_*)"}
{"input": "", "instruction": "Identifies the modification of an account's Kerberos pre-authentication options. An adversary withGenericWrite/GenericAll rights over the account can maliciously modify these settings to perform offline passwordcracking attacks such as AS-REP roasting.", "output": "event_id:4738 AND winlog.api:\"wineventlog\" AND message:\"'Don't Require Preauth' - Enabled\""}
{"input": "", "instruction": "Mimikatz is a credential dumper capable of obtaining plaintext Windows account logins and passwords, along with manyother features that make it useful for testing the security of networks. This rule detects Invoke-Mimikatz PowerShellscript and alike.", "output": "event.category:process AND appname:windows ANDpowershell.file.script_block_text:( (DumpCreds AND DumpCerts) OR \"sekurlsa::logonpasswords\" OR (\"crypto::certificates\" AND \"CERT_SYSTEM_STORE_LOCAL_MACHINE\"))"}
{"input": "", "instruction": "Detects PowerShell scripts that contain the default exported functions used on Invoke-NinjaCopy. Attackers can useInvoke-NinjaCopy to read SYSTEM files that are normally locked, such as the NTDS.dit file or registry hives.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( \"StealthReadFile\" OR \"StealthReadFileAddr\" OR \"StealthCloseFileDelegate\" OR \"StealthOpenFile\" OR \"StealthCloseFile\" OR \"StealthReadFile\" OR \"Invoke-NinjaCopy\" ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "This rule detects PowerShell scripts capable of dumping process memory using WindowsErrorReporting or Dbghelp.dllMiniDumpWriteDump. Attackers can use this tooling to dump LSASS and get access to credentials.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text:(MiniDumpWriteDump OR MiniDumpWithFullMemory OR pmuDetirWpmuDiniM) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "Detects PowerShell scripts that have the capability of requesting kerberos tickets, which is a common step inKerberoasting toolkits to crack service accounts.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( KerberosRequest OR SecurityToken ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "Identifies the assignment of the SeEnableDelegationPrivilege sensitive \"user right\" to a user. TheSeEnableDelegationPrivilege \"user right\" enables computer and user accounts to be trusted for delegation. Attackers canabuse this right to compromise Active Directory accounts and elevate their privileges.", "output": "action:\"Authorization Policy Change\" AND event_id:4704 AND json.event_data.PrivilegeList:\"SeEnableDelegationPrivilege\""}
{"input": "", "instruction": "Identify the modification of the msDS-KeyCredentialLink attribute in an Active Directory Computer or User Object.Attackers can abuse control over the object and create a key pair, append to raw public key in the attribute, and obtainpersistent and stealthy access to the target user or computer object.", "output": "action:\"Directory Service Changes\" AND event_id:\"5136\" AND json.event_data.AttributeLDAPDisplayName:\"msDS-KeyCredentialLink\" AND json.event_data.AttributeValue :B\\:828* AND NOT json.event_data.SubjectUserName: MSOL_*"}
{"input": "", "instruction": "Detects when a user account has the servicePrincipalName attribute modified. Attackers can abuse write privileges over auser to configure Service Principle Names (SPNs) so that they can perform Kerberoasting. Administrators can alsoconfigure this for legitimate purposes, exposing the account to Kerberoasting.", "output": "action:\"Directory Service Changes\" AND event_id:5136 AND json.event_data.ObjectClass:\"user\" AND json.event_data.AttributeLDAPDisplayName:\"servicePrincipalName\""}
{"input": "", "instruction": "Identifies suspicious access to an LSASS handle via PssCaptureSnapShot where two successive process accesses areperformed by the same process and target two different instances of LSASS. This may indicate an attempt to evadedetection and dump LSASS memory for credential access.", "output": "event.category:process AND appname:windows AND event_id:10 AND json.event_data.TargetImage:(\"C:\\Windows\\system32\\lsass.exe\" OR \"c:\\Windows\\system32\\lsass.exe\" OR \"c:\\Windows\\System32\\lsass.exe\")"}
{"input": "", "instruction": "Identifies the execution of PowerShell script with keywords related to different Antimalware Scan Interface (AMSI)bypasses. An adversary may attempt first to disable AMSI before executing further malicious powershell scripts to evadedetection.", "output": "event.category:\"process\" AND appname:windows AND (powershell.file.script_block_text : (\"System.Management.Automation.AmsiUtils\" OR amsiInitFailed OR \"Invoke-AmsiBypass\" OR \"Bypass.AMSI\" OR \"amsi.dll\" OR AntimalwareProvider OR amsiSession OR amsiContext OR \"System.Management.Automation.ScriptBlock\" OR AmsiInitialize OR unloadobfuscated OR unloadsilent OR AmsiX64 OR AmsiX32 OR FindAmsiFun) OR powershell.file.script_block_text:(\"[System.Runtime.InteropServices.Marshal]::Copy\" AND \"VirtualProtect\") OR powershell.file.script_block_text:(\"[Ref].Assembly.GetType(('System.Management.Automation\" AND \".SetValue(\") )"}
{"input": "", "instruction": "Identifies attempts to clear Windows event log stores. This is often done by attackers in an attempt to evade detectionor destroy forensic evidence on a system.", "output": "action:(\"audit-log-cleared\" OR \"Log clear\") AND winlog.api:\"wineventlog\""}
{"input": "", "instruction": "A spoofing vulnerability exists in the way Windows CryptoAPI (Crypt32.dll) validates Elliptic Curve Cryptography (ECC)certificates. An attacker could exploit the vulnerability by using a spoofed code-signing certificate to sign amalicious executable, making it appear the file was from a trusted, legitimate source.", "output": "event.provider:\"Microsoft-Windows-Audit-CVE\" AND message:\"[CVE-2020-0601]\" AND appname:windows"}
{"input": "", "instruction": "An instance of MSBuild, the Microsoft Build Engine, created a thread in another process. This technique is sometimesused to evade detection or elevate privileges.", "output": "process:MSBuild.exe AND appname:windows AND action:\"CreateRemoteThread detected (rule: CreateRemoteThread)\""}
{"input": "", "instruction": "Detects the use of Reflection.Assembly to load PEs and DLLs in memory in PowerShell scripts. Attackers use this methodto load executables and DLLs without writing to the disk, bypassing security solutions.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( \"[System.Reflection.Assembly]::Load\" OR \"[Reflection.Assembly]::Load\" ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "Identifies the use of .NET functionality for decompression and base64 decoding combined in PowerShell scripts, whichmalware and security tools heavily use to deobfuscate payloads and load them directly in memory to bypass defenses.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( ( \"System.IO.Compression.DeflateStream\" OR \"System.IO.Compression.GzipStream\" OR \"IO.Compression.DeflateStream\" OR \"IO.Compression.GzipStream\" ) AND FromBase64String ) AND NOT (uid:(\"S-1-5-18\" OR \"S-1-5-19\") AND current_directory: \"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\Downloads\")"}
{"input": "", "instruction": "Identifies the use of Cmdlets and methods related to encryption/decryption of files in PowerShell scripts, which malwareand offensive security tools can abuse to encrypt data or decrypt payloads to bypass security solutions.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( ( \"Cryptography.AESManaged\" OR \"Cryptography.RijndaelManaged\" OR \"Cryptography.SHA1Managed\" OR \"Cryptography.SHA256Managed\" OR \"Cryptography.SHA384Managed\" OR \"Cryptography.SHA512Managed\" OR \"Cryptography.SymmetricAlgorithm\" OR \"PasswordDeriveBytes\" OR \"Rfc2898DeriveBytes\" ) AND ( CipherMode AND PaddingMode ) AND ( \".CreateEncryptor\" OR \".CreateDecryptor\" ) ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "Detects the use of Windows API functions that are commonly abused by malware and security tools to load malicious codeor inject it into remote processes.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( (VirtualAlloc OR VirtualAllocEx OR VirtualProtect OR LdrLoadDll OR LoadLibrary OR LoadLibraryA OR LoadLibraryEx OR GetProcAddress OR OpenProcess OR OpenProcessToken OR AdjustTokenPrivileges) AND (WriteProcessMemory OR CreateRemoteThread OR NtCreateThreadEx OR CreateThread OR QueueUserAPC OR SuspendThread OR ResumeThread OR GetDelegateForFunctionPointer) ) AND NOT (uid:(\"S-1-5-18\" OR \"S-1-5-19\") AND current_directory: \"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\SenseCM\")"}
{"input": "", "instruction": "Detects scripts that contain PowerShell functions, structures, or Windows API functions related to windows shareenumeration activities. Attackers, mainly ransomware groups, commonly identify and inspect network shares, looking forcritical information for encryption and/or exfiltration.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text:( \"Invoke-ShareFinder\" OR \"Invoke-ShareFinderThreaded\" OR ( \"shi1_netname\" AND \"shi1_remark\" ) OR ( \"NetShareEnum\" AND \"NetApiBufferFree\" ) ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "This rule detects the use of discovery-related Windows API functions in PowerShell Scripts. Attackers can use thesefunctions to perform various situational awareness related activities, like enumerating users, shares, sessions, domaintrusts, groups, etc.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( NetShareEnum OR NetWkstaUserEnum OR NetSessionEnum OR NetLocalGroupEnum OR NetLocalGroupGetMembers OR DsGetSiteName OR DsEnumerateDomainTrusts OR WTSEnumerateSessionsEx OR WTSQuerySessionInformation OR LsaGetLogonSessionData OR QueryServiceObjectSecurity OR GetComputerNameEx OR NetWkstaGetInfo OR GetUserNameEx OR NetUserEnum OR NetUserGetInfo OR NetGroupEnum OR NetGroupGetInfo OR NetGroupGetUsers OR NetWkstaTransportEnum OR NetServerGetInfo OR LsaEnumerateTrustedDomains OR NetScheduleJobEnum OR NetUserModalsGet ) AND NOT (uid:(\"S-1-5-18\" OR \"S-1-5-19\") AND current_directory: \"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\DataCollection\")"}
{"input": "", "instruction": "Detects the presence of a portable executable (PE) in a PowerShell script by looking for its encoded header. Attackersembed PEs into PowerShell scripts to inject them into memory, avoiding defences by not writing to disk.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( TVqQAAMAAAAEAAAA ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "Detects the use of PSReflect in PowerShell scripts. Attackers leverage PSReflect as a library that enables PowerShell toaccess win32 API functions.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text:( \"New-InMemoryModule\" OR \"Add-Win32Type\" OR psenum OR DefineDynamicAssembly OR DefineDynamicModule OR \"Reflection.TypeAttributes\" OR \"Reflection.Emit.OpCodes\" OR \"Reflection.Emit.CustomAttributeBuilder\" OR \"Runtime.InteropServices.DllImportAttribute\" ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "This rule identifies a high number (10) of process terminations (stop, delete, or suspend) from the same host within ashort time period.", "output": "event.category:process AND appname:windows AND event_type:start AND process:(net.exe OR sc.exe OR taskkill.exe) AND process.args:(stop OR pause OR delete OR \"/PID\" OR \"/IM\" OR \"/T\" OR \"/F\" OR \"/t\" OR \"/f\" OR \"/im\" OR \"/pid\")"}
{"input": "", "instruction": "Adversaries may pass the hash using stolen password hashes to move laterally within an environment, bypassing normal system access controls. Pass the hash (PtH) is a method of authenticating as a user without having access to the user's cleartext password. ", "output": "appname:\"windows\" AND event.category : \"authentication\" AND action : \"logged-in\" AND winlog.logon.type : \"NewCredentials\" AND event.outcome : \"success\" AND uid : (S-1-5-21-* OR S-1-12-1-*) AND json.event_data.LogonProcessName : \"seclogo\""}
{"input": "", "instruction": "Detects modifications in the AdminSDHolder object. Attackers can abuse the SDProp process to implement a persistentbackdoor in Active Directory. SDProp compares the permissions on protected objects with those defined on theAdminSDHolder object. If the permissions on any of the protected accounts and groups do not match, the permissions onthe protected accounts and groups are reset to match those of the domain's AdminSDHolder object, regaining theirAdministrative Privileges.", "output": "action:\"Directory Service Changes\" AND event_id:5136 AND json.event_data.ObjectDN:CN=AdminSDHolder,CN=System*"}
{"input": "", "instruction": "Detects the creation and modification of an account with the \"Don't Expire Password\" option Enabled. Attackers can abusethis misconfiguration to persist in the domain and maintain long-term access using compromised accounts with thisproperty.", "output": "action:\"modified-user-account\" AND winlog.api:\"wineventlog\" AND event_id:\"4738\" AND message:\"'Don't Expire Password' - Enabled\" AND NOT uid:\"S-1-5-18\""}
{"input": "", "instruction": "Identifies the load of a driver with an original file name and signature values that were observedfor the first time during the last 30 days. This rule type can help baseline drivers installationwithin your environment.", "output": "event.category:\"driver\" AND appname:windows AND action:\"load\""}
{"input": "", "instruction": "Identifies the modification of the msDS-AllowedToDelegateTo attribute to KRBTGT. Attackers can use this technique tomaintain persistence to the domain by having the ability to request tickets for the KRBTGT service.", "output": "action:modified-user-account AND event_id:4738 AND json.event_data.AllowedToDelegateTo:*krbtgt*"}
{"input": "", "instruction": "Identifies attempts to create a Windows User Account. This is sometimes done by attackers to persist or increase accessto a system or domain.", "output": "event.module:(\"system\" OR \"security\") AND winlog.api:\"wineventlog\" AND (event_id:\"4720\" OR action:\"added-user-account\")"}
{"input": "", "instruction": "Identify the modification of the msPKIAccountCredentials attribute in an Active Directory User Object. Attackers canabuse the credentials roaming feature to overwrite an arbitrary file for privilege escalation. ms-PKI-AccountCredentialscontains binary large objects (BLOBs) of encrypted credential objects from the credential manager store, private keys,certificates, and certificate requests.", "output": "action:\"Directory Service Changes\" AND event_id:\"5136\" AND json.event_data.AttributeLDAPDisplayName:\"msPKIAccountCredentials\" AND json.event_data.OperationType:\"%%14674\" AND NOT json.event_data.SubjectUserSid : \"S-1-5-18\""}
{"input": "", "instruction": "Detects the first occurrence of a modification to Group Policy Object Attributes to add privileges to user accounts oruse them to add users as local admins.", "output": "event_id: \"5136\" AND json.event_data.AttributeLDAPDisplayName:\"gPCMachineExtensionNames\" AND json.event_data.AttributeValue:(*827D319E-6EAC-11D2-A4EA-00C04F79F83A* AND *803E14A0-B4FB-11D0-A0D0-00A0C90F574B*)"}
{"input": "", "instruction": "Detects the modification of Group Policy Object attributes to execute a scheduled task in the objects controlled by theGPO.", "output": "(event_id: \"5136\" AND json.event_data.AttributeLDAPDisplayName:(\"gPCMachineExtensionNames\" OR \"gPCUserExtensionNames\") AND json.event_data.AttributeValue:(*CAB54552-DEEA-4691-817E-ED4A4D1AFC72* AND *AADCED64-746C-4633-A97C-D61349046527*))OR(event_id: \"5145\" AND json.event_data.ShareName: \"\\\\*\\SYSVOL\" AND json.event_data.RelativeTargetName: *ScheduledTasks.xml AND (message: WriteData OR json.event_data.AccessList: *%%4417*))"}
{"input": "", "instruction": "Detects scripts that contain PowerShell functions, structures, or Windows API functions related to tokenimpersonation/theft. Attackers may duplicate then impersonate another user's token to escalate privileges and bypassaccess controls.", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text:( \"Invoke-TokenManipulation\" OR \"ImpersonateNamedPipeClient\" OR \"NtImpersonateThread\" OR ( \"STARTUPINFOEX\" AND \"UpdateProcThreadAttribute\" ) OR ( \"AdjustTokenPrivileges\" AND \"SeDebugPrivilege\" ) OR ( (\"DuplicateToken\" OR \"DuplicateTokenEx\") AND (\"SetThreadToken\" OR \"ImpersonateLoggedOnUser\" OR \"CreateProcessWithTokenW\" OR \"CreatePRocessAsUserW\" OR \"CreateProcessAsUserA\") ) ) AND NOT (uid:(\"S-1-5-18\" OR \"S-1-5-19\") AND current_directory: \"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\Downloads\")"}
{"input": "", "instruction": "Identifies the creation of a Windows service by an unusual client process. Services may be created with administratorprivileges but are executed under SYSTEM privileges, so an adversary may also use a service to escalate privileges fromadministrator to SYSTEM.", "output": "action:\"service-installed\" AND (json.event_data.ClientProcessId:\"0\" OR json.event_data.ParentProcessId:\"0\")"}
{"input": "", "instruction": "我想问有没有权限执行 chmod 命令并修改文件或目录的访问控制列表（ACL）。我正在寻找关于某个名为 \"chmod\"、使用了 \"-g + s\" 或 \"/2[0-9] {3} /\" 参数且不涉及到根用户的信息。。", "output": "event.category:process AND (event_type:start OR event_type:process_started) AND process:chmod AND (process.args:g+s OR process.args:/2[0-9]{3}/) AND NOT user.name:root"}
{"input": "", "instruction": "我想跟踪某些网络活动，可能涉及到一些不安全的网站或服务。这些网站通常会使用 TLS（Transport Layer Security）加密通信，HTTP协议以及TCP传输层协议。我正在追踪与Zoom有关的网络活动，但不是通过其官方域名 zoom.us进行的，而是除destination.domain:zoom.us之外的所有其他域。", "output": "(event.category:network OR event.category:network_traffic) AND (type:tls OR type:http) AND network.transport:tcp AND destination.domain:/[a-zA-Z]{4,5}\\.(pw|us|club|info|site|top)/ AND NOT destination.domain:zoom.us"}
{"input": "", "instruction": "查找包含有关网络流量、HTTP 消息和端口 9200 的事件的结果，同时排除具有特定 MIME 类型的图像文件作为响应正文或未包含身份验证标头的 HTTP 请求。", "output": "event.category:network_traffic AND network.protocol:http AND status:OK AND dst_port:9200 AND network.direction:inbound AND NOT http.response.headers.content-type:\"image/x-icon\" AND NOT _exists_:http.request.headers.authorization"}
{"input": "", "instruction": "查询协议为TCP的网络流量记录；目标端口为20或21；发生在Zeek中所收集的FTP数据集中；源IP地址位于特定的IP范围内（10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16）；目的地IP地址不处于特定的IP范围内（除去10.0.0.0/8, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.168.0.0/16, 224.0.0.0/4, ::1, FE80::/10和FF00::/8）。", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(20 OR 21) OR event.dataset:zeek.ftp) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "发生在公网上的TCP端口为8000的网络通信情况。", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND dst_port:8000 AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "有哪些IP地址访问了端口号为1080、3128或8080的服务器？但不包括本机和内网IP地址范围内的服务器。", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(1080 OR 3128 OR 8080) OR event.dataset:zeek.socks) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "我想知道的是发生在网络上或者使用TCP协议传输的邮件发送失败的情况。", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(25 OR 465 OR 587) OR event.dataset:zeek.smtp) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "帮我创建查询，它应该返回与你的公司的网络有关的所有数据库流量数据，这些流量源自于某个 IP 段（例如 10.0.0.0/8、172.16.0.0/12 或 192.168.0.0/16），并且不包括目标地址在内的任何本地地址（如 10.0.0.0/8、127.0.0.0/8、169.254.0.0/16、172.16.0.0/12、192.168.0.0/16、224.0.0.0/4、::1、FE80::/10 和 FF00::/8）。", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:(1433 OR 1521 OR 3306 OR 5432) OR event.dataset:zeek.mysql) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "我想知道的是发生在哪些网络中，使用TCP协议进行的SSH登录事件，并且不包括本机和一些常见的私有地址范围内的IP地址。", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:22 OR event.dataset:zeek.ssh) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "我想知道最近有没有人在使用 tcpdump 命令进行网络监控。请告诉我最近一次的操作记录。", "output": "event.category:process AND event_type:(start OR process_started) AND process:tcpdump | limit 1"}
{"input": "", "instruction": "系统进程启动事件中包含注册表加载相关的信息", "output": "event.category:process AND event_type:(start OR process_started) AND process:(RegAsm.exe OR RegSvcs.exe)"}
{"input": "", "instruction": "我想知道的是zeek捕获的发生在公司内网的 RDP 网络通信记录", "output": "event.category:(network OR network_traffic) AND network.transport:tcp AND (dst_port:3389 OR event.dataset:zeek.rdp) AND src_ip:( \"10.0.0.0/8\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" ) AND NOT dst_ip:( \"10.0.0.0/8\" OR \"127.0.0.0/8\" OR \"169.254.0.0/16\" OR \"172.16.0.0/12\" OR \"192.168.0.0/16\" OR \"224.0.0.0/4\" OR \"::1\" OR \"FE80::/10\" OR \"FF00::/8\" )"}
{"input": "", "instruction": "我想要知道系统启动时发生的事件，比如文件创建、进程启动等。你能帮我把这些信息从日志易中找出来吗？", "output": "event.category:process AND event_type:(start OR process_started) AND process:mknod"}
{"input": "", "instruction": "我想跟踪某种进程名叫 socat（是一个系统级的工具），并且在启动或运行这个进程时产生了事件。", "output": "event.category:process AND event_type:(start OR process_started) AND process:socat AND NOT process.args:-V"}
{"input": "", "instruction": "我正在寻找关于 Google Cloud Platform（GCP）中 Kubernetes 集群角色绑定创建、更新或删除操作的审计事件。", "output": "event.dataset:(googlecloud.audit OR gcp.audit) AND action:(io.k8s.authorization.rbac.v*.clusterrolebindings.create orio.k8s.authorization.rbac.v*.rolebindings.create OR io.k8s.authorization.rbac.v*.clusterrolebindings.patch orio.k8s.authorization.rbac.v*.rolebindings.patch) AND event.outcome:success AND NOT gcp.audit.authentication_info.principal_email:\"system:addon-manager\""}
{"input": "", "instruction": "我想知道strace进程启动和结束的信息。", "output": "event.category:process AND event_type:(start OR process_started) AND process:strace"}
{"input": "", "instruction": "我想知道的是发生了哪些事件以及这些事件中有没有某个特定的用户与其 ID 不匹配的问题。", "output": "event.agent_id_status:agent_id_mismatch"}
{"input": "", "instruction": "我想询问 sudoers 文件的修改情况", "output": "event.category:file AND event_type:change AND file.path:(/etc/sudoers* OR /private/etc/sudoers*)"}
{"input": "", "instruction": "搜索 AWS CloudTrail 事件数据集中包含 `aws.cloudtrail` 和 `iam.amazonaws.com` 提供程序的信息，同时该事件包含 `UpdateAssumeRolePolicy` 操作和 `MalformedPolicyDocumentException` 错误代码，并且结果为失败。", "output": "event.dataset:aws.cloudtrail AND event.provider:iam.amazonaws.com AND action:UpdateAssumeRolePolicy AND aws.cloudtrail.error_code:MalformedPolicyDocumentException AND event.outcome:failure"}
{"input": "", "instruction": "发生在 AWS CloudTrail 中的登录失败事件的数量和用户类型。", "output": "event.dataset:aws.cloudtrail AND event.provider:signin.amazonaws.com AND action:ConsoleLogin AND aws.cloudtrail.uidentity.type:Root AND event.outcome:failure"}
{"input": "", "instruction": "我想知道的是，在 AWS CloudTrail 服务中，最近有没有成功地执行过 Stop Logging 操作？", "output": "event.dataset:aws.cloudtrail AND event.provider:cloudtrail.amazonaws.com AND action:StopLogging AND event.outcome:success"}
{"input": "", "instruction": "使用 AWS CloudTrail 服务的 EC2 DeleteFlowLogs API 操作成功的事件数据。", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:DeleteFlowLogs AND event.outcome:success"}
{"input": "", "instruction": "我正在寻找 AWS CloudTrail 中关于 EC2 服务删除网络ACL 或 删除网络 ACL 条目的成功事件的信息。", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:(DeleteNetworkAcl OR DeleteNetworkAclEntry) AND event.outcome:success"}
{"input": "", "instruction": "在 Amazon Web Services CloudTrail 服务中，使用 GuardDuty 服务进行删除检测器操作时，操作结果为成功。", "output": "event.dataset:aws.cloudtrail AND event.provider:guardduty.amazonaws.com AND action:DeleteDetector AND event.outcome:success"}
{"input": "", "instruction": "云审计事件中有关EC2的API调用成功的情况。", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com ANDaction:(CreateTrafficMirrorFilter OR CreateTrafficMirrorFilterRule OR CreateTrafficMirrorSession OR CreateTrafficMirrorTarget) AND event.outcome:success"}
{"input": "", "instruction": "我想问 Amazon Web Services (AWS) 中创建 EC2 实例的导出任务失败的审计信息？", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:CreateInstanceExportTask AND event.outcome:failure"}
{"input": "", "instruction": "我想询问云审计中的某些事件的信息，具体来说就是关于删除日志组的操作的信息。", "output": "event.dataset:aws.cloudtrail AND event.provider:logs.amazonaws.com AND action:DeleteLogGroup AND event.outcome:success"}
{"input": "", "instruction": "我想询问云审计事件中是否存在与 Amazon EFS 有关的删除操作成功的记录。这类操作通常会涉及到用户在管理面板或 API 中手动或者自动删除文件系统、挂载点等资源导致的问题。", "output": "event.dataset:aws.cloudtrail AND event.provider:elasticfilesystem.amazonaws.com ANDaction:(DeleteMountTarget OR DeleteFileSystem) AND event.outcome:success"}
{"input": "", "instruction": "我正在寻找 AWS CloudTrail 中发生了多因素认证设备（MFA）被禁用的或删除事件且操作成功的相关记录。", "output": "event.dataset:aws.cloudtrail AND event.provider:iam.amazonaws.com AND action:(DeactivateMFADevice OR DeleteVirtualMFADevice) AND event.outcome:success"}
{"input": "", "instruction": "我正在寻找关于 AWS CloudTrail 服务中 IAM 用户删除用户组操作的成功事件的信息。", "output": "event.dataset:aws.cloudtrail AND event.provider:iam.amazonaws.com AND action:DeleteGroup AND event.outcome:success"}
{"input": "", "instruction": "我想要知道关于 AWS CloudTrail 和 Amazon KMS（Key Management Service）的操作记录，尤其是关停密钥和计划删除密钥这两种操作。", "output": "event.dataset:aws.cloudtrail AND event.provider:kms.amazonaws.com AND action:(\"DisableKey\" OR \"ScheduleKeyDeletion\") AND event.outcome:success"}
{"input": "", "instruction": "我正在寻找 AWS CloudTrail 中涉及到 RDS 删除活动的信息。", "output": "event.dataset:aws.cloudtrail AND event.provider:rds.amazonaws.com AND action:(DeleteDBCluster OR DeleteGlobalCluster OR DeleteDBInstance) AND event.outcome:success"}
{"input": "", "instruction": "我在寻找云审计中AWS Sign-In和密码恢复成功的事件。", "output": "event.dataset:aws.cloudtrail AND event.provider:signin.amazonaws.com AND action:PasswordRecoveryRequested AND event.outcome:success"}
{"input": "", "instruction": "在`aws.cloudtrail`数据集中，由`ec2.amazonaws.com`提供程序发出的操作为`(CreateNetworkAcl OR CreateNetworkAclEntry)`并且结果为成功的事件。", "output": "event.dataset:aws.cloudtrail AND event.provider:ec2.amazonaws.com AND action:(CreateNetworkAcl OR CreateNetworkAclEntry) AND event.outcome:success"}
{"input": "", "instruction": "我正在寻找 AWS CloudTrail 中关于 IAM 创建用户组操作的成功事件。", "output": "event.dataset:aws.cloudtrail AND event.provider:iam.amazonaws.com AND action:CreateGroup AND event.outcome:success"}
{"input": "", "instruction": "我想问的是 RDS 创建数据库集群时发生的事件，只提取 action 为 CreateDBCluster 或 CreateGlobalCluster 时成功的情况。", "output": "event.dataset:aws.cloudtrail AND event.provider:rds.amazonaws.com AND action:(CreateDBCluster OR CreateGlobalCluster) AND event.outcome:success"}
{"input": "", "instruction": "成功创建 RedShift 集群的 CloudTrail 事件。", "output": "event.dataset:aws.cloudtrail AND event.provider:redshift.amazonaws.com AND action:CreateCluster AND event.outcome:success"}
{"input": "", "instruction": "在 Amazon Web Services CloudTrail 中搜索 Route 53 服务禁用域名转移锁定操作的成功事件。", "output": "event.dataset:aws.cloudtrail AND event.provider:route53.amazonaws.com AND action:DisableDomainTransferLock AND event.outcome:success"}
{"input": "", "instruction": "过滤出所有由 AWS CloudTrail 产生、事件提供商为 signin.amazonaws.com（AWS 登录）、操作为 ConsoleLogin（控制台登录）、用户身份类型为 Root（根用户）并且未使用 MFA（多因素认证）的成功事件的 SIEM 查询语句。", "output": "event.dataset:aws.cloudtrail AND event.provider:signin.amazonaws.com AND action:ConsoleLogin AND aws.cloudtrail.uidentity.type:Root AND aws.cloudtrail.console_login.additional_eventdata.mfa_used:false AND event.outcome:success"}
{"input": "", "instruction": "寻找某些帐户通过STS（Security Token Service）服务假冒合法人身份而获得对AWS资源的访问权力的情况。", "output": "event.dataset:aws.cloudtrail AND event.provider:sts.amazonaws.com AND action:AssumedRole ANDaws.cloudtrail.uidentity.session_context.session_issuer.type:Role AND event.outcome:success"}
{"input": "", "instruction": "获取 IAM 用户通过 CloudTrail 使用 STS 服务获得的临时访问凭证的成功事件”。", "output": "event.dataset:aws.cloudtrail AND event.provider:sts.amazonaws.com AND action:GetSessionToken ANDaws.cloudtrail.uidentity.type:IAMUser AND event.outcome:success"}
{"input": "", "instruction": "我想要知道有关 Azure Event Hubs 的访问控制规则的更改情况。请提供这些信息。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我在寻找 Azure 活动日志中关于虚拟网络、 VPN 和数据包捕获操作的信息。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name: ( \"MICROSOFT.NETWORK/*/STARTPACKETCAPTURE/ACTION\" OR \"MICROSOFT.NETWORK/*/VPNCONNECTIONS/STARTPACKETCAPTURE/ACTION\" OR \"MICROSOFT.NETWORK/*/PACKETCAPTURES/WRITE\" ) ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "我要查找的是关于 Azure Key Vault 服务在某个数据集中执行写入操作时是否成功的信息。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.KEYVAULT/VAULTS/WRITE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道关于我的存储账户的访问密钥是否被重置了。你能帮我检查一下吗？我想看看该事件是否在 Azure 活动日志中出现过。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "搜索数据集为 Azure 审计记录的数据； 且操作名称等于“更新应用-证书和机密管理”； 且结果为“成功”。", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Update application - Certificates AND secrets management\" AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "我想要知道 Azure 上的哪些存储帐户正在进行管理所有权或修改权限的操作，并且这些操作是否成功完成。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:( \"MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MANAGEOWNERSHIP/ACTION\" OR \"MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MODIFYPERMISSIONS/ACTION\") AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想问有没有删除诊断设置的操作记录。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道 Event Hubs 是否被删除成功。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道关于 Azure 网络安全组的删除活动的信息。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道关于 Azure Front Door Web Application Firewall Policies 删除操作的详细信息。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.NETWORK/FRONTDOORWEBAPPLICATIONFIREWALLPOLICIES/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道Azure上Kubernetes 删除连接集群的事件。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE\" ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道Azure虚拟机的运行情况的信息。你能帮我把这些信息找出来吗？", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.COMPUTE/VIRTUALMACHINES/RUNCOMMAND/ACTION\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我在寻找 Azure 审计记录中添加服务主体凭据操作的成功或失败事件。", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Add service principal credentials\" AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "Azure上 Kubernetes 删除 Pod 操作的成功或失败事件。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/PODS/DELETE\" ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道关于我的 Azure 订阅中删除资源组的操作是否成功或失败。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我在寻找 Azure 活动日志中涉及虚拟网络资源（例如 NIC、TapConfiguration、VirtualHub 和 VirtualRouter）的所有写入和删除操作的事件。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:(\"MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/WRITE\" OR\"MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/DELETE\" OR \"MICROSOFT.NETWORK/NETWORKINTERFACES/WRITE\" OR\"MICROSOFT.NETWORK/NETWORKINTERFACES/JOIN/ACTION\" OR \"MICROSOFT.NETWORK/NETWORKINTERFACES/DELETE\" OR\"MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/DELETE\" OR \"MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/WRITE\" OR\"MICROSOFT.NETWORK/VIRTUALHUBS/DELETE\" OR \"MICROSOFT.NETWORK/VIRTUALHUBS/WRITE\" OR\"MICROSOFT.NETWORK/VIRTUALROUTERS/WRITE\" OR \"MICROSOFT.NETWORK/VIRTUALROUTERS/DELETE\") ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "我想知道在 Azure Active Directory 中发生了哪些高风险登录活动，并且这些登录活动是否成功完成。", "output": "event.dataset:azure.signinlogs AND (azure.signinlogs.properties.risk_level_during_signin:high OR azure.signinlogs.properties.risk_level_aggregated:high) AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "我想寻找关于 Azure 活动目录中的登录活动的信息。", "output": "event.dataset:azure.signinlogs AND azure.signinlogs.properties.risk_state:(\"confirmedCompromised\" OR \"atRisk\") AND event.outcome:(success OR Success)"}
{"input": "", "instruction": "我在 Azure 中有一个共享数据集，其中有一份名为 guest 的文件资源，并且最近一次对其进行操作的事件类型是邀请外部用户，而且操作是否成功或失败。", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Invite external user\" AND azure.auditlogs.properties.target_resources.*.display_name:guest AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想问的是 Azure 上的自动化账户有哪些操作会导致成功或者失败的事件。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name:\"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想询问有关在 Azure 中运行自动化 Runbook（工作簿）的活动记录事件的信息。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name: ( \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE\" OR \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE\" OR \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION\" ) AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道关于 Azure 自动化的一些信息，比如有哪些操作被执行了、成功或者失败了等等。你能帮我把这些信息找出来吗？", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name: ( \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION\" OR \"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE\" ) AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想询问的是 Azure 活动日志或审核日志中是否存在名为“更新条件访问策略”的操作且其结果为成功或者成功。", "output": "event.dataset:(azure.activitylogs OR azure.auditlogs) ANDaction:\"Update conditional access policy\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道关于 Azure 审计日志的详细信息，特别是与禁用强身份验证有关的信息。", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Disable Strong Authentication\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我想要知道关于 Azure 审计日志的一些信息，比如谁添加了某个服务主体的所有权等等。但是我不太清楚如何进行搜索和筛选。你能帮我吗？", "output": "event.dataset:azure.auditlogs AND azure.auditlogs.operation_name:\"Add owner to service principal\" AND event.outcome:(Success OR success)"}
{"input": "", "instruction": "我正在寻找关于 Azure 活动日志中对 Kubernetes 进行角色绑定更改（例如添加或删除角色）的成功和失败事件的信息。", "output": "event.dataset:azure.activitylogs AND azure.activitylogs.operation_name: (\"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLEBINDINGS/WRITE\" OR \"MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLEBINDINGS/WRITE\") ANDevent.outcome:(Success OR success)"}
{"input": "", "instruction": "询问的是谷歌云平台的审计记录中，在该项目下发生了谷歌云 Pub/Sub 服务发布主题操作并且成功完成的事件。", "output": "event.dataset:gcp.audit AND action:google.pubsub.v*.Publisher.CreateTopic AND event.outcome:success"}
{"input": "", "instruction": "我想问 GCP 审计事件，涉及到谷歌云计算平台中的防火墙规则创建或修改操作，具体来说，有一些用户使用了名为 `*.compute.firewalls.insert` 或 `google.appengine.*.Firewall.Create*Rule` 的 API 来对该服务进行了相应的访问和更改。", "output": "event.dataset:gcp.audit AND action:(*.compute.firewalls.insert OR google.appengine.*.Firewall.Create*Rule)"}
{"input": "", "instruction": "寻找关于谷歌云平台（GCP）审计 logs 中删除 Google Pub/Sub 订阅器的成功事件的信息。", "output": "event.dataset:gcp.audit AND action:google.pubsub.v*.Subscriber.DeleteSubscription AND event.outcome:success"}
{"input": "", "instruction": "我想要知道谁在 GCP 创建了一个新的角色并成功了。你能帮我把这些信息找出来吗？", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.CreateRole AND event.outcome:success"}
{"input": "", "instruction": "谁创建了一个 GCP 云平台的服务帐号密钥，并且该操作成功。就是谁在哪个时间点使用谁的身份信息（比如私人或公司）在 GCP 创建了一个新的服务账户密钥并完成了这个操作。", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.CreateServiceAccountKey AND event.outcome:success"}
{"input": "", "instruction": "在谷歌云审计中，有哪些操作会导致创建 GCP 服务帐户事件（action: google.iam.admin.v1.CreateServiceAccount）并且成功完成（event.outcome: success）。", "output": "event.dataset:gcp.audit AND action:google.iam.admin.v*.CreateServiceAccount AND event.outcome:success"}
{"input": "", "instruction": "我想问的是谁在使用谷歌云盘创建数据传输请求，并且操作的应用名包含“drive”。", "output": "event.dataset:\"google_workspace.admin\" AND action:\"CREATE_DATA_TRANSFER_REQUEST\" AND event.category:\"iam\" AND google_workspace.admin.application.name:Drive*"}
{"input": "", "instruction": "但我在寻找 Google Workspace 中对某用户进行解锁操作的相关事件记录。", "output": "event.dataset:google_workspace.admin AND event.category:iam AND action:UNSUSPEND_USER"}
{"input": "", "instruction": "我想询问 Google Workspace 中的某些事件的详细信息，这些事件涉及到角色分配和管理。根据提供的信息，我在寻找关于谷歌工作区中某个管理员被授予特定的管理权限的相关信息。", "output": "event.dataset:\"google_workspace.admin\" AND event.category:\"iam\" AND action:\"ASSIGN_ROLE\" AND google_workspace.event_type:\"DELEGATED_ADMIN_SETTINGS\" AND google_workspace.admin.role.name : *_ADMIN_ROLE"}
{"input": "", "instruction": "我想问有关谷歌工作区管理员在更改应用设置时进行的身份验证活动的相关信息。", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:(CHANGE_APPLICATION_SETTING OR CREATE_APPLICATION_SETTING) AND google_workspace.admin.setting.name:( \"Password Management - Enforce strong password\" OR \"Password Management - Password reset frequency\" OR \"Password Management - Enable password reuse\" OR \"Password Management - Enforce password policy at next login\" OR \"Password Management - Minimum password length\" OR \"Password Management - Maximum password length\" )"}
{"input": "", "instruction": "我在询问的是谁在使用谷歌云的管理员身份进行强制实施双因素认证（MFA），以及他们是否禁用了该功能。其中涉及到 ENForceStrongAuthentication 和 AllowStrongAuthentication 这两个操作和新值 false 的情况。", "output": "event.dataset:google_workspace.admin AND event.provider:admin AND event.category:iam AND action:(ENForCE_STRONG_AUTHENTICATION OR ALLOW_STRONG_AUTHENTICATION) AND google_workspace.admin.new_value:false"}
{"input": "", "instruction": "我的问题可能涉及到Kubernetes中的RBAC（Role-Based Access Control）机制。在这种机制下，用户可以通过向kube-apiserver发送请求来获取资源对象，而这些请求将被认证和授权。如果请求未经过身份验证或未获得适当的权限，则API服务器将拒绝该请求。", "output": "event.dataset:\"kubernetes.audit_logs\" AND kubernetes.audit.user.username:system\\:serviceaccount\\:* AND kubernetes.audit.annotations.authorization_k8s_io\\/decision:\"forbid\""}
{"input": "", "instruction": " Kubernetes 审计记录中涉及的执行命令（command）、创建资源（resource）等信息。", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.verb:\"create\" AND kubernetes.audit.objectRef.resource:\"pods\" AND kubernetes.audit.objectRef.subresource:\"exec\""}
{"input": "", "instruction": "我想问的是 Kubernetes 审计记录中，有没有创建、更新或修补 Pod 的请求，并且这些 Pod 的卷的主机路径包含某些特定的字符串（比如“/”或者“/var/run/docker.sock”）吗？但是不包括镜像为“docker.elastic.co/beats/elastic-agent:8.4.0”。", "output": "event.dataset : \"kubernetes.audit_logs\" AND kubernetes.audit.annotations.authorization_k8s_io/decision:\"allow\" AND kubernetes.audit.objectRef.resource:\"pods\" AND kubernetes.audit.verb:(\"create\" OR \"update\" OR \"patch\") AND kubernetes.audit.requestObject.spec.volumes.hostPath.path: (\"/\" OR \"/proc\" OR \"/root\" OR \"/var\" OR \"/var/run\" OR \"/var/run/docker.sock\" OR \"/var/run/crio/crio.sock\" OR \"/var/run/cri-dockerd.sock\" OR \"/var/lib/kubelet\" OR \"/var/lib/kubelet/pki\" OR \"/var/lib/docker/overlay2\" OR \"/etc\" OR \"/etc/kubernetes\" OR \"/etc/kubernetes/manifests\" OR \"/etc/kubernetes/pki\" OR \"/home/admin\") AND NOT kubernetes.audit.requestObject.spec.containers.image: (\"docker.elastic.co/beats/elastic-agent:8.4.0\")"}
{"input": "", "instruction": "我想问有关 Office 365 审核事件的相关信息吗？关于在 Exchange Online 中创建或修改收件箱规则时发生的成功和失败活动的信息。这类活动通常涉及将电子邮件发送到其他人、将其保存为附件或将其重定向到另一个位置。", "output": "event.dataset:o365.audit AND event.provider:Exchange ANDevent.category:web AND action:(\"New-InboxRule\" OR \"Set-InboxRule\") AND ( o365.audit.Parameters.ForwardTo:* OR o365.audit.Parameters.ForwardAsAttachmentTo:* OR o365.audit.Parameters.RedirectTo:* ) AND event.outcome:success"}
{"input": "", "instruction": "我在寻找 Azure Active Directory 和Exchange服务器上的用户登录失败或密码身份验证失败事件，并且不包含与以下错误代码相关的任何记录：“UserAccountNotFound、EntitlementGrantsNotFound、UserStrongAuthEnrollmentRequired、UserStrongAuthClientAuthNRequired和InvalidReplyTo”。", "output": "event.dataset:o365.audit AND event.provider:(AzureActiveDirectory OR Exchange) AND event.category:authentication AND action:(UserLoginFailed OR PasswordLogonInitialAuthUsingPassword) AND NOT o365.audit.LogonError:(UserAccountNotFound OR EntitlementGrantsNotFound OR UserStrongAuthEnrollmentRequired OR UserStrongAuthClientAuthNRequired OR InvalidReplyTo)"}
{"input": "", "instruction": "我在寻找 Azure Active Directory 中因 SsoArtifactInvalidOrExpired 错误而导致身份验证失败的事件记录。", "output": "event.dataset:o365.audit AND event.provider:AzureActiveDirectory AND event.category:authentication AND o365.audit.LogonError:\"SsoArtifactInvalidOrExpired\""}
{"input": "", "instruction": "我想要知道有关 Office 365 DLP（数据丢失防护）策略的删除活动的信息。", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"Remove-DlpPolicy\" AND event.outcome:success"}
{"input": "", "instruction": "我想问有关在 Office 365 中删除反恶意软件策略的操作的信息吗？", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"Remove-MalwareFilterPolicy\" AND event.outcome:success"}
{"input": "", "instruction": "我想询问 Exchange Online 中的 Office 365 审核事件数据集中是否存在与“删除恶意软件筛选器规则”或“禁用恶意软件筛选器规则”操作有关的成功事件。", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:(\"Remove-MalwareFilterRule\" OR \"Disable-MalwareFilterRule\") AND event.outcome:success"}
{"input": "", "instruction": "我想跟踪 Exchange Online 中的禁用安全附件规则的活动，这是对你的组织网络安全非常重要的一项操作。", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"Disable-SafeAttachmentRule\" AND event.outcome:success"}
{"input": "", "instruction": "我想问的是 Exchange 邮箱的审计功能是否开启成功？这个事件的结果显示为“成功”，这可能表明该功能已经启用并正常工作。", "output": "event.dataset:o365.audit AND event.provider:Exchange AND action:Set-MailboxAuditBypassAssociation AND event.outcome:success"}
{"input": "", "instruction": "我想要知道有关 Office 365 中的邮件流规则的成功或失败情况。", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"New-TransportRule\" AND event.outcome:success"}
{"input": "", "instruction": "我想问有关 Office 365 Exchange Online 中的反恶意软件 (Antiphishing) 规则管理活动的相关信息：- 数据集（dataset）名称为 o365.audit；- 提供程序（provider）名为 Exchange；- 类别（category）为 web；- 操作（action）包括 Remove-AntiPhishRule 和 Disable-AntiPhishRule；- 结果（outcome）为 success。", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:(\"Remove-AntiPhishRule\" OR \"Disable-AntiPhishRule\") AND event.outcome:success"}
{"input": "", "instruction": "我想问的是，在 Office 365 中有哪些操作会导致用户被禁止发送电子邮件吗？你能帮我列出一些例子吗？", "output": "event.dataset:o365.audit AND event.provider:SecurityComplianceCenter AND event.category:web AND action:\"User restricted from sending email\" AND event.outcome:success"}
{"input": "", "instruction": "有关 Office 365 安全与合规中心中报告电子邮件为恶意软件或钓鱼规则的信息。", "output": "event.dataset:o365.audit AND event.provider:SecurityComplianceCenter AND action:AlertTriggered AND rule.name:\"Email reported by user as malware OR phish\""}
{"input": "", "instruction": "我想表达的是“我在 OneDrive 中发现了一个文件感染病毒”。这是一个合法的搜索词组合，可以找到有关此类事件的详细信息。", "output": "event.dataset:o365.audit AND event.provider:OneDrive AND event_id:SharePointFileOperation AND action:FileMalwareDetected"}
{"input": "", "instruction": "以下内容：这意味着寻找与 Office 365 审核事件、提供程序为 SharePoint（文件共享）、代码为 SharePoint 文件操作和动作为恶意软件检测的文件相关的任何记录。", "output": "event.dataset:o365.audit AND event.provider:SharePoint AND event_id:SharePointFileOperation AND action:FileMalwareDetected"}
{"input": "", "instruction": "我想要知道有关 Office 365 中的管理角色分配的成功事件的信息？", "output": "event.dataset:o365.audit AND event.provider:Exchange AND event.category:web AND action:\"New-ManagementRoleAssignment\" AND event.outcome:success"}
{"input": "", "instruction": "：这是一个针对 Office 365 Azure Active Directory 添加全局管理员角色的事件查询语句。", "output": "event.dataset:o365.audit AND event_id:\"AzureActiveDirectory\" AND action:\"Add member to role.\" ANDo365.audit.ModifiedProperties.Role_DisplayName.NewValue:\"Global Administrator\""}
{"input": "", "instruction": "我想问的是 Skype for Business 或 Microsoft Teams 服务中是否有用户使用联合身份验证登录的情况，并且该操作是否成功。", "output": "event.dataset:o365.audit AND event.provider:(SkypeForBusiness OR MicrosoftTeams) ANDevent.category:web AND action:\"Set-CsTenantFederationConfiguration\" ANDo365.audit.Parameters.AllowFederatedUsers:True AND event.outcome:success"}
{"input": "", "instruction": "我想询问的是关于Okta系统中的用户多因素认证尝试绕过的事件数据集中是否存在某一类名为“event.dataset”、动作名称为“action”且值为“user.mfa.attempt_bypass”。", "output": "event.dataset:okta.system AND action:user.mfa.attempt_bypass"}
{"input": "", "instruction": "我想知道的是，在 Okta 中，当用户禁用某个应用时会触发哪些事件和行为呢？可以帮我把这些信息列举出来吗？", "output": "event.dataset:okta.system AND action:zone.deactivate"}
{"input": "", "instruction": "我想询问Okta安全事件数据集中是否存在与用户帐户解锁相关的系统电子邮件或短信发送活动。", "output": "event.dataset:okta.system AND action:(system.email.account_unlock.sent_message OR system.email.password_reset.sent_message OR system.sms.send_account_unlock_message OR system.sms.send_password_reset_message OR system.voice.send_account_unlock_call OR system.voice.send_password_reset_call OR user.account.unlock_token)"}
{"input": "", "instruction": "我在寻找关于 Okta 系统和应用生命周期管理（Deactivate）事件的数据集。", "output": "event.dataset:okta.system AND action:application.lifecycle.deactivate"}
{"input": "", "instruction": "我想要知道关于Okta系统中删除应用的事件的信息。", "output": "event.dataset:okta.system AND action:application.lifecycle.delete"}
{"input": "", "instruction": "Okta 系统的一些操作事件，比如用户创建、修改等。应该是：`Okta 系统应用生命周期更新`。", "output": "event.dataset:okta.system AND action:application.lifecycle.update"}
{"input": "", "instruction": "Okta 有哪些安全漏洞被发现了吗？", "output": "event.dataset:okta.system AND action:security.threat.detected"}
{"input": "", "instruction": "我想要知道关于 Okta 系统中组权限授予事件的信息。", "output": "event.dataset:okta.system AND action:group.privilege.grant"}
{"input": "", "instruction": "我在询问的是关于 Okta 安全事件数据集的用户权限授予活动的信息？", "output": "event.dataset:okta.system AND action:user.account.privilege.grant"}
{"input": "", "instruction": "我想跟踪某些 Linux 操作系统上名为 `iodine` 或 `iodined` 的进程的启动或运行事件。", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:(iodine OR iodined)"}
{"input": "", "instruction": "我想询问在 Linux 系统中使用 shred 命令删除文件时生成的事件的相关信息。", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:shred AND process.args:(\"-u\" OR \"--remove\" OR \"-z\" OR \"--zero\")"}
{"input": "", "instruction": "我想询问 Linux 系统中非 root 用户，在/tmp，/var/tmp或/dev/shm等临时目录下执行 chmod、chown、chattr 或 chgrp 命令时产生的安全事件。", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:(chmod OR chown OR chattr OR chgrp) AND process.working_directory:(\"/tmp\" OR \"/var/tmp\" OR \"/dev/shm\") AND NOT user.name:root"}
{"input": "", "instruction": "我想要知道系统启动时是否有 rmmod 和 sudo 命令或者 modprobe 和 sudo --remove 或 -r 命令被执行过。", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process.args:((rmmod AND sudo) OR (modprobe AND sudo AND (\"--remove\" OR \"-r\")))"}
{"input": "", "instruction": "使用 Linux 命令查看正在运行的进程是否尝试加载或卸载内核模块这些操作", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process.args:(kmod AND list AND sudo OR sudo AND (depmod OR lsmod OR modinfo))"}
{"input": "", "instruction": "涉及到 Linux 操作系统下的某个主机上发生了进程名为 hping、hping2 或 hping3 的启动或运行活动。", "output": "event.category:process AND appname:linux AND event_type:(start OR process_started) AND process:(hping OR hping2 OR hping3)"}
{"input": "", "instruction": "我想要知道主机的操作系统类型是否为 Linux，并且事件的动作是创建或文件创建事件，文件扩展名是 timer，文件路径包含 /etc/systemd/system、/usr/local/lib/systemd/system、/lib/systemd/system 和 /usr/lib/systemd/system，同时进程执行的文件不是 /usr/bin/dpkg、/usr/bin/dockerd 或 /bin/rpm。", "output": "appname : \"linux\" AND action : (\"creation\" OR \"file_create_event\") AND file.extension : \"timer\" ANDfile.path:(/etc/systemd/system/* OR /usr/local/lib/systemd/system/* OR /lib/systemd/system/* OR /usr/lib/systemd/system/* OR /home/*/.config/systemd/user/*) AND NOT process.executable : (\"/usr/bin/dpkg\" OR \"/usr/bin/dockerd\" OR \"/bin/rpm\")"}
{"input": "", "instruction": "检索满足以下条件的所有记录：1. 事件类别为“文件”。2. 主机操作系统类型为“Linux”。3. 不包括删除类型的事件。4. 文件路径包含字符串“/etc/ld.so.preload”。", "output": "event.category:file AND appname:linux AND NOT event_type:deletion AND file.path:\"/etc/ld.so.preload\""}
{"input": "", "instruction": "我想寻找一些 macOS 系统中与“默认值”或“mkpassdb”有关的进程启动事件、使用名为“ShadowHashData”或带有“-dump”参数的进程命令行参数的相关信息。", "output": "event.category:process AND appname:macos AND event_type:start AND process:(defaults OR mkpassdb) AND process.args:(ShadowHashData OR \"-dump\")"}
{"input": "", "instruction": "我想要知道系统启动时是否有某个进程正在运行，这个进程的名字叫 kcc（Copy Credentials Cache），并且在执行过程中会生成一些文件名以 copy_cred_cache 为前缀的文件。", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:kcc AND process.args:copy_cred_cache"}
{"input": "", "instruction": "帮我查找关于某次 Mac OS X sshd 服务启动的相关事件，具体包括：1、操作系统类型为 macOS；2、发生事件的类型为进程启动（`event_type:start`）；3、启动的进程名包含 `sshd-keygen-wrapper` （ssh 密钥生成器）和父进程名为 launchd（系统守护程序）。", "output": "event.category:process AND appname:macos AND event_type:start AND process:\"sshd-keygen-wrapper\" AND process.parent.name:launchd"}
{"input": "", "instruction": "macOS Catalina 中禁用系统完整性保护的操作记录。", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process.args:(spctl AND \"--master-disable\")"}
{"input": "", "instruction": "我想问的是，在 MacOS 下，有哪些操作会生成.zip 文件？而且不包括删除文件和系统事件。", "output": "event.category:file AND appname:macos AND NOT event_type:deletion AND file.name:~$*.zip AND appname:macos"}
{"input": "", "instruction": "我想询问 macOS 系统中使用 Kerberos 进行 TGS/TGT 票据或者 S4U2self 漏洞的进程启动事件。", "output": "event.category:process AND appname:macos AND event_type:start AND process.args:(\"-action\" AND (\"-kerberoast\" OR askhash OR asktgs OR asktgt OR s4u OR (\"-ticket\" AND ptt) OR (dump AND (tickets OR keytab))))"}
{"input": "", "instruction": "搜索 mac os 下的系统日志中包含 `dscl` 或 `dseditgroup` 命令且参数中有 `/Groups/admin` 或 `admin -a` 或 `admin -append` 的进程启动或登记事件。", "output": "event.category:process AND appname:macos AND event_type:(start OR process_started) AND process:(dscl OR dseditgroup) AND process.args:((\"/Groups/admin\" OR admin) AND (\"-a\" OR \"-append\"))"}
{"input": "", "instruction": "我想询问的是关于 macOS 系统中用户 at 服务的相关问题，具体包括以下几个方面：1、文件访问记录事件中 category 为 \"file\"，appname 为 \"macos\"；2、事件类型不为删除操作（event_type: deletion）；3、文件路径包含 \"/private/var/at/tabs/root\"；4、进程执行文件路径不是 \"/usr/bin/crontab\"。这是一个合格且规范的问题描述，希望能帮助到您。", "output": "event.category:file AND appname:macos AND NOT event_type:deletion AND file.path:\"/private/var/at/tabs/root\" AND NOT process.executable:\"/usr/bin/crontab\""}
{"input": "", "instruction": "跟踪使用 Windows PowerShell 命令 New-MailboxExportRequest 导出 Exchange Online 用户邮箱的行为。这条命令通常用于将用户邮箱数据转移到其他电子邮件系统或存储库中，可能存在安全隐患。", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : \"New-MailboxExportRequest\""}
{"input": "", "instruction": "我想问有 Windows 事件 ID 为 4738、API 名称为 wineventlog 和消息中包含“‘Don’t Require Preauth’ - Enabled”的安全日志记录的信息吗？", "output": "event_id:4738 AND winlog.api:\"wineventlog\" AND message:\"'Don't Require Preauth' - Enabled\""}
{"input": "", "instruction": "我想询问一段 Windows 系统的 PowerShell 进程产生的事件中是否存在通过 `sekurlsa` 和 `crypto` 模块获取凭证和证书的操作行为。", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text:( (DumpCreds AND DumpCerts) OR \"sekurlsa::logonpasswords\" OR (\"crypto::certificates\" AND \"CERT_SYSTEM_STORE_LOCAL_MACHINE\"))"}
{"input": "", "instruction": "我想询问的是关于 Windows 下 MSBuild.exe 创建远程线程的事件的信息。", "output": "process:MSBuild.exe AND appname:windows AND action:\"CreateRemoteThread detected (rule: CreateRemoteThread)\""}
{"input": "", "instruction": "我想知道在 Windows 系统中如何使用 PowerShell 查询事件管理器中的进程、主机操作系统类型和 PowerShell 文件脚本块文本（包含 Load 方法）等信息，同时排除用户标识为 S-1-5-18 的记录。", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( \"[System.Reflection.Assembly]::Load\" OR \"[Reflection.Assembly]::Load\" ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "我在寻找有关 Windows 系统中 PowerShell 使用的压缩流的信息。搜索条件包括：`event.category: process` 表示事件为进程相关；`appname: windows` 表示主机操作系统类型为 Windows；`powershell.file.script_block_text` 表示 PowerShell 文件脚本块文本包含以下内容之一：`System.IO.Compression.DeflateStream`，`System.IO.Compression.GzipStream`，`IO.Compression.DeflateStream`，或 `IO.Compression.GzipStream`。此外，还要求 Base64 解码后字符串包含 `(FromBase64String)` 。最后，排除用户 ID 为 `S-1-5-18` 或 `S-1-5-19` 的用户和文件目录为 `\"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\Downloads\"` 的记录。", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text:( ( \"System.IO.Compression.DeflateStream\" OR \"System.IO.Compression.GzipStream\" OR \"IO.Compression.DeflateStream\" OR \"IO.Compression.GzipStream\" ) AND FromBase64String ) AND NOT (uid:(\"S-1-5-18\" OR \"S-1-5-19\") AND current_directory:\"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\Downloads\")"}
{"input": "", "instruction": "在 Windows 操作系统上发生的进程事件中，包含 PowerShell 执行的脚本块 `\"TVqQAAMAAAAEAAAA\"`（base64编码后的字符串），并且不属于用户 `S-1-5-18`。", "output": "event.category:process AND appname:windows AND powershell.file.script_block_text : ( TVqQAAMAAAAEAAAA ) AND NOT uid : \"S-1-5-18\""}
{"input": "", "instruction": "我想询问某个特定的用户帐户（ID为 S-1-5-18）在其密码未过期之前被启用“不要过期密码”功能的相关信息。", "output": "action:\"modified-user-account\" AND winlog.api:\"wineventlog\" AND event_id:\"4738\" AND message:\"'Don't Expire Password' - Enabled\" AND NOT uid:\"S-1-5-18\""}
{"input": "", "instruction": "我想搜索事件类别为“驱动程序”、操作系统类型为Windows且动作为“加载”的记录。", "output": "event.category:\"driver\" AND appname:windows AND action:\"load\""}
{"input": "", "instruction": "我想问的是，谁在修改用户帐户，使用了什么权限，以及被允许委托访问哪些服务的Kerberos ticket。", "output": "action:modified-user-account AND event_id:4738 AND json.event_data.AllowedToDelegateTo:*krbtgt*"}
{"input": "", "instruction": "搜索系统和安全模块中发生的事件，并且这些事件涉及到添加用户帐户的操作或失败。", "output": "event.module:(\"system\" OR \"security\") AND winlog.api:\"wineventlog\" AND (event_id:\"4720\" OR action:\"added-user-account\")"}
{"input": "", "instruction": "希望搜索所有与某个服务安装有关的所有事件；需要将 ClientProcessID 或 ParentProcessID 字段设置为特定值（0）以便获取所需结果", "output": "action:\"service-installed\" AND (json.event_data.ClientProcessId:\"0\" OR json.event_data.ParentProcessId:\"0\")"}
